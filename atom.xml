<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>XiaoFeiğŸ¥</title>
  
  
  <link href="https://www.naste.top:1024/atom.xml" rel="self"/>
  
  <link href="https://www.naste.top:1024/"/>
  <updated>2023-06-07T12:46:57.571Z</updated>
  <id>https://www.naste.top:1024/</id>
  
  <author>
    <name>XiaoFeiğŸ¥</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Navicaté‡ç½®è¯•ç”¨æ—¶é—´</title>
    <link href="https://www.naste.top:1024/posts/1384618004.html"/>
    <id>https://www.naste.top:1024/posts/1384618004.html</id>
    <published>2023-06-07T08:17:31.000Z</published>
    <updated>2023-06-07T12:46:57.571Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h1><p>[TOC]</p><h1 id="åˆ›å»ºæ¸…ç†è¯•ç”¨ä¿¡æ¯bat"><a href="#åˆ›å»ºæ¸…ç†è¯•ç”¨ä¿¡æ¯bat" class="headerlink" title="åˆ›å»ºæ¸…ç†è¯•ç”¨ä¿¡æ¯bat"></a>åˆ›å»ºæ¸…ç†è¯•ç”¨ä¿¡æ¯bat</h1><blockquote><p><strong>åˆ›å»ºåç¼€ä¸º<code>.bat</code>æ ¼å¼æ–‡ä»¶</strong></p></blockquote><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> Delete HKEY_CURRENT_USER\Software\PremiumSoft\NavicatPremium\Registration[version and language]</span><br><span class="line"><span class="keyword">for</span> /f <span class="variable">%%i</span> <span class="keyword">in</span> (&#x27;&quot;REG QUERY &quot;HKEY_CURRENT_USER\Software\PremiumSoft\NavicatPremium&quot; /s | <span class="built_in">findstr</span> /L Registration&quot;&#x27;) <span class="keyword">do</span> (</span><br><span class="line">    reg delete <span class="variable">%%i</span> /va /f</span><br><span class="line">)</span><br><span class="line"><span class="built_in">echo</span>.</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> Delete Info folder under HKEY_CURRENT_USER\Software\Classes\CLSID</span><br><span class="line"><span class="keyword">for</span> /f <span class="variable">%%i</span> <span class="keyword">in</span> (&#x27;&quot;REG QUERY &quot;HKEY_CURRENT_USER\Software\Classes\CLSID&quot; /s | <span class="built_in">findstr</span> /E Info&quot;&#x27;) <span class="keyword">do</span> (</span><br><span class="line">    reg delete <span class="variable">%%i</span> /va /f</span><br><span class="line">)</span><br><span class="line"><span class="built_in">echo</span>.</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> Finish</span><br><span class="line"></span><br><span class="line"><span class="built_in">pause</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Navicaté‡ç½®è¯•ç”¨æ—¶é—´</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>è®¾è®¡æ¨¡å¼-å»ºé€ è€…æ¨¡å¼</title>
    <link href="https://www.naste.top:1024/posts/709379917.html"/>
    <id>https://www.naste.top:1024/posts/709379917.html</id>
    <published>2023-06-07T07:55:57.000Z</published>
    <updated>2023-06-08T13:14:00.812Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h1><p>[TOC]</p><h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><ul><li><a href="https://zhuanlan.zhihu.com/p/143101326">https://zhuanlan.zhihu.com/p/143101326</a></li><li><a href="https://zhuanlan.zhihu.com/p/58093669">https://zhuanlan.zhihu.com/p/58093669</a></li></ul><h1 id="ä»€ä¹ˆæ˜¯å»ºé€ è€…æ¨¡å¼"><a href="#ä»€ä¹ˆæ˜¯å»ºé€ è€…æ¨¡å¼" class="headerlink" title="ä»€ä¹ˆæ˜¯å»ºé€ è€…æ¨¡å¼"></a>ä»€ä¹ˆæ˜¯å»ºé€ è€…æ¨¡å¼</h1><p>å»ºé€ è€…æ¨¡å¼æ˜¯ä¸€ç§åˆ›å»ºå‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒå¯ä»¥å°†å¯¹è±¡çš„æ„å»ºä¸è¡¨ç¤ºåˆ†ç¦»å¼€æ¥ï¼Œä»¥ä¾¿ç›¸åŒçš„æ„å»ºè¿‡ç¨‹å¯ä»¥åˆ›å»ºä¸åŒçš„è¡¨ç¤ºå½¢å¼ã€‚å®ƒå…è®¸æ‚¨åˆ›å»ºå¤æ‚çš„å¯¹è±¡ï¼ŒåŒæ—¶å¯¹å…¶æ„å»ºè¿‡ç¨‹è¿›è¡Œç»†ç²’åº¦çš„æ§åˆ¶ã€‚</p><p>åœ¨è¯¥æ¨¡å¼ä¸­ï¼Œä¸€ä¸ªDirectorå¯¹è±¡è´Ÿè´£æ ¹æ®ç”¨æˆ·è¾“å…¥æŒ‡ç¤ºç”Ÿæˆæ­£ç¡®çš„äº§å“ã€‚è¯¥æ¨¡å¼é€šå¸¸ç”¨äºå¤„ç†å¤æ‚çš„å¯¹è±¡ï¼Œä¾‹å¦‚åŒ…å«å¤šä¸ªå­ç»„ä»¶ä»¥åŠéœ€è¦æ‰§è¡Œè®¸å¤šæ­¥éª¤çš„å¯¹è±¡ã€‚å»ºé€ è€…æ¨¡å¼æ ¹æ®å»ºé€ è¿‡ç¨‹ä¸åŒåˆ†ä¸ºæ ‡å‡†å»ºé€ è€…æ¨¡å¼å’Œæµå¼å»ºé€ è€…æ¨¡å¼ã€‚åœ¨æ ‡å‡†å»ºé€ è€…æ¨¡å¼ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨å¤šä¸ªæ–¹æ³•æ¥è®¾ç½®å»ºé€ æ­¥éª¤ï¼Œåœ¨æµå¼å»ºé€ è€…æ¨¡å¼ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨å®ç°é“¾å¼è°ƒç”¨çš„å•ä¸ªæ–¹æ³•æ¥è®¾ç½®æ­¥éª¤ã€‚</p><h2 id="å››ä¸ªè§’è‰²"><a href="#å››ä¸ªè§’è‰²" class="headerlink" title="å››ä¸ªè§’è‰²"></a>å››ä¸ªè§’è‰²</h2><p><img src="https://www.naste.top:9000/images/image-20230608205738300.png" alt="image-20230608205738300"></p><p><strong>Productï¼ˆäº§å“è§’è‰²ï¼‰ï¼š</strong> ä¸€ä¸ªå…·ä½“çš„äº§å“å¯¹è±¡ã€‚</p><p><strong>Builderï¼ˆæŠ½è±¡å»ºé€ è€…ï¼‰ï¼š</strong> åˆ›å»ºä¸€ä¸ªProductå¯¹è±¡çš„å„ä¸ªéƒ¨ä»¶æŒ‡å®šçš„æŠ½è±¡æ¥å£ã€‚</p><p><strong>ConcreteBuilderï¼ˆå…·ä½“å»ºé€ è€…ï¼‰ï¼š</strong> å®ç°æŠ½è±¡æ¥å£ï¼Œæ„å»ºå’Œè£…é…å„ä¸ªéƒ¨ä»¶ã€‚</p><p><strong>Directorï¼ˆæŒ‡æŒ¥è€…ï¼‰ï¼š</strong> æ„å»ºä¸€ä¸ªä½¿ç”¨Builderæ¥å£çš„å¯¹è±¡ã€‚å®ƒä¸»è¦æ˜¯ç”¨äºåˆ›å»ºä¸€ä¸ªå¤æ‚çš„å¯¹è±¡ã€‚å®ƒä¸»è¦æœ‰ä¸¤ä¸ªä½œç”¨ï¼Œä¸€æ˜¯ï¼šéš”ç¦»äº†å®¢æˆ·ä¸å¯¹è±¡çš„ç”Ÿäº§è¿‡ç¨‹ï¼ŒäºŒæ˜¯ï¼šè´Ÿè´£æ§åˆ¶äº§å“å¯¹è±¡çš„ç”Ÿäº§è¿‡ç¨‹ã€‚</p><blockquote><p>æ‹¿å…¶ä¸­ä¸¤ä¸ªå¥—é¤ä¸¾ä¾‹</p><p>å¥—é¤A:æ±‰å ¡ï¼Œè–¯æ¡ï¼Œå¤§é¸¡è…¿<br>å¥—é¤B:æ±‰å ¡ï¼Œè–¯æ¡ï¼Œå°é¸¡è…¿ï¼Œå°å¯ä¹ï¼Œå°æŠ«è¨</p><p>å…¶ä¸­è–¯æ¡å’Œæ±‰å ¡å¯å¤§å¯å°ï¼Œå¹¶ä¸”å¿…é¡»æœ‰ï¼Œ<br>å…¶å®ƒçš„éƒ½ä¸ºå›ºå®šå¤§å°ï¼Œä½†æ˜¯ä½ å¯ä»¥é€‰æ‹©æœ‰æˆ–æ²¡æœ‰</p></blockquote><h1 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h1><blockquote><p><strong>å½“ä¸€ä¸ªç±»çš„æ„é€ å‡½æ•°å‚æ•°ä¸ªæ•°è¶…è¿‡4ä¸ªï¼Œè€Œä¸”è¿™äº›å‚æ•°æœ‰äº›æ˜¯å¯é€‰çš„å‚æ•°ï¼Œè€ƒè™‘ä½¿ç”¨æ„é€ è€…æ¨¡å¼</strong></p></blockquote><p>è¿™ä¸ªå°±éå¸¸é‡è¦äº†ï¼Œå› ä¸ºå¦‚æœä½ å­¦äº†ä¸ªä¸œè¥¿ï¼Œéƒ½ä¸çŸ¥é“ç”¨æ¥è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Œä½ è¯´æœ‰ä»€ä¹ˆç”¨ï¼Ÿç†è§£ä½¿ç”¨åœºæ™¯çš„çš„é‡è¦æ€§è¦è¿œé«˜äºä½ æ˜¯ä¸æ˜¯ä¼šå®ç°è¿™ä¸ªæ¨¡å¼ï¼Œå› ä¸ºåªè¦ä½ çŸ¥é“ä»€ä¹ˆé—®é¢˜å¯ä»¥ä½¿ç”¨builderæ¨¡å¼æ¥è§£å†³ï¼Œé‚£ä½ å³ä½¿ä¸ä¼šå†™ï¼Œä¹Ÿå¯ä»¥åœ¨è°ƒæŸ¥ç›¸å…³èµ„æ–™åå®Œæˆã€‚<br>æˆ‘ä¸æƒ³è¯´ä¸€äº›å¤§è€Œæ­£ç¡®çš„æœ¯è¯­æ¥æŠŠä½ æè’™ï¼Œæˆ‘ä»¬åªé’ˆå¯¹å…·ä½“çš„é—®é¢˜ï¼Œè‡³äºå»¶å±•æ€§çš„æ€è€ƒï¼Œéšç€ä½ çŸ¥è¯†çš„å¢é•¿ï¼Œé€æ¸ä¼šæ˜ç™½çš„ã€‚</p><h1 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h1><p>KFCå¥—é¤æ¡ˆä¾‹ï¼šå‡å¦‚ç›®å‰KFCé‡Œé¢æœ‰å¾ˆå¤šä¸ªå¥—é¤</p><ul><li>åœ¨å¥—é¤é‡Œé¢æœ‰å¿…ç‚¹ï¼Œä¹Ÿæœ‰é€‰ç‚¹ï¼Œç„¶åæ¯ä¸ªå•å“åˆæœ‰å¤§å°ä¹‹åˆ†</li><li>å¿…ç‚¹ï¼šæ±‰å ¡ï¼ˆhamburgerï¼‰ï¼Œè–¯æ¡ï¼ˆchipsï¼‰</li><li>é€‰ç‚¹ï¼šé¸¡è…¿ï¼ˆchickenï¼‰ï¼Œå¯ä¹ï¼ˆcolaï¼‰ï¼ŒæŠ«è¨ï¼ˆpizzaï¼‰</li></ul><p>æˆ‘ä»¬å¦‚ä½•æ„æˆè¿™ä¹ˆå¤šå¥—é¤å®ä¾‹å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬ä¸ä½¿ç”¨å»ºé€ è€…æ¨¡å¼ä¹Ÿèƒ½æ„å»ºä»£ç ï¼Œä½†æ˜¯å»ºé€ è€…æ¨¡å¼ä¼šè®©ä»£ç çœ‹ä¸Šå»æ›´è£…é€¼ï¼Œä»£ç åˆ°åæœŸæ›´ç»“æ„åŒ–æ›´å®¹æ˜“ç»´æŠ¤å’Œæ‹“å±•</p><p>é¦–å…ˆæ„å»ºè¿™ä¸ªå®ä½“ç±»`KFC</p><h2 id="å®ä½“ç±»KFC"><a href="#å®ä½“ç±»KFC" class="headerlink" title="å®ä½“ç±»KFC"></a>å®ä½“ç±»KFC</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å®ä½“ç±»`KFC</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">KFC</span> &#123;</span><br><span class="line">    <span class="comment">//å¥—é¤å¿…ç‚¹</span></span><br><span class="line">    <span class="keyword">private</span> String hamburger;</span><br><span class="line">    <span class="keyword">private</span> String chips;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¥—é¤é€‰ç‚¹</span></span><br><span class="line">    <span class="keyword">private</span> String chicken;</span><br><span class="line">    <span class="keyword">private</span> String cola;</span><br><span class="line">    <span class="keyword">private</span> String pizza;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="éå»ºé€ è€…æ¨¡å¼ä»£ç "><a href="#éå»ºé€ è€…æ¨¡å¼ä»£ç " class="headerlink" title="éå»ºé€ è€…æ¨¡å¼ä»£ç "></a>éå»ºé€ è€…æ¨¡å¼ä»£ç </h2><p>æˆ‘ä»¬çš„æƒ³æ³•æ˜¯ä¸æ˜¯æŠ˜å æ„é€ å‡½æ•°æ¥åˆ›å»ºå®ä¾‹ï¼Œä¸‹é¢æ¥å°è¯•ä¸€ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å®ä½“ç±»`KFC</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">KFC</span> &#123;</span><br><span class="line">    <span class="comment">//å¥—é¤å¿…ç‚¹</span></span><br><span class="line">    <span class="keyword">private</span> String hamburger;</span><br><span class="line">    <span class="keyword">private</span> String chips;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¥—é¤é€‰ç‚¹</span></span><br><span class="line">    <span class="keyword">private</span> String chicken;</span><br><span class="line">    <span class="keyword">private</span> String cola;</span><br><span class="line">    <span class="keyword">private</span> String pizza;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¿…ç‚¹å¥—é¤A</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">KFC</span><span class="params">(String hamburger, String chips)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>(hamburger, chips, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¥—é¤B</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">KFC</span><span class="params">(String hamburger, String chips, String chicken)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>(hamburger, chips, chicken, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¥—é¤C</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">KFC</span><span class="params">(String hamburger, String chips, String chicken, String cola)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>(hamburger, chips, chicken, cola, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//......è¿˜æœ‰å¥½å¤šç§ç»„åˆæ–¹å¼ï¼Œä½ ä¼šå‘ç°ä½¿ç”¨æŠ˜å æ„é€ å‡½æ•°çš„æ–¹æ³•ååˆ†å¤æ‚</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//å…¨é€‰</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">KFC</span><span class="params">(String hamburger, String chips, String chicken, String cola, String pizza)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.hamburger = hamburger;</span><br><span class="line">        <span class="built_in">this</span>.chips = chips;</span><br><span class="line">        <span class="built_in">this</span>.chicken = chicken;</span><br><span class="line">        <span class="built_in">this</span>.cola = cola;</span><br><span class="line">        <span class="built_in">this</span>.pizza = pizza;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¼šå‘ç°ä½¿ç”¨æŠ˜å æ„é€ å‡½æ•°çš„æ–¹å¼å¾ˆå¤æ‚ï¼Œå¾ˆæ¶å¿ƒï¼Œä»£ç çœ‹éƒ½ä¸æƒ³çœ‹</p><p>é‚£ä¹ˆæœ‰äººä¼šæƒ³ï¼Œæˆ‘å¯ä»¥ä½¿ç”¨<code>set</code>æ–¹æ³•æ¥åˆ›å»ºï¼Œæˆ‘åªè¦ä¸€ä¸ªå¿…ç‚¹æ„é€ å°±å¥½äº†ï¼Œé‚£ç»§ç»­æ¨¡æ‹Ÿå’¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å®ä½“ç±»`KFC</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">KFC</span> &#123;</span><br><span class="line">    <span class="comment">//å¥—é¤å¿…ç‚¹</span></span><br><span class="line">    <span class="keyword">private</span> String hamburger;</span><br><span class="line">    <span class="keyword">private</span> String chips;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¥—é¤é€‰ç‚¹</span></span><br><span class="line">    <span class="keyword">private</span> String chicken;</span><br><span class="line">    <span class="keyword">private</span> String cola;</span><br><span class="line">    <span class="keyword">private</span> String pizza;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¿…ç‚¹</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">KFC</span><span class="params">(String hamburger, String chips)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.hamburger = hamburger;</span><br><span class="line">        <span class="built_in">this</span>.chips = chips;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//setæ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setChicken</span><span class="params">(String chicken)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.chicken = chicken;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCola</span><span class="params">(String cola)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.cola = cola;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPizza</span><span class="params">(String pizza)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.pizza = pizza;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å®ä¾‹åŒ–å¯¹è±¡ï¼Œä½ ä¼šå‘ç°è¿™ç§æ–¹å¼å°±å‹å¥½å¾ˆå¤š</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">KFC</span> <span class="variable">kfc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">KFC</span>(<span class="string">&quot;å¤§æ±‰å ¡&quot;</span>, <span class="string">&quot;å¤§è–¯æ¡&quot;</span>);</span><br><span class="line">        <span class="comment">//åŠ å°ä»½å¯ä¹</span></span><br><span class="line">        kfc.setCola(<span class="string">&quot;å°å¯ä¹&quot;</span>);</span><br><span class="line">        <span class="comment">//åŠ ä¸ªé¸¡è…¿</span></span><br><span class="line">        kfc.setChicken(<span class="string">&quot;å¤§é¸¡è…¿&quot;</span>);</span><br><span class="line">        System.out.println(kfc);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½ ä¼šå‘ç°ä½¿ç”¨<code>set</code>æ–¹å¼å°±å‹å¥½äº†å¾ˆå¤š</p><p>è¿™ä¸ªè™½ç„¶å‹å¥½äº†å¾ˆå¤šï¼Œä½†æ˜¯ä¹Ÿæœ‰ç‚¹å°æ¯›ç—…ï¼Œå°±æ˜¯ä½ <strong>setå¤ªéšæ„äº†ï¼Œæˆ‘å¯èƒ½è¿™ä¸ªå¥—é¤é‡Œé¢æ²¡æœ‰è¿™ä¸ªå•å“ï¼Œè€Œä½¿ç”¨setçš„äººå´ä¸çŸ¥é“</strong>ï¼Œé€ æˆé”™è¯¯çš„å¥—é¤å‡ºç°ï¼ã€‚</p><p>ä¸ºäº†è§£å†³ä¸Šé¢çš„ä¸¤ç§é—®é¢˜ï¼šä¸€ç§è®¾è®¡æ¨¡å¼è§£å†³ä¸€ç±»é—®é¢˜ï¼Œæ‰€ä»¥<strong>å»ºé€ è€…æ¨¡å¼</strong>å°±å‡ºç°äº†</p><h2 id="å»ºé€ è€…æ¨¡å¼ä»£ç "><a href="#å»ºé€ è€…æ¨¡å¼ä»£ç " class="headerlink" title="å»ºé€ è€…æ¨¡å¼ä»£ç "></a>å»ºé€ è€…æ¨¡å¼ä»£ç </h2><h3 id="äº§å“"><a href="#äº§å“" class="headerlink" title="äº§å“"></a>äº§å“</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * KFCäº§å“</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">KFC</span> &#123;</span><br><span class="line">    <span class="comment">//å¥—é¤å¿…ç‚¹</span></span><br><span class="line">    <span class="keyword">private</span> String hamburger;</span><br><span class="line">    <span class="keyword">private</span> String chips;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¥—é¤é€‰ç‚¹</span></span><br><span class="line">    <span class="keyword">private</span> String chicken;</span><br><span class="line">    <span class="keyword">private</span> String cola;</span><br><span class="line">    <span class="keyword">private</span> String pizza;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¿…ç‚¹</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">KFC</span><span class="params">(String hamburger, String chips)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.hamburger = hamburger;</span><br><span class="line">        <span class="built_in">this</span>.chips = chips;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//setæ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setChicken</span><span class="params">(String chicken)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.chicken = chicken;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCola</span><span class="params">(String cola)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.cola = cola;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPizza</span><span class="params">(String pizza)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.pizza = pizza;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;KFC&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;hamburger=&#x27;&quot;</span> + hamburger + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, chips=&#x27;&quot;</span> + chips + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, chicken=&#x27;&quot;</span> + chicken + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, cola=&#x27;&quot;</span> + cola + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, pizza=&#x27;&quot;</span> + pizza + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Builder"><a href="#Builder" class="headerlink" title="Builder"></a>Builder</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œè¡¨æ˜éœ€è¦å»ºé€ ä»€ä¹ˆï¼Œå¾—åˆ°ä»€ä¹ˆ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Builder</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setChicken</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setCola</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setPizza</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    KFC <span class="title function_">getKFC</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¥—é¤A"><a href="#å¥—é¤A" class="headerlink" title="å¥—é¤A"></a>å¥—é¤A</h3><p>æ­¤æ—¶åº”è¯¥æ³¨æ„ï¼Œè¿™ä¸ªæ—¶å€™è¿˜æ²¡æœ‰ç”Ÿäº§å¥—é¤ï¼Œåªæ˜¯å®šä¹‰å¥—é¤</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¥—é¤A</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConcreteBuilder1</span> <span class="keyword">implements</span> <span class="title class_">Builder</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> KFC kfc;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è¿™ä¸€æ­¥éå¸¸é‡è¦</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ConcreteBuilder1</span><span class="params">(String hamburger, String chips)</span> &#123;</span><br><span class="line">        kfc = <span class="keyword">new</span> <span class="title class_">KFC</span>(hamburger, chips);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setChicken</span><span class="params">()</span> &#123;</span><br><span class="line">        kfc.setChicken(<span class="string">&quot;å¤§é¸¡è…¿&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCola</span><span class="params">()</span> &#123;</span><br><span class="line">        kfc.setCola(<span class="literal">null</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;å¥—é¤Aé‡Œé¢æ²¡æœ‰å¯ä¹&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPizza</span><span class="params">()</span> &#123;</span><br><span class="line">        kfc.setPizza(<span class="literal">null</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;å¥—é¤Aé‡Œé¢æ²¡æœ‰æŠ«è¨&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> KFC <span class="title function_">getKFC</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> kfc;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¥—é¤B"><a href="#å¥—é¤B" class="headerlink" title="å¥—é¤B"></a>å¥—é¤B</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¥—é¤B</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConcreteBuilder2</span> <span class="keyword">implements</span> <span class="title class_">Builder</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> KFC kfc;</span><br><span class="line">    <span class="comment">//è¿™ä¸€æ­¥éå¸¸é‡è¦</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ConcreteBuilder2</span><span class="params">(String hamburger,String chips)</span>&#123;</span><br><span class="line">        kfc = <span class="keyword">new</span> <span class="title class_">KFC</span>(hamburger,chips);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setChicken</span><span class="params">()</span> &#123;</span><br><span class="line">        kfc.setChicken(<span class="string">&quot;å°é¸¡è…¿&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCola</span><span class="params">()</span> &#123;</span><br><span class="line">        kfc.setCola(<span class="string">&quot;å°å¯ä¹&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPizza</span><span class="params">()</span> &#123;</span><br><span class="line">        kfc.setPizza(<span class="string">&quot;å°æŠ«è¨&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> KFC <span class="title function_">getKFC</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> kfc;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Director"><a href="#Director" class="headerlink" title="Director"></a>Director</h3><blockquote><p><strong>çœŸæ­£çš„æ‰§è¡Œè€…ï¼Œè¿™é‡ŒæŠŠä»–å½“ä½œæœåŠ¡å‘˜ï¼Œæ­¤æ—¶ä½ åƒæœåŠ¡å‘˜ç‚¹é¤</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œè¡¨æ˜éœ€è¦å»ºé€ ä»€ä¹ˆï¼Œå¾—åˆ°ä»€ä¹ˆ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Builder</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setChicken</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setCola</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setPizza</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    KFC <span class="title function_">getKFC</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BuilderTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//å¥—é¤A</span></span><br><span class="line">        System.out.println(<span class="string">&quot;======å¥—é¤A======&quot;</span>);</span><br><span class="line">        <span class="type">Builder</span> <span class="variable">concreteBuilder1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConcreteBuilder1</span>(<span class="string">&quot;å¤§æ±‰å ¡&quot;</span>, <span class="string">&quot;å°è–¯æ¡&quot;</span>);</span><br><span class="line">        <span class="type">KFC</span> <span class="variable">kfc1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Director</span>().build(concreteBuilder1);</span><br><span class="line">        System.out.println(kfc1);</span><br><span class="line">        <span class="comment">//å¥—é¤B</span></span><br><span class="line">        System.out.println(<span class="string">&quot;======å¥—é¤B======&quot;</span>);</span><br><span class="line">        <span class="type">Builder</span> <span class="variable">concreteBuilder2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConcreteBuilder2</span>(<span class="string">&quot;å°æ±‰å ¡&quot;</span>, <span class="string">&quot;å°è–¯æ¡&quot;</span>);</span><br><span class="line">        <span class="type">KFC</span> <span class="variable">kfc2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Director</span>().build(concreteBuilder2);</span><br><span class="line">        System.out.println(kfc2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://www.naste.top:9000/images/image-20230608210618559.png" alt="image-20230608210618559"></p><p>åˆ°äº†è¿™é‡Œä½ è¿˜æ˜¯ä¼šè§‰å¾—æœ‰ç‚¹éº»çƒ¦ï¼Œä½ ä¼šå‘ç°ï¼Œå•å“å¯æœ‰å¯æ— çš„é€‰æ‹©ä¸Šé¢ä½ ååˆ†çš„è¢«åŠ¨ï¼Œä»£ç çœ‹ä¸Šå»ä¹Ÿå¾ˆæ€ªï¼Œå¦‚æœä½ ä¸‹æ¬¡æƒ³å…¨éƒ¨å•å“å…ˆé€‰ä¸Šï¼Œå†å»é€‰å¥—é¤çš„æ—¶å€™ï¼Œä½ åˆè¦æ–°å»ºä¸€ä¸ªæ–°çš„æŒ‡å¯¼è€…ã€‚</p><p>æˆ‘è§‰å¾—æ™®é€šçš„å»ºé€ è€…æ¨¡å¼ä¸é€‚åˆå‚æ•°çš„å¯æœ‰å¯æ— çš„é€‰æ‹©ï¼Œ<strong>æ™®é€šçš„å»ºé€ è€…æ¨¡å¼æ›´ä¾§é‡è°ƒæ§æ¬¡åº</strong>ï¼Œåœ¨æœ‰äº›æƒ…å†µä¸‹éœ€è¦ç®€åŒ–ç³»ç»Ÿç»“æ„</p><h2 id="ç®€åŒ–ç‰ˆçš„å»ºé€ è€…æ¨¡å¼"><a href="#ç®€åŒ–ç‰ˆçš„å»ºé€ è€…æ¨¡å¼" class="headerlink" title="ç®€åŒ–ç‰ˆçš„å»ºé€ è€…æ¨¡å¼"></a>ç®€åŒ–ç‰ˆçš„å»ºé€ è€…æ¨¡å¼</h2><h3 id="é‡‡ç”¨é“¾å¼ç¼–ç¨‹çš„æ–¹å¼"><a href="#é‡‡ç”¨é“¾å¼ç¼–ç¨‹çš„æ–¹å¼" class="headerlink" title="é‡‡ç”¨é“¾å¼ç¼–ç¨‹çš„æ–¹å¼"></a>é‡‡ç”¨é“¾å¼ç¼–ç¨‹çš„æ–¹å¼</h3><p>è¿™ç§æ¨¡å¼æ›´åŠ çµæ´»ï¼Œæ›´åŠ ç¬¦åˆå®šä¹‰</p><p>æ—¢ç„¶Directoræ˜¯å˜åŒ–çš„ï¼Œå¹¶ä¸”å…¶å®åœ¨ç”Ÿæ´»ä¸­æˆ‘ä»¬è‡ªå·±æœ¬èº«å°±æ˜¯Director,æ‰€ä»¥è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥<strong>æŠŠDirectorè¿™ä¸ªè§’è‰²å»æ‰</strong>ï¼Œå› ä¸ºæˆ‘ä»¬è‡ªèº«å°±æ˜¯æŒ‡å¯¼è€…</p><h3 id="äº§å“-1"><a href="#äº§å“-1" class="headerlink" title="äº§å“"></a>äº§å“</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å®ä½“ç±»`KFC</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">KFC</span> &#123;</span><br><span class="line">    <span class="comment">//å¥—é¤å¿…ç‚¹</span></span><br><span class="line">    <span class="keyword">private</span> String hamburger;</span><br><span class="line">    <span class="keyword">private</span> String chips;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¥—é¤é€‰ç‚¹</span></span><br><span class="line">    <span class="keyword">private</span> String chicken;</span><br><span class="line">    <span class="keyword">private</span> String cola;</span><br><span class="line">    <span class="keyword">private</span> String pizza;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">KFC</span><span class="params">(String hamburger,String chips)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.hamburger = hamburger;</span><br><span class="line">        <span class="built_in">this</span>.hamburger = chips;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setChicken</span><span class="params">(String chicken)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.chicken = chicken;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCola</span><span class="params">(String cola)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.cola = cola;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPizza</span><span class="params">(String pizza)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.pizza = pizza;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;KFC&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;hamburger=&#x27;&quot;</span> + hamburger + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, chips=&#x27;&quot;</span> + chips + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, chicken=&#x27;&quot;</span> + chicken + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, cola=&#x27;&quot;</span> + cola + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, pizza=&#x27;&quot;</span> + pizza + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æŠ½è±¡å»ºé€ è€…ï¼ˆBuilderï¼‰"><a href="#æŠ½è±¡å»ºé€ è€…ï¼ˆBuilderï¼‰" class="headerlink" title="æŠ½è±¡å»ºé€ è€…ï¼ˆBuilderï¼‰"></a>æŠ½è±¡å»ºé€ è€…ï¼ˆBuilderï¼‰</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œè¡¨æ˜éœ€è¦å»ºé€ ä»€ä¹ˆï¼Œå¾—åˆ°ä»€ä¹ˆ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Builder</span> &#123;</span><br><span class="line">    <span class="keyword">abstract</span> Builder <span class="title function_">setChicken</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">abstract</span> Builder <span class="title function_">setCola</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">abstract</span> Builder <span class="title function_">setPizza</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">abstract</span> KFC <span class="title function_">getKFC</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å…·ä½“å»ºé€ è€…-ConcreteBuilder"><a href="#å…·ä½“å»ºé€ è€…-ConcreteBuilder" class="headerlink" title="å…·ä½“å»ºé€ è€…(ConcreteBuilder)"></a>å…·ä½“å»ºé€ è€…(ConcreteBuilder)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConcreteBuilder</span> <span class="keyword">extends</span> <span class="title class_">Builder</span> &#123;</span><br><span class="line">    KFC kfc;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ConcreteBuilder</span><span class="params">(String hamburger,String chips)</span>&#123;</span><br><span class="line">        kfc = <span class="keyword">new</span> <span class="title class_">KFC</span>(hamburger,chips);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    Builder <span class="title function_">setChicken</span><span class="params">()</span> &#123;</span><br><span class="line">        kfc.setChicken(<span class="string">&quot;é¸¡è…¿&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    Builder <span class="title function_">setCola</span><span class="params">()</span> &#123;</span><br><span class="line">        kfc.setCola(<span class="string">&quot;å¯ä¹&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    Builder <span class="title function_">setPizza</span><span class="params">()</span> &#123;</span><br><span class="line">        kfc.setPizza(<span class="string">&quot;æŠ«è¨&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    KFC <span class="title function_">getKFC</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> kfc;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æµ‹è¯•-1"><a href="#æµ‹è¯•-1" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BuilderTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">KFC</span> <span class="variable">kfc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConcreteBuilder</span>(<span class="string">&quot;æ±‰å ¡&quot;</span>, <span class="string">&quot;è–¯æ¡&quot;</span>).setChicken().setCola().getKFC();</span><br><span class="line">        System.out.println(kfc);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://www.naste.top:9000/images/image-20230608211039517.png" alt="image-20230608211039517"></p><p>å¦‚æœä¸éœ€è¦æŠ½è±¡å»ºé€ è€…çš„è§’è‰²æ¥è§„å®šç”Ÿäº§å†…å®¹ï¼Œé‚£ä¹ˆä»£ç åˆ°è¿™é‡Œå…¶å®è¿˜æœ‰è¿›ä¸€æ­¥çš„ç®€åŒ–ç©ºé—´ã€‚</p><h2 id="ä½¿ç”¨é™æ€å†…éƒ¨ç±»çš„æ–¹å¼"><a href="#ä½¿ç”¨é™æ€å†…éƒ¨ç±»çš„æ–¹å¼" class="headerlink" title="ä½¿ç”¨é™æ€å†…éƒ¨ç±»çš„æ–¹å¼"></a>ä½¿ç”¨é™æ€å†…éƒ¨ç±»çš„æ–¹å¼</h2><blockquote><p><strong>è¿›ä¸€æ­¥ç®€åŒ–</strong></p></blockquote><h3 id="äº§å“-2"><a href="#äº§å“-2" class="headerlink" title="äº§å“"></a>äº§å“</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaofei.builder;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å®ä½“ç±»`KFC</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">KFC</span> &#123;</span><br><span class="line">    <span class="comment">//å¥—é¤å¿…ç‚¹</span></span><br><span class="line">    <span class="keyword">private</span> String hamburger;</span><br><span class="line">    <span class="keyword">private</span> String chips;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¥—é¤é€‰ç‚¹</span></span><br><span class="line">    <span class="keyword">private</span> String chicken;</span><br><span class="line">    <span class="keyword">private</span> String cola;</span><br><span class="line">    <span class="keyword">private</span> String pizza;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä¸€å®šè¦æœ‰ä¸€ä¸ªå¸¦æœ‰Builderå‚æ•°çš„å»ºé€ è€…</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">KFC</span><span class="params">(Builder builder)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.hamburger = builder.hamburger;</span><br><span class="line">        <span class="built_in">this</span>.chips = builder.chips;</span><br><span class="line">        <span class="built_in">this</span>.chicken = builder.chicken;</span><br><span class="line">        <span class="built_in">this</span>.cola = builder.cola;</span><br><span class="line">        <span class="built_in">this</span>.pizza = builder.pizza;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ³¨æ„å¿…é¡»ä¸ºé™æ€å†…éƒ¨ç±»</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Builder</span> &#123;</span><br><span class="line">        <span class="comment">//å¥—é¤å¿…ç‚¹</span></span><br><span class="line">        <span class="keyword">private</span> String hamburger;</span><br><span class="line">        <span class="keyword">private</span> String chips;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¥—é¤é€‰ç‚¹</span></span><br><span class="line">        <span class="keyword">private</span> String chicken;</span><br><span class="line">        <span class="keyword">private</span> String cola;</span><br><span class="line">        <span class="keyword">private</span> String pizza;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Builder</span><span class="params">(String hamburger, String chips)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.hamburger = hamburger;</span><br><span class="line">            <span class="built_in">this</span>.chips = chips;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Builder <span class="title function_">setChicken</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.chicken = <span class="string">&quot;å°é¸¡è…¿&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Builder <span class="title function_">setCola</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.cola = <span class="string">&quot;å°å¯ä¹&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Builder <span class="title function_">setPizza</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.pizza = <span class="string">&quot;å°æŠ«è¨&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç”Ÿæˆä¸€ä¸ªäº§å“</span></span><br><span class="line">        <span class="keyword">public</span> KFC <span class="title function_">getKFC</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">KFC</span>(<span class="built_in">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;KFC&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;hamburger=&#x27;&quot;</span> + hamburger + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, chips=&#x27;&quot;</span> + chips + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, chicken=&#x27;&quot;</span> + chicken + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, cola=&#x27;&quot;</span> + cola + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, pizza=&#x27;&quot;</span> + pizza + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æµ‹è¯•-2"><a href="#æµ‹è¯•-2" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BuilderTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">KFC</span> <span class="variable">kfc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">KFC</span>.Builder(<span class="string">&quot;å¤§æ±‰å ¡&quot;</span>, <span class="string">&quot;å°è–¯æ¡&quot;</span>).setChicken().setCola().getKFC();</span><br><span class="line">        System.out.println(kfc);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://www.naste.top:9000/images/image-20230608211250487.png" alt="image-20230608211250487"></p><h1 id="å»ºé€ è€…æ¨¡å¼å’ŒæŠ½è±¡å·¥å‚æ¨¡å¼çš„åŒºåˆ«"><a href="#å»ºé€ è€…æ¨¡å¼å’ŒæŠ½è±¡å·¥å‚æ¨¡å¼çš„åŒºåˆ«" class="headerlink" title="å»ºé€ è€…æ¨¡å¼å’ŒæŠ½è±¡å·¥å‚æ¨¡å¼çš„åŒºåˆ«"></a>å»ºé€ è€…æ¨¡å¼å’ŒæŠ½è±¡å·¥å‚æ¨¡å¼çš„åŒºåˆ«</h1><p>é€šè¿‡ä¸Šé¢çš„ä»£ç ï¼Œä½ å‘ç°æ™®é€šçš„å»ºé€ è€…æ¨¡å¼å’ŒæŠ½è±¡å·¥å‚æ¨¡å¼çœŸçš„å¾ˆåƒï¼Œåœ¨å»ºé€ è€…æ¨¡å¼ä¸­çš„builderè§’è‰²å¾ˆåƒè¶…çº§å·¥å‚ï¼Œç„¶åcontracterBuilderå¾ˆåƒå…·ä½“çš„å·¥å‚ï¼Œéƒ½æ˜¯è§„å®šäº†å»ºé€ çš„å†…å®¹</p><p>é‚£ä¹ˆå®ƒä»¬ä¹‹é—´ æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢</p><ul><li>å»ºé€ è€…æ¨¡å¼æœ‰æŒ‡å¯¼è€…è¿™ä¸ªè§’è‰²ï¼Œç›´æ¥è¿”å›ä¸€ä¸ªç»„è£…å¥½çš„äº§å“ï¼Œè€ŒæŠ½è±¡å·¥å‚æ¨¡å¼è¿”å›ä¸€ç³»åˆ—ç›¸å…³çš„äº§å“ï¼Œè¿™äº›äº§å“ä½äºä¸åŒçš„äº§å“ç­‰çº§ç»“æ„ï¼Œæ„æˆäº†ä¸€ä¸ªäº§å“æ—</li><li>å»ºé€ è€…æ¨¡å¼æ›´é€‚åˆå¤æ‚çš„äº§å“æ„å»º</li><li>å¯ä»¥å°†æŠ½è±¡å·¥å‚æ¨¡å¼ç†è§£æˆæ±½è½¦é›¶ä»¶ç”Ÿäº§å·¥å‚ï¼Œè€Œå»ºé€ è€…æ¨¡å¼çœ‹å‡ºç»„è£…å·¥å‚</li></ul><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>å­¦ä¹ ä¸€ç±»æŠ€å·§æ˜¯ä¸ºäº†è§£å†³ä¸€ç±»é—®é¢˜ï¼Œå­¦ä¹ è®¾è®¡æ¨¡å¼ä¸»è¦æ˜¯ä¸ºäº†ç†è§£å®ƒçš„æ€æƒ³ï¼Œå°†æ¥é‡åˆ°ä»£ç çš„ç¼–å†™ï¼Œä½¿ç”¨è¿™ç§æ¨¡å¼ä¼šæ›´åŠ çš„æ–¹å¼ï¼Œè€Œæ²¡æœ‰å¿…è¦åˆ»æ„çš„å»ä½¿ç”¨ï¼Œä½†æ˜¯éœ€è¦åˆ»æ„çš„å»ç»ƒä¹ ï¼Œå½¢æˆè¿™ç§æ€æƒ³</p><p>ä¼˜ç‚¹ï¼š</p><ul><li>å¤æ‚äº§å“çš„åˆ›å»ºæ­¥éª¤åˆ†è§£åœ¨ä¸åŒçš„æ–¹æ³•ä¸­ï¼Œè¿™äº›æ–¹æ³•å¯ä»¥è°ƒç”¨é¡ºåºä¸åŒï¼Œç»“æœä¸åŒï¼Œåˆ›å»ºç»“æœå¾ˆæ¸…æ™°</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>å¦‚æœäº§å“çš„å†…éƒ¨å˜åŒ–å¤æ‚ï¼Œå¯èƒ½ä¼šå¯¼è‡´éœ€è¦å®šä¹‰å¾ˆå¤šå…·ä½“å»ºé€ è€…æ¥å®ç°è¿™ç§å˜åŒ–ã€‚</li></ul>]]></content>
    
    
    <summary type="html">è®¾è®¡æ¨¡å¼-å»ºé€ è€…æ¨¡å¼</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>è®¾è®¡æ¨¡å¼-å•ä¾‹æ¨¡å¼</title>
    <link href="https://www.naste.top:1024/posts/1776793711.html"/>
    <id>https://www.naste.top:1024/posts/1776793711.html</id>
    <published>2023-06-07T06:24:15.000Z</published>
    <updated>2023-06-07T07:15:00.427Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h1><p>[TOC]</p><h1 id="ä»€ä¹ˆæ˜¯å•ä¾‹æ¨¡å¼"><a href="#ä»€ä¹ˆæ˜¯å•ä¾‹æ¨¡å¼" class="headerlink" title="ä»€ä¹ˆæ˜¯å•ä¾‹æ¨¡å¼"></a>ä»€ä¹ˆæ˜¯å•ä¾‹æ¨¡å¼</h1><p>å•ä¾‹è®¾è®¡æ¨¡å¼(Singleton Pattern)æ˜¯ä¸€ç§å¸¸ç”¨çš„è½¯ä»¶è®¾è®¡æ¨¡å¼ï¼Œå®ƒä¿è¯ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›ä¸€ä¸ªå…¨å±€è®¿é—®ç‚¹ã€‚è¿™ç§æ¨¡å¼åœ¨éœ€è¦ç¡®ä¿æŸä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹çš„æƒ…å†µä¸‹éå¸¸æœ‰ç”¨ï¼Œå¸¸ç”¨äºç®¡ç†å…±äº«èµ„æºæˆ–é™åˆ¶å¯¹è±¡çš„åˆ›å»ºã€‚</p><h1 id="å•ä¾‹æ¨¡å¼åº”ç”¨åœºæ™¯"><a href="#å•ä¾‹æ¨¡å¼åº”ç”¨åœºæ™¯" class="headerlink" title="å•ä¾‹æ¨¡å¼åº”ç”¨åœºæ™¯"></a>å•ä¾‹æ¨¡å¼åº”ç”¨åœºæ™¯</h1><ol><li>é…ç½®ç®¡ç†ï¼šåœ¨åº”ç”¨ç¨‹åºä¸­ï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨ä¸€äº›å…¨å±€çš„é…ç½®ä¿¡æ¯ï¼Œä¾‹å¦‚æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²ã€æ—¥å¿—çº§åˆ«ç­‰ã€‚è¿™äº›é…ç½®ä¿¡æ¯é€šå¸¸åªéœ€è¦ä¸€ä»½ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨å•ä¾‹æ¨¡å¼æ¥å®ç°ã€‚é€šè¿‡å•ä¾‹æ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶åˆ›å»ºä¸€ä¸ªå”¯ä¸€çš„å®ä¾‹ï¼Œå¹¶åœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­å…±äº«è¿™ä¸ªå®ä¾‹ã€‚è¿™æ ·å¯ä»¥é¿å…å¤šä¸ªçº¿ç¨‹æˆ–è¿›ç¨‹åŒæ—¶è®¿é—®å’Œä¿®æ”¹é…ç½®ä¿¡æ¯ï¼Œä»è€Œä¿è¯äº†é…ç½®ä¿¡æ¯çš„ä¸€è‡´æ€§å’Œå¯é æ€§ã€‚</li><li>æ—¥å¿—è®°å½•ï¼šåœ¨åº”ç”¨ç¨‹åºä¸­ï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨ä¸€ä¸ªå…¨å±€çš„æ—¥å¿—è®°å½•å™¨ï¼Œç”¨äºè®°å½•åº”ç”¨ç¨‹åºçš„è¿è¡Œæƒ…å†µå’Œé”™è¯¯ä¿¡æ¯ã€‚åŒæ ·åœ°ï¼Œåªéœ€è¦ä¸€ä»½æ—¥å¿—è®°å½•å™¨å³å¯ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨å•ä¾‹æ¨¡å¼æ¥å®ç°ã€‚é€šè¿‡å•ä¾‹æ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶åˆ›å»ºä¸€ä¸ªå”¯ä¸€çš„å®ä¾‹ï¼Œå¹¶åœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­å…±äº«è¿™ä¸ªå®ä¾‹ã€‚è¿™æ ·å¯ä»¥é¿å…å¤šä¸ªçº¿ç¨‹æˆ–è¿›ç¨‹åŒæ—¶è®¿é—®å’Œä¿®æ”¹æ—¥å¿—è®°å½•å™¨ï¼Œä»è€Œä¿è¯äº†æ—¥å¿—è®°å½•çš„ä¸€è‡´æ€§å’Œå¯é æ€§ã€‚</li><li>ç¼“å­˜ç®¡ç†ï¼šåœ¨åº”ç”¨ç¨‹åºä¸­ï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨ä¸€ä¸ªå…¨å±€çš„ç¼“å­˜ç³»ç»Ÿï¼Œç”¨äºç¼“å­˜ä¸€äº›æ•°æ®ä»¥æé«˜åº”ç”¨ç¨‹åºçš„æ€§èƒ½ã€‚åŒæ ·åœ°ï¼Œåªéœ€è¦ä¸€ä»½ç¼“å­˜ç³»ç»Ÿå³å¯ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨å•ä¾‹æ¨¡å¼æ¥å®ç°ã€‚é€šè¿‡å•ä¾‹æ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶åˆ›å»ºä¸€ä¸ªå”¯ä¸€çš„å®ä¾‹ï¼Œå¹¶åœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­å…±äº«è¿™ä¸ªå®ä¾‹ã€‚è¿™æ ·å¯ä»¥é¿å…å¤šä¸ªçº¿ç¨‹æˆ–è¿›ç¨‹åŒæ—¶è®¿é—®å’Œä¿®æ”¹ç¼“å­˜ç³»ç»Ÿï¼Œä»è€Œä¿è¯äº†ç¼“å­˜ç³»ç»Ÿçš„ä¸€è‡´æ€§å’Œå¯é æ€§ã€‚</li><li>èµ„æºç®¡ç†ï¼šåœ¨åº”ç”¨ç¨‹åºä¸­ï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨ä¸€äº›å…¨å±€çš„èµ„æºï¼Œä¾‹å¦‚æ–‡ä»¶å¥æŸ„ã€ç½‘ç»œè¿æ¥ç­‰ã€‚è¿™äº›èµ„æºé€šå¸¸åªéœ€è¦ä¸€ä»½ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨å•ä¾‹æ¨¡å¼æ¥å®ç°ã€‚é€šè¿‡å•ä¾‹æ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶åˆ›å»ºä¸€ä¸ªå”¯ä¸€çš„å®ä¾‹ï¼Œå¹¶åœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­å…±äº«è¿™ä¸ªå®ä¾‹ã€‚è¿™æ ·å¯ä»¥é¿å…å¤šä¸ªçº¿ç¨‹æˆ–è¿›ç¨‹åŒæ—¶è®¿é—®å’Œä¿®æ”¹èµ„æºï¼Œä»è€Œä¿è¯äº†èµ„æºçš„ä¸€è‡´æ€§å’Œå¯é æ€§ã€‚</li></ol><h1 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h1><h2 id="æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼ï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼‰"><a href="#æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼ï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼‰" class="headerlink" title="æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼ï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼‰"></a>æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼ï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼‰</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼ï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼‰</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LazySingleton</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ›å»ºä¸€ä¸ªç§æœ‰é™æ€å˜é‡instance,ç”¨äºå­˜å‚¨å•ä¾‹å¯¹è±¡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> LazySingleton instance;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†æ„é€ æ–¹æ³•è®¾ä¸ºç§æœ‰ï¼Œé˜²æ­¢å¤–éƒ¨åˆ›å»ºæ–°çš„å®ä¾‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">LazySingleton</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–å•ä¾‹å®ä¾‹çš„æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> LazySingleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœå®ä¾‹è¿˜æœªåˆ›å»ºï¼Œåˆ›å»ºä¸€ä¸ªæ–°å®ä¾‹è¿”å›</span></span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">            instance = <span class="keyword">new</span> <span class="title class_">LazySingleton</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰"><a href="#æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰" class="headerlink" title="æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰"></a>æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SafeLazySingleton</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ›å»ºä¸€ä¸ªç§æœ‰é™æ€å˜é‡instance,ç”¨äºå­˜å‚¨å•ä¾‹å¯¹è±¡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SafeLazySingleton instance;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†æ„é€ æ–¹æ³•è®¾ä¸ºç§æœ‰ï¼Œé˜²æ­¢å¤–éƒ¨åˆ›å»ºæ–°çš„å®ä¾‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">SafeLazySingleton</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–å•ä¾‹å®ä¾‹çš„æ–¹æ³•ï¼Œä½¿ç”¨ synchronized ä¿®é¥°ä»¥ä¿è¯çº¿ç¨‹å®‰å…¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> SafeLazySingleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœå®ä¾‹è¿˜æœªåˆ›å»ºï¼Œåˆ›å»ºä¸€ä¸ªæ–°å®ä¾‹è¿”å›</span></span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">            instance = <span class="keyword">new</span> <span class="title class_">SafeLazySingleton</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é¥¿æ±‰å¼å•ä¾‹æ¨¡å¼"><a href="#é¥¿æ±‰å¼å•ä¾‹æ¨¡å¼" class="headerlink" title="é¥¿æ±‰å¼å•ä¾‹æ¨¡å¼"></a>é¥¿æ±‰å¼å•ä¾‹æ¨¡å¼</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é¥¿æ±‰å¼å•ä¾‹æ¨¡å¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HungrySingleton</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç±»åŠ è½½æ—¶å°±åˆ›å»ºå•ä¾‹å®ä¾‹ï¼Œä½¿ç”¨ final ä¿®é¥°ä»¥ä¿è¯å®ä¾‹å”¯ä¸€æ€§</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">HungrySingleton</span> <span class="variable">instance</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HungrySingleton</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†æ„é€ æ–¹æ³•è®¾ä¸ºç§æœ‰ï¼Œé˜²æ­¢å¤–éƒ¨åˆ›å»ºæ–°çš„å®ä¾‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">HungrySingleton</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–å•ä¾‹å®ä¾‹çš„æ–¹æ³•ï¼Œç›´æ¥è¿”å›é¢„å…ˆåˆ›å»ºçš„å®ä¾‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> HungrySingleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åŒé‡æ£€æŸ¥é”å•ä¾‹æ¨¡å¼"><a href="#åŒé‡æ£€æŸ¥é”å•ä¾‹æ¨¡å¼" class="headerlink" title="åŒé‡æ£€æŸ¥é”å•ä¾‹æ¨¡å¼"></a>åŒé‡æ£€æŸ¥é”å•ä¾‹æ¨¡å¼</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åŒé‡æ£€æŸ¥é”å•ä¾‹æ¨¡å¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DoubleCheckSingleton</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ£€æŸ¥å®ä¾‹æ˜¯å¦å·²åˆ›å»ºçš„ volatile å˜é‡ï¼Œå¯è§æ€§ä¿è¯çº¿ç¨‹å®‰å…¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> DoubleCheckSingleton instance;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†æ„é€ æ–¹æ³•è®¾ä¸ºç§æœ‰ï¼Œé˜²æ­¢å¤–éƒ¨åˆ›å»ºæ–°çš„å®ä¾‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">DoubleCheckSingleton</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–å•ä¾‹å®ä¾‹çš„æ–¹æ³•ï¼Œä½¿ç”¨åŒé‡æ£€æŸ¥é”ä¿è¯çº¿ç¨‹å®‰å…¨å’Œæ€§èƒ½</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> DoubleCheckSingleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (DoubleCheckSingleton.class) &#123;</span><br><span class="line">                <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="comment">// å¦‚æœå®ä¾‹è¿˜æœªåˆ›å»ºï¼Œåˆ›å»ºä¸€ä¸ªæ–°å®ä¾‹è¿”å›</span></span><br><span class="line">                    instance = <span class="keyword">new</span> <span class="title class_">DoubleCheckSingleton</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é™æ€å†…éƒ¨ç±»å•ä¾‹æ¨¡å¼"><a href="#é™æ€å†…éƒ¨ç±»å•ä¾‹æ¨¡å¼" class="headerlink" title="é™æ€å†…éƒ¨ç±»å•ä¾‹æ¨¡å¼"></a>é™æ€å†…éƒ¨ç±»å•ä¾‹æ¨¡å¼</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é™æ€å†…éƒ¨ç±»å•ä¾‹æ¨¡å¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StaticInnerClassSingleton</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç§æœ‰æ„é€ å‡½æ•°ï¼Œé¿å…ç±»åœ¨å¤–éƒ¨è¢«å®ä¾‹åŒ–</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">StaticInnerClassSingleton</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é™æ€å†…éƒ¨ç±»æŒæœ‰å•ä¾‹å®ä¾‹ï¼Œç±»åŠ è½½æ—¶ä¸ä¼šè¿›è¡Œåˆå§‹åŒ–ã€‚</span></span><br><span class="line"><span class="comment">     * ç›´åˆ°ç¬¬ä¸€æ¬¡è·å–å®ä¾‹æ—¶æ‰åˆ›å»ºï¼Œå¹¶ç¡®ä¿å®ä¾‹åªè¢«åˆå§‹åŒ–ä¸€æ¬¡ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">StaticInnerClassSingleton</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StaticInnerClassSingleton</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿”å›å”¯ä¸€å®ä¾‹çš„æ–¹æ³•ï¼Œä½¿ç”¨é™æ€å†…éƒ¨ç±»ä¸­çš„INSTANCEè¿›è¡Œå®ä¾‹çš„è·å–ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> StaticInnerClassSingleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Singleton.INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æšä¸¾å•ä¾‹æ¨¡å¼"><a href="#æšä¸¾å•ä¾‹æ¨¡å¼" class="headerlink" title="æšä¸¾å•ä¾‹æ¨¡å¼"></a>æšä¸¾å•ä¾‹æ¨¡å¼</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æšä¸¾å•ä¾‹æ¨¡å¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">EnumSingleton</span> &#123;</span><br><span class="line">    INSTANCE;</span><br><span class="line">    <span class="type">int</span> value;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è‡ªå®šä¹‰æ„é€ å‡½æ•°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">EnumSingleton</span><span class="params">()</span> &#123;</span><br><span class="line">        value = <span class="number">1</span>;</span><br><span class="line">        System.out.println(<span class="string">&quot;INSTANCE now created!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getValue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setValue</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaofei.singleton;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å•ä¾‹æ¨¡å¼æµ‹è¯•</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SingletonTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">lazySingletonTest</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼ï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼‰&quot;</span>);</span><br><span class="line">        <span class="type">LazySingleton</span> <span class="variable">instance</span> <span class="operator">=</span> LazySingleton.getInstance();</span><br><span class="line">        System.out.println(instance);</span><br><span class="line">        System.out.println(<span class="string">&quot;æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼ï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼‰\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">safeLazySingleton</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰&quot;</span>);</span><br><span class="line">        <span class="type">SafeLazySingleton</span> <span class="variable">instance</span> <span class="operator">=</span> SafeLazySingleton.getInstance();</span><br><span class="line">        System.out.println(instance);</span><br><span class="line">        System.out.println(<span class="string">&quot;æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">hungrySingleton</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;é¥¿æ±‰å¼å•ä¾‹æ¨¡å¼&quot;</span>);</span><br><span class="line">        <span class="type">HungrySingleton</span> <span class="variable">instance</span> <span class="operator">=</span> HungrySingleton.getInstance();</span><br><span class="line">        System.out.println(instance);</span><br><span class="line">        System.out.println(<span class="string">&quot;é¥¿æ±‰å¼å•ä¾‹æ¨¡å¼\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doubleCheckSingleton</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;åŒé‡æ£€æŸ¥é”å•ä¾‹æ¨¡å¼&quot;</span>);</span><br><span class="line">        <span class="type">DoubleCheckSingleton</span> <span class="variable">instance</span> <span class="operator">=</span> DoubleCheckSingleton.getInstance();</span><br><span class="line">        System.out.println(instance);</span><br><span class="line">        System.out.println(<span class="string">&quot;åŒé‡æ£€æŸ¥é”å•ä¾‹æ¨¡å¼\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">staticInnerClassSingleton</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;é™æ€å†…éƒ¨ç±»å•ä¾‹æ¨¡å¼&quot;</span>);</span><br><span class="line">        <span class="type">StaticInnerClassSingleton</span> <span class="variable">instance</span> <span class="operator">=</span> StaticInnerClassSingleton.getInstance();</span><br><span class="line">        System.out.println(instance);</span><br><span class="line">        System.out.println(<span class="string">&quot;é™æ€å†…éƒ¨ç±»å•ä¾‹æ¨¡å¼\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">enumSingleton</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æšä¸¾å•ä¾‹æ¨¡å¼&quot;</span>);</span><br><span class="line">        <span class="type">EnumSingleton</span> <span class="variable">singleton</span> <span class="operator">=</span> EnumSingleton.INSTANCE;</span><br><span class="line">        System.out.println(singleton.getValue());</span><br><span class="line">        singleton.setValue(<span class="number">2</span>);</span><br><span class="line">        System.out.println(singleton.getValue());</span><br><span class="line">        System.out.println(<span class="string">&quot;æšä¸¾å•ä¾‹æ¨¡å¼\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://www.naste.top:9000/images/image-20230607151223998.png" alt="image-20230607151223998"></p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><ul><li>æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼(çº¿ç¨‹ä¸å®‰å…¨): <ul><li>ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œæ€§èƒ½å¥½ã€‚ </li><li>ç¼ºç‚¹ï¼šçº¿ç¨‹ä¸å®‰å…¨ï¼Œéœ€è¦åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹è¿›è¡ŒåŒæ­¥å¤„ç†ã€‚</li></ul></li><li>æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼(çº¿ç¨‹å®‰å…¨): <ul><li>ä¼˜ç‚¹ï¼šçº¿ç¨‹å®‰å…¨ï¼Œä¸éœ€è¦é¢å¤–çš„åŒæ­¥å¤„ç†ã€‚</li><li>ç¼ºç‚¹ï¼šå®ç°ç›¸å¯¹å¤æ‚ï¼Œæ€§èƒ½ç•¥å·®äºé¥¿æ±‰å¼å•ä¾‹æ¨¡å¼ã€‚</li></ul></li><li>é¥¿æ±‰å¼å•ä¾‹æ¨¡å¼ï¼š <ul><li>ä¼˜ç‚¹ï¼šçº¿ç¨‹å®‰å…¨ï¼Œæ€§èƒ½å¥½ã€‚ </li><li>ç¼ºç‚¹ï¼šåˆ›å»ºå®ä¾‹æ—¶ä¼šè€—è´¹ä¸€å®šçš„æ—¶é—´å’Œèµ„æºã€‚</li></ul></li><li>åŒé‡æ£€æŸ¥é”å•ä¾‹æ¨¡ï¼š <ul><li>ä¼˜ç‚¹ï¼šçº¿ç¨‹å®‰å…¨ï¼Œæ€§èƒ½å¥½ã€‚ </li><li>ç¼ºç‚¹ï¼šå®ç°ç›¸å¯¹å¤æ‚ã€‚</li></ul></li><li>é™æ€å†…éƒ¨ç±»å•ä¾‹æ¨¡å¼ï¼š <ul><li>ä¼˜ç‚¹ï¼šçº¿ç¨‹å®‰å…¨ï¼Œæ€§èƒ½å¥½ã€‚ </li><li>ç¼ºç‚¹ï¼šå®ç°ç›¸å¯¹å¤æ‚ã€‚</li></ul></li><li>æšä¸¾å•ä¾‹æ¨¡å¼ï¼š <ul><li>ä¼˜ç‚¹ï¼šçº¿ç¨‹å®‰å…¨ï¼Œæ€§èƒ½å¥½ã€‚ </li><li>ç¼ºç‚¹ï¼šæšä¸¾ç±»å‹æœ¬èº«ä¸èƒ½è¢«ä¿®æ”¹ï¼Œå› æ­¤å¦‚æœéœ€è¦æ‰©å±•åŠŸèƒ½åˆ™éœ€è¦ä¿®æ”¹æšä¸¾ç±»å‹ã€‚</li></ul></li></ul><p>ç»¼ä¸Šæ‰€è¿°ï¼Œä¸åŒçš„å•ä¾‹æ¨¡å¼é€‚ç”¨äºä¸åŒçš„åœºæ™¯ã€‚æ ¹æ®å®é™…çš„éœ€æ±‚é€‰æ‹©åˆé€‚çš„å•ä¾‹æ¨¡å¼å¯ä»¥æé«˜ç¨‹åºçš„æ•ˆç‡ï¼Œå¹¶ä¿è¯å•ä¾‹å®ä¾‹çš„å”¯ä¸€æ€§ã€‚</p>]]></content>
    
    
    <summary type="html">è®¾è®¡æ¨¡å¼-å•ä¾‹æ¨¡å¼</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>è®¾è®¡æ¨¡å¼-ä»£ç†æ¨¡å¼</title>
    <link href="https://www.naste.top:1024/posts/3822496321.html"/>
    <id>https://www.naste.top:1024/posts/3822496321.html</id>
    <published>2023-06-05T07:06:05.000Z</published>
    <updated>2023-06-06T08:57:28.492Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h1><p>[TOC]</p><h1 id="ä»€ä¹ˆæ˜¯ä»£ç†æ¨¡å¼"><a href="#ä»€ä¹ˆæ˜¯ä»£ç†æ¨¡å¼" class="headerlink" title="ä»€ä¹ˆæ˜¯ä»£ç†æ¨¡å¼"></a>ä»€ä¹ˆæ˜¯ä»£ç†æ¨¡å¼</h1><p>ä»£ç†è®¾è®¡æ¨¡å¼æ˜¯ä¸€ç§ç»“æ„å‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒå…è®¸ä½ æ§åˆ¶å¯¹ä¸€ä¸ªå¯¹è±¡çš„è®¿é—®ã€‚è¯¥æ¨¡å¼é€šè¿‡åœ¨å®¢æˆ·ç«¯å’Œç›®æ ‡å¯¹è±¡ä¹‹é—´åˆ›å»ºä¸€ä¸ªä»£ç†æ¥å®ç°è¿™ä¸€ç›®çš„ã€‚ä»£ç†å¯ä»¥æä¾›é¢å¤–çš„åŠŸèƒ½ï¼Œä¾‹å¦‚å®‰å…¨æ€§ã€ç¼“å­˜ã€æ—¥å¿—è®°å½•ç­‰ã€‚ä»£ç†å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°æ·»åŠ æˆ–åˆ é™¤åŠŸèƒ½ï¼Œä»è€Œä½¿ç³»ç»Ÿæ›´åŠ çµæ´»ã€‚</p><p>ä»£ç†æ¨¡å¼é€šå¸¸åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªè§’è‰²ï¼š</p><ol><li>æŠ½è±¡è§’è‰²ï¼šå®šä¹‰äº†ä»£ç†æ¥å£ï¼Œå¹¶æä¾›äº†ä¸€äº›åŸºæœ¬çš„æ–¹æ³•ã€‚</li><li>å§”æ‰˜è§’è‰²ï¼šå®ç°äº†æŠ½è±¡è§’è‰²ä¸­å®šä¹‰çš„æ–¹æ³•ï¼Œå¹¶æä¾›äº†ä¸ç›®æ ‡å¯¹è±¡ç›¸åŒçš„æ¥å£ã€‚</li><li>ç›®æ ‡è§’è‰²ï¼šè¢«ä»£ç†çš„å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯éœ€è¦è¢«ä¿æŠ¤æˆ–è€…æ§åˆ¶è®¿é—®çš„å¯¹è±¡ã€‚</li></ol><p>ä»£ç†æ¨¡å¼å¯ä»¥åˆ†ä¸ºé™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†ä¸¤ç§ç±»å‹ã€‚é™æ€ä»£ç†æ˜¯åœ¨ç¼–è¯‘æ—¶ç”Ÿæˆä»£ç†ç±»ï¼Œè€ŒåŠ¨æ€ä»£ç†æ˜¯åœ¨è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆä»£ç†ç±»ã€‚</p><h1 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h1><ol><li>è¿œç¨‹æ–¹æ³•è°ƒç”¨(Remote Method Invocation,RMI):åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå®¢æˆ·ç«¯å¯ä»¥é€šè¿‡ä»£ç†å¯¹è±¡æ¥è°ƒç”¨è¿œç¨‹å¯¹è±¡çš„æ–¹æ³•ã€‚</li><li>åŠ¨æ€ä»£ç†ï¼šåŠ¨æ€ä»£ç†å¯ä»¥åœ¨è¿è¡Œæ—¶ç”Ÿæˆä»£ç†å¯¹è±¡ï¼Œä»è€Œå®ç°æ›´çµæ´»çš„ä»£ç é‡ç”¨å’Œæ‰©å±•ã€‚</li><li>ç¼“å­˜ï¼šä»£ç†å¯ä»¥ç”¨äºç¼“å­˜æ•°æ®ï¼Œä»¥æé«˜æ€§èƒ½å¹¶å‡å°‘å¯¹æ•°æ®åº“æˆ–å…¶ä»–å­˜å‚¨ç³»ç»Ÿçš„è®¿é—®ã€‚</li><li>å®‰å…¨æ§åˆ¶ï¼šä»£ç†å¯ä»¥ç”¨äºå®ç°å®‰å…¨æ§åˆ¶ï¼Œä¾‹å¦‚ï¼Œä¸€ä¸ªä»£ç†æœåŠ¡å™¨å¯ä»¥æ£€æŸ¥å®¢æˆ·ç«¯çš„èº«ä»½éªŒè¯ä¿¡æ¯ï¼Œä»¥ç¡®ä¿åªæœ‰æˆæƒçš„ç”¨æˆ·æ‰èƒ½è®¿é—®å—ä¿æŠ¤çš„èµ„æºã€‚</li><li>æ—¥å¿—è®°å½•ï¼šä»£ç†å¯ä»¥ç”¨äºè®°å½•ç³»ç»Ÿçš„è¡Œä¸ºï¼Œä¾‹å¦‚ï¼Œä»£ç†æœåŠ¡å™¨å¯ä»¥è®°å½•æ‰€æœ‰è¢«ä»£ç†å¯¹è±¡çš„æ–¹æ³•è°ƒç”¨ã€‚</li><li>å¯¹è±¡æ± ï¼šä»£ç†å¯ä»¥ç”¨äºç®¡ç†å¯¹è±¡æ± ï¼Œä¾‹å¦‚ï¼Œä»£ç†æœåŠ¡å™¨å¯ä»¥ç»´æŠ¤ä¸€ç»„å¯¹è±¡çš„æ± ï¼Œå¹¶åœ¨éœ€è¦æ—¶ä»æ± ä¸­è·å–å¯¹è±¡è€Œä¸æ˜¯æ¯æ¬¡éƒ½åˆ›å»ºæ–°çš„å¯¹è±¡ã€‚</li><li>å»¶è¿ŸåŠ è½½ï¼šä»£ç†å¯ä»¥ç”¨äºå»¶è¿ŸåŠ è½½èµ„æºï¼Œä¾‹å¦‚ï¼Œå½“éœ€è¦ä½¿ç”¨æŸä¸ªèµ„æºæ—¶æ‰åŠ è½½å®ƒï¼Œè€Œä¸æ˜¯åœ¨ç¨‹åºå¯åŠ¨æ—¶å°±åŠ è½½ã€‚</li><li>å‘½ä»¤æ³¨å…¥ï¼šä»£ç†å¯ä»¥ç”¨äºæ³¨å…¥å‘½ä»¤ï¼Œä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªç³»ç»Ÿä¸­ï¼Œå®¢æˆ·ç«¯å¯ä»¥é€šè¿‡ä»£ç†å¯¹è±¡æ¥æ‰§è¡Œç‰¹å®šçš„å‘½ä»¤ã€‚</li><li>æ™ºèƒ½æŒ‡é’ˆï¼šæ™ºèƒ½æŒ‡é’ˆæ˜¯ä¸€ç§åŸºäºä»£ç†æ¨¡å¼å®ç°çš„æŒ‡é’ˆç±»å‹ï¼Œå®ƒå¯ä»¥è‡ªåŠ¨ç®¡ç†å†…å­˜å¹¶é¿å…å†…å­˜æ³„æ¼ã€‚</li><li>è£…é¥°å™¨æ¨¡å¼ï¼šè£…é¥°å™¨æ¨¡å¼ä¹Ÿå¯ä»¥é€šè¿‡ä»£ç†æ¥å®ç°ï¼Œä¾‹å¦‚ï¼Œä¸€ä¸ªè£…é¥°å™¨å¯ä»¥åŒ…è£…ä¸€ä¸ªå¯¹è±¡å¹¶æ·»åŠ é¢å¤–çš„åŠŸèƒ½ã€‚</li><li>ä¹°ç«è½¦ç¥¨ä¸ä¸€å®šåˆ°ç«è½¦ç«™ä¹°ï¼Œä¹Ÿå¯ä»¥å»ä»£å”®ç‚¹ã€‚</li><li>é“¶è¡Œå¡å’Œæ”¯ç¥¨éƒ½æ˜¯çœŸå®é’±çš„ä»£ç†å¯¹è±¡ã€‚</li></ol><h1 id="é™æ€ä»£ç†"><a href="#é™æ€ä»£ç†" class="headerlink" title="é™æ€ä»£ç†"></a>é™æ€ä»£ç†</h1><p>é™æ€ä»£ç†æ˜¯ä¸€ç§åœ¨<code>ä»£ç ç¼–å†™æœŸ</code>è¿›è¡Œä»£ç†ç±»å’Œè¢«ä»£ç†ç±»çš„å…³è”çš„ä»£ç†æ–¹å¼ã€‚</p><p>å…·ä½“å®ç°æ˜¯åˆ›å»ºä¸€ä¸ªä»£ç†ç±»ï¼Œé€šå¸¸éœ€è¦å®ç°ä¸è¢«ä»£ç†ç±»ç›¸åŒçš„æ¥å£æˆ–ç»§æ‰¿è¢«ä»£ç†ç±»ã€‚</p><p>æˆ¿ä¸œæ¥å£ç±»ï¼šLandlord1Serviceï¼Œæ³¨æ„ï¼Œé™æ€ä»£ç†å®ç°å®ƒçš„çœŸå®å¯¹è±¡åªèƒ½æœ‰ä¸€ä¸ªï¼Œå¤šä¸ªçš„è¯ï¼Œä»£ç†å¯¹è±¡ä¸èƒ½ç¡®å®šå“ªä¸ªå¯¹è±¡éœ€è¦è¢«ä»£ç†ï¼Œä¼šå¯¼è‡´æŠ¥é”™ï¼ŒJDKåŠ¨æ€ä»£ç†æ²¡è¿™ä¸ªé—®é¢˜ã€‚</p><h2 id="ä»£ç ç»“æ„"><a href="#ä»£ç ç»“æ„" class="headerlink" title="ä»£ç ç»“æ„"></a>ä»£ç ç»“æ„</h2><p><img src="https://www.naste.top:9000/images/image-20230606163813219.png" alt="image-20230606163813219"></p><h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><h3 id="æˆ¿ä¸œæ¥å£"><a href="#æˆ¿ä¸œæ¥å£" class="headerlink" title="æˆ¿ä¸œæ¥å£"></a>æˆ¿ä¸œæ¥å£</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æˆ¿ä¸œ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Landlord1Service</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‡ºç§Ÿ</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> money é‡‘é¢</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">rent</span><span class="params">(Integer money)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç§Ÿå®¢"><a href="#ç§Ÿå®¢" class="headerlink" title="ç§Ÿå®¢"></a>ç§Ÿå®¢</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç§Ÿå®¢</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TenantImpl</span> <span class="keyword">implements</span> <span class="title class_">Landlord1Service</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rent</span><span class="params">(Integer money)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ç§Ÿä¸‹&quot;</span> + money + <span class="string">&quot;å…ƒä¸€ä¸ªæœˆçš„æˆ¿å­&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä¸­ä»‹"><a href="#ä¸­ä»‹" class="headerlink" title="ä¸­ä»‹"></a>ä¸­ä»‹</h3><blockquote><p><strong>ä¸­ä»‹è¿™ä¸ªæ—¶å€™å°±ç›¸å½“äºä»£ç†</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¸­ä»‹</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Created by njy on 2023/5/30</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProxyImpl</span> <span class="keyword">implements</span> <span class="title class_">Landlord1Service</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æˆ¿ä¸œæœ‰å¾ˆå¤šå¥—æˆ¿å­ï¼Œä¸æƒ³äº²è‡ªå‡ºé©¬äº†ï¼Œäºæ˜¯æ‰¾æ¥äº†ä¸­ä»‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Landlord1Service target;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¼˜ç‚¹å°±æ˜¯åœ¨ä¸æ”¹å˜åŸæ¥çš„å®ç°ç±»çš„æƒ…å†µä¸‹å¯¹æ–¹æ³•å®ç°äº†å¢å¼º</span></span><br><span class="line"><span class="comment">     * ç¼ºç‚¹æ˜¯å¦‚æœåŸæ¥çš„æ¥å£æ–°å¢äº†æ–¹æ³•ï¼Œé‚£ä¹ˆè¿™é‡Œä¹Ÿè¦å¯¹åº”å®ç°æ–°çš„æ–¹æ³•</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> money é‡‘é¢</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rent</span><span class="params">(Integer money)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;[é™æ€ä»£ç†]äº¤ä¸­ä»‹è´¹&quot;</span>);</span><br><span class="line">        target.rent(money);</span><br><span class="line">        System.out.println(<span class="string">&quot;[é™æ€ä»£ç†]ä¸­ä»‹è´Ÿè´£ç»´ä¿®ç®¡ç†&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestProxy</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç§Ÿå®¢</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> TenantImpl tenant;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¸­ä»‹-ä»£ç†</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ProxyImpl proxy;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//1.é™æ€ä»£ç†</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">TestStatic</span><span class="params">()</span> &#123;</span><br><span class="line">        tenant.rent(<span class="number">1000</span>);</span><br><span class="line">        System.out.println();</span><br><span class="line">        proxy.rent(<span class="number">2000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://www.naste.top:9000/images/image-20230606163616461.png" alt="image-20230606163616461"></p><h3 id="é™æ€ä»£ç†åº”ç”¨åœºæ™¯"><a href="#é™æ€ä»£ç†åº”ç”¨åœºæ™¯" class="headerlink" title="é™æ€ä»£ç†åº”ç”¨åœºæ™¯"></a>é™æ€ä»£ç†åº”ç”¨åœºæ™¯</h3><p>é€‚ç”¨åœºæ™¯ï¼š</p><ol><li>å½“ä»£ç†å¯¹è±¡åªæœ‰ä¸€ä¸ªæ—¶ï¼Œå¯ä»¥ä½¿ç”¨é™æ€ä»£ç†</li><li>å½“è¢«ä»£ç†çš„ç±»çš„æ¥å£æ¯”è¾ƒç¨³å®šæ—¶ï¼Œå¯ä»¥ä½¿ç”¨é™æ€ä»£ç†</li><li>å½“éœ€è¦ä¸ºå¤šä¸ªè¢«ä»£ç†çš„ç±»æä¾›ä»£ç†æ—¶ï¼Œä¼šå¯¼è‡´ä»£ç†ç±»è¿‡å¤šï¼Œä¸æ–¹ä¾¿ç®¡ç†å’Œç»´æŠ¤ï¼Œæ‰€ä»¥ä¸å»ºè®®ä½¿ç”¨é™æ€ä»£ç†ã€‚</li></ol><h1 id="JDKåŠ¨æ€ä»£ç†"><a href="#JDKåŠ¨æ€ä»£ç†" class="headerlink" title="JDKåŠ¨æ€ä»£ç†"></a>JDKåŠ¨æ€ä»£ç†</h1><p>JDKåŠ¨æ€ä»£ç†æ˜¯ä¸€ç§æ¯”è¾ƒå¸¸è§çš„ä»£ç†æ–¹å¼ï¼Œå®ƒæ˜¯åœ¨ç¨‹åºè¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆä»£ç†ç±»ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬åœ¨ç¼–å†™ä»£ç æ—¶å¹¶ä¸çŸ¥é“å…·ä½“ä»£ç†çš„æ˜¯ä»€ä¹ˆç±»ï¼Œè€Œæ˜¯åœ¨ç¨‹åºè¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆã€‚</p><h2 id="ä»£ç ç»“æ„-1"><a href="#ä»£ç ç»“æ„-1" class="headerlink" title="ä»£ç ç»“æ„"></a>ä»£ç ç»“æ„</h2><p><img src="https://www.naste.top:9000/images/image-20230606164651902.png" alt="image-20230606164651902"></p><h2 id="ä»£ç -1"><a href="#ä»£ç -1" class="headerlink" title="ä»£ç "></a>ä»£ç </h2><h3 id="æˆ¿ä¸œæ¥å£-1"><a href="#æˆ¿ä¸œæ¥å£-1" class="headerlink" title="æˆ¿ä¸œæ¥å£"></a>æˆ¿ä¸œæ¥å£</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æˆ¿ä¸œ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Landlord2Service</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‡ºç§Ÿ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">rent</span><span class="params">(Integer money)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç§Ÿå®¢1"><a href="#ç§Ÿå®¢1" class="headerlink" title="ç§Ÿå®¢1"></a>ç§Ÿå®¢1</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç§Ÿå®¢1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Teant1Impl</span> <span class="keyword">implements</span> <span class="title class_">Landlord2Service</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rent</span><span class="params">(Integer money)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;tenant1ç§Ÿä¸‹&quot;</span> + money + <span class="string">&quot;å…ƒä¸€ä¸ªæœˆçš„æˆ¿å­&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç§Ÿå®¢2"><a href="#ç§Ÿå®¢2" class="headerlink" title="ç§Ÿå®¢2"></a>ç§Ÿå®¢2</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç§Ÿå®¢2</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Tenant2Impl</span> <span class="keyword">implements</span> <span class="title class_">Landlord2Service</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rent</span><span class="params">(Integer money)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;tenant2ç§Ÿä¸‹&quot;</span> + money + <span class="string">&quot;å…ƒä¸€ä¸ªæœˆçš„æˆ¿å­&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä¸­ä»‹-1"><a href="#ä¸­ä»‹-1" class="headerlink" title="ä¸­ä»‹"></a>ä¸­ä»‹</h3><blockquote><p><strong>ä¸­ä»‹â€”åŠ¨æ€ä»£ç†ç±»</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * JDKåŠ¨æ€ä»£ç†ï¼šå°±æ˜¯æŠŠä»£ç†æŠ½è±¡äº†ä¸€ä¸‹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JDKProxy</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Object target;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">JDKProxy</span><span class="params">(Object target)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.target = target;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç»™ç›®æ ‡å¯¹è±¡ç”Ÿæˆä»£ç†å¯¹è±¡</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> ä»£ç†ç”Ÿæˆçš„å¯¹è±¡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getProxyInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Proxy.newProxyInstance(target.getClass().getClassLoader(),</span><br><span class="line">                target.getClass().getInterfaces(),</span><br><span class="line">                <span class="comment">//è¿™é‡Œæ˜¯è¦å®ç°jdkä»£ç†InvocationHandlerçš„æ¥å£ï¼Œlambdaè¡¨è¾¾å¼</span></span><br><span class="line">                (proxy, method, args) -&gt; &#123;</span><br><span class="line">                    <span class="comment">//æ‰§è¡Œå¯¹è±¡æ–¹æ³•</span></span><br><span class="line">                    System.out.println(<span class="string">&quot;[JDKåŠ¨æ€ä»£ç†]äº¤ä¸­ä»‹è´¹&quot;</span>);</span><br><span class="line">                    method.invoke(target, args);</span><br><span class="line">                    System.out.println(<span class="string">&quot;[JDKåŠ¨æ€ä»£ç†]ä¸­ä»‹è´Ÿè´£ç»´ä¿®ç®¡ç†&quot;</span>);</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">                &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æµ‹è¯•-1"><a href="#æµ‹è¯•-1" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.xiaofei.proxy.jdkProxy.JDKProxy;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.proxy.jdkProxy.Landlord2Service;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.proxy.jdkProxy.Teant1Impl;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.proxy.jdkProxy.Tenant2Impl;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * JDKåŠ¨æ€ä»£ç†æµ‹è¯•</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JDKProxyTest</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Teant1Impl teant1;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Tenant2Impl tenant2;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.JDKåŠ¨æ€ä»£ç†</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">TestJDK</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Landlord2Service</span> <span class="variable">proxyInstance1</span> <span class="operator">=</span> (Landlord2Service) <span class="keyword">new</span> <span class="title class_">JDKProxy</span>(teant1).getProxyInstance();</span><br><span class="line">        proxyInstance1.rent(<span class="number">2500</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println();</span><br><span class="line">        <span class="type">Landlord2Service</span> <span class="variable">proxyInstance2</span> <span class="operator">=</span> (Landlord2Service) <span class="keyword">new</span> <span class="title class_">JDKProxy</span>(tenant2).getProxyInstance();</span><br><span class="line">        proxyInstance2.rent(<span class="number">2500</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://www.naste.top:9000/images/image-20230606164538352.png" alt="image-20230606164538352"></p><h3 id="JDKåŠ¨æ€ä»£ç†åº”ç”¨åœºæ™¯"><a href="#JDKåŠ¨æ€ä»£ç†åº”ç”¨åœºæ™¯" class="headerlink" title="JDKåŠ¨æ€ä»£ç†åº”ç”¨åœºæ™¯"></a>JDKåŠ¨æ€ä»£ç†åº”ç”¨åœºæ™¯</h3><ol><li>å¯¹è±¡å¿…é¡»å®ç°ä¸€ä¸ªæˆ–å¤šä¸ªæ¥å£</li><li>ä»£ç†ç±»çš„ä»£ç†æ–¹æ³•ä¸éœ€è¦é¢å¤–çš„é€»è¾‘</li></ol><h1 id="Cglibä»£ç†"><a href="#Cglibä»£ç†" class="headerlink" title="Cglibä»£ç†"></a>Cglibä»£ç†</h1><p>CGLIBä»£ç†æ˜¯åœ¨è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆä»£ç†ç±»çš„æ–¹å¼ï¼Œå®ƒä½¿ç”¨çš„åº“æ˜¯cglibï¼Œå’ŒJDKä»£ç†ç›¸æ¯”ï¼Œå®ƒä¸æ˜¯åŠ¨æ€çš„ç”Ÿæˆä¸€ä¸ªå®ç°äº†æ¥å£çš„ä»£ç†ç±»ï¼Œè€Œæ˜¯ç›´æ¥åœ¨å†…å­˜ä¸­æ„å»ºä¸€ä¸ªè¢«ä»£ç†ç±»çš„å­ç±»ï¼Œå¹¶é‡å†™çˆ¶ç±»çš„æ–¹æ³•æ¥è¿›è¡Œä»£ç†ã€‚</p><h2 id="ä»£ç ç»“æ„-2"><a href="#ä»£ç ç»“æ„-2" class="headerlink" title="ä»£ç ç»“æ„"></a>ä»£ç ç»“æ„</h2><h2 id="ä»£ç -2"><a href="#ä»£ç -2" class="headerlink" title="ä»£ç "></a>ä»£ç </h2><h3 id="æˆ¿ä¸œ"><a href="#æˆ¿ä¸œ" class="headerlink" title="æˆ¿ä¸œ"></a>æˆ¿ä¸œ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æˆ¿ä¸œ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Landlord3Service</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‡ºç§Ÿæˆ¿å±‹</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> money</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rent</span><span class="params">(Integer money)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ç§Ÿä¸‹&quot;</span> + money + <span class="string">&quot;å…ƒä¸€ä¸ªæœˆçš„æˆ¿å­&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Cglibä»£ç†-1"><a href="#Cglibä»£ç†-1" class="headerlink" title="Cglibä»£ç†"></a>Cglibä»£ç†</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.cglib.proxy.Enhancer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cglib.proxy.MethodInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cglib.proxy.MethodProxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * JDKProxyï¼šcglibå­ç±»ä»£ç†å·¥å‚</span></span><br><span class="line"><span class="comment"> * 1.ä»£ç†çš„ç±»ä¸èƒ½ä¸ºfinal</span></span><br><span class="line"><span class="comment"> * 2.ç›®æ ‡å¯¹è±¡çš„æ–¹æ³•å¦‚æœä¸ºfinal/staticï¼Œé‚£ä¹ˆå°±ä¸ä¼šè¢«æ‹¦æˆªï¼Œä¹Ÿä¸ä¼šæ‰§è¡Œç›®æ ‡å¯¹è±¡çš„ä¸šåŠ¡æ–¹æ³•</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CglibProxy</span> <span class="keyword">implements</span> <span class="title class_">MethodInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç›®æ ‡å¯¹è±¡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Object target;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CglibProxy</span><span class="params">(Object target)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.target = target;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getProxyInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//1.å·¥å…·ç±»</span></span><br><span class="line">        <span class="type">Enhancer</span> <span class="variable">en</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Enhancer</span>();</span><br><span class="line">        <span class="comment">//2.è®¾ç½®çˆ¶ç±»</span></span><br><span class="line">        en.setSuperclass(target.getClass());</span><br><span class="line">        <span class="comment">//3.è®¾ç½®å›è°ƒå‡½æ•°</span></span><br><span class="line">        en.setCallback(<span class="built_in">this</span>);</span><br><span class="line">        <span class="comment">//4.åˆ›å»ºå­ç±»ï¼ˆä»£ç†å¯¹è±¡ï¼‰</span></span><br><span class="line">        <span class="keyword">return</span> en.create();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">intercept</span><span class="params">(Object o, Method method, Object[] objects, MethodProxy methodProxy)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;[Cglibä»£ç†]äº¤ä¸­ä»‹è´¹&quot;</span>);</span><br><span class="line">        method.invoke(target, objects);</span><br><span class="line">        System.out.println(<span class="string">&quot;[Cglibä»£ç†]ä¸­ä»‹è´Ÿè´£ç»´ä¿®ç®¡ç†&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æµ‹è¯•-2"><a href="#æµ‹è¯•-2" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.xiaofei.proxy.cglib.CglibProxy;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.proxy.cglib.Landlord3Service;</span><br><span class="line"><span class="keyword">import</span> lombok.RequiredArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * CglibProxyæµ‹è¯•</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CglibProxyTest</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Landlord3Service landlord3Service;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Cglibä»£ç†</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">TestCglib</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Landlord3Service</span> <span class="variable">proxyInstance</span> <span class="operator">=</span> (Landlord3Service) <span class="keyword">new</span> <span class="title class_">CglibProxy</span>(landlord3Service).getProxyInstance();</span><br><span class="line">        proxyInstance.rent(<span class="number">3000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://www.naste.top:9000/images/image-20230606165551152.png" alt="image-20230606165551152"></p><h2 id="Cglibä»£ç†åº”ç”¨åœºæ™¯"><a href="#Cglibä»£ç†åº”ç”¨åœºæ™¯" class="headerlink" title="Cglibä»£ç†åº”ç”¨åœºæ™¯"></a>Cglibä»£ç†åº”ç”¨åœºæ™¯</h2><ol><li>è¢«ä»£ç†çš„ç±»æ²¡æœ‰å®ç°æ¥å£æˆ–è€…æ— æ³•å®ç°æ¥å£</li><li>ä»£ç†ç±»çš„ä»£ç†æ–¹æ³•éœ€è¦è¿›è¡Œé¢å¤–çš„é€»è¾‘ï¼Œå¦‚äº‹åŠ¡å¤„ç†ç­‰ã€‚</li></ol><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p><strong>ä¼˜ç‚¹ï¼š</strong></p><ol><li>ä»£ç†æ¨¡å¼å¯ä»¥éšè—çœŸæ˜¯å¯¹è±¡çš„å®ç°ç»†èŠ‚ï¼Œä½¿å®¢æˆ·ç«¯æ— éœ€çŸ¥æ™“çœŸå®å¯¹è±¡çš„å·¥ä½œæ–¹å¼å’Œç»“æ„ã€‚</li><li>é€šè¿‡ä»£ç†ç±»æ¥é—´æ¥è®¿é—®çœŸå®ç±»ï¼Œå¯ä»¥åœ¨ä¸ä¿®æ”¹çœŸå®ç±»çš„æƒ…å†µä¸‹ï¼Œå¯¹å…¶è¿›è¡Œæ‰©å±•ã€ä¼˜åŒ–æˆ–æ·»åŠ å®‰å…¨æªæ–½ã€‚</li><li>ä»£ç†æ¨¡å¼å®ç°èµ·æ¥ç®€å•ï¼Œæ˜“äºæ‰©å±•å’Œç»´æŠ¤ï¼Œç¬¦åˆé¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™ä¸­çš„å¼€é—­åŸåˆ™ã€‚</li></ol><p><strong>ç¼ºç‚¹ï¼š</strong></p><ol><li>ä»£ç†æ¨¡å¼å¯èƒ½ä¼šå¼•å…¥é¢å¤–çš„å¤æ‚æ€§å’Œé—´æ¥æ€§ï¼Œå¢åŠ ç¨‹åºè®¾è®¡å’Œç»´æŠ¤çš„éš¾åº¦ã€‚</li><li>å¯¹è±¡ä»£ç†å¯èƒ½ä¼šé™ä½ç³»ç»Ÿæ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†å¤§æ•°æ®é‡æˆ–é¢‘ç¹è°ƒç”¨çš„æƒ…å†µä¸‹ï¼Œå› ä¸ºä»£ç†éœ€è¦é¢å¤–çš„è®¡ç®—å’Œç½‘ç»œé€šä¿¡å¼€é”€ã€‚</li></ol>]]></content>
    
    
    <summary type="html">è®¾è®¡æ¨¡å¼-ä»£ç†æ¨¡å¼</summary>
    
    
    
    <category term="Java" scheme="https://www.naste.top:1024/categories/Java/"/>
    
    
    <category term="Java" scheme="https://www.naste.top:1024/tags/Java/"/>
    
    <category term="è®¾è®¡æ¨¡å¼" scheme="https://www.naste.top:1024/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    <category term="ä»£ç†æ¨¡å¼" scheme="https://www.naste.top:1024/tags/%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>è®¾è®¡æ¨¡å¼-å·¥å‚æ¨¡å¼</title>
    <link href="https://www.naste.top:1024/posts/3439274786.html"/>
    <id>https://www.naste.top:1024/posts/3439274786.html</id>
    <published>2023-05-31T03:40:08.000Z</published>
    <updated>2023-06-07T07:54:42.405Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h1><p>[TOC]</p><h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><h2 id="æ–‡æ¡£"><a href="#æ–‡æ¡£" class="headerlink" title="æ–‡æ¡£"></a>æ–‡æ¡£</h2><p>å»–é›ªå³°çš„å®˜æ–¹ç½‘ç«™ï¼š<a href="https://www.liaoxuefeng.com/wiki/1252599548343744/1281319170474017">https://www.liaoxuefeng.com/wiki/1252599548343744/1281319170474017</a></p><p>åšå®¢æ–‡æ¡£ï¼š</p><ul><li><a href="https://blog.csdn.net/weixin_45433817/article/details/130934548">https://blog.csdn.net/weixin_45433817/article/details/130934548</a></li></ul><h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><p><a href="https://gitee.com/xiao-i-fei/xiaofei-design-mode">https://gitee.com/xiao-i-fei/xiaofei-design-mode</a></p><p><a href="https://github.com/xiao-i-fei/xiaofei-design-mode">https://github.com/xiao-i-fei/xiaofei-design-mode</a></p><h1 id="ä»€ä¹ˆæ˜¯å·¥å‚æ¨¡å¼"><a href="#ä»€ä¹ˆæ˜¯å·¥å‚æ¨¡å¼" class="headerlink" title="ä»€ä¹ˆæ˜¯å·¥å‚æ¨¡å¼"></a>ä»€ä¹ˆæ˜¯å·¥å‚æ¨¡å¼</h1><blockquote><p><strong>å·¥å‚è®¾è®¡æ¨¡å¼çš„ç›®çš„æ˜¯ä½¿å¾—åˆ›å»ºå¯¹è±¡å’Œä½¿ç”¨å¯¹è±¡æ˜¯åˆ†ç¦»çš„ï¼Œè°ƒç”¨è€…åªç®¡è·å–å¯¹è±¡è·å–å¯¹è±¡ï¼Œæ— éœ€çŸ¥é“å¯¹è±¡æ˜¯æ€ä¹ˆåˆ›å»ºçš„,å·¥å‚æ¨¡å¼æ˜¯ä¸€ç§åˆ›å»ºå‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒç”¨äºè§£è€¦å¯¹è±¡çš„åˆ›å»ºå’Œä½¿ç”¨ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åˆ›å»ºå¯¹è±¡æ—¶éœ€è¦ä½¿ç”¨<code>newæ“ä½œç¬¦</code>ï¼Œä½†æ˜¯ä½¿ç”¨newæ“ä½œç¬¦åˆ›å»ºå¯¹è±¡ä¼šä½¿ä»£ç å…·æœ‰<code>è€¦åˆæ€§</code>ã€‚å·¥å‚æ¨¡å¼é€šè¿‡æä¾›ä¸€ä¸ªå…¬å…±çš„æ¥å£ï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥åœ¨<code>ä¸æš´éœ²å¯¹è±¡åˆ›å»ºé€»è¾‘çš„æƒ…å†µä¸‹</code>åˆ›å»ºå¯¹è±¡ã€‚</strong></p></blockquote><h1 id="å·¥å‚æ¨¡å¼çš„åˆ†ç±»"><a href="#å·¥å‚æ¨¡å¼çš„åˆ†ç±»" class="headerlink" title="å·¥å‚æ¨¡å¼çš„åˆ†ç±»"></a>å·¥å‚æ¨¡å¼çš„åˆ†ç±»</h1><p>å·¥å‚æ¨¡å¼åˆ†ä¸ºä¸‰ç§ç±»å‹ï¼š</p><ul><li>ç®€å•å·¥å‚</li><li>æ–¹æ³•å·¥å‚</li><li>æŠ½è±¡å·¥å‚</li></ul><p>å…¶æœ¬è´¨å°±æ˜¯å¯¹è·å–å¯¹è±¡è¿‡ç¨‹çš„æŠ½è±¡</p><h1 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h1><h2 id="åº”ç”¨å®ä¾‹"><a href="#åº”ç”¨å®ä¾‹" class="headerlink" title="åº”ç”¨å®ä¾‹"></a>åº”ç”¨å®ä¾‹</h2><blockquote><p>ä½ éœ€è¦ä¸€è¾†æ±½è½¦ï¼Œå¯ä»¥ç›´æ¥ä»å·¥å‚é‡Œæè´§ï¼Œè€Œä¸ç”¨å…³å¿ƒå®ƒå…·ä½“æ˜¯æ€ä¹ˆå®ç°çš„</p><p>Hibernateæ¢æ•°æ®åº“åªéœ€è¦æ¢æ–¹è¨€å’Œé©±åŠ¨å°±å¯ä»¥</p></blockquote><h2 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h2><blockquote><p>æ—¥å¿—è®°å½•å™¨ï¼šè®°å½•å¯èƒ½è®°å½•åˆ°æœ¬åœ°ç¡¬ç›˜ã€ç³»ç»Ÿäº‹ä»¶ã€è¿œç¨‹æœåŠ¡å™¨ç­‰ï¼Œç”¨æˆ·å¯ä»¥é€‰æ‹©è®°å½•æ—¥å¿—åˆ°ä»€ä¹ˆåœ°æ–¹ã€‚</p><p>æ•°æ®åº“è®¿é—®ï¼Œå½“ç”¨æˆ·ä¸çŸ¥é“æœ€åç³»ç»Ÿé‡‡ç”¨å“ªä¸€ç±»æ•°æ®åº“ï¼Œä»¥åŠæ•°æ®åº“å¯èƒ½æœ‰å˜åŒ–æ—¶ã€‚</p><p>è®¾è®¡ä¸€ä¸ªè¿æ¥æœåŠ¡å™¨çš„æ¡†æ¶ï¼Œéœ€è¦ä¸‰ä¸ªåè®®ï¼Œâ€POP3â€ã€â€IMAPâ€ã€â€HTTPâ€ï¼Œå¯ä»¥æŠŠè¿™ä¸‰ä¸ªä½œä¸ºäº§å“ç±»ï¼Œå…±åŒå®ç°ä¸€ä¸ªæ¥å£</p></blockquote><h1 id="å·¥å‚æ¨¡å¼å®ç°"><a href="#å·¥å‚æ¨¡å¼å®ç°" class="headerlink" title="å·¥å‚æ¨¡å¼å®ç°"></a>å·¥å‚æ¨¡å¼å®ç°</h1><h2 id="ä¼ ç»Ÿæ¨¡å¼"><a href="#ä¼ ç»Ÿæ¨¡å¼" class="headerlink" title="ä¼ ç»Ÿæ¨¡å¼"></a>ä¼ ç»Ÿæ¨¡å¼</h2><p>åœ¨ä»‹ç»å·¥å‚æ¨¡å¼ä¹‹å‰å…ˆæ¥çœ‹çœ‹ä¼ ç»Ÿæ¨¡å¼ï¼Œä»¥å–åŒ…å­ä¸ºä¾‹ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç®€å•çš„åˆ¶ä½œæµç¨‹</span></span><br><span class="line"><span class="keyword">public</span> BaoZi <span class="title function_">createBaoZi</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">BaoZi</span> <span class="variable">baozi</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BaoZiImpl</span>();</span><br><span class="line">    <span class="comment">//å‡†å¤‡ææ–™</span></span><br><span class="line">    baozi.prepare();</span><br><span class="line">    <span class="comment">//åˆ¶ä½œåŒ…å­</span></span><br><span class="line">    baozi.make();</span><br><span class="line">    <span class="comment">//è’¸åŒ…å­</span></span><br><span class="line">    baozi.braise();</span><br><span class="line">    <span class="keyword">return</span> baozi;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒ…å­è‚¯å®šæœ‰å¾ˆå¤šç§ç±»å§ï¼Œé‚£æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨ä¸Šè¿°ä»£ç ä¸­æ·»åŠ æ ¹æ®åŒ…å­çš„ç§ç±»ç”Ÿæˆä¸åŒç±»å‹çš„å¯¹è±¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åŒ…å­è‚¯å®šæœ‰ä¸åŒçš„é¦…ï¼šé…¸èœã€è±†æ²™ã€çŒªè‚‰ï¼Œé‚£ä¹ˆä»–çš„ææ–™ã€å”®ä»·ç­‰æ–¹å¼ä¹Ÿä¸åŒ</span></span><br><span class="line"><span class="comment"> * æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œæ·»åŠ æ ¹æ®åŒ…å­çš„ä¸åŒç§ç±»ç”Ÿæˆä¸åŒçš„å¯¹è±¡ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> BaoZi <span class="title function_">createBaoZi</span><span class="params">(String type)</span> &#123;</span><br><span class="line">    <span class="type">BaoZi</span> <span class="variable">baoZi</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">switch</span> (type) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;suancai&quot;</span>:</span><br><span class="line">            baoZi = <span class="keyword">new</span> <span class="title class_">SuanCaiBaoZi</span>();</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;dousha&quot;</span>:</span><br><span class="line">            baoZi = <span class="keyword">new</span> <span class="title class_">DouShaBaoZi</span>();</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;pork&quot;</span>:</span><br><span class="line">            baoZi = <span class="keyword">new</span> <span class="title class_">PorkBaoZi</span>();</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Invalid BaoZi Type&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å‡†å¤‡ææ–™</span></span><br><span class="line">    baoZi.prepare();</span><br><span class="line">    <span class="comment">//åˆ¶ä½œåŒ…å­</span></span><br><span class="line">    baoZi.make();</span><br><span class="line">    <span class="comment">//è’¸åŒ…å­</span></span><br><span class="line">    baoZi.braise();</span><br><span class="line">    <span class="keyword">return</span> baoZi;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://www.naste.top:9000/images/image-20230531172315922.png" alt="image-20230531172315922"></p><p>æµ‹è¯•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.ä¼ ç»Ÿæ¨¡å¼</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">traditonal</span><span class="params">()</span>&#123;</span><br><span class="line">    SaleBaoZi saleBaoZi=<span class="keyword">new</span> <span class="title class_">SaleBaoZi</span>();</span><br><span class="line">    <span class="comment">//ä»¥çŒªè‚‰åŒ…ä¸ºä¾‹</span></span><br><span class="line">    saleBaoZi.createBaoZi(<span class="string">&quot;pork&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç®€å•å·¥å‚æ¨¡å¼"><a href="#ç®€å•å·¥å‚æ¨¡å¼" class="headerlink" title="ç®€å•å·¥å‚æ¨¡å¼"></a>ç®€å•å·¥å‚æ¨¡å¼</h2><blockquote><p><strong>ç®€å•å·¥ç¨‹æ ¹æ®å®¢æˆ·ç«¯çš„éœ€æ±‚åˆ›å»ºå…·ä½“çš„å®ä¾‹ï¼Œè¿™ç§æ¨¡å¼å¯¹è°ƒç”¨è€…<code>éšè—äº†å®ä¾‹åˆ›å»ºçš„è¿‡ç¨‹</code>ï¼Œä¹Ÿä½¿å¾—åˆ›å»ºè¿‡ç¨‹æ›´åŠ å®¹æ˜“ç»´æŠ¤ã€‚</strong></p></blockquote><p>è¿˜æ˜¯ä»¥å–åŒ…å­ä¸ºä¾‹ï¼Œç®€å•å·¥å‚æ¨¡å¼å®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 2.ç®€å•å·¥å‚æ–¹æ³•:å¸Œæœ›èƒ½å¤Ÿåˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œä½†åˆ›å»ºè¿‡ç¨‹æ¯”è¾ƒå¤æ‚ï¼Œå¸Œæœ›å¯¹å¤–éšè—è¿™äº›ç»†èŠ‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SimpleFactory</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> BaoZi <span class="title function_">createBaoZi</span><span class="params">(String type)</span>&#123;</span><br><span class="line"> </span><br><span class="line">        BaoZi baoZi=<span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">switch</span> (type)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;suancai&quot;</span>:</span><br><span class="line">                baoZi=<span class="keyword">new</span> <span class="title class_">SuanCaiBaoZi</span>(<span class="string">&quot;é…¸èœåŒ…&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;dousha&quot;</span>:</span><br><span class="line">                baoZi=<span class="keyword">new</span> <span class="title class_">DouShaBaoZi</span>(<span class="string">&quot;è±†æ²™åŒ…&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;lajioa&quot;</span>:</span><br><span class="line">                baoZi=<span class="keyword">new</span> <span class="title class_">PorkBaoZi</span>(<span class="string">&quot;çŒªè‚‰åŒ…&quot;</span>);</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;beef&quot;</span>:</span><br><span class="line">                <span class="comment">//è€æ¿æ‹“å±•ä¸šåŠ¡äº†ï¼Œæ–°åŠ äº†ä¸€ä¸ªç‰›è‚‰åŒ…ç±»å‹çš„åŒ…å­ï¼Œé‚£å¯¹äºç®€å•å·¥å‚æ¨¡å¼è€Œè¨€ï¼Œ</span></span><br><span class="line">                <span class="comment">//äºæ˜¯å°±å¾—ä¿®æ”¹æºä»£ç ï¼Œé‚£ä¹ˆå°±è¿åäº†ocpåŸåˆ™ï¼Œå‡å¦‚æ–°å¢100ä¸ªï¼Ÿ</span></span><br><span class="line">                baoZi=<span class="keyword">new</span> <span class="title class_">BeefBaoZi</span>(<span class="string">&quot;ç‰›è‚‰åŒ…&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Invalid BaoZi Type&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> baoZi;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ç±»å›¾å¦‚ä¸‹ï¼š</p><p><img src="https://www.naste.top:9000/images/image-20230531172545428.png" alt="image-20230531172545428"></p><p>æµ‹è¯•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2.ç®€å•å·¥å‚æ¨¡å¼</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">simpleFactory</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//ä»¥çŒªè‚‰åŒ…ä¸ºä¾‹</span></span><br><span class="line">    <span class="type">BaoZi</span> <span class="variable">pork</span> <span class="operator">=</span> SimpleFactory.createBaoZi(<span class="string">&quot;pork&quot;</span>);</span><br><span class="line">    pork.prepare();</span><br><span class="line">    pork.make();</span><br><span class="line">    pork.braise();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p> ç›¸æ¯”ä¼ ç»Ÿæ¨¡å¼ï¼Œä»ç±»å›¾ä¸Šå°±å¯ä»¥çœ‹å‡ºæ¥ï¼Œåœ¨saleå’Œbaoziä¸­é—´åˆ<code>åŠ äº†ä¸€å±‚</code></p><p> é€šè¿‡å°è£…SimpleFactoryè¿™ä¸ªç±»ï¼Œæˆ‘ä»¬å°†saleå’Œbaoziè¿›è¡Œäº†è§£è€¦åˆã€‚</p></blockquote><h2 id="æ–¹æ³•å·¥å‚æ¨¡å¼"><a href="#æ–¹æ³•å·¥å‚æ¨¡å¼" class="headerlink" title="æ–¹æ³•å·¥å‚æ¨¡å¼"></a>æ–¹æ³•å·¥å‚æ¨¡å¼</h2><p>ç®€å•å·¥å‚æ¨¡å¼ä¸‹ï¼Œå¦‚æœè€æ¿æ‹“å±•ä¸šåŠ¡äº†ï¼ŒåŠ äº†ä¸€ä¸ªç‰›è‚‰ç§ç±»çš„åŒ…å­ï¼Œå°±å¾—åœ¨æºç åŸºç¡€ä¸Šä¿®æ”¹ï¼Œé‚£ä¹ˆè¿™å°±è¿èƒŒäº†<code>å¼€é—­åŸåˆ™ï¼ˆocpï¼‰</code>ï¼Œå³å¯¹<code>æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­</code>ã€‚äºæ˜¯ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°±åˆäº†å·¥å‚æ–¹æ³•æ¨¡å¼ã€‚</p><blockquote><p><strong>å·¥å‚æ–¹æ³•æ¨¡å¼æ˜¯ä¸€ç§æ›´åŠ æŠ½è±¡çš„å·¥å‚æ¨¡å¼ï¼Œå®ƒå°†å·¥å‚çš„èŒè´£æŠ½è±¡ä¸ºæ¥å£ï¼Œç”±å…·ä½“çš„å·¥å‚å®ç°åˆ›å»ºå…·ä½“çš„å¯¹è±¡ã€‚å·¥å‚æ–¹æ³•æ¨¡å¼å¼±åŒ–äº†å·¥å‚çš„å®ç°ï¼Œä½¿å¾—<code>æ¯ä¸ªå·¥å‚åªè´Ÿè´£ä¸€ä¸ªäº§å“çš„åˆ›å»ºã€‚</code></strong></p></blockquote><p>æŠ½è±¡å·¥å‚MeAbStractFactoryï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MeAbstractFactory</span> &#123;</span><br><span class="line">    BaoZi <span class="title function_">createBaoZi</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>DouShaFactoryï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DouShaFactory</span> <span class="keyword">implements</span> <span class="title class_">MeAbstractFactory</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> BaoZi <span class="title function_">createBaoZi</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DouShaBaoZi</span>(<span class="string">&quot;è±†æ²™åŒ…&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>SuanCaiFactoryï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SuanCaiFactory</span> <span class="keyword">implements</span> <span class="title class_">MeAbstractFactory</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> BaoZi <span class="title function_">createBaoZi</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PorkBaoZi</span>(<span class="string">&quot;é…¸èœåŒ…&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>LaJiaoFactoryï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SuanCaiFactory</span> <span class="keyword">implements</span> <span class="title class_">MeAbstractFactory</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> BaoZi <span class="title function_">createBaoZi</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PorkBaoZi</span>(<span class="string">&quot;è¾£æ¤’åŒ…&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶çš„ç±»å›¾å¦‚ä¸‹ï¼š</p><p><img src="https://www.naste.top:9000/images/image-20230531173424995.png" alt="image-20230531173424995"></p><p>æµ‹è¯•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">methodFactory</span><span class="params">()</span>&#123;</span><br><span class="line">    MeAbstractFactory factory=<span class="keyword">new</span> <span class="title class_">PorkFactory</span>();</span><br><span class="line">    <span class="type">BaoZi</span> <span class="variable">pork</span> <span class="operator">=</span> factory.createBaoZi();</span><br><span class="line">    pork.prepare();</span><br><span class="line">    pork.make();</span><br><span class="line">    pork.braise();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ä¹‹å‰çš„SimpleFactoryåœ¨createBaoZiä¸­ç›´æ¥å°±newå‡ºæ¥äº†ï¼Œä½†åœ¨æ–¹æ³•å·¥å‚ä¸­ï¼Œæˆ‘ä»¬å°†createBaoZiè¿™ä¸ªåŠ¨ä½œæ¨è¿Ÿåˆ°äº†MeAbStactFactoryçš„å­ç±»ï¼ˆXXFactoryï¼‰ä¸­æ‰å®Œæˆã€‚å¥½å¤„å°±æ˜¯ï¼Œæ¯”å¦‚åæœŸè¦å–ä¸ªç¾Šè‚‰åŒ…ï¼Œæˆ‘ä»¬ç›´æ¥ç¼–å†™ä¸ªç¾Šè‚‰åŒ…ç±»ï¼Œç„¶åå®ç°MeAbstractFactoryç±»å°±ï¼Œå®ç°å®ƒè‡ªå·±çš„åŠŸèƒ½ï¼Œè¿™æ ·å®Œå…¨ä¸ç”¨ä¿®æ”¹åŸæ¥çš„ä»£ç äº†ï¼Œä¹Ÿå°±è§£å†³äº†è¿åOCPåŸåˆ™çš„é—®é¢˜ã€‚</p></blockquote><h2 id="æŠ½è±¡å·¥å‚"><a href="#æŠ½è±¡å·¥å‚" class="headerlink" title="æŠ½è±¡å·¥å‚"></a>æŠ½è±¡å·¥å‚</h2><blockquote><p>æŠ½è±¡å·¥å‚æ¨¡å¼æ˜¯åŸºäºå·¥å‚æ–¹æ³•æ¨¡å¼çš„åŸºç¡€ä¸Šè¿›è¡Œçš„ã€‚åœ¨è¿™ç§æ¨¡å¼ä¸­ï¼Œæ¯ä¸€ä¸ªå·¥å‚ä¸å†åªè´Ÿè´£ä¸€ä¸ªäº§å“çš„åˆ›å»ºï¼Œè€Œæ˜¯è´Ÿè´£<code>ä¸€ç»„äº§å“çš„</code>åˆ›å»ºã€‚æŠ½è±¡å·¥å‚æ¨¡å¼å°†æ¯ä¸ªäº§å“ç»„éƒ½æå–ä¸ºä¸€ä¸ªæ¥å£ï¼Œæ¯ä¸ªå·¥å‚éƒ½è´Ÿè´£ä¸€ä¸ªäº§å“ç»„ã€‚</p></blockquote><p>å‡å¦‚è€æ¿çš„ç”Ÿæ„åšå¤§äº†ï¼Œåœ¨åŒ—äº¬å¼€äº†ä¸ªåˆ†åº—ï¼Œå¹¶ä¸”ä¸æ­¢å–åŒ…å­ï¼Œè¿˜å–è›‹ç³•ï¼Œé‚£ä¹ˆè¯¥æ€ä¹ˆæ‹“å±•å‘¢ï¼Œå¾ˆç®€å•ï¼Œåªéœ€è¦åœ¨æŠ½è±¡å·¥å‚ç±»ä¸­æ–°å¢åˆ›å»ºè›‹ç³•çš„æŠ½è±¡æ–¹æ³•å°±è¡Œï¼Œå¦‚ä¸‹ï¼š</p><p>AbstractFactoryï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AbstractFactory</span> &#123;</span><br><span class="line">    <span class="comment">//åˆ¶ä½œåŒ…å­</span></span><br><span class="line">    BaoZi <span class="title function_">createBaoZi</span><span class="params">(String type)</span>;</span><br><span class="line">    <span class="comment">//åˆ¶ä½œè›‹ç³•</span></span><br><span class="line">    Cake <span class="title function_">createCake</span><span class="params">(String type)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>BJFactoryï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">//åŒ—äº¬åˆ†åº—</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BJFactory</span> <span class="keyword">implements</span> <span class="title class_">AbstractFactory</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> BaoZi <span class="title function_">createBaoZi</span><span class="params">(String type)</span> &#123;</span><br><span class="line">        BaoZi baoZi=<span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">switch</span> (type)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;suancai&quot;</span>:</span><br><span class="line">                baoZi=<span class="keyword">new</span> <span class="title class_">BJSuanCaiBao</span>(<span class="string">&quot;åŒ—äº¬é…¸èœåŒ…&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;lajioa&quot;</span>:</span><br><span class="line">                baoZi=<span class="keyword">new</span> <span class="title class_">BJLaJiaoBao</span>(<span class="string">&quot;åŒ—äº¬è¾£æ¤’åŒ…&quot;</span>);</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> baoZi;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Cake <span class="title function_">createCake</span><span class="params">(String type)</span> &#123;</span><br><span class="line">        Cake cake=<span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">switch</span> (type)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;apple&quot;</span>:</span><br><span class="line">                cake=<span class="keyword">new</span> <span class="title class_">BJAppleCake</span>(<span class="string">&quot;åŒ—äº¬è‹¹æœè›‹ç³•&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;pear&quot;</span>:</span><br><span class="line">                cake=<span class="keyword">new</span> <span class="title class_">BJPearCake</span>(<span class="string">&quot;åŒ—äº¬æ¢¨å‘³è›‹ç³•&quot;</span>);</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> cake;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å¯ä»¥çœ‹åˆ°ï¼ŒæŠ½è±¡å·¥å‚ä»…ä»…æ˜¯åœ¨å·¥å‚æ–¹æ³•æ¨¡å¼ä¸‹æ–°å¢äº†ä¸€äº›æ¥å£ï¼Œåªæ˜¯å·¥å‚æ¨¡å¼çš„ä¸€ä¸ªæ‹“å±•ï¼Œå½“æŠ½è±¡å·¥å‚åªæœ‰ä¸€ä¸ªäº§å“ä½“ç³»çš„è¯å°±ä¼šé€€åŒ–æˆå·¥å‚æ¨¡å¼ï¼Œæ‰€ä»¥ä¸¤è€…æœ¬è´¨ä¸Šæ²¡æœ‰å¤ªå¤§çš„åŒºåˆ«ã€‚</p></blockquote><p>æµ‹è¯•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">abstractFactory</span><span class="params">()</span>&#123;</span><br><span class="line">    AbstractFactory factory=<span class="keyword">new</span> <span class="title class_">BJFactory</span>();</span><br><span class="line">    <span class="type">Cake</span> <span class="variable">apple</span> <span class="operator">=</span> factory.createCake(<span class="string">&quot;apple&quot;</span>);</span><br><span class="line">    <span class="type">BaoZi</span> <span class="variable">pork</span> <span class="operator">=</span> factory.createBaoZi(<span class="string">&quot;pork&quot;</span>);</span><br><span class="line"></span><br><span class="line">    apple.prepare();</span><br><span class="line">    apple.make();</span><br><span class="line">    apple.bake();</span><br><span class="line">    apple.sale();</span><br><span class="line"></span><br><span class="line">    pork.prepare();</span><br><span class="line">    pork.make();</span><br><span class="line">    pork.braise();</span><br><span class="line">    pork.sale();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><h2 id="ç®€å•å·¥å‚æ¨¡å¼-1"><a href="#ç®€å•å·¥å‚æ¨¡å¼-1" class="headerlink" title="ç®€å•å·¥å‚æ¨¡å¼"></a>ç®€å•å·¥å‚æ¨¡å¼</h2><ul><li><p>ä¼˜ç‚¹ï¼š</p><ul><li>ç®€å•å·¥å‚æ¨¡å¼å®ç°ç®€å•ï¼Œæ˜“äºç†è§£å’Œä½¿ç”¨ï¼›</li><li>å¯ä»¥å¯¹å¯¹è±¡çš„åˆ›å»ºè¿›è¡Œé›†ä¸­ç®¡ç†ï¼Œå®¢æˆ·ç«¯å’Œå…·ä½“å®ç°è§£è€¦ã€‚</li></ul></li><li>ç¼ºç‚¹ï¼š<ul><li>å·¥å‚ç±»è´Ÿè´£åˆ›å»ºæ‰€æœ‰å¯¹è±¡ï¼Œå¦‚æœéœ€è¦æ·»åŠ æ–°ç±»å‹çš„äº§å“ï¼Œåˆ™éœ€è¦ä¿®æ”¹å·¥å‚ç±»çš„ä»£ç ï¼Œè¿™è¿åäº†å¼€é—­åŸåˆ™ï¼›</li><li>å·¥å‚ç±»èŒè´£è¿‡é‡ï¼Œå¯¼è‡´å•ä¸€èŒè´£åŸåˆ™è¢«ç ´åã€‚</li></ul></li><li>é€‚ç”¨åœºæ™¯ï¼š<ul><li>å·¥å‚ç±»è´Ÿè´£åˆ›å»ºçš„å¯¹è±¡è¾ƒå°‘ï¼Œå®¢æˆ·ç«¯ä¸éœ€è¦çŸ¥é“å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹ï¼›</li><li>å®¢æˆ·ç«¯éœ€è¦æ ¹æ®ä¼ é€’çš„å‚æ•°æ¥è·å–å¯¹åº”çš„å¯¹è±¡ã€‚</li></ul></li></ul><h2 id="æ–¹æ³•å·¥å‚æ¨¡å¼-1"><a href="#æ–¹æ³•å·¥å‚æ¨¡å¼-1" class="headerlink" title="æ–¹æ³•å·¥å‚æ¨¡å¼"></a>æ–¹æ³•å·¥å‚æ¨¡å¼</h2><ul><li><p>ä¼˜ç‚¹ï¼š </p><ul><li>æ–¹æ³•å·¥å‚æ¨¡å¼å…·æœ‰è‰¯å¥½çš„å¯æ‰©å±•æ€§ï¼Œå¦‚æœéœ€è¦æ·»åŠ æ–°ç±»å‹çš„äº§å“ï¼Œåªéœ€è¦æ·»åŠ å¯¹åº”çš„å·¥å‚æ–¹æ³•å³å¯ï¼›</li><li>ä¸ç®€å•å·¥å‚æ¨¡å¼ç›¸æ¯”ï¼Œæ–¹æ³•å·¥å‚æ¨¡å¼æ›´ç¬¦åˆå¼€é—­åŸåˆ™å’Œå•ä¸€èŒè´£åŸåˆ™ã€‚</li></ul></li><li>ç¼ºç‚¹ï¼š<ul><li>éœ€è¦å®¢æˆ·ç«¯è‡ªè¡Œé€‰æ‹©ä½¿ç”¨å“ªä¸ªå·¥å‚æ–¹æ³•ï¼Œä¸èƒ½åƒç®€å•å·¥å‚æ¨¡å¼é‚£æ ·ç›´æ¥ä¼ å‚è·å–å¯¹åº”å¯¹è±¡ï¼Œå› æ­¤å¯¹å®¢æˆ·ç«¯çš„ç¼–å†™æœ‰ä¸€å®šè¦æ±‚ã€‚</li></ul></li><li>é€‚ç”¨åœºæ™¯ï¼š<ul><li>åº”ç”¨ä¸­éœ€è¦åˆ›å»ºçš„å¯¹è±¡è¾ƒå°‘ï¼Œä½†æ˜¯éœ€è¦å…·å¤‡è‰¯å¥½çš„å¯æ‰©å±•æ€§ï¼›</li><li>å®¢æˆ·ç«¯å¯ä»¥è‡ªè¡Œé€‰æ‹©åˆ›å»ºå“ªç§å¯¹è±¡ã€‚</li></ul></li></ul><h2 id="æŠ½è±¡å·¥å‚-1"><a href="#æŠ½è±¡å·¥å‚-1" class="headerlink" title="æŠ½è±¡å·¥å‚"></a>æŠ½è±¡å·¥å‚</h2><ul><li><p>ä¼˜ç‚¹ï¼š</p><ul><li>æŠ½è±¡å·¥å‚æ¨¡å¼å¯ä»¥åˆ›å»ºå¤šä¸ªäº§å“æ—çš„äº§å“ï¼Œè¿™äº›äº§å“ä¹‹é—´æœ‰ç›¸äº’ä¾èµ–æˆ–çº¦æŸå…³ç³»ï¼Œæœ‰åŠ©äºä¿æŒç³»ç»Ÿçš„ä¸€è‡´æ€§å’Œç¨³å®šæ€§ï¼›</li><li>å®¢æˆ·ç«¯ä¸å…·ä½“äº§å“è§£è€¦ï¼Œé€šè¿‡äº§å“æ—çš„æ–¹å¼è¿›è¡Œç®¡ç†ã€‚</li></ul></li><li>ç¼ºç‚¹ï¼š<ul><li>æŠ½è±¡å·¥å‚æ¨¡å¼å¢åŠ äº†ç³»ç»Ÿçš„æŠ½è±¡æ€§å’Œç†è§£éš¾åº¦ï¼Œä¸æ˜“äºç†è§£å’Œä¿®æ”¹ï¼›</li><li>æ–°å¢äº§å“æ—æ—¶éœ€è¦ä¿®æ”¹å·¥å‚æ¥å£ã€å·¥å‚å®ç°ç±»å’Œäº§å“ç±»ï¼Œå¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚æ€§ã€‚</li></ul></li><li>é€‚ç”¨åœºæ™¯ï¼š<ul><li>ç³»ç»Ÿéœ€è¦ä¸€ç³»åˆ—ç›¸äº’ä¾èµ–æˆ–çº¦æŸçš„äº§å“ï¼›</li><li>å®¢æˆ·ç«¯ä¸éœ€è¦çŸ¥é“å…·ä½“äº§å“çš„åˆ›å»ºè¿‡ç¨‹ï¼Œåªéœ€è¦çŸ¥é“äº§å“æ—å³å¯ã€‚</li></ul></li></ul>]]></content>
    
    
    <summary type="html">è®¾è®¡æ¨¡å¼-å·¥å‚æ¨¡å¼</summary>
    
    
    
    
    <category term="Java" scheme="https://www.naste.top:1024/tags/Java/"/>
    
    <category term="è®¾è®¡æ¨¡å¼" scheme="https://www.naste.top:1024/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    <category term="å·¥å‚æ¨¡å¼" scheme="https://www.naste.top:1024/tags/%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>è®¾è®¡æ¨¡å¼-ç­–ç•¥æ¨¡å¼</title>
    <link href="https://www.naste.top:1024/posts/3353504920.html"/>
    <id>https://www.naste.top:1024/posts/3353504920.html</id>
    <published>2023-05-30T12:01:02.000Z</published>
    <updated>2023-06-05T07:17:17.186Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><h2 id="æ–‡æ¡£"><a href="#æ–‡æ¡£" class="headerlink" title="æ–‡æ¡£"></a>æ–‡æ¡£</h2><p>å»–é›ªå³°çš„å®˜æ–¹ç½‘ç«™ï¼š<a href="https://www.liaoxuefeng.com/wiki/1252599548343744/1281319170474017">https://www.liaoxuefeng.com/wiki/1252599548343744/1281319170474017</a></p><h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><p><a href="https://gitee.com/xiao-i-fei/xiaofei-design-mode">https://gitee.com/xiao-i-fei/xiaofei-design-mode</a></p><p><a href="https://github.com/xiao-i-fei/xiaofei-design-mode">https://github.com/xiao-i-fei/xiaofei-design-mode</a></p><h1 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h1><ul><li>é£Ÿè°±ä¸­çš„ä¸åŒçƒ¹é¥ªæ–¹æ³•ï¼šåœ¨åšèœæ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä¸åŒçš„çƒ¹é¥ªæ–¹æ³•æ¥åˆ¶ä½œç¾é£Ÿã€‚æ¯”å¦‚ç…®ã€ç‚’ã€çƒ¤ã€è’¸ç­‰ã€‚è¿™äº›çƒ¹é¥ªæ–¹æ³•å¯ä»¥çœ‹ä½œæ˜¯ä¸åŒçš„ç®—æ³•ï¼Œä½¿ç”¨ç­–ç•¥æ¨¡å¼å¯ä»¥è®©ç”¨æˆ·é€‰æ‹©ä¸åŒçš„çƒ¹é¥ªæ–¹æ³•æ¥åˆ¶ä½œä¸åŒçš„èœå“ã€‚</li><li>è´­ç‰©æ¸…å•ä¸­çš„ä¸åŒè´­ä¹°ç­–ç•¥ï¼šåœ¨è´­ç‰©æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä¸åŒçš„è´­ä¹°ç­–ç•¥æ¥è·å–æ›´å¥½çš„ä¼˜æƒ å’Œå•†å“ã€‚æ¯”å¦‚æ‰“æŠ˜ã€æ»¡å‡ã€å›¢è´­ç­‰ã€‚è¿™äº›è´­ä¹°ç­–ç•¥å¯ä»¥çœ‹ä½œæ˜¯ä¸åŒçš„ç®—æ³•ï¼Œä½¿ç”¨ç­–ç•¥æ¨¡å¼å¯ä»¥è®©ç”¨æˆ·é€‰æ‹©ä¸åŒçš„è´­ä¹°ç­–ç•¥æ¥è·å–æ›´å¥½çš„è´­ç‰©ä½“éªŒã€‚</li><li>æ—…æ¸¸è·¯çº¿è§„åˆ’ä¸­çš„ä¸åŒäº¤é€šæ–¹å¼ï¼šåœ¨æ—…æ¸¸æ—¶ï¼Œå¯ä»¥é€‰æ‹©ä¸åŒçš„äº¤é€šæ–¹å¼ï¼Œæ¯”å¦‚é£æœºã€ç«è½¦ã€æ±½è½¦ã€è‡ªé©¾ç­‰ã€‚è¿™äº›äº¤é€šæ–¹å¼å¯ä»¥çœ‹ä½œæ˜¯ä¸åŒçš„ç®—æ³•ï¼Œä½¿ç”¨ç­–ç•¥æ¨¡å¼å¯ä»¥è®©ç”¨æˆ·é€‰æ‹©ä¸åŒçš„äº¤é€šæ–¹å¼æ¥è§„åˆ’æ—…æ¸¸è·¯çº¿ã€‚</li><li>å¥èº«è®¡åˆ’ä¸­çš„ä¸åŒè®­ç»ƒæ–¹å¼ï¼šåœ¨å¥èº«æ—¶ï¼Œå¯ä»¥é€‰æ‹©ä¸åŒçš„è®­ç»ƒæ–¹å¼æ¥è¾¾åˆ°é”»ç‚¼æ•ˆæœã€‚æ¯”å¦‚æœ‰æ°§è¿åŠ¨ã€åŠ›é‡è®­ç»ƒã€ç‘œä¼½ç­‰ã€‚è¿™äº›è®­ç»ƒæ–¹å¼å¯ä»¥çœ‹ä½œæ˜¯ä¸åŒçš„ç®—æ³•ï¼Œä½¿ç”¨ç­–ç•¥æ¨¡å¼å¯ä»¥è®©ç”¨æˆ·é€‰æ‹©ä¸åŒçš„è®­ç»ƒæ–¹å¼æ¥åˆ¶å®šè‡ªå·±çš„å¥èº«è®¡åˆ’ã€‚</li><li>éŸ³ä¹æ¨èç³»ç»Ÿä¸­çš„ä¸åŒæ­Œæ›²æ¨èç­–ç•¥ï¼šåœ¨å¬æ­Œæ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä¸åŒçš„æ­Œæ›²æ¨èç­–ç•¥æ¥å‘ç°æ–°çš„éŸ³ä¹ã€‚æ¯”å¦‚åŸºäºç›¸ä¼¼åº¦ã€åŸºäºçƒ­åº¦ã€åŸºäºæ—¶é—´ç­‰ã€‚è¿™äº›æ¨èç­–ç•¥å¯ä»¥çœ‹ä½œæ˜¯ä¸åŒçš„ç®—æ³•ï¼Œä½¿ç”¨ç­–ç•¥æ¨¡å¼å¯ä»¥è®©ç”¨æˆ·é€‰æ‹©ä¸åŒçš„æ­Œæ›²æ¨èç­–ç•¥æ¥å‘ç°æ›´å¤šçš„å¥½æ­Œã€‚</li><li>ç¤¾äº¤ç½‘ç»œä¸­çš„ä¸åŒå¥½å‹æ¨èç®—æ³•ï¼šåœ¨ç¤¾äº¤ç½‘ç»œä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä¸åŒçš„å¥½å‹æ¨èç®—æ³•æ¥å‘ç°æ–°çš„æœ‹å‹ã€‚æ¯”å¦‚åŸºäºå…´è¶£ã€åŸºäºå…±åŒå¥½å‹ã€åŸºäºåœ°ç†ä½ç½®ç­‰ã€‚è¿™äº›æ¨èç®—æ³•å¯ä»¥çœ‹ä½œæ˜¯ä¸åŒçš„ç®—æ³•ï¼Œä½¿ç”¨ç­–ç•¥æ¨¡å¼å¯ä»¥è®©ç”¨æˆ·é€‰æ‹©ä¸åŒçš„å¥½å‹æ¨èç®—æ³•æ¥æ‰©å¤§è‡ªå·±çš„ç¤¾äº¤åœˆã€‚</li><li>äººè„¸è¯†åˆ«ä¸­çš„ä¸åŒç‰¹å¾æå–ç®—æ³•ï¼šåœ¨äººè„¸è¯†åˆ«ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä¸åŒçš„ç‰¹å¾æå–ç®—æ³•æ¥è¯†åˆ«äººè„¸ã€‚æ¯”å¦‚LBPã€HOGã€Eigenfaceç­‰ã€‚è¿™äº›ç‰¹å¾æå–ç®—æ³•å¯ä»¥çœ‹ä½œæ˜¯ä¸åŒçš„ç®—æ³•ï¼Œä½¿ç”¨ç­–ç•¥æ¨¡å¼å¯ä»¥è®©ç³»ç»Ÿé€‰æ‹©ä¸åŒçš„ç‰¹å¾æå–ç®—æ³•æ¥æé«˜äººè„¸è¯†åˆ«çš„å‡†ç¡®æ€§ã€‚</li><li>è‡ªç„¶è¯­è¨€å¤„ç†ä¸­çš„ä¸åŒæ–‡æœ¬æ¸…æ´—ç®—æ³•ï¼šåœ¨è‡ªç„¶è¯­è¨€å¤„ç†ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä¸åŒçš„æ–‡æœ¬æ¸…æ´—ç®—æ³•æ¥å¤„ç†æ–‡æœ¬æ•°æ®ã€‚æ¯”å¦‚å»é™¤HTMLæ ‡ç­¾ã€å»é™¤ç‰¹æ®Šå­—ç¬¦ã€åˆ†è¯ç­‰ã€‚è¿™äº›æ–‡æœ¬æ¸…æ´—ç®—æ³•å¯ä»¥çœ‹ä½œæ˜¯ä¸åŒçš„ç®—æ³•ï¼Œä½¿ç”¨ç­–ç•¥æ¨¡å¼å¯ä»¥è®©ç³»ç»Ÿé€‰æ‹©ä¸åŒçš„æ–‡æœ¬æ¸…æ´—ç®—æ³•æ¥æé«˜è‡ªç„¶è¯­è¨€å¤„ç†çš„æ•ˆç‡å’Œå‡†ç¡®æ€§ã€‚</li><li>èµ„æºç®¡ç†ä¸­çš„ä¸åŒæƒé™æ§åˆ¶ç­–ç•¥ï¼šåœ¨èµ„æºç®¡ç†ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä¸åŒçš„æƒé™æ§åˆ¶ç­–ç•¥æ¥é™åˆ¶ä¸åŒç”¨æˆ·çš„æ“ä½œæƒé™ã€‚æ¯”å¦‚ç®¡ç†å‘˜æ‹¥æœ‰æœ€é«˜æƒé™ï¼Œæ™®é€šç”¨æˆ·åªæœ‰éƒ¨åˆ†æƒé™ã€‚è¿™äº›æƒé™æ§åˆ¶ç­–ç•¥å¯ä»¥çœ‹ä½œæ˜¯ä¸åŒçš„ç®—æ³•ï¼Œä½¿ç”¨ç­–ç•¥æ¨¡å¼å¯ä»¥è®©ç³»ç»Ÿé€‰æ‹©ä¸åŒçš„æƒé™æ§åˆ¶ç­–ç•¥æ¥ä¿æŠ¤ç³»ç»Ÿçš„å®‰å…¨æ€§å’Œç¨³å®šæ€§ã€‚</li><li>æ¸¸æˆAIä¸­çš„ä¸åŒè¡Œä¸ºç­–ç•¥ï¼šåœ¨æ¸¸æˆä¸­ï¼Œè§’è‰²çš„è¡Œä¸ºå¯ä»¥çœ‹ä½œæ˜¯ä¸åŒçš„ç®—æ³•ï¼Œä½¿ç”¨ç­–ç•¥æ¨¡å¼å¯ä»¥è®©æ¸¸æˆå¼€å‘è€…å°è£…ä¸åŒçš„è¡Œä¸ºç­–ç•¥ï¼Œè®©ç©å®¶å¯ä»¥é€‰æ‹©è‡ªå·±å–œæ¬¢çš„è§’è‰²è¡Œä¸ºã€‚</li><li>æ¸¸æˆå¼€å‘ä¸­çš„ä¸åŒæ¸¸æˆéš¾åº¦è®¾ç½®ï¼šç­–ç•¥æ¨¡å¼å¯ä»¥ç”¨äºå®šä¹‰ä¸€ç³»åˆ—çš„æ¸¸æˆéš¾åº¦é€‰é¡¹ï¼Œæ¯”å¦‚ç®€å•ã€æ™®é€šã€å›°éš¾ç­‰ã€‚æ¯ä¸ªéš¾åº¦é€‰é¡¹éƒ½æœ‰ä¸åŒçš„æ¸¸æˆè§„åˆ™å’Œæ“ä½œæ–¹å¼ï¼Œç©å®¶å¯ä»¥æ ¹æ®è‡ªå·±çš„å–œå¥½é€‰æ‹©ä¸åŒçš„éš¾åº¦ç­‰çº§æ¥ä½“éªŒæ¸¸æˆã€‚</li><li>æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–ç­–ç•¥ï¼šåœ¨å¤§å‹æ•°æ®åº“ä¸­è¿›è¡ŒæŸ¥è¯¢æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ç­–ç•¥æ¨¡å¼æ¥å°è£…ä¸åŒçš„æŸ¥è¯¢ç®—æ³•ï¼Œæ¯”å¦‚å…¨è¡¨æ‰«æã€ç´¢å¼•æ‰«æã€åˆ†åŒºæŸ¥è¯¢ç­‰ã€‚è¿™æ ·å¯ä»¥è®©å®¢æˆ·ç«¯ä»£ç ä¸å…·ä½“çš„æŸ¥è¯¢ç®—æ³•è§£è€¦ï¼ŒåŒæ—¶æé«˜æŸ¥è¯¢æ•ˆç‡ã€‚</li><li>å›¾åƒå¤„ç†ä¸­çš„ä¸åŒæ»¤é•œæ•ˆæœï¼šæ»¤é•œæ˜¯å›¾åƒå¤„ç†ä¸­å¸¸ç”¨çš„ä¸€ç§æ•ˆæœï¼Œæ¯”å¦‚æ¨¡ç³Šã€é”åŒ–ã€è‰²å½©è°ƒæ•´ç­‰ã€‚ç­–ç•¥æ¨¡å¼å¯ä»¥å°†è¿™äº›æ»¤é•œç®—æ³•å°è£…èµ·æ¥ï¼Œè®©å®¢æˆ·ç«¯å¯ä»¥é€‰æ‹©ä¸åŒçš„æ»¤é•œæ•ˆæœï¼Œè€Œä¸ç”¨å…³å¿ƒå…·ä½“çš„å®ç°ç»†èŠ‚ã€‚</li><li>ç½‘ç»œé€šä¿¡ä¸­çš„æ•°æ®å‹ç¼©ç®—æ³•ï¼šåœ¨ç½‘ç»œé€šä¿¡ä¸­ï¼Œæ•°æ®ä¼ è¾“çš„æ•ˆç‡éå¸¸é‡è¦ã€‚å¯ä»¥ä½¿ç”¨ç­–ç•¥æ¨¡å¼æ¥å°è£…ä¸åŒçš„å‹ç¼©ç®—æ³•ï¼Œæ¯”å¦‚gzipã€deflateç­‰ã€‚è¿™æ ·å¯ä»¥è®©å®¢æˆ·ç«¯æ ¹æ®éœ€è¦é€‰æ‹©ä¸åŒçš„å‹ç¼©ç®—æ³•æ¥æé«˜ä¼ è¾“æ•ˆç‡ã€‚</li><li>æœºå™¨å­¦ä¹ ä¸­çš„ä¸åŒåˆ†ç±»å™¨ç®—æ³•ï¼šåœ¨æœºå™¨å­¦ä¹ ä¸­ï¼Œåˆ†ç±»å™¨æ˜¯ä¸€ç§å¸¸ç”¨çš„æ¨¡å‹ã€‚å¯ä»¥ä½¿ç”¨ç­–ç•¥æ¨¡å¼æ¥å°è£…ä¸åŒçš„åˆ†ç±»å™¨ç®—æ³•ï¼Œæ¯”å¦‚å†³ç­–æ ‘ã€æ”¯æŒå‘é‡æœºã€ç¥ç»ç½‘ç»œç­‰ã€‚è¿™æ ·å¯ä»¥è®©å®¢æˆ·ç«¯é€‰æ‹©ä¸åŒçš„åˆ†ç±»å™¨ç®—æ³•æ¥é€‚åº”ä¸åŒçš„æ•°æ®é›†å’Œä»»åŠ¡éœ€æ±‚ã€‚</li><li>è‡ªç„¶è¯­è¨€å¤„ç†ä¸­çš„ä¸åŒæ–‡æœ¬è§£æç®—æ³•ï¼šè‡ªç„¶è¯­è¨€å¤„ç†æ˜¯ä¸€é¡¹å¤æ‚çš„ä»»åŠ¡ï¼Œéœ€è¦ä½¿ç”¨å¤šç§æ–‡æœ¬è§£æç®—æ³•æ¥å®ç°ã€‚å¯ä»¥ä½¿ç”¨ç­–ç•¥æ¨¡å¼æ¥å°è£…è¿™äº›ç®—æ³•ï¼Œå¦‚æ­£åˆ™è¡¨è¾¾å¼ã€è¯æ€§æ ‡æ³¨ã€å‘½åå®ä½“è¯†åˆ«ç­‰ã€‚è¿™æ ·å¯ä»¥è®©å®¢æˆ·ç«¯é€‰æ‹©ä¸åŒçš„è§£æç®—æ³•æ¥é€‚åº”ä¸åŒçš„æ–‡æœ¬æ ¼å¼å’Œä»»åŠ¡éœ€æ±‚ã€‚</li><li>æ“ä½œç³»ç»Ÿä¸­çš„è¿›ç¨‹è°ƒåº¦ç­–ç•¥ï¼šåœ¨æ“ä½œç³»ç»Ÿä¸­ï¼Œè¿›ç¨‹è°ƒåº¦æ˜¯ä¸€ä¸ªé‡è¦çš„ä»»åŠ¡ã€‚å¯ä»¥ä½¿ç”¨ç­–ç•¥æ¨¡å¼æ¥å°è£…ä¸åŒçš„è°ƒåº¦ç®—æ³•ï¼Œå¦‚å…ˆæ¥å…ˆæœåŠ¡(FCFS)ã€æœ€çŸ­ä½œä¸šä¼˜å…ˆ(SJF)ã€ä¼˜å…ˆçº§è°ƒåº¦ç­‰ã€‚è¿™æ ·å¯ä»¥è®©å®¢æˆ·ç«¯é€‰æ‹©ä¸åŒçš„è°ƒåº¦ç­–ç•¥æ¥é€‚åº”ä¸åŒçš„ç³»ç»Ÿè´Ÿè½½å’Œä»»åŠ¡éœ€æ±‚ã€‚</li><li>å®‰å…¨åŠ å¯†ä¸­çš„ä¸åŒåŠ å¯†ç®—æ³•ï¼šåœ¨å®‰å…¨åŠ å¯†ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä¸åŒçš„åŠ å¯†ç®—æ³•æ¥ä¿æŠ¤æ•°æ®çš„å®‰å…¨æ€§ã€‚å¯ä»¥ä½¿ç”¨ç­–ç•¥æ¨¡å¼æ¥å°è£…è¿™äº›ç®—æ³•ï¼Œå¦‚å¯¹ç§°åŠ å¯†ã€éå¯¹ç§°åŠ å¯†ã€å“ˆå¸Œç®—æ³•ç­‰ã€‚è¿™æ ·å¯ä»¥è®©å®¢æˆ·ç«¯é€‰æ‹©ä¸åŒçš„åŠ å¯†ç®—æ³•æ¥é€‚åº”ä¸åŒçš„å®‰å…¨éœ€æ±‚ã€‚</li><li>èµ„æºç®¡ç†ä¸­çš„ä¸åŒåˆ†é…ç­–ç•¥ï¼šåœ¨èµ„æºç®¡ç†ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ç­–ç•¥æ¨¡å¼æ¥å°è£…ä¸åŒçš„åˆ†é…ç®—æ³•ï¼Œå¦‚å…¬å¹³åˆ†é…ã€è½®æµåˆ†é…ã€ä¼˜å…ˆçº§åˆ†é…ç­‰ã€‚è¿™æ ·å¯ä»¥è®©å®¢æˆ·ç«¯é€‰æ‹©ä¸åŒçš„åˆ†é…ç­–ç•¥æ¥é€‚åº”ä¸åŒçš„åœºæ™¯éœ€æ±‚ã€‚</li><li>å†³ç­–æ ‘ç®—æ³•ä¸­ä¸åŒçš„åˆ’åˆ†ç­–ç•¥ï¼šåœ¨å†³ç­–æ ‘ç®—æ³•ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä¸åŒçš„åˆ’åˆ†ç­–ç•¥æ¥ç¡®å®šæ ‘çš„ç»“æ„å’Œå¶å­èŠ‚ç‚¹çš„ä½ç½®ã€‚å¯ä»¥ä½¿ç”¨ç­–ç•¥æ¨¡å¼æ¥å°è£…è¿™äº›ç­–ç•¥ï¼Œå¦‚ID3ã€C4.5ç­‰å¸¸è§çš„å†³ç­–æ ‘ç®—æ³•ã€‚è¿™æ ·å¯ä»¥è®©å®¢æˆ·ç«¯é€‰æ‹©ä¸åŒçš„åˆ’åˆ†ç­–ç•¥æ¥é€‚åº”ä¸åŒçš„æ•°æ®é›†å’Œä»»åŠ¡éœ€æ±‚ã€‚</li></ul><h1 id="ç­–ç•¥æ¨¡å¼"><a href="#ç­–ç•¥æ¨¡å¼" class="headerlink" title="ç­–ç•¥æ¨¡å¼"></a>ç­–ç•¥æ¨¡å¼</h1><blockquote><p><strong>Spring Bootä¸­ä½¿ç”¨ç­–ç•¥æ¨¡å¼</strong></p></blockquote><p><img src="https://www.naste.top:9000/webp/image-20221127223516181.webp" alt="image-20221127223516181"></p><h2 id="application-yml"><a href="#application-yml" class="headerlink" title="application.yml"></a>application.yml</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨é…ç½®æ–‡ä»¶ä¸­é€‰æ‹©</span></span><br><span class="line"><span class="attr">strategy:</span></span><br><span class="line">  <span class="attr">upload:</span> <span class="string">ali-yun-oss</span></span><br></pre></td></tr></table></figure><h2 id="autoconfigure"><a href="#autoconfigure" class="headerlink" title="autoconfigure"></a>autoconfigure</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;strategy&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StrategyModelProperties</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–‡ä»¶ä¸Šä¼ æ‰§è¡Œç­–åˆ—é€‰æ‹©</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String upload;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="enums"><a href="#enums" class="headerlink" title="enums"></a>enums</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">UploadModeEnum</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é˜¿é‡Œäº‘oss</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    OSS(<span class="string">&quot;ali-yun-oss&quot;</span>, <span class="string">&quot;aliYunOssUploadStrategyImpl&quot;</span>),</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æœ¬åœ°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    LOCAL(<span class="string">&quot;local&quot;</span>, <span class="string">&quot;localUploadStrategyImpl&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¨¡å¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String mode;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç­–ç•¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String strategy;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–ç­–ç•¥</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> mode æ¨¡å¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> &#123;<span class="doctag">@link</span> String&#125; æ–‡ä»¶ä¸Šä¼ æ‰§è¡Œç­–ç•¥ç­–ç•¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getStrategy</span><span class="params">(String mode)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (UploadModeEnum value : UploadModeEnum.values()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (value.getMode().equals(mode)) &#123;</span><br><span class="line">                <span class="keyword">return</span> value.getStrategy();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="context"><a href="#context" class="headerlink" title="context"></a>context</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaofei.policy.strategy.context;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xiaofei.policy.autoconfigure.StrategyModelProperties;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.policy.strategy.UploadStrategy;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> com.xiaofei.policy.enums.UploadModeEnum.getStrategy;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UploadStrategyContext</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¸Šä¼ æ¨¡å¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StrategyModelProperties modelProperties;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, UploadStrategy&gt; uploadStrategyMap;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¸Šä¼ æ–‡ä»¶</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> &#123;<span class="doctag">@link</span> String&#125; æ–‡ä»¶åœ°å€</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">executeUploadStrategy</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> uploadStrategyMap.get(getStrategy(modelProperties.getUpload())).uploadFile();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="strategy-interface"><a href="#strategy-interface" class="headerlink" title="strategy-interface"></a>strategy-interface</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UploadStrategy</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¸Šä¼ æ–‡ä»¶</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> &#123;<span class="doctag">@link</span> String&#125; æ–‡ä»¶åœ°å€</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String <span class="title function_">uploadFile</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="strategy-interface-impl"><a href="#strategy-interface-impl" class="headerlink" title="strategy-interface-impl"></a>strategy-interface-impl</h2><blockquote><p>OSSImpl</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.xiaofei.policy.strategy.UploadStrategy;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AliYunOssUploadStrategyImpl</span> <span class="keyword">implements</span> <span class="title class_">UploadStrategy</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æœ¬åœ°æ–‡ä»¶ä¸Šä¼ </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">uploadFile</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;é˜¿é‡Œäº‘æ–‡ä»¶ä¸Šä¼ &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>LocalImpl</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LocalUploadStrategyImpl</span> <span class="keyword">implements</span> <span class="title class_">UploadStrategy</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æœ¬åœ°æ–‡ä»¶ä¸Šä¼ </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">uploadFile</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;æœ¬åœ°æ–‡ä»¶ä¸Šä¼ &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="TestController"><a href="#TestController" class="headerlink" title="TestController"></a>TestController</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.xiaofei.policy.strategy.context.UploadStrategyContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UploadStrategyContext uploadStrategyContext;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">test</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> uploadStrategyContext.executeUploadStrategy();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>ç­–ç•¥æ¨¡å¼æ˜¯ä¸€ç§è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒå…è®¸åœ¨è¿è¡Œæ—¶é€‰æ‹©ç®—æ³•çš„è¡Œä¸ºæ–¹å¼ã€‚ç­–ç•¥æ¨¡å¼çš„ä¼˜ç‚¹åŒ…æ‹¬ï¼š</p><ul><li>å¯æ‰©å±•æ€§ï¼šç­–ç•¥æ¨¡å¼å¯ä»¥åŠ¨æ€åœ°å¢åŠ ã€ä¿®æ”¹å’Œåˆ é™¤ä¸åŒç®—æ³•çš„å®ç°ï¼Œè€Œä¸éœ€è¦ä¿®æ”¹å®¢æˆ·ç«¯ä»£ç ã€‚è¿™æ ·å¯ä»¥ä½¿ç³»ç»Ÿæ›´åŠ çµæ´»ï¼Œæ˜“äºç»´æŠ¤å’Œæ‰©å±•ã€‚</li><li>é«˜å†…èšæ€§ï¼šç­–ç•¥æ¨¡å¼å°†ç®—æ³•å°è£…æˆç‹¬ç«‹çš„ç­–ç•¥ç±»ï¼Œæ¯ä¸ªç®—æ³•ç±»éƒ½æœ‰è‡ªå·±çš„èŒè´£å’ŒåŠŸèƒ½ï¼Œä»è€Œæé«˜äº†ä»£ç çš„å†…èšæ€§ã€‚</li><li>å¯å¤ç”¨æ€§ï¼šç­–ç•¥æ¨¡å¼å¯ä»¥å°†ä¸åŒçš„ç®—æ³•å°è£…æˆç‹¬ç«‹çš„ç­–ç•¥ç±»ï¼Œä»è€Œå¯ä»¥åœ¨ä¸åŒçš„ç³»ç»Ÿä¸­é‡ç”¨è¿™äº›ç®—æ³•ã€‚è¿™æ ·å¯ä»¥å‡å°‘ä»£ç çš„é‡å¤æ€§ï¼Œæé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¯è¯»æ€§ã€‚</li><li>æ˜“æ‰©å±•æ€§ï¼šç­–ç•¥æ¨¡å¼å¯ä»¥è®©ç”¨æˆ·é€‰æ‹©ä¸åŒçš„ç®—æ³•æ¥é€‚åº”ä¸åŒçš„åœºæ™¯éœ€æ±‚ï¼Œä»è€Œæé«˜äº†ç³»ç»Ÿçš„å¯æ‰©å±•æ€§ã€‚</li><li>æ¾è€¦åˆæ€§ï¼šç­–ç•¥æ¨¡å¼å°†ç®—æ³•ä¸å®¢æˆ·ç«¯è§£è€¦ï¼Œä»è€Œå®ç°äº†ç®—æ³•ä¸å®¢æˆ·ç«¯çš„æ¾è€¦åˆã€‚è¿™æ ·å¯ä»¥æé«˜ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</li></ul><p>ç­–ç•¥æ¨¡å¼çš„ç¼ºç‚¹åŒ…æ‹¬ï¼š</p><ul><li>å®ç°å¤æ‚åº¦ï¼šç­–ç•¥æ¨¡å¼éœ€è¦å®ç°å¤šä¸ªç‹¬ç«‹çš„ç­–ç•¥ç±»æ¥å°è£…ä¸åŒçš„ç®—æ³•ï¼Œä»è€Œå¢åŠ äº†ç³»ç»Ÿçš„å®ç°å¤æ‚åº¦ã€‚</li><li>æ€§èƒ½æŸå¤±ï¼šç”±äºç­–ç•¥æ¨¡å¼éœ€è¦åœ¨è¿è¡Œæ—¶é€‰æ‹©ç®—æ³•çš„è¡Œä¸ºæ–¹å¼ï¼Œå› æ­¤å¯èƒ½ä¼šå¸¦æ¥ä¸€å®šçš„æ€§èƒ½æŸå¤±ã€‚</li><li>é™åˆ¶è¾ƒå¤šï¼šç­–ç•¥æ¨¡å¼è¦æ±‚ç³»ç»Ÿä¸­å¿…é¡»æœ‰å¤šç§ç®—æ³•å¯ä¾›é€‰æ‹©ï¼Œå¦åˆ™æ— æ³•å‘æŒ¥å…¶ä¼˜åŠ¿ã€‚</li><li>éš¾ä»¥è°ƒè¯•ï¼šç”±äºç­–ç•¥æ¨¡å¼å°†ç®—æ³•å°è£…æˆäº†ç‹¬ç«‹çš„ç­–ç•¥ç±»ï¼Œå› æ­¤åœ¨å‡ºç°é—®é¢˜æ—¶å¾ˆéš¾å®šä½é—®é¢˜æ‰€åœ¨ã€‚</li></ul>]]></content>
    
    
    <summary type="html">è®¾è®¡æ¨¡å¼-ç­–ç•¥æ¨¡å¼</summary>
    
    
    
    <category term="Java" scheme="https://www.naste.top:1024/categories/Java/"/>
    
    
    <category term="Java" scheme="https://www.naste.top:1024/tags/Java/"/>
    
    <category term="è®¾è®¡æ¨¡å¼" scheme="https://www.naste.top:1024/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    <category term="ç­–ç•¥æ¨¡å¼" scheme="https://www.naste.top:1024/tags/%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>RabbitMQ</title>
    <link href="https://www.naste.top:1024/posts/3041119952.html"/>
    <id>https://www.naste.top:1024/posts/3041119952.html</id>
    <published>2023-05-21T10:36:36.000Z</published>
    <updated>2023-05-30T13:20:40.712Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h1><p>[toc]</p><h1 id="å¿…è¯»"><a href="#å¿…è¯»" class="headerlink" title="å¿…è¯»"></a>å¿…è¯»</h1><blockquote><p><strong>æœ¬æ–‡æ¡£RabbitMQç‰ˆæœ¬ï¼š3.8.8</strong></p><p><strong>ç¼–ç¨‹è¯­è¨€ï¼šJava</strong></p><p><strong>å‚è€ƒæ–‡æ¡£ï¼š<a href="https://frxcat.fun/pages/e645d9/">https://frxcat.fun/pages/e645d9/</a></strong></p><p><strong>å‚è€ƒè§†é¢‘ï¼š<a href="https://www.bilibili.com/video/BV1cb4y1o7zz/">https://www.bilibili.com/video/BV1cb4y1o7zz/</a></strong></p></blockquote><h1 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h1><h2 id="Dockerå®‰è£…"><a href="#Dockerå®‰è£…" class="headerlink" title="Dockerå®‰è£…"></a>Dockerå®‰è£…</h2><h3 id="å•æœºéƒ¨ç½²"><a href="#å•æœºéƒ¨ç½²" class="headerlink" title="å•æœºéƒ¨ç½²"></a>å•æœºéƒ¨ç½²</h3><blockquote><p><strong>ä½¿ç”¨dockerå•æœºéƒ¨ç½²çš„RabbitMQï¼Œç”¨æˆ·åå’Œå¯†ç é»˜è®¤éƒ½ä¸º<code>guest</code>ï¼Œwebè®¿é—®åœ°å€ä¸º<code>ip+15672</code></strong></p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --restart=always --name rabbitmq -p 5672:5672 -p 15672:15672 rabbitmq:3.8.8-management</span><br></pre></td></tr></table></figure><h1 id="MQæ¦‚å¿µ"><a href="#MQæ¦‚å¿µ" class="headerlink" title="MQæ¦‚å¿µ"></a>MQæ¦‚å¿µ</h1><h2 id="ä»€ä¹ˆæ˜¯MQ"><a href="#ä»€ä¹ˆæ˜¯MQ" class="headerlink" title="ä»€ä¹ˆæ˜¯MQ"></a>ä»€ä¹ˆæ˜¯MQ</h2><p>MQ( æ¶ˆæ¯é˜Ÿåˆ— message queue )ï¼Œä»å­—é¢æ„æ€ä¸Šçœ‹ï¼Œæœ¬è´¨æ˜¯ä¸ªé˜Ÿåˆ—ï¼ŒFIFO å…ˆè¿›çš„æ•°æ®å…ˆå‡º ï¼Œåè¿›çš„æ•°æ®åå‡ºï¼Œåªä¸è¿‡é˜Ÿåˆ—ä¸­å­˜æ”¾çš„å†…å®¹æ˜¯message è€Œå·²ï¼Œè¿˜æ˜¯</p><p>ä¸€ç§è·¨è¿›ç¨‹çš„é€šä¿¡æœºåˆ¶ï¼Œç”¨äºä¸Šä¸‹æ¸¸ä¼ é€’æ¶ˆæ¯ã€‚åœ¨äº’è”ç½‘æ¶æ„ä¸­ï¼ŒMQ æ˜¯ä¸€ç§éå¸¸å¸¸è§çš„ä¸Šä¸‹æ¸¸<code>é€»è¾‘è§£è€¦ + ç‰©ç†è§£è€¦</code>çš„æ¶ˆæ¯é€šä¿¡æœåŠ¡ã€‚ä½¿ç”¨äº† MQ ä¹‹åï¼Œæ¶ˆæ¯å‘</p><p>é€ä¸Šæ¸¸åªéœ€è¦ä¾èµ– MQï¼Œä¸ç”¨ä¾èµ–å…¶ä»–æœåŠ¡ã€‚ </p><h2 id="ä¸ºä»€ä¹ˆè¦ç”¨MQ"><a href="#ä¸ºä»€ä¹ˆè¦ç”¨MQ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ç”¨MQ"></a>ä¸ºä»€ä¹ˆè¦ç”¨MQ</h2><ol><li><p>æµé‡æ¶ˆå³°</p><p> ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœè®¢å•ç³»ç»Ÿæœ€å¤šèƒ½å¤„ç†ä¸€ä¸‡æ¬¡è®¢å•ï¼Œè¿™ä¸ªå¤„ç†èƒ½åŠ›åº”ä»˜æ­£å¸¸æ—¶æ®µçš„ä¸‹å•æ—¶ç»°ç»°æœ‰ä½™ï¼Œæ­£å¸¸æ—¶æ®µæˆ‘ä»¬ä¸‹å•ä¸€ç§’åå°±èƒ½è¿”å›ç»“æœã€‚ä½†æ˜¯åœ¨é«˜å³°æœŸï¼Œå¦‚æœæœ‰ä¸¤ä¸‡æ¬¡ä¸‹å•æ“ä½œç³»ç»Ÿæ˜¯å¤„ç†ä¸äº†çš„ï¼Œåªèƒ½é™åˆ¶è®¢å•è¶…è¿‡ä¸€ä¸‡åä¸å…è®¸ç”¨æˆ·ä¸‹å•ã€‚ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—åšç¼“å†²ï¼Œæˆ‘ä»¬å¯ä»¥å–æ¶ˆè¿™ä¸ªé™åˆ¶ï¼ŒæŠŠä¸€ç§’å†…ä¸‹çš„è®¢å•åˆ† æ•£æˆä¸€æ®µæ—¶é—´æ¥å¤„ç†ï¼Œè¿™æ—¶æœ‰äº›ç”¨æˆ·å¯èƒ½åœ¨ä¸‹å•åå‡ ç§’åæ‰èƒ½æ”¶åˆ°ä¸‹å•æˆåŠŸçš„æ“ä½œï¼Œä½†æ˜¯æ¯”ä¸èƒ½ä¸‹å•çš„ä½“éªŒè¦å¥½ã€‚</p></li><li><p>åº”ç”¨è§£è€¦</p><p> ä»¥ç”µå•†åº”ç”¨ä¸ºä¾‹ï¼Œåº”ç”¨ä¸­æœ‰è®¢å•ç³»ç»Ÿã€åº“å­˜ç³»ç»Ÿã€ç‰©æµç³»ç»Ÿã€æ”¯ä»˜ç³»ç»Ÿã€‚ç”¨æˆ·åˆ›å»ºè®¢å•åï¼Œå¦‚æœè€¦åˆè°ƒç”¨åº“å­˜ç³»ç»Ÿã€ç‰©æµç³»ç»Ÿã€æ”¯ä»˜ç³»ç»Ÿï¼Œä»»ä½•ä¸€ä¸ªå­ç³»ç»Ÿå‡ºäº†æ•…éšœï¼Œéƒ½ä¼šé€ æˆä¸‹å•æ“ä½œå¼‚å¸¸ã€‚å½“è½¬å˜æˆåŸºäºæ¶ˆæ¯é˜Ÿåˆ—çš„æ–¹å¼åï¼Œç³»ç»Ÿé—´è°ƒç”¨çš„é—®é¢˜ä¼šå‡å°‘å¾ˆå¤šï¼Œæ¯”å¦‚ç‰©æµç³»ç»Ÿå› ä¸ºå‘ç”Ÿæ•…éšœï¼Œéœ€è¦å‡ åˆ†é’Ÿæ¥ä¿®å¤ã€‚åœ¨è¿™å‡ åˆ†é’Ÿçš„æ—¶é—´é‡Œï¼Œç‰©æµç³»ç»Ÿè¦å¤„ç†çš„å†…å­˜è¢«ç¼“å­˜åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œç”¨æˆ·çš„ä¸‹å•æ“ä½œå¯ä»¥æ­£å¸¸å®Œæˆã€‚å½“ç‰©æµç³»ç»Ÿæ¢å¤åï¼Œç»§ç»­å¤„ç†è®¢å•ä¿¡æ¯å³å¯ï¼Œä¸­å•ç”¨æˆ·æ„Ÿå—ä¸åˆ°ç‰©æµç³»ç»Ÿçš„æ•…éšœï¼Œæå‡ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚</p><p> <img src="https://www.naste.top:9000/images/image-20230524101404096.png" alt="image-20230524101404096"></p></li><li><p>å¼‚æ­¥å¤„ç†</p><p> æœ‰äº›æœåŠ¡é—´è°ƒç”¨æ˜¯å¼‚æ­¥çš„ï¼Œä¾‹å¦‚ A è°ƒç”¨ Bï¼ŒBéœ€è¦èŠ±è´¹å¾ˆé•¿æ—¶é—´æ‰§è¡Œï¼Œä½†æ˜¯ A éœ€è¦çŸ¥é“ B ä»€ä¹ˆæ—¶å€™å¯ ä»¥æ‰§è¡Œå®Œï¼Œä»¥å‰ä¸€èˆ¬æœ‰ä¸¤ç§æ–¹å¼ï¼ŒAè¿‡ä¸€æ®µæ—¶é—´å»è°ƒç”¨ B çš„æŸ¥è¯¢ api æŸ¥è¯¢ã€‚æˆ–è€… A æä¾›ä¸€ä¸ª callback apiï¼Œ B æ‰§è¡Œå®Œä¹‹åè°ƒç”¨ api é€šçŸ¥ A æœåŠ¡ã€‚è¿™ä¸¤ç§æ–¹å¼éƒ½ä¸æ˜¯å¾ˆä¼˜é›…ï¼Œä½¿ç”¨æ¶ˆæ¯æ€»çº¿ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œ A è°ƒç”¨ B æœåŠ¡åï¼Œåªéœ€è¦ç›‘å¬ B å¤„ç†å®Œæˆçš„æ¶ˆæ¯ï¼Œå½“ B å¤„ç†å®Œæˆåï¼Œä¼šå‘é€ä¸€æ¡æ¶ˆæ¯ç»™MQï¼ŒMQä¼šå°†æ­¤ æ¶ˆæ¯è½¬å‘ç»™ A æœåŠ¡ã€‚è¿™æ · A æœåŠ¡æ—¢ä¸ç”¨å¾ªç¯è°ƒç”¨ B çš„æŸ¥è¯¢ apiï¼Œä¹Ÿä¸ç”¨æä¾› callback apiã€‚åŒæ · B æœåŠ¡ä¹Ÿä¸<br> ç”¨åšè¿™äº›æ“ä½œã€‚AæœåŠ¡è¿˜èƒ½åŠæ—¶çš„å¾—åˆ°å¼‚æ­¥å¤„ç†æˆåŠŸçš„æ¶ˆæ¯ã€‚</p><p> <img src="https://www.naste.top:9000/images/image-20230524101758274.png" alt="image-20230524101758274"></p></li></ol><h2 id="MQåˆ†ç±»"><a href="#MQåˆ†ç±»" class="headerlink" title="MQåˆ†ç±»"></a>MQåˆ†ç±»</h2><ul><li><p><strong>ActiveMQ</strong></p><p>  ä¼˜ç‚¹ï¼šå•æœºååé‡ä¸‡çº§ï¼Œæ—¶æ•ˆæ€§ ms çº§ï¼Œå¯ç”¨æ€§é«˜ï¼ŒåŸºäºä¸»ä»æ¶æ„å®ç°é«˜å¯ç”¨æ€§ï¼Œæ¶ˆæ¯å¯é æ€§è¾ƒ ä½çš„æ¦‚ç‡ä¸¢å¤±æ•°æ®</p><p>  ç¼ºç‚¹ï¼šå®˜æ–¹ç¤¾åŒºç°åœ¨å¯¹ ActiveMQ 5.x ç»´æŠ¤è¶Šæ¥è¶Šå°‘ï¼Œé«˜ååé‡åœºæ™¯è¾ƒå°‘ä½¿ç”¨</p></li><li><p><strong>Kafka</strong></p><p>  å¤§æ•°æ®çš„æ€æ‰‹é”ï¼Œè°ˆåˆ°å¤§æ•°æ®é¢†åŸŸå†…çš„æ¶ˆæ¯ä¼ è¾“ï¼Œåˆ™ç»•ä¸å¼€ Kafkaï¼Œè¿™æ¬¾ä¸ºå¤§æ•°æ®è€Œç”Ÿçš„æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œä»¥å…¶ç™¾ä¸‡çº§ TPS çš„ååé‡åå£°å¤§å™ªï¼Œè¿…é€Ÿæˆä¸ºå¤§æ•°æ®é¢†åŸŸçš„å® å„¿ï¼Œåœ¨æ•°æ®é‡‡é›†ã€ä¼ è¾“ã€å­˜å‚¨çš„è¿‡ç¨‹ä¸­å‘æŒ¥ç€ä¸¾è¶³è½»é‡çš„ä½œç”¨ã€‚ç›®å‰å·²ç»è¢« LinkedInï¼ŒUberï¼ŒTwitterï¼ŒNetflix ç­‰å¤§å…¬å¸æ‰€é‡‡çº³ã€‚</p><p>  ä¼˜ç‚¹: æ€§èƒ½å“è¶Šï¼Œå•æœºå†™å…¥ TPS çº¦åœ¨ç™¾ä¸‡æ¡/ç§’ï¼Œæœ€å¤§çš„ä¼˜ç‚¹ï¼Œå°±æ˜¯ååé‡é«˜ã€‚æ—¶æ•ˆæ€§ ms çº§å¯ç”¨æ€§éå¸¸é«˜ï¼Œkafka æ˜¯åˆ†å¸ƒå¼çš„ï¼Œä¸€ä¸ªæ•°æ®å¤šä¸ªå‰¯æœ¬ï¼Œå°‘æ•°æœºå™¨å®•æœºï¼Œä¸ä¼šä¸¢å¤±æ•°æ®ï¼Œä¸ä¼šå¯¼è‡´ä¸å¯ç”¨,æ¶ˆè´¹è€…é‡‡ç”¨ Pull æ–¹å¼è·å–æ¶ˆæ¯ï¼Œæ¶ˆæ¯æœ‰åºï¼Œé€šè¿‡æ§åˆ¶èƒ½å¤Ÿä¿è¯æ‰€æœ‰æ¶ˆæ¯è¢«æ¶ˆè´¹ä¸”ä»…è¢«æ¶ˆè´¹ä¸€æ¬¡ï¼›æœ‰ä¼˜ç§€çš„ç¬¬ä¸‰æ–¹Kafka Web ç®¡ç†ç•Œé¢ Kafka-Managerï¼›åœ¨æ—¥å¿—é¢†åŸŸæ¯”è¾ƒæˆç†Ÿï¼Œè¢«å¤šå®¶å…¬å¸å’Œå¤šä¸ªå¼€æºé¡¹ç›®ä½¿ç”¨ï¼›åŠŸèƒ½æ”¯æŒï¼šåŠŸèƒ½ è¾ƒä¸ºç®€å•ï¼Œä¸»è¦æ”¯æŒç®€å•çš„ MQ åŠŸèƒ½ï¼Œåœ¨å¤§æ•°æ®é¢†åŸŸçš„å®æ—¶è®¡ç®—ä»¥åŠæ—¥å¿—é‡‡é›†è¢«å¤§è§„æ¨¡ä½¿ç”¨</p><p>  ç¼ºç‚¹ï¼šKafka å•æœºè¶…è¿‡ 64 ä¸ªé˜Ÿåˆ—/åˆ†åŒºï¼ŒLoad ä¼šå‘ç”Ÿæ˜æ˜¾çš„é£™é«˜ç°è±¡ï¼Œé˜Ÿåˆ—è¶Šå¤šï¼Œload è¶Šé«˜ï¼Œå‘é€æ¶ˆæ¯å“åº”æ—¶é—´å˜é•¿ï¼Œä½¿ç”¨çŸ­è½®è¯¢æ–¹å¼ï¼Œå®æ—¶æ€§å–å†³äºè½®è¯¢é—´éš”æ—¶é—´ï¼Œæ¶ˆè´¹å¤±è´¥ä¸æ”¯æŒé‡è¯•ï¼›æ”¯æŒæ¶ˆæ¯é¡ºåºï¼Œä½†æ˜¯ä¸€å°ä»£ç†å®•æœºåï¼Œå°±ä¼šäº§ç”Ÿæ¶ˆæ¯ä¹±åºï¼Œç¤¾åŒºæ›´æ–°è¾ƒæ…¢</p></li><li><p><strong>RocketMQ</strong></p><p>  RocketMQ å‡ºè‡ªé˜¿é‡Œå·´å·´çš„å¼€æºäº§å“ï¼Œç”¨ Java è¯­è¨€å®ç°ï¼Œåœ¨è®¾è®¡æ—¶å‚è€ƒäº† Kafkaï¼Œå¹¶åšå‡ºäº†è‡ªå·±çš„ä¸€äº›æ”¹è¿›ã€‚è¢«é˜¿é‡Œå·´å·´å¹¿æ³›åº”ç”¨åœ¨è®¢å•ï¼Œäº¤æ˜“ï¼Œå……å€¼ï¼Œæµè®¡ç®—ï¼Œæ¶ˆæ¯æ¨é€ï¼Œæ—¥å¿—æµå¼å¤„ç†ï¼Œbinglog åˆ†å‘ç­‰åœºæ™¯ã€‚</p><p>  ä¼˜ç‚¹ï¼šå•æœºååé‡åä¸‡çº§ï¼Œå¯ç”¨æ€§éå¸¸é«˜ï¼Œåˆ†å¸ƒå¼æ¶æ„,æ¶ˆæ¯å¯ä»¥åšåˆ° 0 ä¸¢å¤±,MQ åŠŸèƒ½è¾ƒä¸ºå®Œå–„ï¼Œè¿˜æ˜¯åˆ†å¸ƒå¼çš„ï¼Œæ‰©å±•æ€§å¥½,æ”¯æŒ 10 äº¿çº§åˆ«çš„æ¶ˆæ¯å †ç§¯ï¼Œä¸ä¼šå› ä¸ºå †ç§¯å¯¼è‡´æ€§èƒ½ä¸‹é™ï¼Œæºç æ˜¯ java æˆ‘ä»¬å¯ä»¥è‡ªå·±é˜…è¯»æºç ï¼Œå®šåˆ¶è‡ªå·±å…¬å¸çš„ MQ</p><p>  ç¼ºç‚¹ï¼šæ”¯æŒçš„å®¢æˆ·ç«¯è¯­è¨€ä¸å¤šï¼Œç›®å‰æ˜¯ java åŠ c++ï¼Œå…¶ä¸­ c++ ä¸æˆç†Ÿï¼›ç¤¾åŒºæ´»è·ƒåº¦ä¸€èˆ¬,æ²¡æœ‰åœ¨ MQ æ ¸å¿ƒä¸­å»å®ç° JMS ç­‰æ¥å£,æœ‰äº›ç³»ç»Ÿè¦è¿ç§»éœ€è¦ä¿®æ”¹å¤§é‡ä»£ç </p></li><li><p><strong>RabbitMQ</strong></p><p>  2007 å¹´å‘å¸ƒï¼Œæ˜¯ä¸€ä¸ªåœ¨AMQP(é«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®)åŸºç¡€ä¸Šå®Œæˆçš„ï¼Œå¯å¤ç”¨çš„ä¼ä¸šæ¶ˆæ¯ç³»ç»Ÿï¼Œæ˜¯å½“å‰æœ€ä¸»æµçš„æ¶ˆæ¯ä¸­é—´ä»¶ä¹‹ä¸€ã€‚</p><p>  ä¼˜ç‚¹ï¼šç”±äº erlang è¯­è¨€çš„é«˜å¹¶å‘ç‰¹æ€§ï¼Œæ€§èƒ½è¾ƒå¥½ï¼›ååé‡åˆ°ä¸‡çº§ï¼ŒMQ åŠŸèƒ½æ¯”è¾ƒå®Œå¤‡,å¥å£®ã€ç¨³å®šã€æ˜“ç”¨ã€è·¨å¹³å°ã€æ”¯æŒå¤šç§è¯­è¨€ å¦‚ï¼šPythonã€Rubyã€.NETã€Javaã€JMSã€Cã€PHPã€ActionScriptã€XMPPã€STOMP ç­‰ï¼Œæ”¯æŒ AJAX æ–‡æ¡£é½å…¨ï¼›å¼€æºæä¾›çš„ç®¡ç†ç•Œé¢éå¸¸æ£’ï¼Œç”¨èµ·æ¥å¾ˆå¥½ç”¨,ç¤¾åŒºæ´»è·ƒåº¦é«˜ï¼›æ›´æ–°é¢‘ç‡ç›¸å½“é«˜</p><p>  ç¼ºç‚¹ï¼šå•†ä¸šç‰ˆéœ€è¦æ”¶è´¹,å­¦ä¹ æˆæœ¬è¾ƒé«˜</p></li></ul><h2 id="MQé€‰æ‹©"><a href="#MQé€‰æ‹©" class="headerlink" title="MQé€‰æ‹©"></a>MQé€‰æ‹©</h2><ul><li><p><strong>Kafka</strong></p><p>  Kafka ä¸»è¦ç‰¹ç‚¹æ˜¯åŸºäº Pull çš„æ¨¡å¼æ¥å¤„ç†æ¶ˆæ¯æ¶ˆè´¹ï¼Œè¿½æ±‚é«˜ååé‡ï¼Œä¸€å¼€å§‹çš„ç›®çš„å°±æ˜¯ç”¨äºæ—¥å¿—æ”¶é›†å’Œä¼ è¾“ï¼Œé€‚åˆäº§ç”Ÿå¤§é‡æ•°æ®çš„äº’è”ç½‘æœåŠ¡çš„æ•°æ®æ”¶é›†ä¸šåŠ¡ã€‚å¤§å‹å…¬å¸å»ºè®®å¯ä»¥é€‰ç”¨ï¼Œå¦‚æœæœ‰æ—¥å¿—é‡‡é›†åŠŸèƒ½ï¼Œè‚¯å®šæ˜¯é¦–é€‰ kafka äº†</p></li><li><p><strong>RocketMQ</strong></p><p>  å¤©ç”Ÿä¸ºé‡‘èäº’è”ç½‘é¢†åŸŸè€Œç”Ÿï¼Œå¯¹äºå¯é æ€§è¦æ±‚å¾ˆé«˜çš„åœºæ™¯ï¼Œå°¤å…¶æ˜¯ç”µå•†é‡Œé¢çš„è®¢å•æ‰£æ¬¾ï¼Œä»¥åŠä¸šåŠ¡å‰Šå³°ï¼Œåœ¨å¤§é‡äº¤æ˜“æ¶Œå…¥æ—¶ï¼Œåç«¯å¯èƒ½æ— æ³•åŠæ—¶å¤„ç†çš„æƒ…å†µã€‚RoketMQ åœ¨ç¨³å®šæ€§ä¸Šå¯èƒ½æ›´å€¼å¾—ä¿¡èµ–ï¼Œè¿™äº›ä¸šåŠ¡åœºæ™¯åœ¨é˜¿é‡ŒåŒ 11 å·²ç»ç»å†äº†å¤šæ¬¡è€ƒéªŒï¼Œå¦‚æœä½ çš„ä¸šåŠ¡æœ‰ä¸Šè¿°å¹¶å‘åœºæ™¯ï¼Œå»ºè®®å¯ä»¥é€‰æ‹© RocketMQ</p></li><li><p><strong>RabbitMQ</strong></p><p>  ç»“åˆ erlang è¯­è¨€æœ¬èº«çš„å¹¶å‘ä¼˜åŠ¿ï¼Œæ€§èƒ½å¥½æ—¶æ•ˆæ€§å¾®ç§’çº§ï¼Œç¤¾åŒºæ´»è·ƒåº¦ä¹Ÿæ¯”è¾ƒé«˜ï¼Œç®¡ç†ç•Œé¢ç”¨èµ·æ¥ååˆ† æ–¹ä¾¿ï¼Œå¦‚æœä½ çš„æ•°æ®é‡æ²¡æœ‰é‚£ä¹ˆå¤§ï¼Œä¸­å°å‹å…¬å¸ä¼˜å…ˆé€‰æ‹©åŠŸèƒ½æ¯”è¾ƒå®Œå¤‡çš„ RabbitMQ</p></li></ul><h1 id="RabbitMQç›¸å…³æ¦‚å¿µ"><a href="#RabbitMQç›¸å…³æ¦‚å¿µ" class="headerlink" title="RabbitMQç›¸å…³æ¦‚å¿µ"></a>RabbitMQç›¸å…³æ¦‚å¿µ</h1><h2 id="RabbitMQæ¦‚å¿µ"><a href="#RabbitMQæ¦‚å¿µ" class="headerlink" title="RabbitMQæ¦‚å¿µ"></a>RabbitMQæ¦‚å¿µ</h2><p>RabbitMQ æ˜¯ä¸€ä¸ªæ¶ˆæ¯ä¸­é—´ä»¶ï¼šå®ƒæ¥å—å¹¶è½¬å‘æ¶ˆæ¯ã€‚ä½ å¯ä»¥æŠŠå®ƒå½“åšä¸€ä¸ªå¿«é€’ç«™ç‚¹ï¼Œå½“ä½ è¦å‘é€ä¸€ä¸ªåŒ…è£¹æ—¶ï¼Œä½ æŠŠä½ çš„åŒ…è£¹æ”¾åˆ°å¿«é€’ç«™ï¼Œå¿«é€’å‘˜æœ€ç»ˆä¼šæŠŠä½ çš„å¿«é€’é€åˆ°æ”¶ä»¶äººé‚£é‡Œï¼ŒæŒ‰ç…§è¿™ç§é€»è¾‘ RabbitMQ æ˜¯ ä¸€ä¸ªå¿«é€’ç«™ï¼Œä¸€ä¸ªå¿«é€’å‘˜å¸®ä½ ä¼ é€’å¿«ä»¶ã€‚RabbitMQ ä¸å¿«é€’ç«™çš„ä¸»è¦åŒºåˆ«åœ¨äºï¼Œå®ƒä¸å¤„ç†å¿«ä»¶è€Œæ˜¯æ¥æ”¶ï¼Œå­˜å‚¨å’Œè½¬å‘æ¶ˆæ¯æ•°æ®ã€‚</p><h2 id="RabbitMQå››å¤§æ ¸å¿ƒæ¦‚å¿µ"><a href="#RabbitMQå››å¤§æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="RabbitMQå››å¤§æ ¸å¿ƒæ¦‚å¿µ"></a>RabbitMQå››å¤§æ ¸å¿ƒæ¦‚å¿µ</h2><ul><li><p><code>ç”Ÿäº§è€…</code>ï¼š</p><p>  äº§ç”Ÿæ•°æ®å‘é€æ¶ˆæ¯çš„ç¨‹åº</p></li><li><p><code>äº¤æ¢æœº</code>ï¼š</p><p>  æ˜¯ RabbitMQ éå¸¸é‡è¦çš„ä¸€ä¸ªéƒ¨ä»¶ï¼Œä¸€æ–¹é¢å®ƒæ¥æ”¶æ¥è‡ªç”Ÿäº§è€…çš„æ¶ˆæ¯ï¼Œå¦ä¸€æ–¹é¢å®ƒå°†æ¶ˆæ¯ æ¨é€åˆ°é˜Ÿåˆ—ä¸­ã€‚äº¤æ¢æœºå¿…é¡»ç¡®åˆ‡çŸ¥é“å¦‚ä½•å¤„ç†å®ƒæ¥æ”¶åˆ°çš„æ¶ˆæ¯ï¼Œæ˜¯å°†è¿™äº›æ¶ˆæ¯æ¨é€åˆ°ç‰¹å®šé˜Ÿåˆ—è¿˜æ˜¯æ¨é€åˆ°å¤šä¸ªé˜Ÿåˆ—ï¼Œäº¦æˆ–è€…æ˜¯æŠŠæ¶ˆæ¯ä¸¢å¼ƒï¼Œè¿™ä¸ªå¾—æœ‰äº¤æ¢æœºç±»å‹å†³å®š</p></li><li><p><code>é˜Ÿåˆ—</code>ï¼š</p><p>  æ˜¯ RabbitMQ å†…éƒ¨ä½¿ç”¨çš„ä¸€ç§æ•°æ®ç»“æ„ï¼Œå°½ç®¡æ¶ˆæ¯æµç» RabbitMQ å’Œåº”ç”¨ç¨‹åºï¼Œä½†å®ƒä»¬åªèƒ½å­˜å‚¨åœ¨é˜Ÿåˆ—ä¸­ã€‚é˜Ÿåˆ—ä»…å—ä¸»æœºçš„å†…å­˜å’Œç£ç›˜é™åˆ¶çš„çº¦æŸï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå¤§çš„æ¶ˆæ¯ç¼“å†²åŒºã€‚è®¸å¤šç”Ÿäº§è€…å¯ä»¥å°†æ¶ˆæ¯å‘é€åˆ°ä¸€ä¸ªé˜Ÿåˆ—ï¼Œè®¸å¤šæ¶ˆè´¹è€…å¯ä»¥å°è¯•ä»ä¸€ä¸ªé˜Ÿåˆ—æ¥æ”¶æ•°æ®ã€‚è¿™å°±æ˜¯æˆ‘ä»¬ä½¿ç”¨é˜Ÿåˆ—çš„æ–¹å¼</p></li><li><p><code>æ¶ˆè´¹è€…</code>ï¼š</p><p>  æ¶ˆè´¹ä¸æ¥æ”¶å…·æœ‰ç›¸ä¼¼çš„å«ä¹‰ã€‚æ¶ˆè´¹è€…å¤§å¤šæ—¶å€™æ˜¯ä¸€ä¸ªç­‰å¾…æ¥æ”¶æ¶ˆæ¯çš„ç¨‹åºã€‚è¯·æ³¨æ„ç”Ÿäº§è€…ï¼Œæ¶ˆè´¹è€…å’Œæ¶ˆæ¯ä¸­é—´ä»¶å¾ˆå¤šæ—¶å€™å¹¶ä¸åœ¨åŒä¸€æœºå™¨ä¸Šã€‚åŒä¸€ä¸ªåº”ç”¨ç¨‹åºæ—¢å¯ä»¥æ˜¯ç”Ÿäº§è€…åˆæ˜¯å¯ä»¥æ˜¯æ¶ˆè´¹è€…ã€‚</p></li></ul><h2 id="RabbitMQæ ¸å¿ƒéƒ¨åˆ†"><a href="#RabbitMQæ ¸å¿ƒéƒ¨åˆ†" class="headerlink" title="RabbitMQæ ¸å¿ƒéƒ¨åˆ†"></a>RabbitMQæ ¸å¿ƒéƒ¨åˆ†</h2><p><img src="https://www.naste.top:9000/images/202305241050001.png" alt="202305241050001"></p><h2 id="RabbitMQåè¯ä»‹ç»"><a href="#RabbitMQåè¯ä»‹ç»" class="headerlink" title="RabbitMQåè¯ä»‹ç»"></a>RabbitMQåè¯ä»‹ç»</h2><p><img src="https://www.naste.top:9000/images/image-20230524110356724.png" alt="image-20230524110356724"></p><ul><li><code>Producer</code>ï¼šæ¶ˆæ¯ç”Ÿäº§è€…ã€‚</li><li><code>Consumer</code>ï¼šæ¶ˆæ¯æ¶ˆè´¹è€…ã€‚</li><li><code>Broker</code>ï¼šæ¥æ”¶å’Œåˆ†å‘æ¶ˆæ¯çš„åº”ç”¨ï¼ŒRabbitMQ Server å°±æ˜¯ Message Broker</li><li><code>Virtual host</code>ï¼šå‡ºäºå¤šç§Ÿæˆ·å’Œå®‰å…¨å› ç´ è®¾è®¡çš„ï¼ŒæŠŠ AMQP çš„åŸºæœ¬ç»„ä»¶åˆ’åˆ†åˆ°ä¸€ä¸ªè™šæ‹Ÿçš„åˆ†ç»„ä¸­ï¼Œç±»ä¼¼äºç½‘ç»œä¸­çš„ namespace æ¦‚å¿µã€‚å½“å¤šä¸ªä¸åŒçš„ç”¨æˆ·ä½¿ç”¨åŒä¸€ä¸ª RabbitMQ server æä¾›çš„æœåŠ¡æ—¶ï¼Œå¯ä»¥åˆ’åˆ†å‡ºå¤šä¸ªvhostï¼Œæ¯ä¸ªç”¨æˆ·åœ¨è‡ªå·±çš„ vhost åˆ›å»º exchangeï¼queue ç­‰</li><li><code>Connection</code>ï¼špublisherï¼consumer å’Œ broker ä¹‹é—´çš„ TCP è¿æ¥åˆ° RabbitMQ Server</li><li><code>Channel</code>ï¼šå¦‚æœæ¯ä¸€æ¬¡è®¿é—® RabbitMQ éƒ½å»ºç«‹ä¸€ä¸ª Connectionï¼Œåœ¨æ¶ˆæ¯é‡å¤§çš„æ—¶å€™å»ºç«‹ TCP Connection çš„å¼€é”€å°†æ˜¯å·¨å¤§çš„ï¼Œæ•ˆç‡ä¹Ÿè¾ƒä½ã€‚Channel æ˜¯åœ¨ connection å†…éƒ¨å»ºç«‹çš„é€»è¾‘è¿æ¥ï¼Œå¦‚æœåº”ç”¨ç¨‹åºæ”¯æŒå¤šçº¿ç¨‹ï¼Œé€šå¸¸æ¯ä¸ª thread åˆ›å»ºå•ç‹¬çš„ channel è¿›è¡Œé€šè®¯ï¼ŒAMQP method åŒ…å«äº† channel id å¸®åŠ©å®¢ æˆ·ç«¯å’Œ message broker è¯†åˆ« channelï¼Œæ‰€ä»¥ channel ä¹‹é—´æ˜¯å®Œå…¨éš”ç¦»çš„ã€‚Channel ä½œä¸ºè½»é‡çº§çš„ Connection æå¤§å‡å°‘äº†æ“ä½œç³»ç»Ÿå»ºç«‹ TCP connection çš„å¼€é”€</li><li><code>Exchange</code>ï¼šmessage åˆ°è¾¾ broker çš„ç¬¬ä¸€ç«™ï¼Œæ ¹æ®åˆ†å‘è§„åˆ™ï¼ŒåŒ¹é…æŸ¥è¯¢è¡¨ä¸­çš„ routing keyï¼Œåˆ†å‘ æ¶ˆæ¯åˆ° queue ä¸­å»ã€‚å¸¸ç”¨çš„ç±»å‹æœ‰ï¼šdirect (point-to-point)ï¼Œtopic (publish-subscribe) and fanout (multicast)</li><li><p><code>Queue</code>ï¼šæ¶ˆæ¯æœ€ç»ˆè¢«é€åˆ°è¿™é‡Œç­‰å¾… consumer å–èµ°</p></li><li><p><code>Binding</code>ï¼šexchange å’Œ queue ä¹‹é—´çš„è™šæ‹Ÿè¿æ¥ï¼Œbinding ä¸­å¯ä»¥åŒ…å« routing keyï¼ŒBinding ä¿¡æ¯è¢«ä¿ å­˜åˆ° exchange ä¸­çš„æŸ¥è¯¢è¡¨ä¸­ï¼Œç”¨äº message çš„åˆ†å‘ä¾æ®</p></li><li><code>Routing Keyï¼ˆè·¯ç”±é”®ï¼‰</code>ï¼šæ¶ˆæ¯å‘é€ç»™ Exchangeï¼ˆäº¤æ¢å™¨ï¼‰æ—¶ï¼Œæ¶ˆæ¯å°†æ‹¥æœ‰ä¸€ä¸ªè·¯ç”±é”®ï¼ˆé»˜è®¤ä¸ºç©ºï¼‰ï¼Œ Exchangeï¼ˆäº¤æ¢å™¨ï¼‰æ ¹æ®è¿™ä¸ªè·¯ç”±é”®å°†æ¶ˆæ¯å‘é€åˆ°åŒ¹é…çš„é˜Ÿåˆ—ä¸­</li><li><code>Binding Keyï¼ˆç»‘å®šé”®ï¼‰</code>ï¼šæŒ‡å®šå½“å‰ Exchangeï¼ˆäº¤æ¢å™¨ï¼‰ä¸‹ï¼Œä»€ä¹ˆæ ·çš„ Routing Keyï¼ˆè·¯ç”±é”®ï¼‰ä¼šè¢«ä¸‹æ´¾åˆ°å½“å‰ç»‘å®šçš„ Queue ä¸­</li><li><code>Direct</code>ï¼šå®Œå…¨åŒ¹é…ï¼Œæ¶ˆæ¯è·¯ç”±åˆ°é‚£äº› Routing Key ä¸ Binding Key å®Œå…¨åŒ¹é…çš„ Queue ä¸­ã€‚æ¯”å¦‚ Routing Key ä¸º<code>cleint-key</code>ï¼Œåªä¼šè½¬å‘<code>cleint-key</code>ï¼Œä¸ä¼šè½¬å‘<code>cleint-key.1</code>ï¼Œä¹Ÿä¸ä¼šè½¬å‘<code>cleint-key.1.2</code></li><li>Topicï¼šæ¨¡å¼åŒ¹é…ï¼ŒExchange ä¼šæŠŠæ¶ˆæ¯å‘é€åˆ°ä¸€ä¸ªæˆ–è€…å¤šä¸ªæ»¡è¶³é€šé…ç¬¦è§„åˆ™çš„ routing-key çš„ Queueã€‚å…¶ä¸­<em>è¡¨å·åŒ¹é…ä¸€ä¸ª wordï¼Œ#åŒ¹é…å¤šä¸ª word å’Œè·¯å¾„ï¼Œè·¯å¾„ä¹‹é—´é€šè¿‡.éš”å¼€ã€‚å¦‚æ»¡è¶³a.</em>.cçš„ routing-key æœ‰a.hello.cï¼›æ»¡è¶³#.helloçš„ routing-key æœ‰a.b.c.helo</li><li><code>Fanout</code>ï¼šå¿½ç•¥åŒ¹é…ï¼ŒæŠŠæ‰€æœ‰å‘é€åˆ°è¯¥ Exchange çš„æ¶ˆæ¯è·¯ç”±åˆ°æ‰€æœ‰ä¸å®ƒç»‘å®š çš„Queue ä¸­</li></ul><h1 id="ä»£ç å·¥å…·ç±»"><a href="#ä»£ç å·¥å…·ç±»" class="headerlink" title="ä»£ç å·¥å…·ç±»"></a>ä»£ç å·¥å…·ç±»</h1><h2 id="RabbitMQè¿æ¥ä¿¡é“å·¥å…·ç±»"><a href="#RabbitMQè¿æ¥ä¿¡é“å·¥å…·ç±»" class="headerlink" title="RabbitMQè¿æ¥ä¿¡é“å·¥å…·ç±»"></a>RabbitMQè¿æ¥ä¿¡é“å·¥å…·ç±»</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Channel;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Connection;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.ConnectionFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeoutException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–RabbitMQè¿æ¥ä¿¡é“å·¥å…·ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChannelUtils</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">HOST</span> <span class="operator">=</span> <span class="string">&quot;192.168.40.168&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">USERNAME</span> <span class="operator">=</span> <span class="string">&quot;guest&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PASSWORD</span> <span class="operator">=</span> <span class="string">&quot;guest&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–RabbitMQè¿æ¥ä¿¡é“</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Channel <span class="title function_">getChannel</span><span class="params">()</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºä¸€ä¸ªè¿æ¥å·¥å‚</span></span><br><span class="line">        <span class="type">ConnectionFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConnectionFactory</span>();</span><br><span class="line">        <span class="comment">//å·¥å‚IP è¿æ¥RabbitMQå¯¹åˆ—</span></span><br><span class="line">        factory.setHost(HOST);</span><br><span class="line">        <span class="comment">//ç”¨æˆ·å</span></span><br><span class="line">        factory.setUsername(USERNAME);</span><br><span class="line">        <span class="comment">//å¯†ç </span></span><br><span class="line">        factory.setPassword(PASSWORD);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ›å»ºè¿æ¥</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> factory.newConnection();</span><br><span class="line">        <span class="comment">//è·å–ä¿¡é“</span></span><br><span class="line">        <span class="keyword">return</span> connection.createChannel();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç¡çœ å·¥å…·ç±»"><a href="#ç¡çœ å·¥å…·ç±»" class="headerlink" title="ç¡çœ å·¥å…·ç±»"></a>ç¡çœ å·¥å…·ç±»</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç¡çœ å·¥å…·ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SleepUtils</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sleep</span><span class="params">(<span class="type">int</span> second)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">1000L</span> * second);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            Thread.currentThread().interrupt();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="å…¥é—¨æ¡ˆä¾‹"><a href="#å…¥é—¨æ¡ˆä¾‹" class="headerlink" title="å…¥é—¨æ¡ˆä¾‹"></a>å…¥é—¨æ¡ˆä¾‹</h1><h2 id="Hello-World"><a href="#Hello-World" class="headerlink" title="Hello World"></a>Hello World</h2><p>ç”¨ Java ç¼–å†™ä¸¤ä¸ªç¨‹åºã€‚å•ä¸ªç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…</p><p>åœ¨ä¸‹å›¾ä¸­ï¼Œâ€œ Pâ€ æ˜¯ç”Ÿäº§è€…ï¼Œâ€œ Câ€ æ˜¯æ¶ˆè´¹è€…ã€‚ä¸­é—´çš„æ¡†æ˜¯ä¸€ä¸ªé˜Ÿåˆ—ï¼Œ RabbitMQ ä»£è¡¨ä½¿ç”¨è€…ä¿ç•™çš„æ¶ˆæ¯ç¼“å†²åŒº</p><p><img src="https://www.naste.top:9000/images/image-20230524145429005.png" alt="image-20230524145429005"></p><h3 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h3><h4 id="mavenä¾èµ–"><a href="#mavenä¾èµ–" class="headerlink" title="mavenä¾èµ–"></a>mavenä¾èµ–</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--rabbitmq ä¾èµ–å®¢æˆ·ç«¯--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.rabbitmq<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>amqp-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.8.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--æ“ä½œæ–‡ä»¶æµçš„ä¸€ä¸ªä¾èµ–--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="ç”Ÿäº§è€…"><a href="#ç”Ÿäº§è€…" class="headerlink" title="ç”Ÿäº§è€…"></a>ç”Ÿäº§è€…</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Channel;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.rabbitmq.utils.ChannelUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeoutException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”Ÿäº§è€…ä»£ç </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProducerOne</span> &#123;</span><br><span class="line">    <span class="comment">//å¯¹åˆ—åç§°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å‘æ¶ˆæ¯</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="comment">//è·å–ä¿¡é“</span></span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> ChannelUtils.getChannel();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * ç”Ÿäº§ä¸€ä¸ªå¯¹åˆ—</span></span><br><span class="line"><span class="comment">         * 1.å¯¹åˆ—åç§°</span></span><br><span class="line"><span class="comment">         * 2.å¯¹åˆ—é‡Œé¢çš„æ¶ˆæ¯æ˜¯å¦æŒä¹…åŒ–ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ¶ˆæ¯å­˜å‚¨åœ¨å†…å­˜ä¸­</span></span><br><span class="line"><span class="comment">         * 3.è¯¥é˜Ÿåˆ—æ˜¯å¦åªä¾›ä¸€ä¸ªæ¶ˆè´¹è€…è¿›è¡Œæ¶ˆè´¹ï¼Œæ˜¯å¦è¿›è¡Œæ¶ˆæ¯å…±äº«ï¼Œtrueå¯ä»¥å¤šä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ falseï¼šåªèƒ½ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹</span></span><br><span class="line"><span class="comment">         * 4.æ˜¯å¦è‡ªåŠ¨åˆ é™¤ï¼Œæœ€åä¸€ä¸ªæ¶ˆè´¹è€…ç«¯å¼€é“¾æ¥ä»¥åï¼Œè¯¥é˜Ÿåˆ—æ˜¯å¦è‡ªåŠ¨åˆ é™¤ï¼Œtrueè¡¨ç¤ºè‡ªåŠ¨åˆ é™¤</span></span><br><span class="line"><span class="comment">         * 5.å…¶ä»–å‚æ•°</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        channel.queueDeclare(QUEUE_NAME, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//éœ€è¦å‘é€çš„æ¶ˆæ¯</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;Hello,world&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * å‘é€ä¸€ä¸ªæ¶ˆæ¯</span></span><br><span class="line"><span class="comment">         * 1.å‘é€åˆ°å“ªä¸ªäº¤æ¢æœº</span></span><br><span class="line"><span class="comment">         * 2.è·¯ç”±çš„keyå€¼æ˜¯å“ªä¸ªæœ¬æ¬¡æ˜¯é˜Ÿåˆ—çš„åç§°</span></span><br><span class="line"><span class="comment">         * 3.å…¶ä»–å‚æ•°ä¿¡æ¯</span></span><br><span class="line"><span class="comment">         * 4.å‘é€æ¶ˆæ¯çš„æ¶ˆæ¯ä½“</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        channel.basicPublish(<span class="string">&quot;&quot;</span>, QUEUE_NAME, <span class="literal">null</span>, message.getBytes());</span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">&quot;æ¶ˆæ¯å‘é€å®Œæ¯•&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ¶ˆè´¹è€…"><a href="#æ¶ˆè´¹è€…" class="headerlink" title="æ¶ˆè´¹è€…"></a>æ¶ˆè´¹è€…</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.rabbitmq.client.*;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.rabbitmq.utils.ChannelUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeoutException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¶ˆè´¹è€…</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConsumerOne</span> &#123;</span><br><span class="line">    <span class="comment">//é˜Ÿåˆ—çš„åç§°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ¥æ”¶æ¶ˆæ¯</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="comment">//è·å–è¿æ¥ä¿¡é“</span></span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> ChannelUtils.getChannel();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ¨é€çš„æ¶ˆæ¯å¦‚ä½•è¿›è¡Œæ¶ˆè´¹çš„æ¥å£å›è°ƒï¼Œåœ¨è¯¥æ¥å£ä¸­è¿›è¡Œæ¶ˆæ¯æ¶ˆè´¹</span></span><br><span class="line">        <span class="comment">//TODO è¿™é‡Œç”±äºDeliverCallbackæ˜¯ä¸ªæ¥å£ï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥ä½¿ç”¨äº†Java8æä¾›çš„Lambdaè¡¨è¾¾å¼å®ç°äº†ï¼Œæ²¡æœ‰å¦å¤–å†å†™ä¸€ä¸ªç±»å®ç°è¯¥æ¥å£</span></span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumerTag, message) -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æ¥æ”¶æ¶ˆæ¯äº†&quot;</span>);</span><br><span class="line">            System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(message.getBody()));</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å–æ¶ˆæ¶ˆè´¹çš„ä¸€ä¸ªå›è°ƒæ¥å£ å¦‚åœ¨æ¶ˆè´¹çš„æ—¶å€™é˜Ÿåˆ—è¢«åˆ é™¤æ‰äº†</span></span><br><span class="line">        <span class="comment">//TODO è¿™é‡Œç”±äºCancelCallbackæ˜¯ä¸ªæ¥å£ï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥ä½¿ç”¨äº†Java8æä¾›çš„Lambdaè¡¨è¾¾å¼å®ç°äº†ï¼Œæ²¡æœ‰å¦å¤–å†å†™ä¸€ä¸ªç±»å®ç°è¯¥æ¥å£</span></span><br><span class="line">        <span class="type">CancelCallback</span> <span class="variable">cancelCallback</span> <span class="operator">=</span> consumerTag -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æ¶ˆæ¯æ¶ˆè´¹è¢«ä¸­æ–­&quot;</span>);</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">         * 1.æ¶ˆè´¹å“ªä¸ªé˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">         * 2.æ¶ˆè´¹æˆåŠŸä¹‹åæ˜¯å¦è¦è‡ªåŠ¨åº”ç­”trueï¼šä»£è¡¨è‡ªåŠ¨åº”ç­”false:ä»£è¡¨æ‰‹åŠ¨åº”ç­”</span></span><br><span class="line"><span class="comment">         * 3.æ¶ˆè´¹è€…æœªæˆåŠŸæ¶ˆè´¹çš„å›è°ƒ</span></span><br><span class="line"><span class="comment">         * 4.æ¶ˆè´¹è€…å–æ¶ˆæ¶ˆè´¹çš„å›è°ƒ</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        channel.basicConsume(QUEUE_NAME, <span class="literal">true</span>, deliverCallback, cancelCallback);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Work-Queues"><a href="#Work-Queues" class="headerlink" title="Work Queues"></a>Work Queues</h2><p>Work Queues æ˜¯å·¥ä½œé˜Ÿåˆ—ï¼ˆåˆç§°ä»»åŠ¡é˜Ÿåˆ—ï¼‰çš„ä¸»è¦æ€æƒ³æ˜¯é¿å…ç«‹å³æ‰§è¡Œèµ„æºå¯†é›†å‹ä»»åŠ¡ï¼Œè€Œä¸å¾—ä¸ç­‰å¾…å®ƒå®Œæˆã€‚ç›¸åæˆ‘ä»¬å®‰æ’ä»»åŠ¡åœ¨ä¹‹åæ‰§è¡Œã€‚æˆ‘ä»¬æŠŠä»»åŠ¡å°è£…ä¸ºæ¶ˆæ¯å¹¶å°†å…¶å‘é€åˆ°é˜Ÿåˆ—ã€‚åœ¨åå°è¿è¡Œçš„å·¥ä½œè¿›ç¨‹å°†å¼¹å‡ºä»»åŠ¡å¹¶æœ€ç»ˆæ‰§è¡Œä½œä¸šã€‚å½“æœ‰å¤šä¸ªå·¥ä½œçº¿ç¨‹æ—¶ï¼Œè¿™äº›å·¥ä½œçº¿ç¨‹å°†ä¸€èµ·å¤„ç†è¿™äº›ä»»åŠ¡ã€‚<strong><code>ç›¸å½“äºè´Ÿè½½å‡è¡¡ï¼Œhello worldæ˜¯ä¸€ä¸ªé˜Ÿåˆ—ä¸€ä¸ªå·¥ä½œç°åœºï¼Œwork queuesæ˜¯å¤šä¸ªæ¶ˆè´¹è€…åŒæ—¶å¯¹æ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹</code></strong></p><h3 id="è½®è¯¢æ¶ˆè´¹"><a href="#è½®è¯¢æ¶ˆè´¹" class="headerlink" title="è½®è¯¢æ¶ˆè´¹"></a>è½®è¯¢æ¶ˆè´¹</h3><blockquote><p><strong>ä»£ç è¿˜æ˜¯å‰é¢<code>Hello World</code>ä¸­çš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä»£ç ï¼Œåªæ˜¯ä½¿ç”¨äº†ideaå¯åŠ¨äº†ä¸¤ä¸ªæ¶ˆè´¹è€…</strong></p></blockquote><p>è½®è¯¢æ¶ˆè´¹æ¶ˆæ¯æŒ‡çš„æ˜¯è½®æµæ¶ˆè´¹æ¶ˆæ¯ï¼Œå³æ¯ä¸ªå·¥ä½œé˜Ÿåˆ—éƒ½ä¼šè·å–ä¸€ä¸ªæ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹ï¼Œå¹¶ä¸”è·å–çš„æ¬¡æ•°æŒ‰ç…§é¡ºåºä¾æ¬¡å¾€ä¸‹è½®æµã€‚</p><p>æ¡ˆä¾‹ä¸­ç”Ÿäº§è€…å«åš Taskï¼Œä¸€ä¸ªæ¶ˆè´¹è€…å°±æ˜¯ä¸€ä¸ªå·¥ä½œé˜Ÿåˆ—ï¼Œå¯åŠ¨ä¸¤ä¸ªå·¥ä½œé˜Ÿåˆ—æ¶ˆè´¹æ¶ˆæ¯ï¼Œè¿™ä¸ªä¸¤ä¸ªå·¥ä½œé˜Ÿåˆ—ä¼šä»¥è½®è¯¢çš„æ–¹å¼æ¶ˆè´¹æ¶ˆæ¯ã€‚</p><p><img src="https://www.naste.top:9000/images/image-20230524160903040.png" alt="image-20230524160903040"></p><p><img src="https://www.naste.top:9000/images/image-20230524160935245.png" alt="image-20230524160935245"></p><h2 id="webé¡µé¢æ·»åŠ é˜Ÿåˆ—"><a href="#webé¡µé¢æ·»åŠ é˜Ÿåˆ—" class="headerlink" title="webé¡µé¢æ·»åŠ é˜Ÿåˆ—"></a>webé¡µé¢æ·»åŠ é˜Ÿåˆ—</h2><p><img src="https://www.naste.top:9000/images/image-20230524164535093.png" alt="image-20230524164535093"></p><ol><li>ç‚¹å‡» <code>Queues</code> èœå•</li><li>ç‚¹å‡» <code>Add a new queue</code>ï¼Œå¼¹å‡ºä¸‹æ‹‰èœå•</li><li>ä¸‹æ–¹çš„å¾ˆå¤šå‚æ•°å¯ä»¥è¿›è¡Œé€‰æ‹©ï¼ˆæ—è¾¹æœ‰ ï¼Ÿçš„å‚æ•°ï¼‰ï¼Œå¦‚ä¼˜å…ˆçº§ï¼ˆ<code>Lazy mode</code>ï¼‰ã€ç»‘å®šæ­»ä¿¡é˜Ÿåˆ—ï¼ˆ<code>Dead letter exchange/routing key</code>ï¼‰</li><li>æ‰§è¡Œæ­¥éª¤ 3 åï¼Œåœ¨ <code>Arguments</code> çš„ç¬¬ä¸€ä¸ªæ–‡æœ¬æ¡†å¼¹å‡ºå¯¹åº”çš„å‚æ•°ï¼Œç±»ä¼¼äº Map çš„ key</li><li>ç¬¬äºŒä¸ªæ–‡æœ¬æ¡†å¡«å†™å‚æ•°ï¼Œç±»ä¼¼äº Map çš„ value</li><li>ç¬¬ä¸‰ä¸ªæ˜¯ä¸‹æ‹‰èœå•ï¼Œé€‰æ‹© value ç±»å‹</li><li>ç‚¹å‡» <code>Add queue</code>ï¼Œæ·»åŠ é˜Ÿåˆ—</li></ol><p>æ—è¾¹æœ‰ ï¼Ÿçš„å‚æ•°ï¼Œå°±æ˜¯ <code>channel.queueDeclare(é˜Ÿåˆ—å/String, æŒä¹…åŒ–/boolean, å…±äº«æ¶ˆè´¹/boolean, è‡ªåŠ¨åˆ é™¤/boolean, é…ç½®å‚æ•°/Map);</code> æˆ–è€… <code>channel.basicPublish(äº¤æ¢æœºå/String, é˜Ÿåˆ—å/String, é…ç½®å‚æ•°/Map, æ¶ˆæ¯/String);</code> çš„å‚æ•°ï¼šé…ç½®å‚æ•°/Map çš„ key</p><h1 id="æ¶ˆæ¯åº”ç­”å’Œå‘å¸ƒ"><a href="#æ¶ˆæ¯åº”ç­”å’Œå‘å¸ƒ" class="headerlink" title="æ¶ˆæ¯åº”ç­”å’Œå‘å¸ƒ"></a>æ¶ˆæ¯åº”ç­”å’Œå‘å¸ƒ</h1><h2 id="æ¶ˆæ¯åº”ç­”"><a href="#æ¶ˆæ¯åº”ç­”" class="headerlink" title="æ¶ˆæ¯åº”ç­”"></a>æ¶ˆæ¯åº”ç­”</h2><h3 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h3><p>æ¶ˆè´¹è€…å®Œæˆä¸€ä¸ªä»»åŠ¡å¯èƒ½éœ€è¦ä¸€æ®µæ—¶é—´ï¼Œå¦‚æœå…¶ä¸­ä¸€ä¸ªæ¶ˆè´¹è€…å¤„ç†ä¸€ä¸ªé•¿çš„ä»»åŠ¡å¹¶ä»…åªå®Œæˆäº†éƒ¨åˆ†çªç„¶å®ƒæŒ‚æ‰äº†ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µã€‚RabbitMQ ä¸€æ—¦å‘æ¶ˆè´¹è€…ä¼ é€’äº†ä¸€æ¡æ¶ˆæ¯ï¼Œä¾¿ç«‹å³å°†è¯¥æ¶ˆæ¯æ ‡è®°ä¸ºåˆ é™¤ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œçªç„¶æœ‰ä¸ªæ¶ˆè´¹è€…æŒ‚æ‰äº†ï¼Œæˆ‘ä»¬å°†ä¸¢å¤±æ­£åœ¨å¤„ç†çš„æ¶ˆæ¯ã€‚ä»¥åŠåç»­å‘é€ç»™è¯¥æ¶ˆè´¹è€…çš„æ¶ˆæ¯ï¼Œå› ä¸ºå®ƒæ— æ³•æ¥æ”¶åˆ°ã€‚</p><p>ä¸ºäº†ä¿è¯æ¶ˆæ¯åœ¨å‘é€è¿‡ç¨‹ä¸­ä¸ä¸¢å¤±ï¼Œå¼•å…¥æ¶ˆæ¯åº”ç­”æœºåˆ¶ï¼Œæ¶ˆæ¯åº”ç­”å°±æ˜¯ï¼š<mark><strong>æ¶ˆè´¹è€…åœ¨æ¥æ”¶åˆ°æ¶ˆæ¯å¹¶ä¸”å¤„ç†è¯¥æ¶ˆæ¯ä¹‹åï¼Œå‘Šè¯‰ RabbitMQ å®ƒå·²ç»å¤„ç†äº†ï¼ŒRabbitMQ å¯ä»¥æŠŠè¯¥æ¶ˆæ¯åˆ é™¤äº†</strong></mark>ã€‚</p><h3 id="è‡ªåŠ¨åº”ç­”ï¼ˆæ— éœ€è®¾ç½®ï¼‰"><a href="#è‡ªåŠ¨åº”ç­”ï¼ˆæ— éœ€è®¾ç½®ï¼‰" class="headerlink" title="è‡ªåŠ¨åº”ç­”ï¼ˆæ— éœ€è®¾ç½®ï¼‰"></a>è‡ªåŠ¨åº”ç­”ï¼ˆæ— éœ€è®¾ç½®ï¼‰</h3><p>æ¶ˆæ¯å‘é€åç«‹å³è¢«è®¤ä¸ºå·²ç»ä¼ é€æˆåŠŸï¼Œè¿™ç§æ¨¡å¼éœ€è¦åœ¨<strong>é«˜ååé‡å’Œæ•°æ®ä¼ è¾“å®‰å…¨æ€§æ–¹é¢åšæƒè¡¡</strong>,å› ä¸ºè¿™ç§æ¨¡å¼å¦‚æœæ¶ˆæ¯åœ¨æ¥æ”¶åˆ°ä¹‹å‰ï¼Œæ¶ˆè´¹è€…é‚£è¾¹å‡ºç°è¿æ¥æˆ–è€… channel å…³é—­ï¼Œé‚£ä¹ˆæ¶ˆæ¯å°±ä¸¢å¤±äº†,å½“ç„¶å¦ä¸€æ–¹é¢è¿™ç§æ¨¡å¼æ¶ˆè´¹è€…é‚£è¾¹å¯ä»¥ä¼ é€’è¿‡è½½çš„æ¶ˆæ¯ï¼Œ<strong>æ²¡æœ‰å¯¹ä¼ é€’çš„æ¶ˆæ¯æ•°é‡è¿›è¡Œé™åˆ¶</strong>ï¼Œå½“ç„¶è¿™æ ·æœ‰å¯èƒ½ä½¿å¾—æ¶ˆè´¹è€…è¿™è¾¹ç”±äºæ¥æ”¶å¤ªå¤šè¿˜æ¥ä¸åŠå¤„ç†çš„æ¶ˆæ¯ï¼Œå¯¼è‡´è¿™äº›æ¶ˆæ¯çš„ç§¯å‹ï¼Œæœ€ç»ˆä½¿å¾—å†…å­˜è€—å°½ï¼Œæœ€ç»ˆè¿™äº›æ¶ˆè´¹è€…çº¿ç¨‹è¢«æ“ä½œç³»ç»Ÿæ€æ­»ï¼Œ<strong>æ‰€ä»¥è¿™ç§æ¨¡å¼ä»…é€‚ç”¨åœ¨æ¶ˆè´¹è€…å¯ä»¥é«˜æ•ˆå¹¶ä»¥ æŸç§é€Ÿç‡èƒ½å¤Ÿå¤„ç†è¿™äº›æ¶ˆæ¯çš„æƒ…å†µä¸‹ä½¿ç”¨ã€‚</strong></p><h3 id="æ‰‹åŠ¨åº”ç­”æ–¹æ³•åŠå‚æ•°è§£é‡Š"><a href="#æ‰‹åŠ¨åº”ç­”æ–¹æ³•åŠå‚æ•°è§£é‡Š" class="headerlink" title="æ‰‹åŠ¨åº”ç­”æ–¹æ³•åŠå‚æ•°è§£é‡Š"></a>æ‰‹åŠ¨åº”ç­”æ–¹æ³•åŠå‚æ•°è§£é‡Š</h3><ul><li><code>Channel.basicAck</code> (è‚¯å®šç¡®è®¤åº”ç­”)ï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">basicAck(<span class="type">long</span> deliveryTag, <span class="type">boolean</span> multiple);</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ¶ˆæ¯çš„æ ‡è®°ï¼Œç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºæ˜¯å¦åº”ç”¨äºå¤šæ¶ˆæ¯ï¼ŒRabbitMQ å·²çŸ¥é“è¯¥æ¶ˆæ¯å¹¶ä¸”æˆåŠŸçš„å¤„ç†æ¶ˆæ¯ï¼Œå¯ä»¥å°†å…¶ä¸¢å¼ƒäº†</p><ul><li><code>Channel.basicReject</code> (å¦å®šç¡®è®¤åº”ç­”)</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">basicReject(<span class="type">long</span> deliveryTag, <span class="type">boolean</span> requeue);</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤ºæ‹’ç» <code>deliveryTag</code> å¯¹åº”çš„æ¶ˆæ¯ï¼Œç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºæ˜¯å¦ <code>requeue</code>ï¼štrue åˆ™é‡æ–°å…¥é˜Ÿåˆ—ï¼Œfalse åˆ™ä¸¢å¼ƒæˆ–è€…è¿›å…¥æ­»ä¿¡é˜Ÿåˆ—ã€‚</p><p>è¯¥æ–¹æ³• reject åï¼Œè¯¥æ¶ˆè´¹è€…è¿˜æ˜¯ä¼šæ¶ˆè´¹åˆ°è¯¥æ¡è¢« reject çš„æ¶ˆæ¯ã€‚</p><ul><li><code>Channel.basicNack</code> (ç”¨äºå¦å®šç¡®è®¤)ï¼šç¤ºå·±æ‹’ç»å¤„ç†è¯¥æ¶ˆæ¯ï¼Œå¯ä»¥å°†å…¶ä¸¢å¼ƒäº†</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">basicNack(<span class="type">long</span> deliveryTag, <span class="type">boolean</span> multiple, <span class="type">boolean</span> requeue);</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤ºæ‹’ç» <code>deliveryTag</code> å¯¹åº”çš„æ¶ˆæ¯ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯è¡¨ç¤ºå¦åº”ç”¨äºå¤šæ¶ˆæ¯ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°è¡¨ç¤ºæ˜¯å¦ <code>requeue</code>ï¼Œä¸ basicReject åŒºåˆ«å°±æ˜¯åŒæ—¶æ”¯æŒå¤šä¸ªæ¶ˆæ¯ï¼Œå¯ä»¥ æ‹’ç»ç­¾æ”¶ è¯¥æ¶ˆè´¹è€…å…ˆå‰æ¥æ”¶æœª ack çš„æ‰€æœ‰æ¶ˆæ¯ã€‚æ‹’ç»ç­¾æ”¶åçš„æ¶ˆæ¯ä¹Ÿä¼šè¢«è‡ªå·±æ¶ˆè´¹åˆ°ã€‚</p><ul><li><code>Channel.basicRecover</code></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">basicRecover(<span class="type">boolean</span> requeue);</span><br></pre></td></tr></table></figure><p>æ˜¯å¦æ¢å¤æ¶ˆæ¯åˆ°é˜Ÿåˆ—ï¼Œå‚æ•°æ˜¯æ˜¯å¦ <code>requeue</code>ï¼Œtrue åˆ™é‡æ–°å…¥é˜Ÿåˆ—ï¼Œå¹¶ä¸”å°½å¯èƒ½çš„å°†ä¹‹å‰ <code>recover</code> çš„æ¶ˆæ¯æŠ•é€’ç»™å…¶ä»–æ¶ˆè´¹è€…æ¶ˆè´¹ï¼Œè€Œä¸æ˜¯è‡ªå·±å†æ¬¡æ¶ˆè´¹ã€‚false åˆ™æ¶ˆæ¯ä¼šé‡æ–°è¢«æŠ•é€’ç»™è‡ªå·±ã€‚</p><p><strong>ä¸Šé¢æ‰‹åŠ¨åº”ç­”æ–¹æ³•ä¸­Multipleå‚æ•°çš„è§£é‡Šï¼š</strong></p><ul><li><p>trueï¼šä»£è¡¨æ‰¹é‡åº”ç­” channel ä¸Šæœªåº”ç­”çš„æ¶ˆæ¯ã€‚æ¯”å¦‚è¯´ channel ä¸Šæœ‰ä¼ é€ tag çš„æ¶ˆæ¯ 5,6,7,8 å½“å‰ tag æ˜¯ 8 é‚£ä¹ˆæ­¤æ—¶ 5-8 çš„è¿™äº›è¿˜æœªåº”ç­”çš„æ¶ˆæ¯éƒ½ä¼šè¢«ç¡®è®¤æ”¶åˆ°æ¶ˆæ¯åº”ç­”</p></li><li><p>falseï¼šåŒä¸Šé¢ç›¸æ¯”åªä¼šåº”ç­” tag=8 çš„æ¶ˆæ¯ 5,6,7 è¿™ä¸‰ä¸ªæ¶ˆæ¯ä¾ç„¶ä¸ä¼šè¢«ç¡®è®¤æ”¶åˆ°æ¶ˆæ¯åº”ç­”</p></li></ul><p><img src="https://www.naste.top:9000/images/image-20230524210837312.png" alt="image-20230524210837312"></p><h3 id="æ¶ˆæ¯è‡ªåŠ¨é‡æ–°å…¥é˜Ÿ"><a href="#æ¶ˆæ¯è‡ªåŠ¨é‡æ–°å…¥é˜Ÿ" class="headerlink" title="æ¶ˆæ¯è‡ªåŠ¨é‡æ–°å…¥é˜Ÿ"></a>æ¶ˆæ¯è‡ªåŠ¨é‡æ–°å…¥é˜Ÿ</h3><p>å¦‚æœæ¶ˆè´¹è€…ç”±äºæŸäº›åŸå› å¤±å»è¿æ¥(å…¶é€šé“å·²å…³é—­ï¼Œè¿æ¥å·²å…³é—­æˆ– TCP è¿æ¥ä¸¢å¤±)ï¼Œå¯¼è‡´æ¶ˆæ¯æœªå‘é€ ACK ç¡®è®¤ï¼ŒRabbitMQ å°†äº†è§£åˆ°æ¶ˆæ¯æœªå®Œå…¨å¤„ç†ï¼Œå¹¶å°†å¯¹å…¶é‡æ–°æ’é˜Ÿã€‚å¦‚æœæ­¤æ—¶å…¶ä»–æ¶ˆè´¹è€…å¯ä»¥å¤„ç†ï¼Œå®ƒå°†å¾ˆå¿«å°†å…¶é‡æ–°åˆ†å‘ç»™å¦ä¸€ä¸ªæ¶ˆè´¹è€…ã€‚è¿™æ ·ï¼Œå³ä½¿æŸä¸ªæ¶ˆè´¹è€…å¶å°”æ­»äº¡ï¼Œä¹Ÿå¯ä»¥ç¡®ä¿ä¸ä¼šä¸¢å¤±ä»»ä½•æ¶ˆæ¯ã€‚</p><blockquote><p><strong>ä¸‹é¢å›¾ç‰‡é¡ºåºï¼Œä»å·¦è‡³å³ï¼Œä»ä¸Šè‡³ä¸‹çœ‹ï¼Œæ˜¯è¿ç»­å›¾ï¼Œä¸Šä¸‹ä¸¤å¼ å›¾ï¼ˆ1ï¼Œ2ï¼‰ï¼Œä¸‹é¢ä¸¤å¼ å›¾ï¼ˆ3ï¼Œ4ï¼‰</strong></p></blockquote><p><img src="https://www.naste.top:9000/images/image.4hplocbhsdk0.webp" alt="img"></p><h3 id="æ‰‹åŠ¨åº”ç­”æ¡ˆä¾‹"><a href="#æ‰‹åŠ¨åº”ç­”æ¡ˆä¾‹" class="headerlink" title="æ‰‹åŠ¨åº”ç­”æ¡ˆä¾‹"></a>æ‰‹åŠ¨åº”ç­”æ¡ˆä¾‹</h3><h4 id="ç”Ÿäº§è€…-1"><a href="#ç”Ÿäº§è€…-1" class="headerlink" title="ç”Ÿäº§è€…"></a>ç”Ÿäº§è€…</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Channel;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.rabbitmq.utils.ChannelUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.StandardCharsets;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeoutException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¶ˆæ¯ç”Ÿäº§è€…</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProducerTwo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é˜Ÿåˆ—åç§°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">TASK_QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;ACK_QUEUE&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="comment">//è·å–ä¿¡é“</span></span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> ChannelUtils.getChannel();</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * ç”Ÿäº§ä¸€ä¸ªå¯¹åˆ—</span></span><br><span class="line"><span class="comment">         * 1.å¯¹åˆ—åç§°</span></span><br><span class="line"><span class="comment">         * 2.å¯¹åˆ—é‡Œé¢çš„æ¶ˆæ¯æ˜¯å¦æŒä¹…åŒ–ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ¶ˆæ¯å­˜å‚¨åœ¨å†…å­˜ä¸­</span></span><br><span class="line"><span class="comment">         * 3.è¯¥é˜Ÿåˆ—æ˜¯å¦åªä¾›ä¸€ä¸ªæ¶ˆè´¹è€…è¿›è¡Œæ¶ˆè´¹ï¼Œæ˜¯å¦è¿›è¡Œæ¶ˆæ¯å…±äº«ï¼Œtrueå¯ä»¥å¤šä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ falseï¼šåªèƒ½ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹</span></span><br><span class="line"><span class="comment">         * 4.æ˜¯å¦è‡ªåŠ¨åˆ é™¤ï¼Œæœ€åä¸€ä¸ªæ¶ˆè´¹è€…ç«¯å¼€é“¾æ¥ä»¥åï¼Œè¯¥é˜Ÿåˆ—æ˜¯å¦è‡ªåŠ¨åˆ é™¤ï¼Œtrueè¡¨ç¤ºè‡ªåŠ¨åˆ é™¤</span></span><br><span class="line"><span class="comment">         * 5.å…¶ä»–å‚æ•°</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        channel.queueDeclare(TASK_QUEUE_NAME, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åœ¨æ§åˆ¶å°ä¸­è¾“å…¥éœ€è¦ç”Ÿäº§çš„ä¿¡æ¯</span></span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        System.out.println(<span class="string">&quot;è¯·è¾“å…¥ä¿¡æ¯ï¼š&quot;</span>);</span><br><span class="line">        <span class="keyword">while</span> (scanner.hasNext()) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> scanner.next();</span><br><span class="line"></span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">             * å‘é€ä¸€ä¸ªæ¶ˆæ¯</span></span><br><span class="line"><span class="comment">             * 1.å‘é€åˆ°å“ªä¸ªäº¤æ¢æœº</span></span><br><span class="line"><span class="comment">             * 2.è·¯ç”±çš„keyå€¼æ˜¯å“ªä¸ªæœ¬æ¬¡æ˜¯é˜Ÿåˆ—çš„åç§°</span></span><br><span class="line"><span class="comment">             * 3.å…¶ä»–å‚æ•°ä¿¡æ¯</span></span><br><span class="line"><span class="comment">             * 4.å‘é€æ¶ˆæ¯çš„æ¶ˆæ¯ä½“</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            channel.basicPublish(<span class="string">&quot;&quot;</span>, TASK_QUEUE_NAME, <span class="literal">null</span>, message.getBytes(StandardCharsets.UTF_8));</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;ç”Ÿäº§è€…å‘å‡ºæ¶ˆæ¯:&quot;</span> + message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ¶ˆè´¹è€…-1"><a href="#æ¶ˆè´¹è€…-1" class="headerlink" title="æ¶ˆè´¹è€…"></a>æ¶ˆè´¹è€…</h4><blockquote><p><strong>æ²¡æœ‰åº”ç­”çš„æ¶ˆæ¯ä¼šåœ¨<code>Unacked</code>ä¸­è¿›è¡Œç»Ÿè®¡ï¼Œç­‰åç»­æ¶ˆè´¹è€…å¯¹è¯¥æ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹</strong></p></blockquote><p><img src="https://www.naste.top:9000/images/image-20230525100622070.png" alt="image-20230525100622070"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.rabbitmq.client.CancelCallback;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Channel;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.DeliverCallback;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.rabbitmq.utils.ChannelUtils;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.rabbitmq.utils.SleepUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeoutException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Channel.basicAck (è‚¯å®šç¡®è®¤åº”ç­”)å®ç°æ‰‹åŠ¨æ¶ˆæ¯åº”ç­”</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConsumerTwo</span> &#123;</span><br><span class="line">    <span class="comment">//é˜Ÿåˆ—çš„åç§°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">TASK_QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;ACK_QUEUE&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ¥å—æ¶ˆæ¯</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> ChannelUtils.getChannel();</span><br><span class="line">        System.out.println(<span class="string">&quot;C1ç­‰å¾…æ¥å—æ¶ˆæ¯å¤„ç†æ—¶é—´è¾ƒçŸ­&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ¨é€çš„æ¶ˆæ¯å¦‚ä½•è¿›è¡Œæ¶ˆè´¹çš„æ¥å£å›è°ƒï¼Œåœ¨è¯¥æ¥å£ä¸­è¿›è¡Œæ¶ˆæ¯æ¶ˆè´¹</span></span><br><span class="line">        <span class="comment">//TODO è¿™é‡Œç”±äºDeliverCallbackæ˜¯ä¸ªæ¥å£ï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥ä½¿ç”¨äº†Java8æä¾›çš„Lambdaè¡¨è¾¾å¼å®ç°äº†ï¼Œæ²¡æœ‰å¦å¤–å†å†™ä¸€ä¸ªç±»å®ç°è¯¥æ¥å£</span></span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumerTag, message) -&gt; &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//æ²‰ç¡1S</span></span><br><span class="line">            SleepUtils.sleep(<span class="number">1</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;æ¥å—åˆ°çš„æ¶ˆæ¯:&quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(message.getBody(), <span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">            </span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">             * æ‰‹åŠ¨åº”ç­”</span></span><br><span class="line"><span class="comment">             * 1.æ¶ˆæ¯çš„æ ‡è®°Tag</span></span><br><span class="line"><span class="comment">             * 2.æ˜¯å¦æ‰¹é‡åº”ç­” falseè¡¨ç¤ºä¸æ‰¹é‡åº”ç­”ä¿¡é“ä¸­çš„æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            channel.basicAck(message.getEnvelope().getDeliveryTag(), <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å–æ¶ˆæ¶ˆè´¹çš„ä¸€ä¸ªå›è°ƒæ¥å£ å¦‚åœ¨æ¶ˆè´¹çš„æ—¶å€™é˜Ÿåˆ—è¢«åˆ é™¤æ‰äº†</span></span><br><span class="line">        <span class="comment">//TODO è¿™é‡Œç”±äºCancelCallbackæ˜¯ä¸ªæ¥å£ï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥ä½¿ç”¨äº†Java8æä¾›çš„Lambdaè¡¨è¾¾å¼å®ç°äº†ï¼Œæ²¡æœ‰å¦å¤–å†å†™ä¸€ä¸ªç±»å®ç°è¯¥æ¥å£</span></span><br><span class="line">        <span class="type">CancelCallback</span> <span class="variable">cancelCallback</span> <span class="operator">=</span> (consumerTag -&gt; &#123;</span><br><span class="line">            System.out.println(consumerTag + <span class="string">&quot;æ¶ˆè´¹è€…å–æ¶ˆæ¶ˆè´¹æ¥å£å›è°ƒé€»è¾‘&quot;</span>);</span><br><span class="line"></span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è®¾ç½®å‚æ•°å€¼ä¸ºfalseï¼Œè®¾ç½®ä¸ºæ‰‹åŠ¨åº”ç­”ï¼Œæ‰‹åŠ¨åº”ç­”çš„ä»£ç åœ¨DeliverCallbackæ¶ˆè´¹æ¥å£ä¸­è¿›è¡Œå®ç°</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">autoAck</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">         * 1.æ¶ˆè´¹å“ªä¸ªé˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">         * 2.æ¶ˆè´¹æˆåŠŸä¹‹åæ˜¯å¦è¦è‡ªåŠ¨åº”ç­”trueï¼šä»£è¡¨è‡ªåŠ¨åº”ç­”false:ä»£è¡¨æ‰‹åŠ¨åº”ç­”</span></span><br><span class="line"><span class="comment">         * 3.æ¶ˆè´¹è€…æœªæˆåŠŸæ¶ˆè´¹çš„å›è°ƒ</span></span><br><span class="line"><span class="comment">         * 4.æ¶ˆè´¹è€…å–æ¶ˆæ¶ˆè´¹çš„å›è°ƒ</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        channel.basicConsume(TASK_QUEUE_NAME, autoAck, deliverCallback, cancelCallback);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="RabbitMQæŒä¹…åŒ–"><a href="#RabbitMQæŒä¹…åŒ–" class="headerlink" title="RabbitMQæŒä¹…åŒ–"></a>RabbitMQæŒä¹…åŒ–</h2><p>å½“ RabbitMQ æœåŠ¡åœæ‰ä»¥åï¼Œæ¶ˆæ¯ç”Ÿäº§è€…å‘é€è¿‡æ¥çš„æ¶ˆæ¯ä¸ä¸¢å¤±è¦å¦‚ä½•ä¿éšœï¼Ÿé»˜è®¤æƒ…å†µä¸‹ RabbitMQ é€€å‡ºæˆ–ç”±äºæŸç§åŸå› å´©æºƒæ—¶ï¼Œå®ƒå¿½è§†é˜Ÿåˆ—å’Œæ¶ˆæ¯ï¼Œé™¤éå‘ŠçŸ¥å®ƒä¸è¦è¿™æ ·åšã€‚ç¡®ä¿æ¶ˆæ¯ä¸ä¼šä¸¢å¤±éœ€è¦åšä¸¤ä»¶äº‹ï¼š<strong>æˆ‘ä»¬éœ€è¦å°†é˜Ÿåˆ—å’Œæ¶ˆæ¯éƒ½æ ‡è®°ä¸ºæŒä¹…åŒ–ã€‚</strong></p><h3 id="é˜Ÿåˆ—æŒä¹…åŒ–å’Œæ¶ˆæ¯æŒä¹…åŒ–è§£é‡Š"><a href="#é˜Ÿåˆ—æŒä¹…åŒ–å’Œæ¶ˆæ¯æŒä¹…åŒ–è§£é‡Š" class="headerlink" title="é˜Ÿåˆ—æŒä¹…åŒ–å’Œæ¶ˆæ¯æŒä¹…åŒ–è§£é‡Š"></a>é˜Ÿåˆ—æŒä¹…åŒ–å’Œæ¶ˆæ¯æŒä¹…åŒ–è§£é‡Š</h3><ul><li>åœ¨ RabbitMQ ä¸­ï¼Œæ¶ˆæ¯æŒä¹…åŒ–å’Œé˜Ÿåˆ—æŒä¹…åŒ–æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„æ¦‚å¿µï¼Œå› æ­¤å¯ä»¥åˆ†åˆ«å¼€å¯å®ƒä»¬ï¼Œä¸éœ€è¦åŒæ—¶å¼€å¯é˜Ÿåˆ—æŒä¹…åŒ–æ¥å¯ç”¨æ¶ˆæ¯æŒä¹…åŒ–ã€‚</li><li>åœ¨ RabbitMQ ä¸­ï¼Œæ¶ˆæ¯æŒä¹…åŒ–å’Œé˜Ÿåˆ—æŒä¹…åŒ–å¯ä»¥ä¿è¯æ¶ˆæ¯åœ¨ RabbitMQ æœåŠ¡å™¨å‘ç”Ÿæ•…éšœæ—¶ä¸ä¼šä¸¢å¤±ï¼Œä½†å®ƒä»¬å¹¶ä¸ä¼šå½±å“æ¶ˆæ¯è¢«æ¶ˆè´¹åæ˜¯å¦è¢«åˆ é™¤çš„è¡Œä¸ºã€‚å½“ä¸€ä¸ªæ¶ˆè´¹è€…ä»ä¸€ä¸ªé˜Ÿåˆ—ä¸­è·å–ä¸€æ¡æ¶ˆæ¯å¹¶å¤„ç†å®Œæˆåï¼Œè¯¥æ¶ˆæ¯é»˜è®¤æƒ…å†µä¸‹ä¼šè¢«ä»é˜Ÿåˆ—ä¸­åˆ é™¤ã€‚è¿™æ„å‘³ç€ï¼Œå³ä½¿æ‚¨å¼€å¯äº†æ¶ˆæ¯æŒä¹…åŒ–å’Œé˜Ÿåˆ—æŒä¹…åŒ–ï¼Œä»é˜Ÿåˆ—ä¸­è·å–å¹¶å¤„ç†çš„æ¶ˆæ¯ä»ç„¶ä¼šè¢«åˆ é™¤ï¼Œä¸ä¼šè¢«ä¿å­˜åœ¨é˜Ÿåˆ—ä¸­ã€‚</li></ul><h3 id="é˜Ÿåˆ—æŒä¹…åŒ–"><a href="#é˜Ÿåˆ—æŒä¹…åŒ–" class="headerlink" title="é˜Ÿåˆ—æŒä¹…åŒ–"></a>é˜Ÿåˆ—æŒä¹…åŒ–</h3><p>ä¹‹å‰åˆ›å»ºçš„é˜Ÿåˆ—éƒ½æ˜¯éæŒä¹…åŒ–çš„ï¼ŒRabbitMQ å¦‚æœé‡å¯çš„åŒ–ï¼Œè¯¥é˜Ÿåˆ—å°±ä¼šè¢«åˆ é™¤æ‰ï¼Œå¦‚æœè¦é˜Ÿåˆ—å®ç°æŒä¹…åŒ–éœ€è¦åœ¨å£°æ˜é˜Ÿåˆ—çš„æ—¶å€™æŠŠ durable å‚æ•°è®¾ç½®ä¸ºtrueï¼Œä»£è¡¨å¼€å¯æŒä¹…åŒ–</p><blockquote><p><strong>å·²ç»å¼€å¯æŒä¹…åŒ–çš„é˜Ÿåˆ—ï¼Œä¼šå†<code>Features</code>ä¸­æ ‡æ³¨<code>D</code></strong></p></blockquote><p><img src="https://www.naste.top:9000/images/image-20230525101558937.png" alt="image-20230525101558937"></p><h4 id="ç”Ÿäº§è€…-2"><a href="#ç”Ÿäº§è€…-2" class="headerlink" title="ç”Ÿäº§è€…"></a>ç”Ÿäº§è€…</h4><blockquote><p><strong>å¦‚æœå³å°†åˆ›å»ºçš„é˜Ÿåˆ—åœ¨ä¹‹å‰æ˜¯éæŒä¹…åŒ–åˆ›å»ºçš„ï¼Œå¿…é¡»è¦å…ˆå°†åˆ›å»ºçš„éæŒä¹…åŒ–é˜Ÿåˆ—è¿›è¡Œåˆ é™¤ï¼Œç„¶åå†åˆ›å»ºæ–°çš„æŒä¹…åŒ–é˜Ÿåˆ—ï¼Œå†RabbitMQçš„webæ§åˆ¶å°ä¸Šè¿›è¡Œåˆ é™¤</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Channel;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.rabbitmq.utils.ChannelUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.StandardCharsets;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeoutException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¶ˆæ¯ç”Ÿäº§è€…ï¼Œå¹¶ä¸”åœ¨åˆ›å»ºé˜Ÿåˆ—çš„æ—¶å€™ï¼Œè¿›è¡Œé˜Ÿåˆ—æŒä¹…åŒ–</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProducerTwo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é˜Ÿåˆ—åç§°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">TASK_QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;QUEUE_MESSAGE&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="comment">//è·å–ä¿¡é“</span></span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> ChannelUtils.getChannel();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//å¼€å¯æŒä¹…åŒ–</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">durable</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * ç”Ÿäº§ä¸€ä¸ªå¯¹åˆ—</span></span><br><span class="line"><span class="comment">         * 1.å¯¹åˆ—åç§°</span></span><br><span class="line"><span class="comment">         * 2.å¯¹åˆ—é‡Œé¢çš„æ¶ˆæ¯æ˜¯å¦æŒä¹…åŒ–ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ¶ˆæ¯å­˜å‚¨åœ¨å†…å­˜ä¸­</span></span><br><span class="line"><span class="comment">         * 3.è¯¥é˜Ÿåˆ—æ˜¯å¦åªä¾›ä¸€ä¸ªæ¶ˆè´¹è€…è¿›è¡Œæ¶ˆè´¹ï¼Œæ˜¯å¦è¿›è¡Œæ¶ˆæ¯å…±äº«ï¼Œtrueå¯ä»¥å¤šä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ falseï¼šåªèƒ½ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹</span></span><br><span class="line"><span class="comment">         * 4.æ˜¯å¦è‡ªåŠ¨åˆ é™¤ï¼Œæœ€åä¸€ä¸ªæ¶ˆè´¹è€…ç«¯å¼€é“¾æ¥ä»¥åï¼Œè¯¥é˜Ÿåˆ—æ˜¯å¦è‡ªåŠ¨åˆ é™¤ï¼Œtrueè¡¨ç¤ºè‡ªåŠ¨åˆ é™¤</span></span><br><span class="line"><span class="comment">         * 5.å…¶ä»–å‚æ•°</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        channel.queueDeclare(TASK_QUEUE_NAME, durable, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åœ¨æ§åˆ¶å°ä¸­è¾“å…¥éœ€è¦ç”Ÿäº§çš„ä¿¡æ¯</span></span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        System.out.println(<span class="string">&quot;è¯·è¾“å…¥ä¿¡æ¯ï¼š&quot;</span>);</span><br><span class="line">        <span class="keyword">while</span> (scanner.hasNext()) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> scanner.next();</span><br><span class="line"></span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">             * å‘é€ä¸€ä¸ªæ¶ˆæ¯</span></span><br><span class="line"><span class="comment">             * 1.å‘é€åˆ°å“ªä¸ªäº¤æ¢æœº</span></span><br><span class="line"><span class="comment">             * 2.è·¯ç”±çš„keyå€¼æ˜¯å“ªä¸ªæœ¬æ¬¡æ˜¯é˜Ÿåˆ—çš„åç§°</span></span><br><span class="line"><span class="comment">             * 3.å…¶ä»–å‚æ•°ä¿¡æ¯</span></span><br><span class="line"><span class="comment">             * 4.å‘é€æ¶ˆæ¯çš„æ¶ˆæ¯ä½“</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            channel.basicPublish(<span class="string">&quot;&quot;</span>, TASK_QUEUE_NAME, <span class="literal">null</span>, message.getBytes(StandardCharsets.UTF_8));</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;ç”Ÿäº§è€…å‘å‡ºæ¶ˆæ¯:&quot;</span> + message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ¶ˆè´¹è€…-2"><a href="#æ¶ˆè´¹è€…-2" class="headerlink" title="æ¶ˆè´¹è€…"></a>æ¶ˆè´¹è€…</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.rabbitmq.client.CancelCallback;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Channel;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.DeliverCallback;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.rabbitmq.utils.ChannelUtils;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.rabbitmq.utils.SleepUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeoutException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¶ˆè´¹è€…ä»£ç </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConsumerTwo</span> &#123;</span><br><span class="line">    <span class="comment">//é˜Ÿåˆ—çš„åç§°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">TASK_QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;QUEUE_MESSAGE&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ¥å—æ¶ˆæ¯</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> ChannelUtils.getChannel();</span><br><span class="line">        System.out.println(<span class="string">&quot;C1ç­‰å¾…æ¥å—æ¶ˆæ¯å¤„ç†æ—¶é—´è¾ƒçŸ­&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ¨é€çš„æ¶ˆæ¯å¦‚ä½•è¿›è¡Œæ¶ˆè´¹çš„æ¥å£å›è°ƒï¼Œåœ¨è¯¥æ¥å£ä¸­è¿›è¡Œæ¶ˆæ¯æ¶ˆè´¹</span></span><br><span class="line">        <span class="comment">//TODO è¿™é‡Œç”±äºDeliverCallbackæ˜¯ä¸ªæ¥å£ï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥ä½¿ç”¨äº†Java8æä¾›çš„Lambdaè¡¨è¾¾å¼å®ç°äº†ï¼Œæ²¡æœ‰å¦å¤–å†å†™ä¸€ä¸ªç±»å®ç°è¯¥æ¥å£</span></span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumerTag, message) -&gt; &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//æ²‰ç¡1S</span></span><br><span class="line">            SleepUtils.sleep(<span class="number">1</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;æ¥å—åˆ°çš„æ¶ˆæ¯:&quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(message.getBody(), <span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">            <span class="comment">//æ‰‹åŠ¨åº”ç­”</span></span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">             * 1.æ¶ˆæ¯çš„æ ‡è®°Tag</span></span><br><span class="line"><span class="comment">             * 2.æ˜¯å¦æ‰¹é‡åº”ç­” falseè¡¨ç¤ºä¸æ‰¹é‡åº”ç­”ä¿¡é“ä¸­çš„æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            channel.basicAck(message.getEnvelope().getDeliveryTag(), <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å–æ¶ˆæ¶ˆè´¹çš„ä¸€ä¸ªå›è°ƒæ¥å£ å¦‚åœ¨æ¶ˆè´¹çš„æ—¶å€™é˜Ÿåˆ—è¢«åˆ é™¤æ‰äº†</span></span><br><span class="line">        <span class="comment">//TODO è¿™é‡Œç”±äºCancelCallbackæ˜¯ä¸ªæ¥å£ï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥ä½¿ç”¨äº†Java8æä¾›çš„Lambdaè¡¨è¾¾å¼å®ç°äº†ï¼Œæ²¡æœ‰å¦å¤–å†å†™ä¸€ä¸ªç±»å®ç°è¯¥æ¥å£</span></span><br><span class="line">        <span class="type">CancelCallback</span> <span class="variable">cancelCallback</span> <span class="operator">=</span> (consumerTag -&gt; &#123;</span><br><span class="line">            System.out.println(consumerTag + <span class="string">&quot;æ¶ˆè´¹è€…å–æ¶ˆæ¶ˆè´¹æ¥å£å›è°ƒé€»è¾‘&quot;</span>);</span><br><span class="line"></span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è®¾ç½®å‚æ•°å€¼ä¸ºfalseï¼Œè®¾ç½®ä¸ºæ‰‹åŠ¨åº”ç­”ï¼Œæ‰‹åŠ¨åº”ç­”çš„ä»£ç åœ¨DeliverCallbackæ¶ˆè´¹æ¥å£ä¸­è¿›è¡Œå®ç°</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">autoAck</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">         * 1.æ¶ˆè´¹å“ªä¸ªé˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">         * 2.æ¶ˆè´¹æˆåŠŸä¹‹åæ˜¯å¦è¦è‡ªåŠ¨åº”ç­”trueï¼šä»£è¡¨è‡ªåŠ¨åº”ç­”false:ä»£è¡¨æ‰‹åŠ¨åº”ç­”</span></span><br><span class="line"><span class="comment">         * 3.æ¶ˆè´¹è€…æœªæˆåŠŸæ¶ˆè´¹çš„å›è°ƒ</span></span><br><span class="line"><span class="comment">         * 4.æ¶ˆè´¹è€…å–æ¶ˆæ¶ˆè´¹çš„å›è°ƒ</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        channel.basicConsume(TASK_QUEUE_NAME, autoAck, deliverCallback, cancelCallback);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ¶ˆæ¯æŒä¹…åŒ–"><a href="#æ¶ˆæ¯æŒä¹…åŒ–" class="headerlink" title="æ¶ˆæ¯æŒä¹…åŒ–"></a>æ¶ˆæ¯æŒä¹…åŒ–</h3><h4 id="ç”Ÿäº§è€…-3"><a href="#ç”Ÿäº§è€…-3" class="headerlink" title="ç”Ÿäº§è€…"></a>ç”Ÿäº§è€…</h4><blockquote><p><strong>éœ€è¦ç”Ÿäº§è€…å‘å¸ƒæ¶ˆæ¯çš„æ—¶å€™è¿›è¡Œæ¶ˆæ¯æŒä¹…åŒ–</strong></p><p><strong>åœ¨ basicPublish æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°æ·»åŠ è¿™ä¸ªå±æ€§ï¼š <code>MessageProperties.PERSISTENT_TEXT_PLAIN</code></strong></p></blockquote><p>å°†æ¶ˆæ¯æ ‡è®°ä¸ºæŒä¹…åŒ–å¹¶ä¸èƒ½å®Œå…¨ä¿è¯ä¸ä¼šä¸¢å¤±æ¶ˆæ¯ã€‚å°½ç®¡å®ƒå‘Šè¯‰ RabbitMQ å°†æ¶ˆæ¯ä¿å­˜åˆ°ç£ç›˜ï¼Œä½†æ˜¯è¿™é‡Œä¾ç„¶å­˜åœ¨å½“æ¶ˆæ¯åˆšå‡†å¤‡å­˜å‚¨åœ¨ç£ç›˜çš„æ—¶å€™ ä½†æ˜¯è¿˜æ²¡æœ‰å­˜å‚¨å®Œï¼Œæ¶ˆæ¯è¿˜åœ¨ç¼“å­˜çš„ä¸€ä¸ªé—´éš”ç‚¹ã€‚æ­¤æ—¶å¹¶æ²¡ æœ‰çœŸæ­£å†™å…¥ç£ç›˜ã€‚æŒä¹…æ€§ä¿è¯å¹¶ä¸å¼ºï¼Œä½†æ˜¯å¯¹äºæˆ‘ä»¬çš„ç®€å•ä»»åŠ¡é˜Ÿåˆ—è€Œè¨€ï¼Œè¿™å·²ç»ç»°ç»°æœ‰ä½™äº†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Channel;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.MessageProperties;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.rabbitmq.utils.ChannelUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.StandardCharsets;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeoutException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¶ˆæ¯ç”Ÿäº§è€…ï¼Œå¹¶ä¸”å†æ¶ˆæ¯ç”Ÿäº§çš„æ—¶å€™ï¼Œè¿›è¡Œæ¶ˆæ¯æŒä¹…åŒ–</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProducerTwo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é˜Ÿåˆ—åç§°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">TASK_QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;QUEUE_MESSAGE&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="comment">//è·å–ä¿¡é“</span></span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> ChannelUtils.getChannel();</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * ç”Ÿäº§ä¸€ä¸ªå¯¹åˆ—</span></span><br><span class="line"><span class="comment">         * 1.å¯¹åˆ—åç§°</span></span><br><span class="line"><span class="comment">         * 2.å¯¹åˆ—é‡Œé¢çš„æ¶ˆæ¯æ˜¯å¦æŒä¹…åŒ–ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ¶ˆæ¯å­˜å‚¨åœ¨å†…å­˜ä¸­</span></span><br><span class="line"><span class="comment">         * 3.è¯¥é˜Ÿåˆ—æ˜¯å¦åªä¾›ä¸€ä¸ªæ¶ˆè´¹è€…è¿›è¡Œæ¶ˆè´¹ï¼Œæ˜¯å¦è¿›è¡Œæ¶ˆæ¯å…±äº«ï¼Œtrueå¯ä»¥å¤šä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ falseï¼šåªèƒ½ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹</span></span><br><span class="line"><span class="comment">         * 4.æ˜¯å¦è‡ªåŠ¨åˆ é™¤ï¼Œæœ€åä¸€ä¸ªæ¶ˆè´¹è€…ç«¯å¼€é“¾æ¥ä»¥åï¼Œè¯¥é˜Ÿåˆ—æ˜¯å¦è‡ªåŠ¨åˆ é™¤ï¼Œtrueè¡¨ç¤ºè‡ªåŠ¨åˆ é™¤</span></span><br><span class="line"><span class="comment">         * 5.å…¶ä»–å‚æ•°</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        channel.queueDeclare(TASK_QUEUE_NAME, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åœ¨æ§åˆ¶å°ä¸­è¾“å…¥éœ€è¦ç”Ÿäº§çš„ä¿¡æ¯</span></span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        System.out.println(<span class="string">&quot;è¯·è¾“å…¥ä¿¡æ¯ï¼š&quot;</span>);</span><br><span class="line">        <span class="keyword">while</span> (scanner.hasNext()) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> scanner.next();</span><br><span class="line"></span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">             * å‘é€ä¸€ä¸ªæ¶ˆæ¯</span></span><br><span class="line"><span class="comment">             * 1.å‘é€åˆ°å“ªä¸ªäº¤æ¢æœº</span></span><br><span class="line"><span class="comment">             * 2.è·¯ç”±çš„keyå€¼æ˜¯å“ªä¸ªæœ¬æ¬¡æ˜¯é˜Ÿåˆ—çš„åç§°</span></span><br><span class="line"><span class="comment">             * 3.å…¶ä»–å‚æ•°ä¿¡æ¯ï¼Œè¿™ä½¿ç”¨ã€MessageProperties.PERSISTENT_TEXT_PLAINã€‘å¼€å¯æ¶ˆæ¯æŒä¹…åŒ–</span></span><br><span class="line"><span class="comment">             * 4.å‘é€æ¶ˆæ¯çš„æ¶ˆæ¯ä½“</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            channel.basicPublish(<span class="string">&quot;&quot;</span>, TASK_QUEUE_NAME, MessageProperties.PERSISTENT_TEXT_PLAIN, message.getBytes(StandardCharsets.UTF_8));</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;ç”Ÿäº§è€…å‘å‡ºæ¶ˆæ¯:&quot;</span> + message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ¶ˆè´¹è€…-3"><a href="#æ¶ˆè´¹è€…-3" class="headerlink" title="æ¶ˆè´¹è€…"></a>æ¶ˆè´¹è€…</h4><blockquote><p><strong>å’Œé˜Ÿåˆ—æŒä¹…åŒ–ä¸­çš„æ¶ˆè´¹è€…ä»£ç ä¸€è‡´</strong></p></blockquote><h2 id="ä¸å…¬å¹³åˆ†å‘"><a href="#ä¸å…¬å¹³åˆ†å‘" class="headerlink" title="ä¸å…¬å¹³åˆ†å‘"></a>ä¸å…¬å¹³åˆ†å‘</h2><blockquote><p><strong>åŸæ¥å¤šä¸ªæ¶ˆè´¹è€…æ˜¯é‡‡ç”¨è½®è¯¢æ¶ˆè´¹ï¼Œä¸€ä¸ªæ¶ˆè´¹è€…ä¸€ä¸ªã€‚ä½†æ˜¯å¯èƒ½ç”±äºæ¯ä¸ªæ¶ˆè´¹è€…çš„å¤„ç†æ¶ˆæ¯çš„èƒ½åŠ›ä¸åŒï¼Œæ‰€ä»¥æ‰‹åŠ¨å¹²é¢„æ¯ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯çš„èƒ½åŠ›ï¼Œ<code>å¤„ç†æ¶ˆæ¯å¿«çš„æ¶ˆè´¹è€…å¤šæ¶ˆè´¹æ¶ˆæ¯ï¼Œèƒ½è€…å¤šåŠ³</code></strong></p><p><strong>åœ¨æ¶ˆè´¹è€…ä¸­æ¶ˆè´¹æ¶ˆæ¯ä¹‹å‰ï¼Œæ‰€æœ‰çš„æ¶ˆè´¹è€…éƒ½è¦è®¾ç½®å‚æ•° <code>channel.basicQos(1);</code></strong></p><p><strong>ä¸å…¬å¹³åˆ†å‘å’Œé¢„å–å€¼åˆ†å‘éƒ½ç”¨åˆ° <code>basicQos</code> æ–¹æ³•ï¼Œå¦‚æœå–å€¼ä¸º 1ï¼Œä»£è¡¨ä¸å…¬å¹³åˆ†å‘ï¼Œå–å€¼ä¸ä¸º1ï¼Œä»£è¡¨é¢„å–å€¼åˆ†å‘</strong></p></blockquote><p>åœ¨æœ€å¼€å§‹çš„æ—¶å€™æˆ‘ä»¬å­¦ä¹ åˆ° RabbitMQ åˆ†å‘æ¶ˆæ¯é‡‡ç”¨çš„è½®è¯¢åˆ†å‘ï¼Œä½†æ˜¯åœ¨æŸç§åœºæ™¯ä¸‹è¿™ç§ç­–ç•¥å¹¶ä¸æ˜¯å¾ˆå¥½ï¼Œæ¯”æ–¹è¯´æœ‰ä¸¤ä¸ªæ¶ˆè´¹è€…åœ¨å¤„ç†ä»»åŠ¡ï¼Œå…¶ä¸­æœ‰ä¸ª<strong>æ¶ˆè´¹è€… 1</strong> å¤„ç†ä»»åŠ¡çš„é€Ÿåº¦éå¸¸å¿«ï¼Œè€Œå¦å¤–ä¸€ä¸ª<strong>æ¶ˆè´¹è€… 2</strong> å¤„ç†é€Ÿåº¦å´å¾ˆæ…¢ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬è¿˜æ˜¯é‡‡ç”¨è½®è¯¢åˆ†å‘çš„åŒ–å°±ä¼šåˆ°è¿™å¤„ç†é€Ÿåº¦å¿«çš„è¿™ä¸ªæ¶ˆè´¹è€…å¾ˆå¤§ä¸€éƒ¨åˆ†æ—¶é—´å¤„äºç©ºé—²çŠ¶æ€ï¼Œè€Œå¤„ç†æ…¢çš„é‚£ä¸ªæ¶ˆè´¹è€…ä¸€ç›´åœ¨å¹²æ´»ï¼Œè¿™ç§åˆ†é…æ–¹å¼åœ¨è¿™ç§æƒ…å†µä¸‹å…¶å®å°±ä¸å¤ªå¥½ï¼Œä½†æ˜¯ RabbitMQ å¹¶ä¸çŸ¥é“è¿™ç§æƒ…å†µå®ƒä¾ç„¶å¾ˆå…¬å¹³çš„è¿›è¡Œåˆ†å‘ã€‚</p><h3 id="ç”Ÿäº§è€…-4"><a href="#ç”Ÿäº§è€…-4" class="headerlink" title="ç”Ÿäº§è€…"></a>ç”Ÿäº§è€…</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Channel;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.MessageProperties;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.rabbitmq.utils.ChannelUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.StandardCharsets;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeoutException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¶ˆæ¯ç”Ÿäº§è€…</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProducerTwo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é˜Ÿåˆ—åç§°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">TASK_QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;QUEUE_MESSAGE&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="comment">//è·å–ä¿¡é“</span></span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> ChannelUtils.getChannel();</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * ç”Ÿäº§ä¸€ä¸ªå¯¹åˆ—</span></span><br><span class="line"><span class="comment">         * 1.å¯¹åˆ—åç§°</span></span><br><span class="line"><span class="comment">         * 2.å¯¹åˆ—é‡Œé¢çš„æ¶ˆæ¯æ˜¯å¦æŒä¹…åŒ–ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ¶ˆæ¯å­˜å‚¨åœ¨å†…å­˜ä¸­</span></span><br><span class="line"><span class="comment">         * 3.è¯¥é˜Ÿåˆ—æ˜¯å¦åªä¾›ä¸€ä¸ªæ¶ˆè´¹è€…è¿›è¡Œæ¶ˆè´¹ï¼Œæ˜¯å¦è¿›è¡Œæ¶ˆæ¯å…±äº«ï¼Œtrueå¯ä»¥å¤šä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ falseï¼šåªèƒ½ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹</span></span><br><span class="line"><span class="comment">         * 4.æ˜¯å¦è‡ªåŠ¨åˆ é™¤ï¼Œæœ€åä¸€ä¸ªæ¶ˆè´¹è€…ç«¯å¼€é“¾æ¥ä»¥åï¼Œè¯¥é˜Ÿåˆ—æ˜¯å¦è‡ªåŠ¨åˆ é™¤ï¼Œtrueè¡¨ç¤ºè‡ªåŠ¨åˆ é™¤</span></span><br><span class="line"><span class="comment">         * 5.å…¶ä»–å‚æ•°</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        channel.queueDeclare(TASK_QUEUE_NAME, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åœ¨æ§åˆ¶å°ä¸­è¾“å…¥éœ€è¦ç”Ÿäº§çš„ä¿¡æ¯</span></span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        System.out.println(<span class="string">&quot;è¯·è¾“å…¥ä¿¡æ¯ï¼š&quot;</span>);</span><br><span class="line">        <span class="keyword">while</span> (scanner.hasNext()) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> scanner.next();</span><br><span class="line"></span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">             * å‘é€ä¸€ä¸ªæ¶ˆæ¯</span></span><br><span class="line"><span class="comment">             * 1.å‘é€åˆ°å“ªä¸ªäº¤æ¢æœº</span></span><br><span class="line"><span class="comment">             * 2.è·¯ç”±çš„keyå€¼æ˜¯å“ªä¸ªæœ¬æ¬¡æ˜¯é˜Ÿåˆ—çš„åç§°</span></span><br><span class="line"><span class="comment">             * 3.å…¶ä»–å‚æ•°ä¿¡æ¯ï¼Œè¿™ä½¿ç”¨ã€MessageProperties.PERSISTENT_TEXT_PLAINã€‘å¼€å¯æ¶ˆæ¯æŒä¹…åŒ–</span></span><br><span class="line"><span class="comment">             * 4.å‘é€æ¶ˆæ¯çš„æ¶ˆæ¯ä½“</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            channel.basicPublish(<span class="string">&quot;&quot;</span>, TASK_QUEUE_NAME, MessageProperties.PERSISTENT_TEXT_PLAIN, message.getBytes(StandardCharsets.UTF_8));</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;ç”Ÿäº§è€…å‘å‡ºæ¶ˆæ¯:&quot;</span> + message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ¶ˆè´¹è€…-4"><a href="#æ¶ˆè´¹è€…-4" class="headerlink" title="æ¶ˆè´¹è€…"></a>æ¶ˆè´¹è€…</h3><blockquote><p><strong>æ¶ˆè´¹è€…ä»£ç ä¸­ï¼Œéƒ½éœ€è¦åŠ ä¸Š<code>channel.basicQos(1);</code></strong></p></blockquote><h4 id="æ¶ˆè´¹è€…1"><a href="#æ¶ˆè´¹è€…1" class="headerlink" title="æ¶ˆè´¹è€…1"></a>æ¶ˆè´¹è€…1</h4><blockquote><p><strong>æ¶ˆè´¹è€…1è¿˜åœ¨<code>DeliverCallback</code>å›è°ƒæ¥å£ä¸­åŠ å…¥äº†ç¡çœ çš„ä»£ç ï¼Œè¡¨ç¤ºä¸šåŠ¡å¤„ç†æ—¶é—´è¾ƒé•¿</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.rabbitmq.client.CancelCallback;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Channel;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.DeliverCallback;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.rabbitmq.utils.ChannelUtils;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.rabbitmq.utils.SleepUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeoutException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Date: 2023/5/24</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> XiaoFei</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConsumerTwo</span> &#123;</span><br><span class="line">    <span class="comment">//é˜Ÿåˆ—çš„åç§°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">TASK_QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;QUEUE_MESSAGE&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ¥å—æ¶ˆæ¯</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> ChannelUtils.getChannel();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ¨é€çš„æ¶ˆæ¯å¦‚ä½•è¿›è¡Œæ¶ˆè´¹çš„æ¥å£å›è°ƒï¼Œåœ¨è¯¥æ¥å£ä¸­è¿›è¡Œæ¶ˆæ¯æ¶ˆè´¹</span></span><br><span class="line">        <span class="comment">//TODO è¿™é‡Œç”±äºDeliverCallbackæ˜¯ä¸ªæ¥å£ï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥ä½¿ç”¨äº†Java8æä¾›çš„Lambdaè¡¨è¾¾å¼å®ç°äº†ï¼Œæ²¡æœ‰å¦å¤–å†å†™ä¸€ä¸ªç±»å®ç°è¯¥æ¥å£</span></span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumerTag, message) -&gt; &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//æ²‰ç¡1S</span></span><br><span class="line">            SleepUtils.sleep(<span class="number">3</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;æ¥å—åˆ°çš„æ¶ˆæ¯:&quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(message.getBody(), <span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">            <span class="comment">//æ‰‹åŠ¨åº”ç­”</span></span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">             * 1.æ¶ˆæ¯çš„æ ‡è®°Tag</span></span><br><span class="line"><span class="comment">             * 2.æ˜¯å¦æ‰¹é‡åº”ç­” falseè¡¨ç¤ºä¸æ‰¹é‡åº”ç­”ä¿¡é“ä¸­çš„æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            channel.basicAck(message.getEnvelope().getDeliveryTag(), <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å–æ¶ˆæ¶ˆè´¹çš„ä¸€ä¸ªå›è°ƒæ¥å£ å¦‚åœ¨æ¶ˆè´¹çš„æ—¶å€™é˜Ÿåˆ—è¢«åˆ é™¤æ‰äº†</span></span><br><span class="line">        <span class="comment">//TODO è¿™é‡Œç”±äºCancelCallbackæ˜¯ä¸ªæ¥å£ï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥ä½¿ç”¨äº†Java8æä¾›çš„Lambdaè¡¨è¾¾å¼å®ç°äº†ï¼Œæ²¡æœ‰å¦å¤–å†å†™ä¸€ä¸ªç±»å®ç°è¯¥æ¥å£</span></span><br><span class="line">        <span class="type">CancelCallback</span> <span class="variable">cancelCallback</span> <span class="operator">=</span> (consumerTag -&gt; &#123;</span><br><span class="line">            System.out.println(consumerTag + <span class="string">&quot;æ¶ˆè´¹è€…å–æ¶ˆæ¶ˆè´¹æ¥å£å›è°ƒé€»è¾‘&quot;</span>);</span><br><span class="line"></span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è®¾ç½®ä¸å…¬å¹³åˆ†å‘</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">prefetchCount</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        channel.basicQos(prefetchCount);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è®¾ç½®å‚æ•°å€¼ä¸ºfalseï¼Œè®¾ç½®ä¸ºæ‰‹åŠ¨åº”ç­”ï¼Œæ‰‹åŠ¨åº”ç­”çš„ä»£ç åœ¨DeliverCallbackæ¶ˆè´¹æ¥å£ä¸­è¿›è¡Œå®ç°</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">autoAck</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">         * 1.æ¶ˆè´¹å“ªä¸ªé˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">         * 2.æ¶ˆè´¹æˆåŠŸä¹‹åæ˜¯å¦è¦è‡ªåŠ¨åº”ç­”trueï¼šä»£è¡¨è‡ªåŠ¨åº”ç­”false:ä»£è¡¨æ‰‹åŠ¨åº”ç­”</span></span><br><span class="line"><span class="comment">         * 3.æ¶ˆè´¹è€…æœªæˆåŠŸæ¶ˆè´¹çš„å›è°ƒ</span></span><br><span class="line"><span class="comment">         * 4.æ¶ˆè´¹è€…å–æ¶ˆæ¶ˆè´¹çš„å›è°ƒ</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        channel.basicConsume(TASK_QUEUE_NAME, autoAck, deliverCallback, cancelCallback);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ¶ˆè´¹è€…2"><a href="#æ¶ˆè´¹è€…2" class="headerlink" title="æ¶ˆè´¹è€…2"></a>æ¶ˆè´¹è€…2</h4><blockquote><p><strong>æ¶ˆè´¹è€…2è¿˜åœ¨<code>DeliverCallback</code>å›è°ƒæ¥å£ä¸­æ²¡æœ‰åŠ å…¥äº†ç¡çœ çš„ä»£ç ï¼Œè¡¨ç¤ºä¸šåŠ¡å¤„ç†æ—¶é—´è¾ƒçŸ­ï¼Œå¯ä»¥å¤„ç†è¾ƒå¤šçš„æ¶ˆæ¯</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.rabbitmq.client.CancelCallback;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Channel;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.DeliverCallback;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.rabbitmq.utils.ChannelUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeoutException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¶ˆæ¯æ¶ˆè´¹è€…</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConsumerThree</span> &#123;</span><br><span class="line">    <span class="comment">//é˜Ÿåˆ—çš„åç§°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">TASK_QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;QUEUE_MESSAGE&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ¥å—æ¶ˆæ¯</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> ChannelUtils.getChannel();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ¨é€çš„æ¶ˆæ¯å¦‚ä½•è¿›è¡Œæ¶ˆè´¹çš„æ¥å£å›è°ƒï¼Œåœ¨è¯¥æ¥å£ä¸­è¿›è¡Œæ¶ˆæ¯æ¶ˆè´¹</span></span><br><span class="line">        <span class="comment">//TODO è¿™é‡Œç”±äºDeliverCallbackæ˜¯ä¸ªæ¥å£ï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥ä½¿ç”¨äº†Java8æä¾›çš„Lambdaè¡¨è¾¾å¼å®ç°äº†ï¼Œæ²¡æœ‰å¦å¤–å†å†™ä¸€ä¸ªç±»å®ç°è¯¥æ¥å£</span></span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumerTag, message) -&gt; &#123;</span><br><span class="line">            </span><br><span class="line">            System.out.println(<span class="string">&quot;æ¥å—åˆ°çš„æ¶ˆæ¯:&quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(message.getBody(), <span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//æ‰‹åŠ¨åº”ç­”</span></span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">             * 1.æ¶ˆæ¯çš„æ ‡è®°Tag</span></span><br><span class="line"><span class="comment">             * 2.æ˜¯å¦æ‰¹é‡åº”ç­” falseè¡¨ç¤ºä¸æ‰¹é‡åº”ç­”ä¿¡é“ä¸­çš„æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            channel.basicAck(message.getEnvelope().getDeliveryTag(), <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å–æ¶ˆæ¶ˆè´¹çš„ä¸€ä¸ªå›è°ƒæ¥å£ å¦‚åœ¨æ¶ˆè´¹çš„æ—¶å€™é˜Ÿåˆ—è¢«åˆ é™¤æ‰äº†</span></span><br><span class="line">        <span class="comment">//TODO è¿™é‡Œç”±äºCancelCallbackæ˜¯ä¸ªæ¥å£ï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥ä½¿ç”¨äº†Java8æä¾›çš„Lambdaè¡¨è¾¾å¼å®ç°äº†ï¼Œæ²¡æœ‰å¦å¤–å†å†™ä¸€ä¸ªç±»å®ç°è¯¥æ¥å£</span></span><br><span class="line">        <span class="type">CancelCallback</span> <span class="variable">cancelCallback</span> <span class="operator">=</span> (consumerTag -&gt; &#123;</span><br><span class="line">            System.out.println(consumerTag + <span class="string">&quot;æ¶ˆè´¹è€…å–æ¶ˆæ¶ˆè´¹æ¥å£å›è°ƒé€»è¾‘&quot;</span>);</span><br><span class="line"></span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è®¾ç½®ä¸å…¬å¹³åˆ†å‘</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">prefetchCount</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        channel.basicQos(prefetchCount);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è®¾ç½®å‚æ•°å€¼ä¸ºfalseï¼Œè®¾ç½®ä¸ºæ‰‹åŠ¨åº”ç­”ï¼Œæ‰‹åŠ¨åº”ç­”çš„ä»£ç åœ¨DeliverCallbackæ¶ˆè´¹æ¥å£ä¸­è¿›è¡Œå®ç°</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">autoAck</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">         * 1.æ¶ˆè´¹å“ªä¸ªé˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">         * 2.æ¶ˆè´¹æˆåŠŸä¹‹åæ˜¯å¦è¦è‡ªåŠ¨åº”ç­”trueï¼šä»£è¡¨è‡ªåŠ¨åº”ç­”false:ä»£è¡¨æ‰‹åŠ¨åº”ç­”</span></span><br><span class="line"><span class="comment">         * 3.æ¶ˆè´¹è€…æœªæˆåŠŸæ¶ˆè´¹çš„å›è°ƒ</span></span><br><span class="line"><span class="comment">         * 4.æ¶ˆè´¹è€…å–æ¶ˆæ¶ˆè´¹çš„å›è°ƒ</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        channel.basicConsume(TASK_QUEUE_NAME, autoAck, deliverCallback, cancelCallback);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ•ˆæœ"><a href="#æ•ˆæœ" class="headerlink" title="æ•ˆæœ"></a>æ•ˆæœ</h4><p><img src="https://www.naste.top:9000/images/image-20230525150516234.png" alt="image-20230525150516234"></p><h2 id="é¢„å–å€¼åˆ†å‘"><a href="#é¢„å–å€¼åˆ†å‘" class="headerlink" title="é¢„å–å€¼åˆ†å‘"></a>é¢„å–å€¼åˆ†å‘</h2><p>RabbitMQ æ˜¯ä¸€ç§æµè¡Œçš„æ¶ˆæ¯ä»£ç†ï¼Œå®ƒå…è®¸åº”ç”¨ç¨‹åºä¹‹é—´é€šè¿‡æ¶ˆæ¯ä¼ é€’è¿›è¡Œé€šä¿¡ã€‚é¢„å–å€¼ï¼ˆPrefetchï¼‰æ˜¯ RabbitMQ ä¸­ç”¨äºæ§åˆ¶æ¶ˆè´¹è€…è·å–æ¶ˆæ¯æ•°é‡çš„æœºåˆ¶ä¹‹ä¸€ï¼Œå®ƒæŒ‡å®šä¸€ä¸ªæ¶ˆè´¹è€…å¯ä»¥ä»é˜Ÿåˆ—ä¸­é¢„å–çš„æœªç¡®è®¤æ¶ˆæ¯çš„æœ€å¤§æ•°é‡ã€‚</p><p><strong>é¢„å–å€¼ä¸º 1 æ˜¯æœ€ä¿å®ˆçš„ã€‚å½“ç„¶è¿™å°†ä½¿ååé‡å˜å¾—å¾ˆä½ï¼Œç‰¹åˆ«æ˜¯æ¶ˆè´¹è€…è¿æ¥å»¶è¿Ÿå¾ˆä¸¥é‡çš„æƒ…å†µä¸‹ï¼Œç‰¹åˆ«æ˜¯åœ¨æ¶ˆè´¹è€…è¿æ¥ç­‰å¾…æ—¶é—´è¾ƒé•¿çš„ç¯å¢ƒ ä¸­ã€‚å¯¹äºå¤§å¤šæ•°åº”ç”¨æ¥è¯´ï¼Œç¨å¾®é«˜ä¸€ç‚¹çš„å€¼å°†æ˜¯æœ€ä½³çš„ã€‚</strong></p><blockquote><p><strong>æ­¤æ—¶æœ‰ä¸¤ä¸ªå‘æ¶ˆè´¹è€…ï¼Œå¦‚æœç”Ÿäº§è€…æ€»å…±å‘å¸ƒäº†äº”æ¡æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…1è®¾ç½®<code>basicQos(2)</code>ï¼Œé‚£æ¶ˆè´¹è€…åªèƒ½æ¶ˆè´¹<code>ä¸¤æ¡</code>æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…2è®¾ç½®<code>basicQos(3)</code>ï¼Œé‚£æ¶ˆè´¹è€…åªèƒ½æ¶ˆè´¹<code>ä¸‰æ¡</code>æ¶ˆæ¯ï¼ŒæŒ‰æ¯”ä¾‹è¿›è¡Œæ¶ˆè´¹</strong></p><p><strong>ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä»£ç å’Œå‰é¢çš„ä¸å…¬å¹³åˆ†å‘ä¸­ç”Ÿäº§è€…ä»£ç ä¸€æ ·ï¼Œåªæ˜¯<code>channel.basicQos(æ­£æ•´æ•°);</code>è®¾ç½®çš„å€¼ä¸ä¸€è‡´ï¼Œæ¥å½±å“æ¯ä¸ªæ¶ˆè´¹è€…å¯ä»¥æ¶ˆè´¹çš„æ¶ˆæ¯æ¯”ä¾‹ï¼Œé¿å…æ¶ˆè´¹è€…ä»é˜Ÿåˆ—ä¸­è·å–å¤ªå¤šçš„æ¶ˆæ¯è€Œæ— æ³•åŠæ—¶å¤„ç†å®ƒä»¬</strong></p></blockquote><p><img src="https://www.naste.top:9000/images/image-20230525161925342.png" alt="image-20230525161925342"></p><h2 id="å‘å¸ƒç¡®è®¤"><a href="#å‘å¸ƒç¡®è®¤" class="headerlink" title="å‘å¸ƒç¡®è®¤"></a>å‘å¸ƒç¡®è®¤</h2><blockquote><p><strong>ç¡®è®¤å‘å¸ƒæŒ‡çš„æ˜¯æˆåŠŸå‘é€åˆ°äº†é˜Ÿåˆ—ï¼Œå¹¶ä¸æ˜¯æ¶ˆè´¹è€…æ¶ˆè´¹äº†æ¶ˆæ¯</strong></p></blockquote><p>ç”Ÿäº§è€…å‘å¸ƒæ¶ˆæ¯åˆ° RabbitMQ åï¼Œéœ€è¦ RabbitMQ è¿”å›ã€ ACKï¼ˆå·²æ”¶åˆ°ï¼‰ã€‘ç»™ç”Ÿäº§è€…ï¼Œè¿™æ ·ç”Ÿäº§è€…æ‰çŸ¥é“è‡ªå·±ç”Ÿäº§çš„æ¶ˆæ¯æˆåŠŸå‘å¸ƒå‡ºå»</p><h3 id="å‘å¸ƒç¡®è®¤é€»è¾‘"><a href="#å‘å¸ƒç¡®è®¤é€»è¾‘" class="headerlink" title="å‘å¸ƒç¡®è®¤é€»è¾‘"></a>å‘å¸ƒç¡®è®¤é€»è¾‘</h3><p>ç”Ÿäº§è€…å°†ä¿¡é“è®¾ç½®æˆ confirm æ¨¡å¼ï¼Œä¸€æ—¦ä¿¡é“è¿›å…¥ confirm æ¨¡å¼ï¼Œæ‰€æœ‰åœ¨è¯¥ä¿¡é“ä¸Šé¢å‘å¸ƒçš„æ¶ˆæ¯éƒ½å°†ä¼šè¢«æŒ‡æ´¾ä¸€ä¸ªå”¯ä¸€çš„ ID(ä» 1 å¼€å§‹)ï¼Œä¸€æ—¦æ¶ˆæ¯è¢«æŠ•é€’åˆ°æ‰€æœ‰åŒ¹é…çš„é˜Ÿåˆ—ä¹‹åï¼Œbroker å°±ä¼šå‘é€ä¸€ä¸ªç¡®è®¤ç»™ç”Ÿäº§è€…(åŒ…å«æ¶ˆæ¯çš„å”¯ä¸€ ID)ï¼Œè¿™å°±ä½¿å¾—ç”Ÿäº§è€…çŸ¥é“æ¶ˆæ¯å·²ç»æ­£ç¡®åˆ°è¾¾ç›®çš„é˜Ÿåˆ—äº†ï¼Œå¦‚æœæ¶ˆæ¯å’Œé˜Ÿåˆ—æ˜¯å¯æŒä¹…åŒ–çš„ï¼Œé‚£ä¹ˆç¡®è®¤æ¶ˆæ¯ä¼šåœ¨å°†æ¶ˆæ¯å†™å…¥ç£ç›˜ä¹‹åå‘å‡ºï¼Œbroker å›ä¼ ç»™ç”Ÿäº§è€…çš„ç¡®è®¤æ¶ˆæ¯ä¸­ delivery-tag åŸŸåŒ…å«äº†ç¡®è®¤æ¶ˆæ¯çš„åºåˆ—å·ï¼Œæ­¤å¤– broker ä¹Ÿå¯ä»¥è®¾ç½® basic.ack çš„ multiple åŸŸï¼Œè¡¨ç¤ºåˆ°è¿™ä¸ªåºåˆ—å·ä¹‹å‰çš„æ‰€æœ‰æ¶ˆæ¯éƒ½å·²ç»å¾—åˆ°äº†å¤„ç†ã€‚</p><p>confirm æ¨¡å¼æœ€å¤§çš„å¥½å¤„åœ¨äºæ˜¯å¼‚æ­¥çš„ï¼Œä¸€æ—¦å‘å¸ƒä¸€æ¡æ¶ˆæ¯ï¼Œç”Ÿäº§è€…åº”ç”¨ç¨‹åºå°±å¯ä»¥åœ¨ç­‰ä¿¡é“è¿”å›ç¡®è®¤çš„åŒæ—¶ç»§ç»­å‘é€ä¸‹ä¸€æ¡æ¶ˆæ¯ï¼Œå½“æ¶ˆæ¯æœ€ç»ˆå¾—åˆ°ç¡®è®¤ä¹‹åï¼Œç”Ÿäº§è€…åº”ç”¨ä¾¿å¯ä»¥é€šè¿‡å›è°ƒæ–¹æ³•æ¥å¤„ç†è¯¥ç¡®è®¤æ¶ˆæ¯ï¼Œå¦‚æœRabbitMQ å› ä¸ºè‡ªèº«å†…éƒ¨é”™è¯¯å¯¼è‡´æ¶ˆæ¯ä¸¢å¤±ï¼Œå°±ä¼šå‘é€ä¸€æ¡ nack æ¶ˆæ¯ï¼Œ ç”Ÿäº§è€…åº”ç”¨ç¨‹åºåŒæ ·å¯ä»¥åœ¨å›è°ƒæ–¹æ³•ä¸­å¤„ç†è¯¥ nack æ¶ˆæ¯</p><h3 id="å¼€å¯å‘å¸ƒç¡®è®¤æ–¹æ³•"><a href="#å¼€å¯å‘å¸ƒç¡®è®¤æ–¹æ³•" class="headerlink" title="å¼€å¯å‘å¸ƒç¡®è®¤æ–¹æ³•"></a>å¼€å¯å‘å¸ƒç¡®è®¤æ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åœ¨ channel.queueDeclare( ) åï¼Œä½¿ç”¨ä¸‹é¢æ–¹æ³•å¼€å¯å‘å¸ƒç¡®è®¤</span></span><br><span class="line">channel.confirmSelect();</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨ channel.basicPublish() å°†æ¶ˆæ¯å‘å¸ƒåï¼Œä½¿ç”¨ä¸‹é¢æ–¹æ³•ï¼Œç¡®è®¤æ¶ˆæ¯å‘å¸ƒ</span></span><br><span class="line">channel.waitForConfirms();</span><br></pre></td></tr></table></figure><h3 id="å•ä¸ªç¡®è®¤å‘å¸ƒ"><a href="#å•ä¸ªç¡®è®¤å‘å¸ƒ" class="headerlink" title="å•ä¸ªç¡®è®¤å‘å¸ƒ"></a>å•ä¸ªç¡®è®¤å‘å¸ƒ</h3><p>è¿™æ˜¯ä¸€ç§ç®€å•çš„ç¡®è®¤æ–¹å¼ï¼Œå®ƒæ˜¯ä¸€ç§<strong>åŒæ­¥ç¡®è®¤å‘å¸ƒ</strong>çš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯å‘å¸ƒä¸€ä¸ªæ¶ˆæ¯ä¹‹ååªæœ‰å®ƒè¢«ç¡®è®¤å‘å¸ƒï¼Œåç»­çš„æ¶ˆæ¯æ‰èƒ½ç»§ç»­å‘å¸ƒï¼Œ<code>waitForConfirmsOrDie(long)</code> è¿™ä¸ªæ–¹æ³•åªæœ‰åœ¨æ¶ˆæ¯è¢«ç¡®è®¤çš„æ—¶å€™æ‰è¿”å›ï¼Œå¦‚æœåœ¨æŒ‡å®šæ—¶é—´èŒƒå›´å†…è¿™ä¸ªæ¶ˆæ¯æ²¡æœ‰è¢«ç¡®è®¤é‚£ä¹ˆå®ƒå°†æŠ›å‡ºå¼‚å¸¸ã€‚</p><p>è¿™ç§ç¡®è®¤æ–¹å¼æœ‰ä¸€ä¸ªæœ€å¤§çš„ç¼ºç‚¹å°±æ˜¯ï¼š<strong>å‘å¸ƒé€Ÿåº¦ç‰¹åˆ«çš„æ…¢</strong>ï¼Œå› ä¸ºå¦‚æœæ²¡æœ‰ç¡®è®¤å‘å¸ƒçš„æ¶ˆæ¯å°±ä¼šé˜»å¡æ‰€æœ‰åç»­æ¶ˆæ¯çš„å‘å¸ƒï¼Œè¿™ç§æ–¹å¼æœ€å¤šæä¾›æ¯ç§’ä¸è¶…è¿‡æ•°ç™¾æ¡å‘å¸ƒæ¶ˆæ¯çš„ååé‡ã€‚å½“ç„¶å¯¹äºæŸäº›åº”ç”¨ç¨‹åºæ¥è¯´è¿™å¯èƒ½å·²ç»è¶³å¤Ÿäº†ã€‚</p><blockquote><p><strong>ä¸‹é¢ä¸ºæ¶ˆæ¯ç”Ÿäº§è€…çš„ä»£ç ï¼Œç”±äºç¡®è®¤å‘å¸ƒæ˜¯ç”Ÿäº§è€…çš„æ“ä½œï¼Œæ‰€ä»¥è¿™é‡Œä¸æä¾›æ¶ˆè´¹è€…ä»£ç äº†ï¼Œå‘å¸ƒç¡®è®¤ä»£ç ä½¿ç”¨äº†<code>TODO</code>æ ‡è®°</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Channel;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.rabbitmq.utils.ChannelUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeoutException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å•ä¸ªç¡®è®¤å‘å¸ƒ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProducerOne</span> &#123;</span><br><span class="line">    <span class="comment">//å¯¹åˆ—åç§°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å‘æ¶ˆæ¯</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException, InterruptedException &#123;</span><br><span class="line">        <span class="comment">//è·å–ä¿¡é“</span></span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> ChannelUtils.getChannel();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * ç”Ÿäº§ä¸€ä¸ªå¯¹åˆ—</span></span><br><span class="line"><span class="comment">         * 1.å¯¹åˆ—åç§°</span></span><br><span class="line"><span class="comment">         * 2.å¯¹åˆ—é‡Œé¢çš„æ¶ˆæ¯æ˜¯å¦æŒä¹…åŒ–ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ¶ˆæ¯å­˜å‚¨åœ¨å†…å­˜ä¸­</span></span><br><span class="line"><span class="comment">         * 3.è¯¥é˜Ÿåˆ—æ˜¯å¦åªä¾›ä¸€ä¸ªæ¶ˆè´¹è€…è¿›è¡Œæ¶ˆè´¹ï¼Œæ˜¯å¦è¿›è¡Œæ¶ˆæ¯å…±äº«ï¼Œtrueå¯ä»¥å¤šä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ falseï¼šåªèƒ½ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹</span></span><br><span class="line"><span class="comment">         * 4.æ˜¯å¦è‡ªåŠ¨åˆ é™¤ï¼Œæœ€åä¸€ä¸ªæ¶ˆè´¹è€…ç«¯å¼€é“¾æ¥ä»¥åï¼Œè¯¥é˜Ÿåˆ—æ˜¯å¦è‡ªåŠ¨åˆ é™¤ï¼Œtrueè¡¨ç¤ºè‡ªåŠ¨åˆ é™¤</span></span><br><span class="line"><span class="comment">         * 5.å…¶ä»–å‚æ•°</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        channel.queueDeclare(QUEUE_NAME, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//TODO å¼€å¯å‘å¸ƒç¡®è®¤</span></span><br><span class="line">        channel.confirmSelect();</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * å‘é€ä¸€ä¸ªæ¶ˆæ¯</span></span><br><span class="line"><span class="comment">         * 1.å‘é€åˆ°å“ªä¸ªäº¤æ¢æœº</span></span><br><span class="line"><span class="comment">         * 2.è·¯ç”±çš„keyå€¼æ˜¯å“ªä¸ªæœ¬æ¬¡æ˜¯é˜Ÿåˆ—çš„åç§°</span></span><br><span class="line"><span class="comment">         * 3.å…¶ä»–å‚æ•°ä¿¡æ¯</span></span><br><span class="line"><span class="comment">         * 4.å‘é€æ¶ˆæ¯çš„æ¶ˆæ¯ä½“</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            channel.basicPublish(<span class="string">&quot;&quot;</span>, QUEUE_NAME, <span class="literal">null</span>, (i + <span class="string">&quot;&quot;</span>).getBytes());</span><br><span class="line">            <span class="comment">//TODO å•ä¸ªæ¶ˆæ¯å°±é©¬ä¸Šè¿›è¡Œå‘å¸ƒç¡®è®¤</span></span><br><span class="line">            <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> channel.waitForConfirms();</span><br><span class="line">            <span class="keyword">if</span> (flag) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;æ¶ˆæ¯å‘é€å®Œæ¯•&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="æ‰¹é‡ç¡®è®¤å‘å¸ƒ"><a href="#æ‰¹é‡ç¡®è®¤å‘å¸ƒ" class="headerlink" title="æ‰¹é‡ç¡®è®¤å‘å¸ƒ"></a>æ‰¹é‡ç¡®è®¤å‘å¸ƒ</h3><blockquote><p><strong>æ‰¹é‡ç¡®è®¤å’Œå•ä¸ªç¡®è®¤å†™æ³•ä¸€è‡´ï¼Œåªæ˜¯æ‰§è¡Œ<code>channel.waitForConfirms()</code>æ–¹æ³•çš„æ—¶æœºä¸ä¸€è‡´ï¼Œæ‰¹é‡ç¡®è®¤æ˜¯ç­‰æ¶ˆæ¯å‘å¸ƒäº†æŒ‡å®šæ•°é‡çš„æ—¶å€™ï¼Œå†æ‰§è¡Œè¯¥æ–¹æ³•ï¼Œå•ä¸ªç¡®è®¤å‘å¸ƒæ˜¯ï¼Œæ¶ˆæ¯ä¸€å‘å¸ƒå°±ç«‹åˆ»æ‰§è¡Œè¯¥æ–¹æ³•</strong></p></blockquote><p>å•ä¸ªç¡®è®¤å‘å¸ƒæ–¹å¼éå¸¸æ…¢ï¼Œä¸å•ä¸ªç­‰å¾…ç¡®è®¤æ¶ˆæ¯ç›¸æ¯”ï¼Œå…ˆå‘å¸ƒä¸€æ‰¹æ¶ˆæ¯ç„¶åä¸€èµ·ç¡®è®¤å¯ä»¥æå¤§åœ°æé«˜ååé‡ï¼Œå½“ç„¶è¿™ç§æ–¹å¼çš„ç¼ºç‚¹å°±æ˜¯ï¼šå½“å‘ç”Ÿæ•…éšœå¯¼è‡´å‘å¸ƒå‡ºç°é—®é¢˜æ—¶ï¼Œä¸çŸ¥é“æ˜¯å“ªä¸ªæ¶ˆæ¯å‡ºé—®é¢˜äº†ï¼Œæˆ‘ä»¬å¿…é¡»å°†æ•´ä¸ªæ‰¹å¤„ç†ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œä»¥è®°å½•é‡è¦çš„ä¿¡æ¯è€Œåé‡æ–°å‘å¸ƒæ¶ˆæ¯ã€‚å½“ç„¶è¿™ç§æ–¹æ¡ˆä»ç„¶æ˜¯åŒæ­¥çš„ï¼Œä¹Ÿä¸€æ ·é˜»å¡æ¶ˆæ¯çš„å‘å¸ƒã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Channel;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.rabbitmq.utils.ChannelUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeoutException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¶ˆæ¯ç”Ÿäº§è€…æ‰¹é‡ç¡®è®¤å‘å¸ƒ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProducerOne</span> &#123;</span><br><span class="line">    <span class="comment">//å¯¹åˆ—åç§°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å‘æ¶ˆæ¯</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException, InterruptedException &#123;</span><br><span class="line">        <span class="comment">//è·å–ä¿¡é“</span></span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> ChannelUtils.getChannel();</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * ç”Ÿäº§ä¸€ä¸ªå¯¹åˆ—</span></span><br><span class="line"><span class="comment">         * 1.å¯¹åˆ—åç§°</span></span><br><span class="line"><span class="comment">         * 2.å¯¹åˆ—é‡Œé¢çš„æ¶ˆæ¯æ˜¯å¦æŒä¹…åŒ–ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ¶ˆæ¯å­˜å‚¨åœ¨å†…å­˜ä¸­</span></span><br><span class="line"><span class="comment">         * 3.è¯¥é˜Ÿåˆ—æ˜¯å¦åªä¾›ä¸€ä¸ªæ¶ˆè´¹è€…è¿›è¡Œæ¶ˆè´¹ï¼Œæ˜¯å¦è¿›è¡Œæ¶ˆæ¯å…±äº«ï¼Œtrueå¯ä»¥å¤šä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ falseï¼šåªèƒ½ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹</span></span><br><span class="line"><span class="comment">         * 4.æ˜¯å¦è‡ªåŠ¨åˆ é™¤ï¼Œæœ€åä¸€ä¸ªæ¶ˆè´¹è€…ç«¯å¼€é“¾æ¥ä»¥åï¼Œè¯¥é˜Ÿåˆ—æ˜¯å¦è‡ªåŠ¨åˆ é™¤ï¼Œtrueè¡¨ç¤ºè‡ªåŠ¨åˆ é™¤</span></span><br><span class="line"><span class="comment">         * 5.å…¶ä»–å‚æ•°</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        channel.queueDeclare(QUEUE_NAME, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//TODO å¼€å¯å‘å¸ƒç¡®è®¤</span></span><br><span class="line">        channel.confirmSelect();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//TODO æ‰¹é‡ç¡®è®¤æ¶ˆæ¯å¤§å°ï¼Œå½“æ¶ˆæ¯å‘å¸ƒå¤šå°‘æ¡åè¿›è¡Œå‘å¸ƒç¡®è®¤</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">batchSize</span> <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * å‘é€ä¸€ä¸ªæ¶ˆæ¯</span></span><br><span class="line"><span class="comment">         * 1.å‘é€åˆ°å“ªä¸ªäº¤æ¢æœº</span></span><br><span class="line"><span class="comment">         * 2.è·¯ç”±çš„keyå€¼æ˜¯å“ªä¸ªæœ¬æ¬¡æ˜¯é˜Ÿåˆ—çš„åç§°</span></span><br><span class="line"><span class="comment">         * 3.å…¶ä»–å‚æ•°ä¿¡æ¯</span></span><br><span class="line"><span class="comment">         * 4.å‘é€æ¶ˆæ¯çš„æ¶ˆæ¯ä½“</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">            channel.basicPublish(<span class="string">&quot;&quot;</span>, QUEUE_NAME, <span class="literal">null</span>, (i + <span class="string">&quot;&quot;</span>).getBytes());</span><br><span class="line"></span><br><span class="line">            <span class="comment">//TODO åˆ¤æ–­è¾¾åˆ°100æ¡æ¶ˆæ¯çš„æ—¶å€™ï¼Œæ‰¹é‡ç¡®è®¤ä¸€æ¬¡</span></span><br><span class="line">            <span class="keyword">if</span> ((i + <span class="number">1</span>) % batchSize == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">//TODO å‘å¸ƒç¡®è®¤</span></span><br><span class="line">                channel.waitForConfirms();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¼‚æ­¥ç¡®è®¤"><a href="#å¼‚æ­¥ç¡®è®¤" class="headerlink" title="å¼‚æ­¥ç¡®è®¤"></a>å¼‚æ­¥ç¡®è®¤</h3><p>å¼‚æ­¥ç¡®è®¤è™½ç„¶ç¼–ç¨‹é€»è¾‘æ¯”ä¸Šä¸¤ä¸ªè¦å¤æ‚ï¼Œä½†æ˜¯æ€§ä»·æ¯”æœ€é«˜ï¼Œæ— è®ºæ˜¯å¯é æ€§è¿˜æ˜¯æ•ˆç‡éƒ½å¾ˆå¥½ï¼Œåˆ©ç”¨äº†å›è°ƒå‡½æ•°æ¥è¾¾åˆ°æ¶ˆæ¯å¯é æ€§ä¼ é€’çš„ï¼Œè¿™ä¸ªä¸­é—´ä»¶ä¹Ÿæ˜¯é€šè¿‡å‡½æ•°å›è°ƒæ¥ä¿è¯æ˜¯å¦æŠ•é€’æˆåŠŸï¼Œä¸‹é¢è¯¦ç»†è®²è§£å¼‚æ­¥ç¡®è®¤æ˜¯æ€ä¹ˆå®ç°çš„ã€‚</p><p><img src="https://www.naste.top:9000/images/202305231852001.png" alt="202305231852001"></p><p>å®é™…æ¡ˆä¾‹é‡Œï¼Œå°†å‘å¸ƒçš„æ¶ˆæ¯å­˜å…¥ Map é‡Œï¼Œæ–¹ä¾¿è·å–ã€‚<code>headMap</code> æ–¹æ³•ç”¨äºå°†å·²ç¡®è®¤çš„æ¶ˆæ¯å­˜å…¥æ–°çš„ Map ç¼“å­˜åŒºé‡Œï¼Œç„¶åæ¸…é™¤è¯¥æ–°ç¼“å­˜åŒºçš„å†…å®¹ã€‚å› ä¸º <code>headMap</code> æ–¹æ³•æ˜¯æµ…æ‹·è´ï¼Œæ‰€ä»¥æ¸…é™¤äº†ç¼“å­˜åŒºï¼Œç›¸å½“äºæ¸…é™¤äº†å†…å®¹çš„åœ°å€ï¼Œä¹Ÿå°±æ¸…é™¤äº†é˜Ÿåˆ—çš„ç¡®è®¤çš„æ¶ˆæ¯ã€‚</p><p><strong>æœªå¤„ç†å¼‚æ­¥æœªç¡®è®¤æ¶ˆæ¯ä»£ç </strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Channel;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.ConfirmCallback;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.rabbitmq.utils.ChannelUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeoutException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¼‚æ­¥ç¡®è®¤æ¶ˆæ¯å‘å¸ƒï¼ˆæœªå¤„ç†å¼‚æ­¥æœªç¡®è®¤æ¶ˆæ¯ä»£ç ï¼‰</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProducerOne</span> &#123;</span><br><span class="line">    <span class="comment">//å¯¹åˆ—åç§°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å‘æ¶ˆæ¯</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException, InterruptedException &#123;</span><br><span class="line">        <span class="comment">//è·å–ä¿¡é“</span></span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> ChannelUtils.getChannel();</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * ç”Ÿäº§ä¸€ä¸ªå¯¹åˆ—</span></span><br><span class="line"><span class="comment">         * 1.å¯¹åˆ—åç§°</span></span><br><span class="line"><span class="comment">         * 2.å¯¹åˆ—é‡Œé¢çš„æ¶ˆæ¯æ˜¯å¦æŒä¹…åŒ–ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ¶ˆæ¯å­˜å‚¨åœ¨å†…å­˜ä¸­</span></span><br><span class="line"><span class="comment">         * 3.è¯¥é˜Ÿåˆ—æ˜¯å¦åªä¾›ä¸€ä¸ªæ¶ˆè´¹è€…è¿›è¡Œæ¶ˆè´¹ï¼Œæ˜¯å¦è¿›è¡Œæ¶ˆæ¯å…±äº«ï¼Œtrueå¯ä»¥å¤šä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ falseï¼šåªèƒ½ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹</span></span><br><span class="line"><span class="comment">         * 4.æ˜¯å¦è‡ªåŠ¨åˆ é™¤ï¼Œæœ€åä¸€ä¸ªæ¶ˆè´¹è€…ç«¯å¼€é“¾æ¥ä»¥åï¼Œè¯¥é˜Ÿåˆ—æ˜¯å¦è‡ªåŠ¨åˆ é™¤ï¼Œtrueè¡¨ç¤ºè‡ªåŠ¨åˆ é™¤</span></span><br><span class="line"><span class="comment">         * 5.å…¶ä»–å‚æ•°</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        channel.queueDeclare(QUEUE_NAME, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¼€å¯å‘å¸ƒç¡®è®¤</span></span><br><span class="line">        channel.confirmSelect();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ¶ˆæ¯ç¡®è®¤å›è°ƒçš„å‡½æ•°</span></span><br><span class="line">        <span class="type">ConfirmCallback</span> <span class="variable">ackCallback</span> <span class="operator">=</span> (deliveryTag, multiple) -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ç¡®è®¤çš„æ¶ˆæ¯:&quot;</span> + deliveryTag);</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * æ¶ˆæ¯ç¡®è®¤å¤±è´¥å›è°ƒå‡½æ•°</span></span><br><span class="line"><span class="comment">         * 1.æ¶ˆæ¯çš„æ ‡è®°</span></span><br><span class="line"><span class="comment">         * 2.æ˜¯å¦ä¸ºæ‰¹é‡ç¡®è®¤</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="type">ConfirmCallback</span> <span class="variable">nackCallback</span> <span class="operator">=</span> (deliveryTag, multiple) -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æœªç¡®è®¤çš„æ¶ˆæ¯:&quot;</span> + deliveryTag);</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * å¼‚æ­¥é€šçŸ¥</span></span><br><span class="line"><span class="comment">         * å‡†å¤‡æ¶ˆæ¯çš„ç›‘å¬å™¨ ç›‘å¬é‚£äº›æ¶ˆæ¯æˆåŠŸäº†ï¼Œå“ªäº›æ¶ˆæ¯å¤±è´¥äº†</span></span><br><span class="line"><span class="comment">         * 1.ç›‘å¬å“ªäº›æ¶ˆæ¯æˆåŠŸäº†</span></span><br><span class="line"><span class="comment">         * 2.ç›‘å¬å“ªäº›æ¶ˆæ¯å¤±è´¥äº†</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        channel.addConfirmListener(ackCallback, nackCallback);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * å‘é€ä¸€ä¸ªæ¶ˆæ¯</span></span><br><span class="line"><span class="comment">         * 1.å‘é€åˆ°å“ªä¸ªäº¤æ¢æœº</span></span><br><span class="line"><span class="comment">         * 2.è·¯ç”±çš„keyå€¼æ˜¯å“ªä¸ªæœ¬æ¬¡æ˜¯é˜Ÿåˆ—çš„åç§°</span></span><br><span class="line"><span class="comment">         * 3.å…¶ä»–å‚æ•°ä¿¡æ¯</span></span><br><span class="line"><span class="comment">         * 4.å‘é€æ¶ˆæ¯çš„æ¶ˆæ¯ä½“</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">            channel.basicPublish(<span class="string">&quot;&quot;</span>, QUEUE_NAME, <span class="literal">null</span>, (i + <span class="string">&quot;&quot;</span>).getBytes());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å¤„ç†å¼‚æ­¥æœªç¡®è®¤æ¶ˆæ¯ä»£ç </strong></p><blockquote><p><strong>æœ€å¥½çš„è§£å†³çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯æŠŠæœªç¡®è®¤çš„æ¶ˆæ¯æ”¾åˆ°ä¸€ä¸ªåŸºäºå†…å­˜çš„èƒ½è¢«å‘å¸ƒçº¿ç¨‹è®¿é—®çš„é˜Ÿåˆ—ï¼Œæ¯”å¦‚è¯´ç”¨ ConcurrentLinkedQueue è¿™ä¸ªé˜Ÿåˆ—åœ¨ confirm callbacks ä¸å‘å¸ƒçº¿ç¨‹ä¹‹é—´è¿›è¡Œæ¶ˆæ¯çš„ä¼ é€’ã€‚</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Channel;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.ConfirmCallback;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.rabbitmq.utils.ChannelUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ConcurrentNavigableMap;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ConcurrentSkipListMap;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeoutException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¼‚æ­¥ç¡®è®¤æ¶ˆæ¯å‘å¸ƒï¼ˆå¤„ç†å¼‚æ­¥æœªç¡®è®¤æ¶ˆæ¯ä»£ç ï¼‰</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProducerOne</span> &#123;</span><br><span class="line">    <span class="comment">//å¯¹åˆ—åç§°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å‘æ¶ˆæ¯</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException, InterruptedException &#123;</span><br><span class="line">        <span class="comment">//è·å–ä¿¡é“</span></span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> ChannelUtils.getChannel();</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * ç”Ÿäº§ä¸€ä¸ªå¯¹åˆ—</span></span><br><span class="line"><span class="comment">         * 1.å¯¹åˆ—åç§°</span></span><br><span class="line"><span class="comment">         * 2.å¯¹åˆ—é‡Œé¢çš„æ¶ˆæ¯æ˜¯å¦æŒä¹…åŒ–ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ¶ˆæ¯å­˜å‚¨åœ¨å†…å­˜ä¸­</span></span><br><span class="line"><span class="comment">         * 3.è¯¥é˜Ÿåˆ—æ˜¯å¦åªä¾›ä¸€ä¸ªæ¶ˆè´¹è€…è¿›è¡Œæ¶ˆè´¹ï¼Œæ˜¯å¦è¿›è¡Œæ¶ˆæ¯å…±äº«ï¼Œtrueå¯ä»¥å¤šä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ falseï¼šåªèƒ½ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹</span></span><br><span class="line"><span class="comment">         * 4.æ˜¯å¦è‡ªåŠ¨åˆ é™¤ï¼Œæœ€åä¸€ä¸ªæ¶ˆè´¹è€…ç«¯å¼€é“¾æ¥ä»¥åï¼Œè¯¥é˜Ÿåˆ—æ˜¯å¦è‡ªåŠ¨åˆ é™¤ï¼Œtrueè¡¨ç¤ºè‡ªåŠ¨åˆ é™¤</span></span><br><span class="line"><span class="comment">         * 5.å…¶ä»–å‚æ•°</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        channel.queueDeclare(QUEUE_NAME, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¼€å¯å‘å¸ƒç¡®è®¤</span></span><br><span class="line">        channel.confirmSelect();</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * çº¿ç¨‹å®‰å…¨æœ‰åºçš„ä¸€ä¸ªå“ˆå¸Œè¡¨ï¼Œé€‚ç”¨äºé«˜å¹¶å‘çš„æƒ…å†µä¸‹</span></span><br><span class="line"><span class="comment">         * 1.è½»æ¾çš„å°†åºå·ä¸æ¶ˆæ¯è¿›è¡Œå…³è”</span></span><br><span class="line"><span class="comment">         * 2.è½»æ¾æ‰¹é‡åˆ é™¤æ¡ç›® åªè¦ç»™åˆ°åºå·</span></span><br><span class="line"><span class="comment">         * 3.æ”¯æŒé«˜å¹¶å‘(å¤šçº¿ç¨‹)</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        ConcurrentSkipListMap&lt;Long, String&gt; outstandingConfirms =</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConcurrentSkipListMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ¶ˆæ¯ç¡®è®¤å›è°ƒçš„å‡½æ•°</span></span><br><span class="line">        <span class="type">ConfirmCallback</span> <span class="variable">ackCallback</span> <span class="operator">=</span> (deliveryTag, multiple) -&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (multiple) &#123;</span><br><span class="line">                <span class="comment">//2.åˆ é™¤æ‰å·²ç»ç¡®è®¤çš„æ¶ˆæ¯ å‰©ä¸‹çš„å°±æ˜¯æœªç¡®è®¤çš„æ¶ˆæ¯</span></span><br><span class="line">                ConcurrentNavigableMap&lt;Long, String&gt; confirmed =</span><br><span class="line">                        outstandingConfirms.headMap(deliveryTag);</span><br><span class="line">                confirmed.clear();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                outstandingConfirms.remove(deliveryTag);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;ç¡®è®¤çš„æ¶ˆæ¯:&quot;</span> + deliveryTag);</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * æ¶ˆæ¯ç¡®è®¤å¤±è´¥å›è°ƒå‡½æ•°</span></span><br><span class="line"><span class="comment">         * 1.æ¶ˆæ¯çš„æ ‡è®°</span></span><br><span class="line"><span class="comment">         * 2.æ˜¯å¦ä¸ºæ‰¹é‡ç¡®è®¤</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="type">ConfirmCallback</span> <span class="variable">nackCallback</span> <span class="operator">=</span> (deliveryTag, multiple) -&gt; &#123;</span><br><span class="line">            <span class="comment">//3.æ‰“å°ä¸€ä¸‹æœªç¡®è®¤çš„æ¶ˆæ¯éƒ½æœ‰å“ªäº›</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> outstandingConfirms.remove(deliveryTag);</span><br><span class="line">            System.out.println(<span class="string">&quot;æœªç¡®è®¤çš„æ¶ˆæ¯æ˜¯:&quot;</span> + message + <span class="string">&quot;:::æœªç¡®è®¤çš„æ¶ˆæ¯tag:&quot;</span> + deliveryTag);</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * å¼‚æ­¥é€šçŸ¥</span></span><br><span class="line"><span class="comment">         * å‡†å¤‡æ¶ˆæ¯çš„ç›‘å¬å™¨ ç›‘å¬é‚£äº›æ¶ˆæ¯æˆåŠŸäº†ï¼Œå“ªäº›æ¶ˆæ¯å¤±è´¥äº†</span></span><br><span class="line"><span class="comment">         * 1.ç›‘å¬å“ªäº›æ¶ˆæ¯æˆåŠŸäº†</span></span><br><span class="line"><span class="comment">         * 2.ç›‘å¬å“ªäº›æ¶ˆæ¯å¤±è´¥äº†</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        channel.addConfirmListener(ackCallback, nackCallback);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * å‘é€ä¸€ä¸ªæ¶ˆæ¯</span></span><br><span class="line"><span class="comment">         * 1.å‘é€åˆ°å“ªä¸ªäº¤æ¢æœº</span></span><br><span class="line"><span class="comment">         * 2.è·¯ç”±çš„keyå€¼æ˜¯å“ªä¸ªæœ¬æ¬¡æ˜¯é˜Ÿåˆ—çš„åç§°</span></span><br><span class="line"><span class="comment">         * 3.å…¶ä»–å‚æ•°ä¿¡æ¯</span></span><br><span class="line"><span class="comment">         * 4.å‘é€æ¶ˆæ¯çš„æ¶ˆæ¯ä½“</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">            channel.basicPublish(<span class="string">&quot;&quot;</span>, QUEUE_NAME, <span class="literal">null</span>, (i + <span class="string">&quot;&quot;</span>).getBytes());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="ä¸‰ç§å‘å¸ƒç¡®è®¤æ–¹å¼å¯¹æ¯”"><a href="#ä¸‰ç§å‘å¸ƒç¡®è®¤æ–¹å¼å¯¹æ¯”" class="headerlink" title="ä¸‰ç§å‘å¸ƒç¡®è®¤æ–¹å¼å¯¹æ¯”"></a>ä¸‰ç§å‘å¸ƒç¡®è®¤æ–¹å¼å¯¹æ¯”</h3><ul><li>å•ç‹¬å‘å¸ƒæ¶ˆæ¯ï¼šåŒæ­¥ç­‰å¾…ç¡®è®¤ï¼Œç®€å•ï¼Œä½†ååé‡éå¸¸æœ‰é™ã€‚</li><li>æ‰¹é‡å‘å¸ƒæ¶ˆæ¯ï¼šæ‰¹é‡åŒæ­¥ç­‰å¾…ç¡®è®¤ï¼Œç®€å•ï¼Œåˆç†çš„ååé‡ï¼Œä¸€æ—¦å‡ºç°é—®é¢˜ä½†å¾ˆéš¾æ¨æ–­å‡ºæ˜¯é‚£æ¡æ¶ˆæ¯å‡ºç°äº†é—®é¢˜ã€‚</li><li>å¼‚æ­¥å¤„ç†ï¼šæœ€ä½³æ€§èƒ½å’Œèµ„æºä½¿ç”¨ï¼Œåœ¨å‡ºç°é”™è¯¯çš„æƒ…å†µä¸‹å¯ä»¥å¾ˆå¥½åœ°æ§åˆ¶ï¼Œä½†æ˜¯å®ç°èµ·æ¥ç¨å¾®éš¾äº›</li></ul><h2 id="æ¶ˆæ¯åº”ç­”å’Œå‘å¸ƒç¡®è®¤çš„åŒºåˆ«"><a href="#æ¶ˆæ¯åº”ç­”å’Œå‘å¸ƒç¡®è®¤çš„åŒºåˆ«" class="headerlink" title="æ¶ˆæ¯åº”ç­”å’Œå‘å¸ƒç¡®è®¤çš„åŒºåˆ«"></a>æ¶ˆæ¯åº”ç­”å’Œå‘å¸ƒç¡®è®¤çš„åŒºåˆ«</h2><p>æ¶ˆæ¯åº”ç­”ï¼šå±äºæ¶ˆè´¹è€…ï¼Œæ¶ˆè´¹å®Œæ¶ˆæ¯å‘Šè¯‰ RabbitMQ å·²ç»æ¶ˆè´¹æˆåŠŸ</p><p>å‘å¸ƒç¡®è®¤ï¼šå±äºç”Ÿäº§è€…ï¼Œç”Ÿäº§æ¶ˆæ¯åˆ° RabbitMQï¼ŒRabbitMQ éœ€è¦å‘Šè¯‰ç”Ÿäº§è€…å·²ç»æ”¶åˆ°æ¶ˆæ¯</p><h1 id="äº¤æ¢æœº"><a href="#äº¤æ¢æœº" class="headerlink" title="äº¤æ¢æœº"></a>äº¤æ¢æœº</h1><p><img src="https://www.naste.top:9000/images/image-20230526172345156.png" alt="image-20230526172345156"></p><h2 id="äº¤æ¢æœºï¼ˆExchangesï¼‰"><a href="#äº¤æ¢æœºï¼ˆExchangesï¼‰" class="headerlink" title="äº¤æ¢æœºï¼ˆExchangesï¼‰"></a>äº¤æ¢æœºï¼ˆExchangesï¼‰</h2><p>RabbitMQ æ¶ˆæ¯ä¼ é€’æ¨¡å‹çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š<strong>ç”Ÿäº§è€…ç”Ÿäº§çš„æ¶ˆæ¯ä»ä¸ä¼šç›´æ¥å‘é€åˆ°é˜Ÿåˆ—</strong>ã€‚å®é™…ä¸Šï¼Œé€šå¸¸ç”Ÿäº§è€…ç”šè‡³éƒ½ä¸çŸ¥é“è¿™äº›æ¶ˆæ¯ä¼ é€’ä¼ é€’åˆ°äº†å“ªäº›é˜Ÿåˆ—ä¸­ã€‚</p><p>ç›¸åï¼Œ<strong>ç”Ÿäº§è€…åªèƒ½å°†æ¶ˆæ¯å‘é€åˆ°äº¤æ¢æœº(exchange)</strong>ï¼Œäº¤æ¢æœºå·¥ä½œçš„å†…å®¹éå¸¸ç®€å•ï¼Œä¸€æ–¹é¢å®ƒæ¥æ”¶æ¥è‡ªç”Ÿäº§è€…çš„æ¶ˆæ¯ï¼Œå¦ä¸€æ–¹é¢å°†å®ƒä»¬æ¨å…¥é˜Ÿåˆ—ã€‚äº¤æ¢æœºå¿…é¡»ç¡®åˆ‡çŸ¥é“å¦‚ä½•å¤„ç†æ”¶åˆ°çš„æ¶ˆæ¯ã€‚æ˜¯åº”è¯¥æŠŠè¿™äº›æ¶ˆæ¯æ”¾åˆ°ç‰¹å®šé˜Ÿåˆ—è¿˜æ˜¯è¯´æŠŠä»–ä»¬åˆ°è®¸å¤šé˜Ÿåˆ—ä¸­è¿˜æ˜¯è¯´åº”è¯¥ä¸¢å¼ƒå®ƒä»¬ã€‚è¿™å°±çš„ç”±äº¤æ¢æœºçš„ç±»å‹æ¥å†³å®šã€‚</p><h2 id="äº¤æ¢æœºç±»å‹"><a href="#äº¤æ¢æœºç±»å‹" class="headerlink" title="äº¤æ¢æœºç±»å‹"></a>äº¤æ¢æœºç±»å‹</h2><ul><li><p><strong>ç›´æ¥(direct)</strong>ï¼šå¤„ç†è·¯ç”±é”®ã€‚éœ€è¦å°†ä¸€ä¸ªé˜Ÿåˆ—ç»‘å®šåˆ°äº¤æ¢æœºä¸Šï¼Œè¦æ±‚è¯¥æ¶ˆæ¯ä¸ä¸€ä¸ªç‰¹å®šçš„è·¯ç”±é”®å®Œå…¨åŒ¹é…ã€‚è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„åŒ¹é…ã€‚å¦‚æœä¸€ä¸ªé˜Ÿåˆ—ç»‘å®šåˆ°è¯¥äº¤æ¢æœºä¸Šè¦æ±‚è·¯ç”±é”® abc ï¼Œåˆ™åªæœ‰è¢«æ ‡è®°ä¸º abc çš„æ¶ˆæ¯æ‰è¢«è½¬å‘ï¼Œä¸ä¼šè½¬å‘ abc.defï¼Œä¹Ÿä¸ä¼šè½¬å‘ dog.ghiï¼Œåªä¼šè½¬å‘ abcã€‚</p></li><li><p><strong>ä¸»é¢˜(topic)</strong>ï¼šå°†è·¯ç”±é”®å’ŒæŸæ¨¡å¼è¿›è¡ŒåŒ¹é…ã€‚æ­¤æ—¶é˜Ÿåˆ—éœ€è¦ç»‘å®šè¦ä¸€ä¸ªæ¨¡å¼ä¸Šã€‚ç¬¦å·â€œ#â€åŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªè¯ï¼Œç¬¦å· <em> åŒ¹é…ä¸å¤šä¸å°‘ä¸€ä¸ªè¯ã€‚å› æ­¤ abc.# èƒ½å¤ŸåŒ¹é…åˆ° abc.def.ghiï¼Œä½†æ˜¯ abc.</em> åªä¼šåŒ¹é…åˆ° abc.defã€‚</p></li><li><p><strong>æ ‡é¢˜(headers)</strong>ï¼šä¸å¤„ç†è·¯ç”±é”®ã€‚è€Œæ˜¯æ ¹æ®å‘é€çš„æ¶ˆæ¯å†…å®¹ä¸­çš„headerså±æ€§è¿›è¡ŒåŒ¹é…ã€‚åœ¨ç»‘å®š Queue ä¸ Exchange æ—¶æŒ‡å®šä¸€ç»„é”®å€¼å¯¹ï¼›å½“æ¶ˆæ¯å‘é€åˆ°RabbitMQ æ—¶ä¼šå–åˆ°è¯¥æ¶ˆæ¯çš„ headers ä¸ Exchange ç»‘å®šæ—¶æŒ‡å®šçš„é”®å€¼å¯¹è¿›è¡ŒåŒ¹é…ï¼›å¦‚æœå®Œå…¨åŒ¹é…åˆ™æ¶ˆæ¯ä¼šè·¯ç”±åˆ°è¯¥é˜Ÿåˆ—ï¼Œå¦åˆ™ä¸ä¼šè·¯ç”±åˆ°è¯¥é˜Ÿåˆ—ã€‚headers å±æ€§æ˜¯ä¸€ä¸ªé”®å€¼å¯¹ï¼Œå¯ä»¥æ˜¯ Hashtableï¼Œé”®å€¼å¯¹çš„å€¼å¯ä»¥æ˜¯ä»»ä½•ç±»å‹ã€‚è€Œ fanoutï¼Œdirectï¼Œtopic çš„è·¯ç”±é”®éƒ½éœ€è¦è¦å­—ç¬¦ä¸²å½¢å¼çš„ã€‚</p><ul><li>åŒ¹é…è§„åˆ™ x-match æœ‰ä¸‹åˆ—ä¸¤ç§ç±»å‹ï¼š<ul><li>x-match = all ï¼šè¡¨ç¤ºæ‰€æœ‰çš„é”®å€¼å¯¹éƒ½åŒ¹é…æ‰èƒ½æ¥å—åˆ°æ¶ˆæ¯</li><li>x-match = any ï¼šè¡¨ç¤ºåªè¦æœ‰é”®å€¼å¯¹åŒ¹é…å°±èƒ½æ¥å—åˆ°æ¶ˆæ¯</li></ul></li></ul></li><li><p><strong>æ‰‡å‡º(fanout)</strong>ï¼šä¸å¤„ç†è·¯ç”±é”®ã€‚ä½ åªéœ€è¦ç®€å•çš„å°†é˜Ÿåˆ—ç»‘å®šåˆ°äº¤æ¢æœºä¸Šã€‚ä¸€ä¸ªå‘é€åˆ°äº¤æ¢æœºçš„æ¶ˆæ¯éƒ½ä¼šè¢«è½¬å‘åˆ°ä¸è¯¥äº¤æ¢æœºç»‘å®šçš„æ‰€æœ‰é˜Ÿåˆ—ä¸Šã€‚å¾ˆåƒå­ç½‘å¹¿æ’­ï¼Œæ¯å°å­ç½‘å†…çš„ä¸»æœºéƒ½è·å¾—äº†ä¸€ä»½å¤åˆ¶çš„æ¶ˆæ¯ã€‚Fanout äº¤æ¢æœºè½¬å‘æ¶ˆæ¯æ˜¯æœ€å¿«çš„ã€‚<code>ç±»ä¼¼äºï¼Œå¤šä¸ªäººå…³æ³¨ä¸€ä¸ªå…¬ä¼—å·ï¼Œè¯¥å…¬ä¼—å·å‘å¸ƒæ¶ˆæ¯ï¼Œæ‰€æœ‰è®¢é˜…çš„äººéƒ½èƒ½æ”¶åˆ°æ¶ˆæ¯</code></p></li><li><p><strong>é»˜è®¤</strong>ï¼šé€šè¿‡ç©ºå­—ç¬¦ä¸²(â€œâ€)è¿›è¡Œæ ‡è¯†çš„äº¤æ¢æœºæ˜¯é»˜è®¤äº¤æ¢</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯äº¤æ¢æœºçš„åç§°ã€‚ç©ºå­—ç¬¦ä¸² è¡¨ç¤ºé»˜è®¤æˆ–æ— åç§°äº¤æ¢æœºï¼šæ¶ˆæ¯èƒ½è·¯ç”±å‘é€åˆ°é˜Ÿåˆ—ä¸­å…¶å®æ˜¯ç”± routingKey(bindingkey) ç»‘å®šæŒ‡å®šçš„ key</span></span><br><span class="line">channel.basicPublish(<span class="string">&quot;&quot;</span>, QUEUE_NAME, <span class="literal">null</span>, message.getBytes(<span class="string">&quot;UTF-8&quot;</span>));</span><br></pre></td></tr></table></figure><p>  <img src="https://www.naste.top:9000/images/image-20230526172615744.png" alt="image-20230526172615744"></p></li></ul><h2 id="ä¸´æ—¶é˜Ÿåˆ—"><a href="#ä¸´æ—¶é˜Ÿåˆ—" class="headerlink" title="ä¸´æ—¶é˜Ÿåˆ—"></a>ä¸´æ—¶é˜Ÿåˆ—</h2><p>ä¹‹å‰çš„ä½¿ç”¨çš„æ˜¯å…·æœ‰ç‰¹å®šåç§°çš„é˜Ÿåˆ—(è¿˜è®°å¾— hello å’Œ ack_queue å—ï¼Ÿ)ã€‚é˜Ÿåˆ—çš„åç§°æˆ‘ä»¬æ¥è¯´è‡³å…³é‡è¦ï¼Œæˆ‘ä»¬éœ€è¦æŒ‡å®šæˆ‘ä»¬çš„æ¶ˆè´¹è€…å»æ¶ˆè´¹å“ªä¸ªé˜Ÿåˆ—çš„æ¶ˆæ¯ã€‚</p><p>æ¯å½“æˆ‘ä»¬è¿æ¥åˆ° Rabbit æ—¶ï¼Œæˆ‘ä»¬éƒ½éœ€è¦ä¸€ä¸ªå…¨æ–°çš„ç©ºé˜Ÿåˆ—ï¼Œä¸ºæ­¤æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªå…·æœ‰<strong>éšæœºåç§°çš„é˜Ÿåˆ—</strong>ï¼Œæˆ–è€…èƒ½è®©æœåŠ¡å™¨ä¸ºæˆ‘ä»¬é€‰æ‹©ä¸€ä¸ªéšæœºé˜Ÿåˆ—åç§°é‚£å°±æ›´å¥½äº†ã€‚å…¶æ¬¡ä¸€æ—¦æˆ‘ä»¬æ–­å¼€äº†æ¶ˆè´¹è€…çš„è¿æ¥ï¼Œé˜Ÿåˆ—å°†è¢«è‡ªåŠ¨åˆ é™¤ã€‚</p><p>åˆ›å»ºä¸´æ—¶é˜Ÿåˆ—çš„æ–¹å¼å¦‚ä¸‹:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–åˆ›å»ºçš„ä¸´æ—¶é˜Ÿåˆ—åç§°</span></span><br><span class="line"><span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span> channel.queueDeclare().getQueue();</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Channel;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.rabbitmq.utils.ChannelUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.StandardCharsets;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeoutException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ›å»ºä¸´æ—¶é˜Ÿåˆ—</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProducerTwo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é˜Ÿåˆ—åç§°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">TASK_QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;QUEUE_MESSAGE&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="comment">//è·å–ä¿¡é“</span></span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> ChannelUtils.getChannel();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸´æ—¶é˜Ÿåˆ—å¹¶ä¸”è·å–åˆ›å»ºçš„ä¸´æ—¶é˜Ÿåˆ—çš„åç§°</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span> channel.queueDeclare().getQueue();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * ç”Ÿäº§ä¸€ä¸ªå¯¹åˆ—</span></span><br><span class="line"><span class="comment">         * 1.å¯¹åˆ—åç§°</span></span><br><span class="line"><span class="comment">         * 2.å¯¹åˆ—é‡Œé¢çš„æ¶ˆæ¯æ˜¯å¦æŒä¹…åŒ–ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ¶ˆæ¯å­˜å‚¨åœ¨å†…å­˜ä¸­</span></span><br><span class="line"><span class="comment">         * 3.è¯¥é˜Ÿåˆ—æ˜¯å¦åªä¾›ä¸€ä¸ªæ¶ˆè´¹è€…è¿›è¡Œæ¶ˆè´¹ï¼Œæ˜¯å¦è¿›è¡Œæ¶ˆæ¯å…±äº«ï¼Œtrueå¯ä»¥å¤šä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ falseï¼šåªèƒ½ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹</span></span><br><span class="line"><span class="comment">         * 4.æ˜¯å¦è‡ªåŠ¨åˆ é™¤ï¼Œæœ€åä¸€ä¸ªæ¶ˆè´¹è€…ç«¯å¼€é“¾æ¥ä»¥åï¼Œè¯¥é˜Ÿåˆ—æ˜¯å¦è‡ªåŠ¨åˆ é™¤ï¼Œtrueè¡¨ç¤ºè‡ªåŠ¨åˆ é™¤</span></span><br><span class="line"><span class="comment">         * 5.å…¶ä»–å‚æ•°</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        channel.queueDeclare(queueName, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åœ¨æ§åˆ¶å°ä¸­è¾“å…¥éœ€è¦ç”Ÿäº§çš„ä¿¡æ¯</span></span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        System.out.println(<span class="string">&quot;è¯·è¾“å…¥ä¿¡æ¯ï¼š&quot;</span>);</span><br><span class="line">        <span class="keyword">while</span> (scanner.hasNext()) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> scanner.next();</span><br><span class="line"></span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">             * å‘é€ä¸€ä¸ªæ¶ˆæ¯</span></span><br><span class="line"><span class="comment">             * 1.å‘é€åˆ°å“ªä¸ªäº¤æ¢æœº</span></span><br><span class="line"><span class="comment">             * 2.è·¯ç”±çš„keyå€¼æ˜¯å“ªä¸ªæœ¬æ¬¡æ˜¯é˜Ÿåˆ—çš„åç§°</span></span><br><span class="line"><span class="comment">             * 3.å…¶ä»–å‚æ•°ä¿¡æ¯ï¼Œè¿™ä½¿ç”¨ã€MessageProperties.PERSISTENT_TEXT_PLAINã€‘å¼€å¯æ¶ˆæ¯æŒä¹…åŒ–</span></span><br><span class="line"><span class="comment">             * 4.å‘é€æ¶ˆæ¯çš„æ¶ˆæ¯ä½“</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            channel.basicPublish(<span class="string">&quot;&quot;</span>, queueName, <span class="literal">null</span>, message.getBytes(StandardCharsets.UTF_8));</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;ç”Ÿäº§è€…å‘å‡ºæ¶ˆæ¯:&quot;</span> + message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://www.naste.top:9000/images/image-20230526173242830.png" alt="image-20230526173242830"></p><h2 id="ç»‘å®šäº¤æ¢æœºï¼ˆç»‘å®šbindingsï¼‰"><a href="#ç»‘å®šäº¤æ¢æœºï¼ˆç»‘å®šbindingsï¼‰" class="headerlink" title="ç»‘å®šäº¤æ¢æœºï¼ˆç»‘å®šbindingsï¼‰"></a>ç»‘å®šäº¤æ¢æœºï¼ˆç»‘å®šbindingsï¼‰</h2><p>ä»€ä¹ˆæ˜¯ bingding å‘¢ï¼Œbinding å…¶å®æ˜¯ exchange å’Œ queue ä¹‹é—´çš„æ¡¥æ¢ï¼Œå®ƒå‘Šè¯‰æˆ‘ä»¬ exchange å’Œé‚£ä¸ªé˜Ÿåˆ—è¿›è¡Œäº†ç»‘å®šå…³ç³»ã€‚æ¯”å¦‚è¯´ä¸‹é¢è¿™å¼ å›¾å‘Šè¯‰æˆ‘ä»¬çš„å°±æ˜¯ äº¤æ¢æœº ä¸ é˜Ÿåˆ—1 å’Œ é˜Ÿåˆ—2 è¿›è¡Œäº†ç»‘å®š</p><p><img src="https://www.naste.top:9000/images/image-20230526192930194.png" alt="image-20230526192930194"></p><h2 id="å„ç±»å‹äº¤æ¢æœºä½¿ç”¨"><a href="#å„ç±»å‹äº¤æ¢æœºä½¿ç”¨" class="headerlink" title="å„ç±»å‹äº¤æ¢æœºä½¿ç”¨"></a>å„ç±»å‹äº¤æ¢æœºä½¿ç”¨</h2><h3 id="Fanout"><a href="#Fanout" class="headerlink" title="Fanout"></a>Fanout</h3><p>ä¸ºäº†è¯´æ˜è¿™ç§æ¨¡å¼ï¼Œæˆ‘ä»¬å°†æ„å»ºä¸€ä¸ªç®€å•çš„æ—¥å¿—ç³»ç»Ÿã€‚å®ƒå°†ç”±ä¸¤ä¸ªç¨‹åºç»„æˆ:ç¬¬ä¸€ä¸ªç¨‹åºå°†å‘å‡ºæ—¥å¿—æ¶ˆæ¯ï¼Œç¬¬äºŒä¸ªç¨‹åºæ˜¯æ¶ˆè´¹è€…ã€‚å…¶ä¸­å¯åŠ¨ä¸¤ä¸ªæ¶ˆè´¹è€…ï¼Œå…¶ä¸­ä¸€ä¸ªæ¶ˆè´¹è€…æ¥æ”¶åˆ°æ¶ˆæ¯åæŠŠæ—¥å¿—å­˜å‚¨åœ¨ç£ç›˜</p><h4 id="ç”Ÿäº§è€…-5"><a href="#ç”Ÿäº§è€…-5" class="headerlink" title="ç”Ÿäº§è€…"></a>ç”Ÿäº§è€…</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.rabbitmq.client.BuiltinExchangeType;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Channel;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.rabbitmq.utils.ChannelUtils;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeoutException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¶ˆæ¯ç”Ÿäº§è€…å°†æ¶ˆæ¯å‘é€ç»™äº¤æ¢æœº</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProducerOne</span> &#123;</span><br><span class="line">    <span class="comment">//äº¤æ¢æœºåç§°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">&quot;exchange_test&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="comment">// è·å–ä¿¡é“</span></span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> ChannelUtils.getChannel();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * åˆ›å»ºä¸€ä¸ªexchangeï¼ˆäº¤æ¢æœºï¼‰</span></span><br><span class="line"><span class="comment">         * 1.exchangeçš„åç§°</span></span><br><span class="line"><span class="comment">         * 2.exchangeçš„ç±»å‹</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        channel.exchangeDeclare(EXCHANGE_NAME, BuiltinExchangeType.FANOUT);</span><br><span class="line">        </span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> (scanner.hasNext()) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> scanner.next();</span><br><span class="line">            </span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">   * å‘é€æ¶ˆæ¯ç»™æŒ‡å®šçš„äº¤æ¢æœº</span></span><br><span class="line"><span class="comment">             * exchangeï¼ˆäº¤æ¢å™¨ï¼‰ï¼šä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæ¶ˆæ¯å°†è¦å‘é€åˆ°å“ªä¸ªäº¤æ¢å™¨ã€‚</span></span><br><span class="line"><span class="comment">             * routing_keyï¼ˆè·¯ç”±é”®ï¼‰ï¼šä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæ¶ˆæ¯çš„è·¯ç”±é”®ï¼Œç”¨äºé€‰æ‹©ä¸è¯¥è·¯ç”±é”®åŒ¹é…çš„é˜Ÿåˆ—ã€‚</span></span><br><span class="line"><span class="comment">             * propertiesï¼ˆå±æ€§ï¼‰ï¼šä¸€ä¸ªAMQPå±æ€§å¯¹è±¡ï¼Œç”¨äºæºå¸¦ä¸€äº›é¢å¤–çš„å…ƒæ•°æ®ï¼ˆå¦‚æ¶ˆæ¯ç±»å‹ã€ä¼˜å…ˆçº§ç­‰ï¼‰ã€‚</span></span><br><span class="line"><span class="comment">             * bodyï¼ˆæ¶ˆæ¯ä½“ï¼‰ï¼šä¸€ä¸ªå­—èŠ‚æ•°ç»„ï¼Œè¡¨ç¤ºæ¶ˆæ¯çš„å†…å®¹ã€‚</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            channel.basicPublish(EXCHANGE_NAME, <span class="string">&quot;&quot;</span>, <span class="literal">null</span>, message.getBytes(<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">            System.out.println(<span class="string">&quot;ç”Ÿäº§è€…å‘å‡ºæ¶ˆæ¯:&quot;</span> + message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ¶ˆè´¹è€…-5"><a href="#æ¶ˆè´¹è€…-5" class="headerlink" title="æ¶ˆè´¹è€…"></a>æ¶ˆè´¹è€…</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.rabbitmq.client.BuiltinExchangeType;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Channel;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.DeliverCallback;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.rabbitmq.utils.ChannelUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeoutException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¶ˆè´¹è€…ï¼Œé€šè¿‡å¸®ä¼šé¡¶çš„</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConsumerOne</span> &#123;</span><br><span class="line">    <span class="comment">//äº¤æ¢æœºåç§°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">&quot;exchange_test&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="comment">// è·å–ä¿¡é“</span></span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> ChannelUtils.getChannel();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å£°æ˜ä¸€ä¸ªäº¤æ¢æœºã€äº¤æ¢æœºåç§°ï¼Œäº¤æ¢æœºç±»å‹ã€‘</span></span><br><span class="line">        channel.exchangeDeclare(EXCHANGE_NAME, BuiltinExchangeType.FANOUT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * ç”Ÿæˆä¸€ä¸ªä¸´æ—¶çš„é˜Ÿåˆ—ï¼Œé˜Ÿåˆ—çš„åç§°æ˜¯éšæœºçš„</span></span><br><span class="line"><span class="comment">         * å½“æ¶ˆè´¹è€…æ–­å¼€ä¸é˜Ÿåˆ—çš„è¿æ¥çš„æ—¶å€™ é˜Ÿåˆ—å°±è‡ªåŠ¨åˆ é™¤</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span> channel.queueDeclare().getQueue();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç»‘å®šäº¤æ¢æœºä¸é˜Ÿåˆ—ã€é˜Ÿåˆ—åç§°ã€äº¤æ¢æœºåç§°ã€äº¤æ¢æœºå’Œé˜Ÿåˆ—ç»‘å®šçš„RoutingKeyã€‘</span></span><br><span class="line">        channel.queueBind(queueName, EXCHANGE_NAME, <span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;ç­‰å¾…æ¥æ”¶æ¶ˆæ¯ï¼ŒæŠŠæ¥æ”¶åˆ°çš„æ¶ˆæ¯æ‰“å°åœ¨å±å¹•ä¸Š...&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ¶ˆè´¹è€…å–æ¶ˆæ¶ˆæ¯æ—¶å›è°ƒæ¥å£</span></span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumerTag, message) -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æ§åˆ¶å°æ‰“å°æ¥æ”¶åˆ°çš„æ¶ˆæ¯:&quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(message.getBody(), <span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯</span></span><br><span class="line">        channel.basicConsume(queueName, <span class="literal">true</span>, deliverCallback, consumerTag -&gt; &#123;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç»“æœï¼šç”Ÿäº§è€…å°†æ¶ˆæ¯å‘é€ç»™ç»‘å®šçš„é˜Ÿåˆ—ï¼Œæ¶ˆè´¹è€…ä»ç»‘å®šçš„é˜Ÿåˆ—ä¸­è·å–æ¶ˆæ¯ï¼Œéƒ½èƒ½è·å–åˆ°ï¼Œ<code>ç±»ä¼¼äºï¼Œå¤šä¸ªäººå…³æ³¨ä¸€ä¸ªå…¬ä¼—å·ï¼Œè¯¥å…¬ä¼—å·å‘å¸ƒæ¶ˆæ¯ï¼Œæ‰€æœ‰è®¢é˜…çš„äººéƒ½èƒ½æ”¶åˆ°æ¶ˆæ¯</code></strong></p><p><img src="https://www.naste.top:9000/images/image-20230526193106406.png" alt="image-20230526193106406"></p><h3 id="Direct"><a href="#Direct" class="headerlink" title="Direct"></a>Direct</h3><p>åœ¨ä¸Šä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬æ„å»ºäº†ä¸€ä¸ªç®€å•çš„æ—¥å¿—è®°å½•ç³»ç»Ÿã€‚æˆ‘ä»¬èƒ½å¤Ÿå‘è®¸å¤šæ¥æ”¶è€…å¹¿æ’­æ—¥å¿—æ¶ˆæ¯ã€‚åœ¨æœ¬èŠ‚æˆ‘ä»¬å°†å‘å…¶ä¸­æ·»åŠ ä¸€äº›ç‰¹åˆ«çš„åŠŸèƒ½â€”â€”è®©æŸä¸ªæ¶ˆè´¹è€…è®¢é˜…å‘å¸ƒçš„éƒ¨åˆ†æ¶ˆæ¯ã€‚ä¾‹å¦‚æˆ‘ä»¬åªæŠŠä¸¥é‡é”™è¯¯æ¶ˆæ¯å®šå‘å­˜å‚¨åˆ°æ—¥å¿—æ–‡ä»¶(ä»¥èŠ‚çœç£ç›˜ç©ºé—´)ï¼ŒåŒæ—¶ä»ç„¶èƒ½å¤Ÿåœ¨æ§åˆ¶å°ä¸Šæ‰“å°æ‰€æœ‰æ—¥å¿—æ¶ˆæ¯ã€‚</p><p>æˆ‘ä»¬å†æ¬¡æ¥å›é¡¾ä¸€ä¸‹ä»€ä¹ˆæ˜¯ bindingsï¼Œç»‘å®šæ˜¯äº¤æ¢æœºå’Œé˜Ÿåˆ—ä¹‹é—´çš„æ¡¥æ¢å…³ç³»ã€‚ä¹Ÿå¯ä»¥è¿™ä¹ˆç†è§£ï¼š <strong>é˜Ÿåˆ—åªå¯¹å®ƒç»‘å®šçš„äº¤æ¢æœºçš„æ¶ˆæ¯æ„Ÿå…´è¶£</strong>ã€‚ç»‘å®šç”¨å‚æ•°ï¼šroutingKey æ¥è¡¨ç¤ºä¹Ÿå¯ç§°è¯¥å‚æ•°ä¸º binding keyï¼Œ åˆ›å»ºç»‘å®šæˆ‘ä»¬ç”¨ä»£ç :channel.queueBind(queueName, EXCHANGE_NAME, â€œroutingKeyâ€);</p><p>ç»‘å®šä¹‹åçš„æ„ä¹‰ç”±å…¶äº¤æ¢ç±»å‹å†³å®šã€‚</p><h4 id="Directä»‹ç»"><a href="#Directä»‹ç»" class="headerlink" title="Directä»‹ç»"></a>Directä»‹ç»</h4><p>ä¸Šä¸€èŠ‚ä¸­çš„æˆ‘ä»¬çš„æ—¥å¿—ç³»ç»Ÿå°†æ‰€æœ‰æ¶ˆæ¯å¹¿æ’­ç»™æ‰€æœ‰æ¶ˆè´¹è€…ï¼Œå¯¹æ­¤æˆ‘ä»¬æƒ³åšä¸€äº›æ”¹å˜ï¼Œä¾‹å¦‚æˆ‘ä»¬å¸Œæœ›å°†æ—¥å¿—æ¶ˆæ¯å†™å…¥ç£ç›˜çš„ç¨‹åºä»…æ¥æ”¶ä¸¥é‡é”™è¯¯(errros)ï¼Œè€Œä¸å­˜å‚¨å“ªäº›è­¦å‘Š(warning)æˆ–ä¿¡æ¯(info)æ—¥å¿— æ¶ˆæ¯é¿å…æµªè´¹ç£ç›˜ç©ºé—´ã€‚Fanout è¿™ç§äº¤æ¢ç±»å‹å¹¶ä¸èƒ½ç»™æˆ‘ä»¬å¸¦æ¥å¾ˆå¤§çš„çµæ´»æ€§-å®ƒåªèƒ½è¿›è¡Œæ— æ„è¯†çš„å¹¿æ’­ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å°†ä½¿ç”¨ direct è¿™ç§ç±»å‹æ¥è¿›è¡Œæ›¿æ¢ï¼Œè¿™ç§ç±»å‹çš„å·¥ä½œæ–¹å¼æ˜¯ï¼Œæ¶ˆæ¯åªå»åˆ°å®ƒç»‘å®šçš„ routingKey é˜Ÿåˆ—ä¸­å»ã€‚</p><p><img src="https://www.naste.top:9000/images/image-20230529095924798.png" alt="image-20230529095924798"></p><p>åœ¨ä¸Šé¢è¿™å¼ å›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° X ç»‘å®šäº†ä¸¤ä¸ªé˜Ÿåˆ—ï¼Œç»‘å®šç±»å‹æ˜¯ directã€‚é˜Ÿåˆ—1 ç»‘å®šé”®ä¸º orangeï¼Œ é˜Ÿåˆ—2 ç»‘å®šé”®æœ‰ä¸¤ä¸ªï¼šä¸€ä¸ªç»‘å®šé”®ä¸º blackï¼Œå¦ä¸€ä¸ªç»‘å®šé”®ä¸º green.</p><p>åœ¨è¿™ç§ç»‘å®šæƒ…å†µä¸‹ï¼Œç”Ÿäº§è€…å‘å¸ƒæ¶ˆæ¯åˆ° exchange ä¸Šï¼Œç»‘å®šé”®ä¸º orange çš„æ¶ˆæ¯ä¼šè¢«å‘å¸ƒåˆ°é˜Ÿåˆ—1ã€‚ç»‘å®šé”®ä¸º blackæˆ–greençš„æ¶ˆæ¯ä¼šè¢«å‘å¸ƒåˆ°é˜Ÿåˆ—2ï¼Œå…¶ä»–æ¶ˆæ¯ç±»å‹çš„æ¶ˆæ¯å°†è¢«ä¸¢å¼ƒã€‚</p><h4 id="å¤šé‡ç»‘å®š"><a href="#å¤šé‡ç»‘å®š" class="headerlink" title="å¤šé‡ç»‘å®š"></a>å¤šé‡ç»‘å®š</h4><p>å½“ç„¶å¦‚æœ exchange çš„ç»‘å®šç±»å‹æ˜¯directï¼Œ<strong>ä½†æ˜¯å®ƒç»‘å®šçš„å¤šä¸ªé˜Ÿåˆ—çš„ key å¦‚æœéƒ½ç›¸åŒ</strong>ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹è™½ç„¶ç»‘å®šç±»å‹æ˜¯ direct <strong>ä½†æ˜¯å®ƒè¡¨ç°çš„å°±å’Œ fanout æœ‰ç‚¹ç±»ä¼¼äº†</strong>ï¼Œå°±è·Ÿå¹¿æ’­å·®ä¸å¤šï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºã€‚</p><p><img src="https://www.naste.top:9000/images/image-20230529100107558.png" alt="image-20230529100107558"></p><h4 id="ç”Ÿäº§è€…-6"><a href="#ç”Ÿäº§è€…-6" class="headerlink" title="ç”Ÿäº§è€…"></a>ç”Ÿäº§è€…</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Channel;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.rabbitmq.utils.ChannelUtils;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeoutException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * directç±»å‹äº¤æ¢æœºæµ‹è¯•</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProducerOne</span> &#123;</span><br><span class="line">    <span class="comment">//äº¤æ¢æœºåç§°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">&quot;direct_exchange&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> ChannelUtils.getChannel();</span><br><span class="line"></span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="keyword">while</span> (scanner.hasNext()) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> scanner.next();</span><br><span class="line">            <span class="comment">// orangeæ˜¯routingKeyï¼Œå¯ä»¥å˜æ¢</span></span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">             * exchangeï¼ˆäº¤æ¢å™¨ï¼‰ï¼šä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæ¶ˆæ¯å°†è¦å‘é€åˆ°å“ªä¸ªäº¤æ¢å™¨ã€‚</span></span><br><span class="line"><span class="comment">             * routing_keyï¼ˆè·¯ç”±é”®ï¼‰ï¼šä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæ¶ˆæ¯çš„è·¯ç”±é”®ï¼Œç”¨äºé€‰æ‹©ä¸è¯¥è·¯ç”±é”®åŒ¹é…çš„é˜Ÿåˆ—ã€‚</span></span><br><span class="line"><span class="comment">             * propertiesï¼ˆå±æ€§ï¼‰ï¼šä¸€ä¸ªAMQPå±æ€§å¯¹è±¡ï¼Œç”¨äºæºå¸¦ä¸€äº›é¢å¤–çš„å…ƒæ•°æ®ï¼ˆå¦‚æ¶ˆæ¯ç±»å‹ã€ä¼˜å…ˆçº§ç­‰ï¼‰ã€‚</span></span><br><span class="line"><span class="comment">             * bodyï¼ˆæ¶ˆæ¯ä½“ï¼‰ï¼šä¸€ä¸ªå­—èŠ‚æ•°ç»„ï¼Œè¡¨ç¤ºæ¶ˆæ¯çš„å†…å®¹ã€‚</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            channel.basicPublish(EXCHANGE_NAME, <span class="string">&quot;orange&quot;</span>, <span class="literal">null</span>, message.getBytes(<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">            System.out.println(<span class="string">&quot;ç”Ÿäº§è€…å‘å‡ºæ¶ˆæ¯:&quot;</span> + message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="æ¶ˆè´¹è€…1-1"><a href="#æ¶ˆè´¹è€…1-1" class="headerlink" title="æ¶ˆè´¹è€…1"></a>æ¶ˆè´¹è€…1</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.rabbitmq.client.BuiltinExchangeType;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Channel;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.DeliverCallback;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.rabbitmq.utils.ChannelUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeoutException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¶ˆè´¹è€…1ï¼ŒroutingKeyï¼šorange</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConsumerOne</span> &#123;</span><br><span class="line">    <span class="comment">//äº¤æ¢æœºåç§°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">&quot;direct_exchange&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é˜Ÿåˆ—åç§°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;person&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="comment">// è·å–ä¿¡é“</span></span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> ChannelUtils.getChannel();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å£°æ˜ä¸€ä¸ªäº¤æ¢æœºã€äº¤æ¢æœºåç§°ï¼Œäº¤æ¢æœºç±»å‹ã€‘</span></span><br><span class="line">        channel.exchangeDeclare(EXCHANGE_NAME, BuiltinExchangeType.DIRECT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * é˜Ÿåˆ—åç§°ã€‚</span></span><br><span class="line"><span class="comment">         * æŒ‡å®šé˜Ÿåˆ—æ˜¯å¦éœ€è¦æŒä¹…åŒ–ã€‚</span></span><br><span class="line"><span class="comment">         * æŒ‡å®šé˜Ÿåˆ—æ˜¯å¦ä¸ºç‹¬å é˜Ÿåˆ—ã€‚</span></span><br><span class="line"><span class="comment">         * æŒ‡å®šé˜Ÿåˆ—æ˜¯å¦è‡ªåŠ¨åˆ é™¤ã€‚</span></span><br><span class="line"><span class="comment">         * ç”¨äºè®¾ç½®é˜Ÿåˆ—çš„å…¶ä»–å±æ€§ï¼Œä¾‹å¦‚ TTLã€æœ€å¤§é•¿åº¦ç­‰ã€‚</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        channel.queueDeclare(QUEUE_NAME, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç»‘å®šäº¤æ¢æœºä¸é˜Ÿåˆ—ã€é˜Ÿåˆ—åç§°ã€äº¤æ¢æœºåç§°ã€äº¤æ¢æœºå’Œé˜Ÿåˆ—ç»‘å®šçš„RoutingKeyã€‘</span></span><br><span class="line">        channel.queueBind(QUEUE_NAME, EXCHANGE_NAME, <span class="string">&quot;orange&quot;</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;ç­‰å¾…æ¥æ”¶æ¶ˆæ¯ï¼ŒæŠŠæ¥æ”¶åˆ°çš„æ¶ˆæ¯æ‰“å°åœ¨å±å¹•ä¸Š...&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ¶ˆè´¹è€…å–æ¶ˆæ¶ˆæ¯æ—¶å›è°ƒæ¥å£</span></span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumerTag, message) -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;exchangeï¼šdirect_exchange\nqueueï¼šperson\nroutingKeyï¼šorange\næ¶ˆæ¯ï¼š&quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(message.getBody(), <span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯</span></span><br><span class="line">        channel.basicConsume(QUEUE_NAME, <span class="literal">true</span>, deliverCallback, consumerTag -&gt; &#123;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ¶ˆè´¹è€…2-1"><a href="#æ¶ˆè´¹è€…2-1" class="headerlink" title="æ¶ˆè´¹è€…2"></a>æ¶ˆè´¹è€…2</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.rabbitmq.client.BuiltinExchangeType;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Channel;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.DeliverCallback;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.rabbitmq.utils.ChannelUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeoutException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¶ˆè´¹è€…2ï¼ŒroutingKeyï¼šblack</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConsumerTwo</span> &#123;</span><br><span class="line">    <span class="comment">//äº¤æ¢æœºåç§°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">&quot;direct_exchange&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é˜Ÿåˆ—åç§°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;user&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="comment">// è·å–ä¿¡é“</span></span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> ChannelUtils.getChannel();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å£°æ˜ä¸€ä¸ªäº¤æ¢æœºã€äº¤æ¢æœºåç§°ï¼Œäº¤æ¢æœºç±»å‹ã€‘</span></span><br><span class="line">        channel.exchangeDeclare(EXCHANGE_NAME, BuiltinExchangeType.DIRECT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * é˜Ÿåˆ—åç§°ã€‚</span></span><br><span class="line"><span class="comment">         * æŒ‡å®šé˜Ÿåˆ—æ˜¯å¦éœ€è¦æŒä¹…åŒ–ã€‚</span></span><br><span class="line"><span class="comment">         * æŒ‡å®šé˜Ÿåˆ—æ˜¯å¦ä¸ºç‹¬å é˜Ÿåˆ—ã€‚</span></span><br><span class="line"><span class="comment">         * æŒ‡å®šé˜Ÿåˆ—æ˜¯å¦è‡ªåŠ¨åˆ é™¤ã€‚</span></span><br><span class="line"><span class="comment">         * ç”¨äºè®¾ç½®é˜Ÿåˆ—çš„å…¶ä»–å±æ€§ï¼Œä¾‹å¦‚ TTLã€æœ€å¤§é•¿åº¦ç­‰ã€‚</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        channel.queueDeclare(QUEUE_NAME, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç»‘å®šäº¤æ¢æœºä¸é˜Ÿåˆ—ã€é˜Ÿåˆ—åç§°ã€äº¤æ¢æœºåç§°ã€äº¤æ¢æœºå’Œé˜Ÿåˆ—ç»‘å®šçš„RoutingKeyã€‘</span></span><br><span class="line">        channel.queueBind(QUEUE_NAME, EXCHANGE_NAME, <span class="string">&quot;black&quot;</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;ç­‰å¾…æ¥æ”¶æ¶ˆæ¯ï¼ŒæŠŠæ¥æ”¶åˆ°çš„æ¶ˆæ¯æ‰“å°åœ¨å±å¹•ä¸Š...&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ¶ˆè´¹è€…å–æ¶ˆæ¶ˆæ¯æ—¶å›è°ƒæ¥å£</span></span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumerTag, message) -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;exchangeï¼šdirect_exchange\nqueueï¼šuser\nroutingKeyï¼šblack\næ¶ˆæ¯ï¼š&quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(message.getBody(), <span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯</span></span><br><span class="line">        channel.basicConsume(QUEUE_NAME, <span class="literal">true</span>, deliverCallback, consumerTag -&gt; &#123;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ç»“æœ"><a href="#ç»“æœ" class="headerlink" title="ç»“æœ"></a>ç»“æœ</h4><p><img src="https://www.naste.top:9000/images/image-20230529104022902.png" alt="image-20230529104022902"></p><p><img src="https://www.naste.top:9000/images/image-20230529104243705.png" alt="image-20230529104243705"></p><h3 id="Topics"><a href="#Topics" class="headerlink" title="Topics"></a>Topics</h3><h4 id="Topicçš„ä»‹ç»"><a href="#Topicçš„ä»‹ç»" class="headerlink" title="Topicçš„ä»‹ç»"></a>Topicçš„ä»‹ç»</h4><p>åœ¨ä¸Šä¸€ä¸ªå°èŠ‚ä¸­ï¼Œæˆ‘ä»¬æ”¹è¿›äº†æ—¥å¿—è®°å½•ç³»ç»Ÿã€‚æˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨åªèƒ½è¿›è¡Œéšæ„å¹¿æ’­çš„ fanout äº¤æ¢æœºï¼Œè€Œæ˜¯ä½¿ç”¨äº† direct äº¤æ¢æœºï¼Œä»è€Œæœ‰èƒ½å®ç°æœ‰é€‰æ‹©æ€§åœ°æ¥æ”¶æ—¥å¿—ã€‚</p><p>å°½ç®¡ä½¿ç”¨ direct äº¤æ¢æœºæ”¹è¿›äº†æˆ‘ä»¬çš„ç³»ç»Ÿï¼Œä½†æ˜¯å®ƒä»ç„¶å­˜åœ¨å±€é™æ€§â€”â€”æ¯”æ–¹è¯´æˆ‘ä»¬æƒ³æ¥æ”¶çš„æ—¥å¿—ç±»å‹æœ‰ info.base å’Œ info.advantageï¼ŒæŸä¸ªé˜Ÿåˆ—åªæƒ³ info.base çš„æ¶ˆæ¯ï¼Œé‚£è¿™ä¸ªæ—¶å€™direct å°±åŠä¸åˆ°äº†ã€‚è¿™ä¸ªæ—¶å€™å°±åªèƒ½ä½¿ç”¨ <strong>topic</strong> ç±»å‹</p><p><strong>Topic çš„è¦æ±‚</strong></p><p>å‘é€åˆ°ç±»å‹æ˜¯ topic äº¤æ¢æœºçš„æ¶ˆæ¯çš„ routing_key ä¸èƒ½éšæ„å†™ï¼Œå¿…é¡»æ»¡è¶³ä¸€å®šçš„è¦æ±‚ï¼Œå®ƒå¿…é¡»æ˜¯<strong>ä¸€ä¸ªå•è¯åˆ—è¡¨</strong>ï¼Œ<strong>ä»¥ç‚¹å·åˆ†éš”å¼€</strong>ã€‚è¿™äº›å•è¯å¯ä»¥æ˜¯ä»»æ„å•è¯</p><p>æ¯”å¦‚è¯´ï¼šâ€stock.usd.nyseâ€, â€œnyse.vmwâ€, â€œquick.orange.rabbitâ€ è¿™ç§ç±»å‹çš„ã€‚</p><p>å½“ç„¶è¿™ä¸ªå•è¯åˆ—è¡¨æœ€å¤šä¸èƒ½è¶…è¿‡ 255 ä¸ªå­—èŠ‚ã€‚</p><p>åœ¨è¿™ä¸ªè§„åˆ™åˆ—è¡¨ä¸­ï¼Œå…¶ä¸­æœ‰ä¸¤ä¸ªæ›¿æ¢ç¬¦æ˜¯å¤§å®¶éœ€è¦æ³¨æ„çš„ï¼š</p><ul><li><strong>*(æ˜Ÿå·)å¯ä»¥ä»£æ›¿ä¸€ä¸ªä½ç½®</strong></li><li><strong>#(äº•å·)å¯ä»¥æ›¿ä»£é›¶ä¸ªæˆ–å¤šä¸ªä½ç½®</strong></li></ul><h4 id="TopicåŒ¹é…æ¡ˆä¾‹"><a href="#TopicåŒ¹é…æ¡ˆä¾‹" class="headerlink" title="TopicåŒ¹é…æ¡ˆä¾‹"></a>TopicåŒ¹é…æ¡ˆä¾‹</h4><p><img src="https://www.naste.top:9000/images/image-20230529105705819.png" alt="image-20230529105705819"></p><ul><li>Q1â€”&gt;ç»‘å®šçš„æ˜¯<ul><li>ä¸­é—´å¸¦ orange å¸¦ 3 ä¸ªå•è¯çš„å­—ç¬¦ä¸² <code>(*.orange.*)</code></li></ul></li><li>Q2â€”&gt;ç»‘å®šçš„æ˜¯<ul><li>æœ€åä¸€ä¸ªå•è¯æ˜¯ rabbit çš„ 3 ä¸ªå•è¯ <code>(*.*.rabbit)</code></li><li>ç¬¬ä¸€ä¸ªå•è¯æ˜¯ lazy çš„å¤šä¸ªå•è¯ <code>(lazy.#)</code></li></ul></li></ul><p>ä¸Šå›¾æ˜¯ä¸€ä¸ªé˜Ÿåˆ—ç»‘å®šå…³ç³»å›¾ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ä»–ä»¬ä¹‹é—´æ•°æ®æ¥æ”¶æƒ…å†µæ˜¯æ€ä¹ˆæ ·çš„</p><div class="table-container"><table><thead><tr><th>ä¾‹å­</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>quick.orange.rabbit</td><td>è¢«é˜Ÿåˆ— Q1Q2 æ¥æ”¶åˆ°</td></tr><tr><td>azy.orange.elephant</td><td>è¢«é˜Ÿåˆ— Q1Q2 æ¥æ”¶åˆ°</td></tr><tr><td>quick.orange.fox</td><td>è¢«é˜Ÿåˆ— Q1 æ¥æ”¶åˆ°</td></tr><tr><td>lazy.brown.fox</td><td>è¢«é˜Ÿåˆ— Q2 æ¥æ”¶åˆ°</td></tr><tr><td>lazy.pink.rabbit</td><td>è™½ç„¶æ»¡è¶³ä¸¤ä¸ªç»‘å®šä½†åªè¢«é˜Ÿåˆ— Q2 æ¥æ”¶ä¸€æ¬¡</td></tr><tr><td>quick.brown.fox</td><td>ä¸åŒ¹é…ä»»ä½•ç»‘å®šä¸ä¼šè¢«ä»»ä½•é˜Ÿåˆ—æ¥æ”¶åˆ°ä¼šè¢«ä¸¢å¼ƒ</td></tr><tr><td>quick.orange.male.rabbit</td><td>æ˜¯å››ä¸ªå•è¯ä¸åŒ¹é…ä»»ä½•ç»‘å®šä¼šè¢«ä¸¢å¼ƒ</td></tr><tr><td>lazy.orange.male.rabbit</td><td>æ˜¯å››ä¸ªå•è¯ä½†åŒ¹é… Q2</td></tr></tbody></table></div><blockquote><p><strong>å½“ä¸€ä¸ªé˜Ÿåˆ—ç»‘å®šé”®æ˜¯ #ï¼Œé‚£ä¹ˆè¿™ä¸ªé˜Ÿåˆ—å°†æ¥æ”¶æ‰€æœ‰æ•°æ®ï¼Œå°±æœ‰ç‚¹åƒ fanout äº†</strong></p><p><strong>å¦‚æœé˜Ÿåˆ—ç»‘å®šé”®å½“ä¸­æ²¡æœ‰ # å’Œ * å‡ºç°ï¼Œé‚£ä¹ˆè¯¥é˜Ÿåˆ—ç»‘å®šç±»å‹å°±æ˜¯ direct äº†</strong></p></blockquote><h4 id="ç”Ÿäº§è€…-7"><a href="#ç”Ÿäº§è€…-7" class="headerlink" title="ç”Ÿäº§è€…"></a>ç”Ÿäº§è€…</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Channel;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.rabbitmq.utils.ChannelUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeoutException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * topicsç±»å‹äº¤æ¢æœºæµ‹è¯•</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProducerOne</span> &#123;</span><br><span class="line">    <span class="comment">//äº¤æ¢æœºåç§°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">&quot;topic_exchange&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> ChannelUtils.getChannel();</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * Q1--&gt;ç»‘å®šçš„æ˜¯</span></span><br><span class="line"><span class="comment">         *      ä¸­é—´å¸¦ orange å¸¦ 3 ä¸ªå•è¯çš„å­—ç¬¦ä¸²(*.orange.*)</span></span><br><span class="line"><span class="comment">         * Q2--&gt;ç»‘å®šçš„æ˜¯</span></span><br><span class="line"><span class="comment">         *      æœ€åä¸€ä¸ªå•è¯æ˜¯ rabbit çš„ 3 ä¸ªå•è¯(*.*.rabbit)</span></span><br><span class="line"><span class="comment">         *      ç¬¬ä¸€ä¸ªå•è¯æ˜¯ lazy çš„å¤šä¸ªå•è¯(lazy.#)</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        HashMap&lt;String, String&gt; bindingKeyMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        bindingKeyMap.put(<span class="string">&quot;quick.orange.rabbit&quot;</span>, <span class="string">&quot;è¢«é˜Ÿåˆ— Q1Q2 æ¥æ”¶åˆ°&quot;</span>);</span><br><span class="line">        bindingKeyMap.put(<span class="string">&quot;lazy.orange.elephant&quot;</span>, <span class="string">&quot;è¢«é˜Ÿåˆ— Q1Q2 æ¥æ”¶åˆ°&quot;</span>);</span><br><span class="line">        bindingKeyMap.put(<span class="string">&quot;quick.orange.fox&quot;</span>, <span class="string">&quot;è¢«é˜Ÿåˆ— Q1 æ¥æ”¶åˆ°&quot;</span>);</span><br><span class="line">        bindingKeyMap.put(<span class="string">&quot;lazy.brown.fox&quot;</span>, <span class="string">&quot;è¢«é˜Ÿåˆ— Q2 æ¥æ”¶åˆ°&quot;</span>);</span><br><span class="line">        bindingKeyMap.put(<span class="string">&quot;lazy.pink.rabbit&quot;</span>, <span class="string">&quot;è™½ç„¶æ»¡è¶³ä¸¤ä¸ªç»‘å®šä½†åªè¢«é˜Ÿåˆ— Q2 æ¥æ”¶ä¸€æ¬¡&quot;</span>);</span><br><span class="line">        bindingKeyMap.put(<span class="string">&quot;quick.brown.fox&quot;</span>, <span class="string">&quot;ä¸åŒ¹é…ä»»ä½•ç»‘å®šä¸ä¼šè¢«ä»»ä½•é˜Ÿåˆ—æ¥æ”¶åˆ°ä¼šè¢«ä¸¢å¼ƒ&quot;</span>);</span><br><span class="line">        bindingKeyMap.put(<span class="string">&quot;quick.orange.male.rabbit&quot;</span>, <span class="string">&quot;æ˜¯å››ä¸ªå•è¯ä¸åŒ¹é…ä»»ä½•ç»‘å®šä¼šè¢«ä¸¢å¼ƒ&quot;</span>);</span><br><span class="line">        bindingKeyMap.put(<span class="string">&quot;lazy.orange.male.rabbit&quot;</span>, <span class="string">&quot;æ˜¯å››ä¸ªå•è¯ä½†åŒ¹é… Q2&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; bindingKeyEntry : bindingKeyMap.entrySet()) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">routingKey</span> <span class="operator">=</span> bindingKeyEntry.getKey();</span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> bindingKeyEntry.getValue();</span><br><span class="line"></span><br><span class="line">            channel.basicPublish(EXCHANGE_NAME, routingKey, <span class="literal">null</span>, message.getBytes(<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">            System.out.println(<span class="string">&quot;ç”Ÿäº§è€…å‘å‡ºæ¶ˆæ¯:&quot;</span> + message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="æ¶ˆè´¹è€…1-2"><a href="#æ¶ˆè´¹è€…1-2" class="headerlink" title="æ¶ˆè´¹è€…1"></a>æ¶ˆè´¹è€…1</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.rabbitmq.client.BuiltinExchangeType;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Channel;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.DeliverCallback;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.rabbitmq.utils.ChannelUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeoutException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * topicsç±»å‹äº¤æ¢æœºæ¶ˆæ¯æ¥æ”¶</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConsumerOne</span> &#123;</span><br><span class="line">    <span class="comment">//äº¤æ¢æœºåç§°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">&quot;topic_exchange&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ¥æ”¶æ¶ˆæ¯</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> ChannelUtils.getChannel();</span><br><span class="line">        <span class="comment">//å£°æ˜äº¤æ¢æœº</span></span><br><span class="line">        channel.exchangeDeclare(EXCHANGE_NAME, BuiltinExchangeType.TOPIC);</span><br><span class="line">        <span class="comment">//å£°æ˜é˜Ÿåˆ—</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span> <span class="string">&quot;Q1&quot;</span>;</span><br><span class="line">        channel.queueDeclare(queueName,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">null</span>);</span><br><span class="line">        channel.queueBind(queueName,EXCHANGE_NAME,<span class="string">&quot;*.orange.*&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;ç­‰å¾…æ¥æ”¶æ¶ˆæ¯...&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumerTag,message) -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(message.getBody(),<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">            System.out.println(<span class="string">&quot;æ¥æ”¶é˜Ÿåˆ—ï¼š&quot;</span>+queueName+<span class="string">&quot;  ç»‘å®šé”®:&quot;</span>+message.getEnvelope().getRoutingKey());</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">//æ¥æ”¶æ¶ˆæ¯</span></span><br><span class="line">        channel.basicConsume(queueName,<span class="literal">true</span>,deliverCallback,consumerTag -&gt;&#123;&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ¶ˆè´¹è€…2-2"><a href="#æ¶ˆè´¹è€…2-2" class="headerlink" title="æ¶ˆè´¹è€…2"></a>æ¶ˆè´¹è€…2</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.rabbitmq.client.BuiltinExchangeType;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Channel;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.DeliverCallback;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.rabbitmq.utils.ChannelUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeoutException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * topicsç±»å‹äº¤æ¢æœºæ¶ˆæ¯æ¥æ”¶</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConsumerTwo</span> &#123;</span><br><span class="line">    <span class="comment">//äº¤æ¢æœºåç§°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">&quot;topic_exchange&quot;</span>;</span><br><span class="line">    <span class="comment">//æ¥æ”¶æ¶ˆæ¯</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> ChannelUtils.getChannel();</span><br><span class="line">        <span class="comment">//å£°æ˜äº¤æ¢æœº</span></span><br><span class="line">        channel.exchangeDeclare(EXCHANGE_NAME, BuiltinExchangeType.TOPIC);</span><br><span class="line">        <span class="comment">//å£°æ˜é˜Ÿåˆ—</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span> <span class="string">&quot;Q2&quot;</span>;</span><br><span class="line">        channel.queueDeclare(queueName,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">null</span>);</span><br><span class="line">        channel.queueBind(queueName,EXCHANGE_NAME,<span class="string">&quot;*.*.rabbit&quot;</span>);</span><br><span class="line">        channel.queueBind(queueName,EXCHANGE_NAME,<span class="string">&quot;lazy.#&quot;</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;ç­‰å¾…æ¥æ”¶æ¶ˆæ¯...&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumerTag,message) -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(message.getBody(),<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">            System.out.println(<span class="string">&quot;æ¥æ”¶é˜Ÿåˆ—ï¼š&quot;</span>+queueName+<span class="string">&quot;  ç»‘å®šé”®:&quot;</span>+message.getEnvelope().getRoutingKey());</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">//æ¥æ”¶æ¶ˆæ¯</span></span><br><span class="line">        channel.basicConsume(queueName,<span class="literal">true</span>,deliverCallback,consumerTag -&gt;&#123;&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ç»“æœ-1"><a href="#ç»“æœ-1" class="headerlink" title="ç»“æœ"></a>ç»“æœ</h4><p><img src="https://www.naste.top:9000/images/image-20230529110312371.png" alt="image-20230529110312371"></p><h1 id="æ­»ä¿¡é˜Ÿåˆ—"><a href="#æ­»ä¿¡é˜Ÿåˆ—" class="headerlink" title="æ­»ä¿¡é˜Ÿåˆ—"></a>æ­»ä¿¡é˜Ÿåˆ—</h1><h2 id="æ­»ä¿¡æ¦‚å¿µ"><a href="#æ­»ä¿¡æ¦‚å¿µ" class="headerlink" title="æ­»ä¿¡æ¦‚å¿µ"></a>æ­»ä¿¡æ¦‚å¿µ</h2><p>å…ˆä»æ¦‚å¿µè§£é‡Šä¸Šææ¸…æ¥šè¿™ä¸ªå®šä¹‰ï¼Œæ­»ä¿¡ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯æ— æ³•è¢«æ¶ˆè´¹çš„æ¶ˆæ¯ï¼Œå­—é¢æ„æ€å¯ä»¥è¿™æ ·ç†è§£ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œproducer å°†æ¶ˆæ¯æŠ•é€’åˆ° broker æˆ–è€…ç›´æ¥åˆ°queue é‡Œäº†ï¼Œconsumer ä» queue å–å‡ºæ¶ˆæ¯ è¿›è¡Œæ¶ˆè´¹ï¼Œä½†æŸäº›æ—¶å€™ç”±äºç‰¹å®šçš„åŸå› <strong>å¯¼è‡´ queue ä¸­çš„æŸäº›æ¶ˆæ¯æ— æ³•è¢«æ¶ˆè´¹</strong>ï¼Œè¿™æ ·çš„æ¶ˆæ¯å¦‚æœæ²¡æœ‰åç»­çš„å¤„ç†ï¼Œå°±å˜æˆäº†æ­»ä¿¡ï¼Œæœ‰æ­»ä¿¡è‡ªç„¶å°±æœ‰äº†æ­»ä¿¡é˜Ÿåˆ—ã€‚</p><p>åº”ç”¨åœºæ™¯ï¼šä¸ºäº†ä¿è¯è®¢å•ä¸šåŠ¡çš„æ¶ˆæ¯æ•°æ®ä¸ä¸¢å¤±ï¼Œéœ€è¦ä½¿ç”¨åˆ° RabbitMQ çš„æ­»ä¿¡é˜Ÿåˆ—æœºåˆ¶ï¼Œå½“æ¶ˆæ¯æ¶ˆè´¹å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œå°†æ¶ˆæ¯æŠ•å…¥æ­»ä¿¡é˜Ÿåˆ—ä¸­ã€‚è¿˜æœ‰æ¯”å¦‚è¯´ï¼šç”¨æˆ·åœ¨å•†åŸä¸‹å•æˆåŠŸå¹¶ç‚¹å‡»å»æ”¯ä»˜ååœ¨æŒ‡å®šæ—¶é—´æœªæ”¯ä»˜æ—¶è‡ªåŠ¨å¤±æ•ˆã€‚</p><h2 id="æ­»ä¿¡çš„æ¥æº"><a href="#æ­»ä¿¡çš„æ¥æº" class="headerlink" title="æ­»ä¿¡çš„æ¥æº"></a>æ­»ä¿¡çš„æ¥æº</h2><ul><li><p>æ¶ˆæ¯ TTL è¿‡æœŸ</p><p>  TTLæ˜¯ Time To Live çš„ç¼©å†™, ä¹Ÿå°±æ˜¯ç”Ÿå­˜æ—¶é—´</p></li><li><p>é˜Ÿåˆ—è¾¾åˆ°æœ€å¤§é•¿åº¦</p><p>  é˜Ÿåˆ—æ»¡äº†ï¼Œæ— æ³•å†æ·»åŠ æ•°æ®åˆ° MQ ä¸­</p></li><li><p>æ¶ˆæ¯è¢«æ‹’ç»</p><p>  (basic.reject æˆ– basic.nack) å¹¶ä¸” requeue = false</p></li></ul><h2 id="æ­»ä¿¡å®æˆ˜"><a href="#æ­»ä¿¡å®æˆ˜" class="headerlink" title="æ­»ä¿¡å®æˆ˜"></a>æ­»ä¿¡å®æˆ˜</h2><p>äº¤æ¢æœºç±»å‹æ˜¯ directï¼Œä¸¤ä¸ªæ¶ˆè´¹è€…ï¼Œä¸€ä¸ªç”Ÿäº§è€…ï¼Œä¸¤ä¸ªé˜Ÿåˆ—ï¼šæ¶ˆæ¯é˜Ÿåˆ—å’Œæ­»ä¿¡é˜Ÿåˆ—</p><p><img src="https://www.naste.top:9000/images/image.691xh9mh3yk0.webp" alt="image"></p><h3 id="æ¶ˆæ¯TTLè¿‡æœŸ"><a href="#æ¶ˆæ¯TTLè¿‡æœŸ" class="headerlink" title="æ¶ˆæ¯TTLè¿‡æœŸ"></a>æ¶ˆæ¯TTLè¿‡æœŸ</h3><p><strong>ç”Ÿäº§è€…</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> frx</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/7/25  19:13</span></span><br><span class="line"><span class="comment"> * desc:æ­»ä¿¡é˜Ÿåˆ—ä¹‹ç”Ÿäº§è€…</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Producer</span> &#123;</span><br><span class="line">    <span class="comment">//æ™®é€šäº¤æ¢æœºçš„åç§°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">NORMAL_EXCHANGE</span> <span class="operator">=</span> <span class="string">&quot;normal_exchange&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> ChannelUtils.getChannel();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ­»ä¿¡æ¶ˆæ¯ è®¾ç½®ttlæ—¶é—´ live to time å•ä½æ˜¯ms</span></span><br><span class="line">        AMQP.<span class="type">BasicProperties</span> <span class="variable">properties</span> <span class="operator">=</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">AMQP</span>.BasicProperties().builder().expiration(<span class="string">&quot;10000&quot;</span>).build();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;<span class="number">11</span> ; i++) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;info&quot;</span>+i;</span><br><span class="line">            channel.basicPublish(NORMAL_EXCHANGE,<span class="string">&quot;zhangsan&quot;</span>,properties,message.getBytes());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ¶ˆè´¹è€… C1 ä»£ç </strong>(å¯åŠ¨ä¹‹åå…³é—­è¯¥æ¶ˆè´¹è€… æ¨¡æ‹Ÿå…¶æ¥æ”¶ä¸åˆ°æ¶ˆæ¯)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> frx</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/7/25  17:00</span></span><br><span class="line"><span class="comment"> * desc:æœ¬æ¬¡æ˜¯ä¸ºäº†æ­»ä¿¡é˜Ÿåˆ—å®æˆ˜</span></span><br><span class="line"><span class="comment"> * æ¶ˆè´¹è€…1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Consumer01</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ™®é€šäº¤æ¢æœºçš„åç§°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">NORMAL_EXCHANGE</span> <span class="operator">=</span> <span class="string">&quot;normal_exchange&quot;</span>;</span><br><span class="line">    <span class="comment">//æ­»ä¿¡äº¤æ¢æœºçš„åç§°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEAD_EXCHANGE</span> <span class="operator">=</span> <span class="string">&quot;dead_exchange&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ™®é€šé˜Ÿåˆ—çš„åç§°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">NORMAL_QUEUE</span> <span class="operator">=</span> <span class="string">&quot;normal_queue&quot;</span>;</span><br><span class="line">    <span class="comment">//æ­»ä¿¡é˜Ÿåˆ—çš„åç§°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEAD_QUEUE</span> <span class="operator">=</span> <span class="string">&quot;dead_queue&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> ChannelUtils.getChannel();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å£°æ˜æ­»ä¿¡å’Œæ™®é€šäº¤æ¢æœºï¼Œç±»å‹ä¸ºdirect</span></span><br><span class="line">        channel.exchangeDeclare(NORMAL_EXCHANGE, BuiltinExchangeType.DIRECT);</span><br><span class="line">        channel.exchangeDeclare(DEAD_EXCHANGE, BuiltinExchangeType.DIRECT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å£°æ˜æ™®é€šé˜Ÿåˆ—</span></span><br><span class="line">        Map&lt;String,Object&gt; arguments = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//è¿‡æœŸæ—¶é—´ 10s ç”±ç”Ÿäº§è€…æŒ‡å®š æ›´åŠ çµæ´»</span></span><br><span class="line">        <span class="comment">//arguments.put(&quot;x-message-ttl&quot;,10000);</span></span><br><span class="line">        <span class="comment">//æ­£å¸¸çš„é˜Ÿåˆ—è®¾ç½®æ­»ä¿¡äº¤æ¢æœº</span></span><br><span class="line">        arguments.put(<span class="string">&quot;x-dead-letter-exchange&quot;</span>,DEAD_EXCHANGE);<span class="comment">//å›¾ä¸­çº¢ç®­å¤´</span></span><br><span class="line">        <span class="comment">//è®¾ç½®æ­»ä¿¡routingKey</span></span><br><span class="line">        arguments.put(<span class="string">&quot;x-dead-letter-routing-key&quot;</span>,<span class="string">&quot;lisi&quot;</span>);</span><br><span class="line"></span><br><span class="line">        channel.queueDeclare(NORMAL_QUEUE,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">false</span>,arguments);</span><br><span class="line">        <span class="comment">/////////////////////////////////////////////////////////////////////////</span></span><br><span class="line">        <span class="comment">//å£°æ˜æ­»ä¿¡é˜Ÿåˆ—</span></span><br><span class="line">        channel.queueDeclare(DEAD_QUEUE,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç»‘å®šæ™®é€šçš„äº¤æ¢æœºä¸é˜Ÿåˆ—</span></span><br><span class="line">        channel.queueBind(NORMAL_QUEUE,NORMAL_EXCHANGE,<span class="string">&quot;zhangsan&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç»‘å®šæ­»ä¿¡çš„äº¤æ¢æœºä¸æ­»ä¿¡çš„é˜Ÿåˆ—</span></span><br><span class="line">        channel.queueBind(DEAD_QUEUE,DEAD_EXCHANGE,<span class="string">&quot;lisi&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;ç­‰å¾…æ¥æ”¶æ¶ˆæ¯...&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumerTag,message) -&gt;&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Consumer01æ¥å—çš„æ¶ˆæ¯æ˜¯ï¼š&quot;</span>+<span class="keyword">new</span> <span class="title class_">String</span>(message.getBody(),<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        channel.basicConsume(NORMAL_QUEUE,<span class="literal">true</span>,deliverCallback,consumerTag -&gt; &#123;&#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…ˆå¯åŠ¨æ¶ˆè´¹è€… C1ï¼Œåˆ›å»ºå‡ºé˜Ÿåˆ—ï¼Œç„¶ååœæ­¢è¯¥ C1 çš„è¿è¡Œï¼Œåˆ™ C1 å°†æ— æ³•æ”¶åˆ°é˜Ÿåˆ—çš„æ¶ˆæ¯ï¼Œæ— æ³•æ”¶åˆ°çš„æ¶ˆæ¯ 10 ç§’åè¿›å…¥æ­»ä¿¡é˜Ÿåˆ—ã€‚å¯åŠ¨ç”Ÿäº§è€… producer ç”Ÿäº§æ¶ˆæ¯</p><p><strong>ç”Ÿäº§è€…æœªå‘é€æ¶ˆæ¯</strong></p><p><img src="https://www.naste.top:9000/images/image.5ldx5kffws00.webp" alt="image"></p><p><strong>ç”Ÿäº§è€…å‘é€äº†10æ¡æ¶ˆæ¯ï¼Œæ­¤æ—¶æ­£å¸¸æ¶ˆæ¯é˜Ÿåˆ—æœ‰10æ¡æœªæ¶ˆè´¹æ¶ˆæ¯</strong></p><p><img src="https://www.naste.top:9000/images/image.4k5fjvtukpe0.webp" alt="image"></p><p><strong>æ—¶é—´è¿‡å»10ç§’ï¼Œæ­£å¸¸é˜Ÿåˆ—é‡Œé¢çš„æ¶ˆæ¯ç”±äºæ²¡æœ‰è¢«æ¶ˆè´¹ï¼Œæ¶ˆæ¯è¿›å…¥æ­»ä¿¡é˜Ÿåˆ—</strong></p><p><img src="https://www.naste.top:9000/images/image.5g2svti1sec0.webp" alt="image"></p><p><strong>æ¶ˆè´¹è€… C2 ä»£ç </strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> frx</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/7/25  19:30</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Consumer02</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ­»ä¿¡é˜Ÿåˆ—çš„åç§°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEAD_QUEUE</span> <span class="operator">=</span> <span class="string">&quot;dead_queue&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> ChannelUtils.getChannel();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;ç­‰å¾…æ¥æ”¶æ­»ä¿¡æ¶ˆæ¯...&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumerTag, message) -&gt;&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Consumer02æ¥å—çš„æ¶ˆæ¯æ˜¯ï¼š&quot;</span>+<span class="keyword">new</span> <span class="title class_">String</span>(message.getBody(),<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        channel.basicConsume(DEAD_QUEUE,<span class="literal">true</span>,deliverCallback,consumerTag -&gt; &#123;&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ•ˆæœæ¼”ç¤º</strong></p><p><img src="https://www.naste.top:9000/images/image.3a1tkaqx5jm0.webp" alt="image"></p><ul><li>æ§åˆ¶å°</li></ul><p><img src="https://www.naste.top:9000/images/image.2qvoqd9bcdc0.webp" alt="image"></p><h3 id="æ­»ä¿¡æœ€å¤§é•¿åº¦"><a href="#æ­»ä¿¡æœ€å¤§é•¿åº¦" class="headerlink" title="æ­»ä¿¡æœ€å¤§é•¿åº¦"></a>æ­»ä¿¡æœ€å¤§é•¿åº¦</h3><ol><li>æ¶ˆæ¯ç”Ÿäº§è€…ä»£ç å»æ‰ TTL å±æ€§ï¼Œ<code>basicPublish</code> çš„ç¬¬ä¸‰ä¸ªå‚æ•°æ”¹ä¸º null</li></ol><figure class="highlight java"><figcaption><span>&#123;9,10,13&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Producer</span> &#123;</span><br><span class="line">    <span class="comment">//æ™®é€šäº¤æ¢æœºçš„åç§°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">NORMAL_EXCHANGE</span> <span class="operator">=</span> <span class="string">&quot;normal_exchange&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> ChannelUtils.getChannel();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ­»ä¿¡æ¶ˆæ¯ è®¾ç½®ttlæ—¶é—´ live to time å•ä½æ˜¯ms</span></span><br><span class="line">        <span class="comment">//AMQP.BasicProperties properties =</span></span><br><span class="line">        <span class="comment">//        new AMQP.BasicProperties().builder().expiration(&quot;10000&quot;).build();</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;<span class="number">11</span> ; i++) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;info&quot;</span>+i;</span><br><span class="line">            channel.basicPublish(NORMAL_EXCHANGE,<span class="string">&quot;zhangsan&quot;</span>,<span class="literal">null</span>,message.getBytes());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>C1 æ¶ˆè´¹è€…ä¿®æ”¹ä»¥ä¸‹ä»£ç (<strong>å¯åŠ¨ä¹‹åå…³é—­è¯¥æ¶ˆè´¹è€… æ¨¡æ‹Ÿå…¶æ¥æ”¶ä¸åˆ°æ¶ˆæ¯</strong>)</li></ol><figure class="highlight java"><figcaption><span>&#123;30&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Consumer01</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ™®é€šäº¤æ¢æœºçš„åç§°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">NORMAL_EXCHANGE</span> <span class="operator">=</span> <span class="string">&quot;normal_exchange&quot;</span>;</span><br><span class="line">    <span class="comment">//æ­»ä¿¡äº¤æ¢æœºçš„åç§°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEAD_EXCHANGE</span> <span class="operator">=</span> <span class="string">&quot;dead_exchange&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ™®é€šé˜Ÿåˆ—çš„åç§°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">NORMAL_QUEUE</span> <span class="operator">=</span> <span class="string">&quot;normal_queue&quot;</span>;</span><br><span class="line">    <span class="comment">//æ­»ä¿¡é˜Ÿåˆ—çš„åç§°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEAD_QUEUE</span> <span class="operator">=</span> <span class="string">&quot;dead_queue&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> ChannelUtils.getChannel();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å£°æ˜æ­»ä¿¡å’Œæ™®é€šäº¤æ¢æœºï¼Œç±»å‹ä¸ºdirect</span></span><br><span class="line">        channel.exchangeDeclare(NORMAL_EXCHANGE, BuiltinExchangeType.DIRECT);</span><br><span class="line">        channel.exchangeDeclare(DEAD_EXCHANGE, BuiltinExchangeType.DIRECT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å£°æ˜æ™®é€šé˜Ÿåˆ—</span></span><br><span class="line">        Map&lt;String,Object&gt; arguments = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//è¿‡æœŸæ—¶é—´ 10s ç”±ç”Ÿäº§è€…æŒ‡å®š æ›´åŠ çµæ´»</span></span><br><span class="line">        <span class="comment">//arguments.put(&quot;x-message-ttl&quot;,10000);</span></span><br><span class="line">        <span class="comment">//æ­£å¸¸çš„é˜Ÿåˆ—è®¾ç½®æ­»ä¿¡äº¤æ¢æœº</span></span><br><span class="line">        arguments.put(<span class="string">&quot;x-dead-letter-exchange&quot;</span>,DEAD_EXCHANGE);<span class="comment">//å›¾ä¸­çº¢ç®­å¤´</span></span><br><span class="line">        <span class="comment">//è®¾ç½®æ­»ä¿¡routingKey</span></span><br><span class="line">        arguments.put(<span class="string">&quot;x-dead-letter-routing-key&quot;</span>,<span class="string">&quot;lisi&quot;</span>);</span><br><span class="line">        <span class="comment">//è®¾ç½®æ­£å¸¸é˜Ÿåˆ—é•¿åº¦çš„é™åˆ¶ï¼Œä¾‹å¦‚å‘é€10ä¸ªæ¶ˆæ¯ï¼Œ6ä¸ªä¸ºæ­£å¸¸ï¼Œ4ä¸ªä¸ºæ­»ä¿¡</span></span><br><span class="line">        arguments.put(<span class="string">&quot;x-max-length&quot;</span>,<span class="number">6</span>);</span><br><span class="line">        </span><br><span class="line">        channel.queueDeclare(NORMAL_QUEUE,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">false</span>,arguments);</span><br><span class="line">        <span class="comment">/////////////////////////////////////////////////////////////////////////</span></span><br><span class="line">        <span class="comment">//å£°æ˜æ­»ä¿¡é˜Ÿåˆ—</span></span><br><span class="line">        channel.queueDeclare(DEAD_QUEUE,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç»‘å®šæ™®é€šçš„äº¤æ¢æœºä¸é˜Ÿåˆ—</span></span><br><span class="line">        channel.queueBind(NORMAL_QUEUE,NORMAL_EXCHANGE,<span class="string">&quot;zhangsan&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç»‘å®šæ­»ä¿¡çš„äº¤æ¢æœºä¸æ­»ä¿¡çš„é˜Ÿåˆ—</span></span><br><span class="line">        channel.queueBind(DEAD_QUEUE,DEAD_EXCHANGE,<span class="string">&quot;lisi&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;ç­‰å¾…æ¥æ”¶æ¶ˆæ¯...&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumerTag,message) -&gt;&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Consumer01æ¥å—çš„æ¶ˆæ¯æ˜¯ï¼š&quot;</span>+<span class="keyword">new</span> <span class="title class_">String</span>(message.getBody(),<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        channel.basicConsume(NORMAL_QUEUE,<span class="literal">true</span>,deliverCallback,consumerTag -&gt; &#123;&#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>::: tip æ³¨æ„</p><p>å› ä¸ºå‚æ•°æ”¹å˜äº†ï¼Œæ‰€ä»¥éœ€è¦æŠŠåŸå…ˆé˜Ÿåˆ—åˆ é™¤</p><p>:::</p><ol><li>C2 æ¶ˆè´¹è€…ä»£ç ä¸å˜</li></ol><ul><li>å¯åŠ¨æ¶ˆè´¹è€…C1ï¼Œåˆ›å»ºå‡ºé˜Ÿåˆ—ï¼Œç„¶ååœæ­¢è¯¥ C1 çš„è¿è¡Œï¼Œå¯åŠ¨ç”Ÿäº§è€…</li></ul><p><img src="https://www.naste.top:9000/images/image.6nv41w7ky0o0.webp" alt="image"></p><ul><li>å¯åŠ¨ C2 æ¶ˆè´¹è€…</li></ul><p><img src="https://www.naste.top:9000/images/image.3mg5ph9jr020.webp" alt="image"></p><ul><li>æ§åˆ¶å°</li></ul><p><img src="https://www.naste.top:9000/images/image.664h3njwl6w0.webp" alt="image"></p><h3 id="æ­»ä¿¡æ¶ˆæ¯è¢«æ‹’"><a href="#æ­»ä¿¡æ¶ˆæ¯è¢«æ‹’" class="headerlink" title="æ­»ä¿¡æ¶ˆæ¯è¢«æ‹’"></a>æ­»ä¿¡æ¶ˆæ¯è¢«æ‹’</h3><ol><li>æ¶ˆæ¯ç”Ÿäº§è€…ä»£ç åŒä¸Šç”Ÿäº§è€…ä¸€è‡´</li><li>éœ€æ±‚ï¼šæ¶ˆè´¹è€… C1 æ‹’æ”¶æ¶ˆæ¯ â€œinfo5â€ï¼Œå¼€å¯æ‰‹åŠ¨åº”ç­”</li></ol><p><strong>æ¶ˆè´¹è€…C1</strong></p><figure class="highlight java"><figcaption><span>&#123;30,46-53,57&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Consumer01</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ™®é€šäº¤æ¢æœºçš„åç§°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">NORMAL_EXCHANGE</span> <span class="operator">=</span> <span class="string">&quot;normal_exchange&quot;</span>;</span><br><span class="line">    <span class="comment">//æ­»ä¿¡äº¤æ¢æœºçš„åç§°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEAD_EXCHANGE</span> <span class="operator">=</span> <span class="string">&quot;dead_exchange&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ™®é€šé˜Ÿåˆ—çš„åç§°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">NORMAL_QUEUE</span> <span class="operator">=</span> <span class="string">&quot;normal_queue&quot;</span>;</span><br><span class="line">    <span class="comment">//æ­»ä¿¡é˜Ÿåˆ—çš„åç§°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEAD_QUEUE</span> <span class="operator">=</span> <span class="string">&quot;dead_queue&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> ChannelUtils.getChannel();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å£°æ˜æ­»ä¿¡å’Œæ™®é€šäº¤æ¢æœºï¼Œç±»å‹ä¸ºdirect</span></span><br><span class="line">        channel.exchangeDeclare(NORMAL_EXCHANGE, BuiltinExchangeType.DIRECT);</span><br><span class="line">        channel.exchangeDeclare(DEAD_EXCHANGE, BuiltinExchangeType.DIRECT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å£°æ˜æ™®é€šé˜Ÿåˆ—</span></span><br><span class="line">        Map&lt;String,Object&gt; arguments = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//è¿‡æœŸæ—¶é—´ 10s ç”±ç”Ÿäº§è€…æŒ‡å®š æ›´åŠ çµæ´»</span></span><br><span class="line">        <span class="comment">//arguments.put(&quot;x-message-ttl&quot;,10000);</span></span><br><span class="line">        <span class="comment">//æ­£å¸¸çš„é˜Ÿåˆ—è®¾ç½®æ­»ä¿¡äº¤æ¢æœº</span></span><br><span class="line">        arguments.put(<span class="string">&quot;x-dead-letter-exchange&quot;</span>,DEAD_EXCHANGE);<span class="comment">//å›¾ä¸­çº¢ç®­å¤´</span></span><br><span class="line">        <span class="comment">//è®¾ç½®æ­»ä¿¡routingKey</span></span><br><span class="line">        arguments.put(<span class="string">&quot;x-dead-letter-routing-key&quot;</span>,<span class="string">&quot;lisi&quot;</span>);</span><br><span class="line">        <span class="comment">//è®¾ç½®æ­£å¸¸é˜Ÿåˆ—é•¿åº¦çš„é™åˆ¶ï¼Œä¾‹å¦‚å‘é€10ä¸ªæ¶ˆæ¯ï¼Œ6ä¸ªä¸ºæ­£å¸¸ï¼Œ4ä¸ªä¸ºæ­»ä¿¡</span></span><br><span class="line">        <span class="comment">//arguments.put(&quot;x-max-length&quot;,6);</span></span><br><span class="line"></span><br><span class="line">        channel.queueDeclare(NORMAL_QUEUE,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">false</span>,arguments);</span><br><span class="line">        <span class="comment">/////////////////////////////////////////////////////////////////////////</span></span><br><span class="line">        <span class="comment">//å£°æ˜æ­»ä¿¡é˜Ÿåˆ—</span></span><br><span class="line">        channel.queueDeclare(DEAD_QUEUE,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç»‘å®šæ™®é€šçš„äº¤æ¢æœºä¸é˜Ÿåˆ—</span></span><br><span class="line">        channel.queueBind(NORMAL_QUEUE,NORMAL_EXCHANGE,<span class="string">&quot;zhangsan&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç»‘å®šæ­»ä¿¡çš„äº¤æ¢æœºä¸æ­»ä¿¡çš„é˜Ÿåˆ—</span></span><br><span class="line">        channel.queueBind(DEAD_QUEUE,DEAD_EXCHANGE,<span class="string">&quot;lisi&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;ç­‰å¾…æ¥æ”¶æ¶ˆæ¯...&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumerTag,message) -&gt;&#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(message.getBody(), <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span>(msg.equals(<span class="string">&quot;info5&quot;</span>))&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Consumer01æ¥å—çš„æ¶ˆæ¯æ˜¯ï¼š&quot;</span>+msg+<span class="string">&quot;ï¼š æ­¤æ¶ˆæ¯æ˜¯è¢«C1æ‹’ç»çš„&quot;</span>);</span><br><span class="line">                <span class="comment">//requeue è®¾ç½®ä¸º false ä»£è¡¨æ‹’ç»é‡æ–°å…¥é˜Ÿ è¯¥é˜Ÿåˆ—å¦‚æœé…ç½®äº†æ­»ä¿¡äº¤æ¢æœºå°†å‘é€åˆ°æ­»ä¿¡é˜Ÿåˆ—ä¸­</span></span><br><span class="line">                channel.basicReject(message.getEnvelope().getDeliveryTag(), <span class="literal">false</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Consumer01æ¥å—çš„æ¶ˆæ¯æ˜¯ï¼š&quot;</span>+msg);</span><br><span class="line">                channel.basicAck(message.getEnvelope().getDeliveryTag(), <span class="literal">false</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">//å¼€å¯æ‰‹åŠ¨åº”ç­”ï¼Œä¹Ÿå°±æ˜¯å…³é—­æ‰‹åŠ¨åº”ç­”</span></span><br><span class="line">        channel.basicConsume(NORMAL_QUEUE,<span class="literal">false</span>,deliverCallback,consumerTag -&gt; &#123;&#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¼€å¯æ¶ˆè´¹è€…C1ï¼Œåˆ›å»ºå‡ºé˜Ÿåˆ—ï¼Œç„¶ååœæ­¢è¯¥ C1 çš„è¿è¡Œï¼Œå¯åŠ¨ç”Ÿäº§è€…</li></ul><p><img src="https://www.naste.top:9000/images/image.ncokzmns2t.webp" alt="image"></p><ul><li>å¯åŠ¨æ¶ˆè´¹è€… C1 ç­‰å¾… 10 ç§’ä¹‹åï¼Œå†å¯åŠ¨æ¶ˆè´¹è€… C2</li></ul><p><img src="https://www.naste.top:9000/images/image.1xxchsmgsgdc.webp" alt="image"></p><ul><li>C1æ§åˆ¶å°</li></ul><p><img src="https://www.naste.top:9000/images/image.5zgbkg8gij80.webp" alt="image"></p><ul><li>C2æ§åˆ¶å°</li></ul><p><img src="https://www.naste.top:9000/images/image.783con5n7f40.webp" alt="image"></p><h1 id="å»¶è¿Ÿé˜Ÿåˆ—"><a href="#å»¶è¿Ÿé˜Ÿåˆ—" class="headerlink" title="å»¶è¿Ÿé˜Ÿåˆ—"></a>å»¶è¿Ÿé˜Ÿåˆ—</h1><h2 id="å»¶è¿Ÿé˜Ÿåˆ—ä»‹ç»"><a href="#å»¶è¿Ÿé˜Ÿåˆ—ä»‹ç»" class="headerlink" title="å»¶è¿Ÿé˜Ÿåˆ—ä»‹ç»"></a>å»¶è¿Ÿé˜Ÿåˆ—ä»‹ç»</h2><p>å»¶æ—¶é˜Ÿåˆ—,é˜Ÿåˆ—å†…éƒ¨æ˜¯æœ‰åºçš„ï¼Œæœ€é‡è¦çš„ç‰¹æ€§å°±ä½“ç°åœ¨å®ƒçš„å»¶æ—¶å±æ€§ä¸Šï¼Œå»¶æ—¶é˜Ÿåˆ—ä¸­çš„å…ƒç´ æ˜¯å¸Œæœ› åœ¨æŒ‡å®šæ—¶é—´åˆ°äº†ä»¥åæˆ–ä¹‹å‰å–å‡ºå’Œå¤„ç†ï¼Œç®€å•æ¥è¯´ï¼Œå»¶æ—¶é˜Ÿåˆ—å°±æ˜¯ç”¨æ¥å­˜æ”¾éœ€è¦åœ¨æŒ‡å®šæ—¶é—´è¢«å¤„ç†çš„ å…ƒç´ çš„é˜Ÿåˆ—ã€‚</p><ol><li>è®¢å•åœ¨ååˆ†é’Ÿä¹‹å†…æœªæ”¯ä»˜åˆ™è‡ªåŠ¨å–æ¶ˆ</li><li>æ–°åˆ›å»ºçš„åº—é“ºï¼Œå¦‚æœåœ¨åå¤©å†…éƒ½æ²¡æœ‰ä¸Šä¼ è¿‡å•†å“ï¼Œåˆ™è‡ªåŠ¨å‘é€æ¶ˆæ¯æé†’</li><li>ç”¨æˆ·æ³¨å†ŒæˆåŠŸåï¼Œå¦‚æœä¸‰å¤©å†…æ²¡æœ‰ç™»é™†åˆ™è¿›è¡ŒçŸ­ä¿¡æé†’</li><li>ç”¨æˆ·å‘èµ·é€€æ¬¾ï¼Œå¦‚æœä¸‰å¤©å†…æ²¡æœ‰å¾—åˆ°å¤„ç†åˆ™é€šçŸ¥ç›¸å…³è¿è¥äººå‘˜</li><li>é¢„å®šä¼šè®®åï¼Œéœ€è¦åœ¨é¢„å®šçš„æ—¶é—´ç‚¹å‰ååˆ†é’Ÿé€šçŸ¥å„ä¸ªä¸ä¼šäººå‘˜å‚åŠ ä¼šè®®</li></ol><p>è¿™äº›åœºæ™¯éƒ½æœ‰ä¸€ä¸ªç‰¹ç‚¹ï¼Œéœ€è¦åœ¨æŸä¸ªäº‹ä»¶å‘ç”Ÿä¹‹åæˆ–è€…ä¹‹å‰çš„æŒ‡å®šæ—¶é—´ç‚¹å®ŒæˆæŸä¸€é¡¹ä»»åŠ¡ï¼Œå¦‚ï¼š å‘ç”Ÿè®¢å•ç”Ÿæˆäº‹ä»¶ï¼Œåœ¨ååˆ†é’Ÿä¹‹åæ£€æŸ¥è¯¥è®¢å•æ”¯ä»˜çŠ¶æ€ï¼Œç„¶åå°†æœªæ”¯ä»˜çš„è®¢å•è¿›è¡Œå…³é—­ï¼›é‚£æˆ‘ä»¬ä¸€ç›´è½®è¯¢æ•°æ®ï¼Œæ¯ç§’æŸ¥ä¸€æ¬¡ï¼Œå–å‡ºéœ€è¦è¢«å¤„ç†çš„æ•°æ®ï¼Œç„¶åå¤„ç†ä¸å°±å®Œäº‹äº†å—ï¼Ÿ</p><p>å¦‚æœæ•°æ®é‡æ¯”è¾ƒå°‘ï¼Œç¡®å®å¯ä»¥è¿™æ ·åšï¼Œæ¯”å¦‚ï¼šå¯¹äºã€Œå¦‚æœè´¦å•ä¸€å‘¨å†…æœªæ”¯ä»˜åˆ™è¿›è¡Œè‡ªåŠ¨ç»“ç®—ã€è¿™æ ·çš„éœ€æ±‚ï¼Œ å¦‚æœå¯¹äºæ—¶é—´ä¸æ˜¯ä¸¥æ ¼é™åˆ¶ï¼Œè€Œæ˜¯å®½æ¾æ„ä¹‰ä¸Šçš„ä¸€å‘¨ï¼Œé‚£ä¹ˆæ¯å¤©æ™šä¸Šè·‘ä¸ªå®šæ—¶ä»»åŠ¡æ£€æŸ¥ä¸€ä¸‹æ‰€æœ‰æœªæ”¯ä»˜çš„è´¦å•ï¼Œç¡®å®ä¹Ÿæ˜¯ä¸€ä¸ªå¯è¡Œçš„æ–¹æ¡ˆã€‚ä½†å¯¹äºæ•°æ®é‡æ¯”è¾ƒå¤§ï¼Œå¹¶ä¸”æ—¶æ•ˆæ€§è¾ƒå¼ºçš„åœºæ™¯ï¼Œå¦‚ï¼šã€Œè®¢å•ååˆ†é’Ÿå†…æœªæ”¯ä»˜åˆ™å…³é—­ã€ï¼ŒçŸ­æœŸå†…æœªæ”¯ä»˜çš„è®¢å•æ•°æ®å¯èƒ½ä¼šæœ‰å¾ˆå¤šï¼Œæ´»åŠ¨æœŸé—´ç”šè‡³ä¼šè¾¾åˆ°ç™¾ä¸‡ç”šè‡³åƒä¸‡çº§åˆ«ï¼Œå¯¹è¿™ä¹ˆåºå¤§çš„æ•°æ®é‡ä»æ—§ä½¿ç”¨è½®è¯¢çš„æ–¹å¼æ˜¾ç„¶æ˜¯ä¸å¯å–çš„ï¼Œå¾ˆå¯èƒ½åœ¨ä¸€ç§’å†…æ— æ³•å®Œæˆæ‰€æœ‰è®¢å•çš„æ£€æŸ¥ï¼ŒåŒæ—¶ä¼šç»™æ•°æ®åº“å¸¦æ¥å¾ˆå¤§å‹åŠ›ï¼Œæ— æ³•æ»¡è¶³ä¸šåŠ¡è¦æ±‚è€Œä¸”æ€§èƒ½ä½ä¸‹ã€‚</p><p><img src="https://www.naste.top:9000/images/image-20230530185309579.png" alt="image-20230530185309579"></p><h2 id="TTLçš„ä¸¤ç§è®¾ç½®"><a href="#TTLçš„ä¸¤ç§è®¾ç½®" class="headerlink" title="TTLçš„ä¸¤ç§è®¾ç½®"></a>TTLçš„ä¸¤ç§è®¾ç½®</h2><p>TTL æ˜¯ä»€ä¹ˆå‘¢ï¼ŸTTL æ˜¯ RabbitMQ ä¸­ä¸€ä¸ªæ¶ˆæ¯æˆ–è€…é˜Ÿåˆ—çš„å±æ€§ï¼Œè¡¨æ˜ä¸€æ¡æ¶ˆæ¯æˆ–è€…è¯¥é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰æ¶ˆæ¯çš„æœ€å¤§å­˜æ´»æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’ã€‚</p><p>æ¢å¥è¯è¯´ï¼Œå¦‚æœä¸€æ¡æ¶ˆæ¯è®¾ç½®äº† TTL å±æ€§æˆ–è€…è¿›å…¥äº†è®¾ç½® TTL å±æ€§çš„é˜Ÿåˆ—ï¼Œé‚£ä¹ˆè¿™æ¡æ¶ˆæ¯å¦‚æœåœ¨ TTL è®¾ç½®çš„æ—¶é—´å†…æ²¡æœ‰è¢«æ¶ˆè´¹ï¼Œåˆ™ä¼šæˆä¸ºã€Œæ­»ä¿¡ã€ã€‚å¦‚æœåŒæ—¶é…ç½®äº†é˜Ÿåˆ—çš„ TTL å’Œæ¶ˆæ¯çš„ TTLï¼Œé‚£ä¹ˆè¾ƒå°çš„é‚£ä¸ªå€¼å°†ä¼šè¢«ä½¿ç”¨ï¼Œæœ‰ä¸¤ç§æ–¹å¼è®¾ç½® TTLã€‚</p><p><strong>é˜Ÿåˆ—è®¾ç½® TTL</strong></p><p>åœ¨åˆ›å»ºé˜Ÿåˆ—çš„æ—¶å€™è®¾ç½®é˜Ÿåˆ—çš„ x-message-ttl å±æ€§</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String, Object&gt; params = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">params.put(<span class="string">&quot;x-message-ttl&quot;</span>,<span class="number">5000</span>);</span><br><span class="line"><span class="keyword">return</span> QueueBuilder.durable(<span class="string">&quot;QA&quot;</span>).withArguments(args).build(); <span class="comment">// QA é˜Ÿåˆ—çš„æœ€å¤§å­˜æ´»æ—¶é—´ä½ 5000 æ¯«ç§’</span></span><br></pre></td></tr></table></figure><p><strong>æ¶ˆæ¯è®¾ç½® TTL</strong></p><p>é’ˆå¯¹æ¯æ¡æ¶ˆæ¯è®¾ç½® TTL</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rabbitTemplate.converAndSend(<span class="string">&quot;X&quot;</span>,<span class="string">&quot;XC&quot;</span>,message,correlationData -&gt; &#123;</span><br><span class="line">    correlationData.getMessageProperties().setExpiration(<span class="string">&quot;5000&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ä¸¤ä¸ªä»£ç å—æ¥è‡ªä¸‹æ–¹çš„æ¡ˆä¾‹</p><p><strong>ä¸¤è€…åŒºåˆ«</strong></p><p>å¦‚æœè®¾ç½®äº†é˜Ÿåˆ—çš„ TTL å±æ€§ï¼Œé‚£ä¹ˆä¸€æ—¦æ¶ˆæ¯è¿‡æœŸï¼Œå°±ä¼šè¢«é˜Ÿåˆ—ä¸¢å¼ƒ(å¦‚æœé…ç½®äº†æ­»ä¿¡é˜Ÿåˆ—è¢«ä¸¢åˆ°æ­»ä¿¡é˜Ÿåˆ—ä¸­)ï¼Œè€Œç¬¬äºŒç§æ–¹å¼ï¼Œæ¶ˆæ¯å³ä½¿è¿‡æœŸï¼Œä¹Ÿä¸ä¸€å®šä¼šè¢«é©¬ä¸Šä¸¢å¼ƒï¼Œå› ä¸ºæ¶ˆæ¯æ˜¯å¦è¿‡æœŸæ˜¯åœ¨å³å°†æŠ•é€’åˆ°æ¶ˆè´¹è€…ä¹‹å‰åˆ¤å®šçš„ï¼Œå¦‚æœå½“å‰é˜Ÿåˆ—æœ‰ä¸¥é‡çš„æ¶ˆæ¯ç§¯å‹æƒ…å†µï¼Œåˆ™å·²è¿‡æœŸçš„æ¶ˆæ¯ä¹Ÿè®¸è¿˜èƒ½å­˜æ´»è¾ƒé•¿æ—¶é—´ï¼Œå…·ä½“çœ‹ä¸‹æ–¹æ¡ˆä¾‹ã€‚</p><p>å¦å¤–ï¼Œè¿˜éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œå¦‚æœä¸è®¾ç½® TTLï¼Œè¡¨ç¤ºæ¶ˆæ¯æ°¸è¿œä¸ä¼šè¿‡æœŸï¼Œå¦‚æœå°† TTL è®¾ç½®ä¸º 0ï¼Œåˆ™è¡¨ç¤ºé™¤éæ­¤æ—¶å¯ä»¥ç›´æ¥æŠ•é€’è¯¥æ¶ˆæ¯åˆ°æ¶ˆè´¹è€…ï¼Œå¦åˆ™è¯¥æ¶ˆæ¯å°†ä¼šè¢«ä¸¢å¼ƒ</p><h2 id="SpringBootä¸­æ•´åˆRabbitMQ"><a href="#SpringBootä¸­æ•´åˆRabbitMQ" class="headerlink" title="SpringBootä¸­æ•´åˆRabbitMQ"></a>SpringBootä¸­æ•´åˆRabbitMQ</h2><blockquote><p><strong>ä½¿ç”¨<a href="https://www.naste.top:18083/">å°é£ä»£ç ç”Ÿæˆå™¨</a>å¿«é€Ÿç”ŸæˆSpringBooté¡¹ç›®</strong></p></blockquote><h3 id="ä¾èµ–"><a href="#ä¾èµ–" class="headerlink" title="ä¾èµ–"></a>ä¾èµ–</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--RabbitMQ-SpringBoot ä¾èµ–--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="ymlé…ç½®"><a href="#ymlé…ç½®" class="headerlink" title="ymlé…ç½®"></a>ymlé…ç½®</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.40</span><span class="number">.168</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">guest</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">guest</span></span><br></pre></td></tr></table></figure><h2 id="é˜Ÿåˆ—TTLâ€”SpringBoot"><a href="#é˜Ÿåˆ—TTLâ€”SpringBoot" class="headerlink" title="é˜Ÿåˆ—TTLâ€”SpringBoot"></a>é˜Ÿåˆ—TTLâ€”SpringBoot</h2><h3 id="ä»£ç æ¶æ„å›¾"><a href="#ä»£ç æ¶æ„å›¾" class="headerlink" title="ä»£ç æ¶æ„å›¾"></a>ä»£ç æ¶æ„å›¾</h3><p>åˆ›å»ºä¸¤ä¸ªé˜Ÿåˆ— QA å’Œ QBï¼Œä¸¤ä¸ªé˜Ÿåˆ—çš„ TTL åˆ†åˆ«è®¾ç½®ä¸º 10S å’Œ 40Sï¼Œç„¶åå†åˆ›å»ºä¸€ä¸ªäº¤æ¢æœº X å’Œæ­»ä¿¡äº¤æ¢æœº Yï¼Œå®ƒä»¬çš„ç±»å‹éƒ½æ˜¯ directï¼Œåˆ›å»ºä¸€ä¸ªæ­»ä¿¡é˜Ÿåˆ— QDï¼Œå®ƒä»¬çš„ç»‘å®šå…³ç³»å¦‚ä¸‹ï¼š</p><p><img src="https://www.naste.top:9000/images/image.6ipia9redgw0.webp" alt="image"></p><p>åŸå…ˆé…ç½®é˜Ÿåˆ—ä¿¡æ¯ï¼Œå†™åœ¨äº†ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä»£ç ä¸­ï¼Œç°åœ¨å¯å†™åœ¨é…ç½®ç±»ä¸­ï¼Œç”Ÿäº§è€…åªå‘æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…åªæ¥å—æ¶ˆæ¯</p><h3 id="TTLé…ç½®"><a href="#TTLé…ç½®" class="headerlink" title="TTLé…ç½®"></a>TTLé…ç½®</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * TTLé…ç½®ç±»ä»£ç </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TtlQueueConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ™®é€šäº¤æ¢æœºçš„åç§°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">X_EXCHANGE</span> <span class="operator">=</span> <span class="string">&quot;X&quot;</span>;</span><br><span class="line">    <span class="comment">//æ­»ä¿¡äº¤æ¢æœºçš„åç§°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">Y_DEAD_LETTER_EXCHANGE</span> <span class="operator">=</span> <span class="string">&quot;Y&quot;</span>;</span><br><span class="line">    <span class="comment">//æ™®é€šé˜Ÿåˆ—çš„åç§°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">QUEUE_A</span> <span class="operator">=</span> <span class="string">&quot;QA&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">QUEUE_B</span> <span class="operator">=</span> <span class="string">&quot;QB&quot;</span>;</span><br><span class="line">    <span class="comment">//æ­»ä¿¡é˜Ÿåˆ—çš„åç§°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEAD_LETTER_QUEUE</span> <span class="operator">=</span> <span class="string">&quot;QD&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å£°æ˜xExchange  åˆ«å</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean(&quot;xExchange&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DirectExchange <span class="title function_">xExchange</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DirectExchange</span>(X_EXCHANGE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å£°æ˜yExchange åˆ«å</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean(&quot;yExchange&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DirectExchange <span class="title function_">yExchange</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DirectExchange</span>(Y_DEAD_LETTER_EXCHANGE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å£°æ˜æ™®é€šé˜Ÿåˆ—  è¦æœ‰ttl ä¸º10s</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean(&quot;queueA&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">queueA</span><span class="params">()</span> &#123;</span><br><span class="line">        Map&lt;String, Object&gt; arguments = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(<span class="number">3</span>);</span><br><span class="line">        <span class="comment">//è®¾ç½®æ­»ä¿¡äº¤æ¢æœº</span></span><br><span class="line">        arguments.put(<span class="string">&quot;x-dead-letter-exchange&quot;</span>, Y_DEAD_LETTER_EXCHANGE);</span><br><span class="line">        <span class="comment">//è®¾ç½®æ­»ä¿¡RoutingKey</span></span><br><span class="line">        arguments.put(<span class="string">&quot;x-dead-letter-routing-key&quot;</span>, <span class="string">&quot;YD&quot;</span>);</span><br><span class="line">        <span class="comment">//è®¾ç½®TTL 10s å•ä½æ˜¯ms</span></span><br><span class="line">        arguments.put(<span class="string">&quot;x-message-ttl&quot;</span>, <span class="number">10000</span>);</span><br><span class="line">        <span class="keyword">return</span> QueueBuilder.durable(QUEUE_A).withArguments(arguments).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å£°æ˜æ™®é€šé˜Ÿåˆ—  è¦æœ‰ttl ä¸º40s</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean(&quot;queueB&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">queueB</span><span class="params">()</span> &#123;</span><br><span class="line">        Map&lt;String, Object&gt; arguments = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(<span class="number">3</span>);</span><br><span class="line">        <span class="comment">//è®¾ç½®æ­»ä¿¡äº¤æ¢æœº</span></span><br><span class="line">        arguments.put(<span class="string">&quot;x-dead-letter-exchange&quot;</span>, Y_DEAD_LETTER_EXCHANGE);</span><br><span class="line">        <span class="comment">//è®¾ç½®æ­»ä¿¡RoutingKey</span></span><br><span class="line">        arguments.put(<span class="string">&quot;x-dead-letter-routing-key&quot;</span>, <span class="string">&quot;YD&quot;</span>);</span><br><span class="line">        <span class="comment">//è®¾ç½®TTL 10s å•ä½æ˜¯ms</span></span><br><span class="line">        arguments.put(<span class="string">&quot;x-message-ttl&quot;</span>, <span class="number">40000</span>);</span><br><span class="line">        <span class="keyword">return</span> QueueBuilder.durable(QUEUE_B).withArguments(arguments).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å£°æ˜æ­»ä¿¡é˜Ÿåˆ—  è¦æœ‰ttl ä¸º40s</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean(&quot;queueD&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">queueD</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> QueueBuilder.durable(DEAD_LETTER_QUEUE).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å£°æ˜é˜Ÿåˆ— QA ç»‘å®š X äº¤æ¢æœº</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">queueABindingX</span><span class="params">(<span class="meta">@Qualifier(&quot;queueA&quot;)</span> Queue queueA,</span></span><br><span class="line"><span class="params">                                  <span class="meta">@Qualifier(&quot;xExchange&quot;)</span> DirectExchange xExchange)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(queueA).to(xExchange).with(<span class="string">&quot;XA&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å£°æ˜é˜Ÿåˆ— QB ç»‘å®š X äº¤æ¢æœº</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">queueBBindingX</span><span class="params">(<span class="meta">@Qualifier(&quot;queueB&quot;)</span> Queue queueB,</span></span><br><span class="line"><span class="params">                                  <span class="meta">@Qualifier(&quot;xExchange&quot;)</span> DirectExchange xExchange)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(queueB).to(xExchange).with(<span class="string">&quot;XB&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å£°æ˜é˜Ÿåˆ— QD ç»‘å®š Y äº¤æ¢æœº</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">queueDBindingY</span><span class="params">(<span class="meta">@Qualifier(&quot;queueD&quot;)</span> Queue queueD,</span></span><br><span class="line"><span class="params">                                  <span class="meta">@Qualifier(&quot;yExchange&quot;)</span> DirectExchange yExchange)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(queueD).to(yExchange).with(<span class="string">&quot;YD&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç”Ÿäº§è€…-8"><a href="#ç”Ÿäº§è€…-8" class="headerlink" title="ç”Ÿäº§è€…"></a>ç”Ÿäº§è€…</h3><p><strong>Controllerå±‚æ¥æ”¶å‚æ•°ï¼Œå°†æ¥æ”¶çš„å‚æ•°ä¿¡æ¯æ”¾å…¥åˆ°RabbitMQä¸­</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.swagger.annotations.Api;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.core.RabbitTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å‘é€æ¶ˆæ¯</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;å‘é€æ¶ˆæ¯&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;ttl&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SendMessageController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¼€å§‹å‘æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/sendMsg/&#123;message&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendMsg</span><span class="params">(<span class="meta">@PathVariable(&quot;message&quot;)</span> String message)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;å½“å‰æ—¶é—´:&#123;&#125;,å‘é€ä¸€æ¡ä¿¡æ¯ç»™ä¸¤ä¸ªTTLé˜Ÿåˆ—ï¼š&#123;&#125;&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>().toString(), message);</span><br><span class="line">        rabbitTemplate.convertAndSend(<span class="string">&quot;X&quot;</span>, <span class="string">&quot;XA&quot;</span>, <span class="string">&quot;æ¶ˆæ¯æ¥è‡ªttlä¸º10sçš„é˜Ÿåˆ—:&quot;</span> + message);</span><br><span class="line">        rabbitTemplate.convertAndSend(<span class="string">&quot;X&quot;</span>, <span class="string">&quot;XB&quot;</span>, <span class="string">&quot;æ¶ˆæ¯æ¥è‡ªttlä¸º40sçš„é˜Ÿåˆ—:&quot;</span> + message);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><p>å‘èµ·è¯·æ±‚ï¼š<a href="http://localhost:8088/ttl/sendMsg/å“ˆå“ˆå“ˆ1">http://localhost:8088/ttl/sendMsg/å“ˆå“ˆå“ˆ1</a></p><p><img src="https://www.naste.top:9000/images/image-20230530202305866.png" alt="image-20230530202305866"></p><p>ç¬¬ä¸€æ¡æ¶ˆæ¯åœ¨ 10S åå˜æˆäº†æ­»ä¿¡æ¶ˆæ¯ï¼Œç„¶åè¢«æ¶ˆè´¹è€…æ¶ˆè´¹æ‰ï¼Œç¬¬äºŒæ¡æ¶ˆæ¯åœ¨ 40S ä¹‹åå˜æˆäº†æ­»ä¿¡æ¶ˆæ¯ï¼Œ ç„¶åè¢«æ¶ˆè´¹æ‰ï¼Œè¿™æ ·ä¸€ä¸ªå»¶æ—¶é˜Ÿåˆ—å°±æ‰“é€ å®Œæˆäº†ã€‚</p><p>ä¸è¿‡ï¼Œå¦‚æœè¿™æ ·ä½¿ç”¨çš„è¯ï¼Œå²‚ä¸æ˜¯æ¯å¢åŠ ä¸€ä¸ªæ–°çš„æ—¶é—´éœ€æ±‚ï¼Œå°±è¦æ–°å¢ä¸€ä¸ªé˜Ÿåˆ—ï¼Œè¿™é‡Œåªæœ‰ 10S å’Œ 40S ä¸¤ä¸ªæ—¶é—´é€‰é¡¹ï¼Œå¦‚æœéœ€è¦ä¸€ä¸ªå°æ—¶åå¤„ç†ï¼Œé‚£ä¹ˆå°±éœ€è¦å¢åŠ  TTL ä¸ºä¸€ä¸ªå°æ—¶çš„é˜Ÿåˆ—ï¼Œå¦‚æœæ˜¯é¢„å®šä¼šè®®å®¤ç„¶åæå‰é€šçŸ¥è¿™æ ·çš„åœºæ™¯ï¼Œå²‚ä¸æ˜¯è¦å¢åŠ æ— æ•°ä¸ªé˜Ÿåˆ—æ‰èƒ½æ»¡è¶³éœ€æ±‚ï¼Ÿ</p><h2 id="å»¶æ—¶é˜Ÿåˆ—TTLä¼˜åŒ–"><a href="#å»¶æ—¶é˜Ÿåˆ—TTLä¼˜åŒ–" class="headerlink" title="å»¶æ—¶é˜Ÿåˆ—TTLä¼˜åŒ–"></a>å»¶æ—¶é˜Ÿåˆ—TTLä¼˜åŒ–</h2><p>åœ¨è¿™é‡Œæ–°å¢äº†ä¸€ä¸ªé˜Ÿåˆ— QCï¼Œè¯¥é˜Ÿåˆ—ä¸è®¾ç½® TTL æ—¶é—´ï¼Œæ ¹æ®å‰ç«¯çš„è¯·æ±‚ç¡®å®š TTL æ—¶é—´ï¼Œç»‘å®šå…³ç³»å¦‚ä¸‹ï¼š</p><p><img src="https://www.naste.top:9000/images/image.267zky9xj8dc.webp" alt="image"></p><h3 id="é…ç½®ç±»ä»£ç "><a href="#é…ç½®ç±»ä»£ç " class="headerlink" title="é…ç½®ç±»ä»£ç "></a>é…ç½®ç±»ä»£ç </h3><p><strong>æ–°å¢ä¸€ä¸ªé…ç½®æ–‡ä»¶ç±»ï¼Œç”¨äºæ–°å¢é˜Ÿåˆ— QCï¼Œä¹Ÿå¯ä»¥æ”¾åœ¨ä¸Šæ–¹çš„é…ç½®æ–‡ä»¶ç±»é‡Œ</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MsgTtlQueueConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ™®é€šé˜Ÿåˆ—çš„åç§°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">QUEUE_C</span> <span class="operator">=</span> <span class="string">&quot;QC&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ­»ä¿¡äº¤æ¢æœºçš„åç§°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String Y_DEAD_LETTER_EXCHANGE=<span class="string">&quot;Y&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å£°æ˜QC</span></span><br><span class="line">    <span class="meta">@Bean(&quot;queueC&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">QueueC</span><span class="params">()</span>&#123;</span><br><span class="line">        Map&lt;String,Object&gt; arguments = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(<span class="number">3</span>);</span><br><span class="line">        <span class="comment">//è®¾ç½®æ­»ä¿¡äº¤æ¢æœº</span></span><br><span class="line">        arguments.put(<span class="string">&quot;x-dead-letter-exchange&quot;</span>,Y_DEAD_LETTER_EXCHANGE);</span><br><span class="line">        <span class="comment">//è®¾ç½®æ­»ä¿¡RoutingKey</span></span><br><span class="line">        arguments.put(<span class="string">&quot;x-dead-letter-routing-key&quot;</span>,<span class="string">&quot;XC&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> QueueBuilder.durable(QUEUE_C).withArguments(arguments).build();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å£°æ˜é˜Ÿåˆ— QC ç»‘å®š X äº¤æ¢æœº</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">queueCBindingX</span><span class="params">(<span class="meta">@Qualifier(&quot;queueC&quot;)</span> Queue queueC,</span></span><br><span class="line"><span class="params">                                  <span class="meta">@Qualifier(&quot;xExchange&quot;)</span> DirectExchange xExchange)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(queueC).to(xExchange).with(<span class="string">&quot;XC&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç”Ÿäº§è€…-9"><a href="#ç”Ÿäº§è€…-9" class="headerlink" title="ç”Ÿäº§è€…"></a>ç”Ÿäº§è€…</h3><p><strong>Controller æ–°å¢æ–¹æ³•ï¼šè¯¥æ–¹æ³•æ¥æ”¶çš„è¯·æ±‚è¦å¸¦æœ‰ TTL æ—¶é—´</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaofei.rabbit.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.Api;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.core.RabbitTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å‘é€æ¶ˆæ¯</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;å‘é€æ¶ˆæ¯&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;ttl&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SendMessageController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¼€å§‹å‘æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/sendMsg/&#123;message&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendMsg</span><span class="params">(<span class="meta">@PathVariable(&quot;message&quot;)</span> String message)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;å½“å‰æ—¶é—´:&#123;&#125;,å‘é€ä¸€æ¡ä¿¡æ¯ç»™ä¸¤ä¸ªTTLé˜Ÿåˆ—ï¼š&#123;&#125;&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>().toString(), message);</span><br><span class="line">        rabbitTemplate.convertAndSend(<span class="string">&quot;X&quot;</span>, <span class="string">&quot;XA&quot;</span>, <span class="string">&quot;æ¶ˆæ¯æ¥è‡ªttlä¸º10sçš„é˜Ÿåˆ—:&quot;</span> + message);</span><br><span class="line">        rabbitTemplate.convertAndSend(<span class="string">&quot;X&quot;</span>, <span class="string">&quot;XB&quot;</span>, <span class="string">&quot;æ¶ˆæ¯æ¥è‡ªttlä¸º40sçš„é˜Ÿåˆ—:&quot;</span> + message);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¼€å§‹å‘æ¶ˆæ¯ å‘TTL</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/sendExpirationMsg/&#123;message&#125;/&#123;ttlTime&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendMsg</span><span class="params">(<span class="meta">@PathVariable(&quot;message&quot;)</span> String message,</span></span><br><span class="line"><span class="params">                        <span class="meta">@PathVariable(&quot;ttlTime&quot;)</span> String ttlTime)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;å½“å‰æ—¶é—´:&#123;&#125;,å‘é€ä¸€æ¡æ—¶é•¿æ˜¯&#123;&#125;æ¯«ç§’TTLä¿¡æ¯ç»™é˜Ÿåˆ—QCï¼š&#123;&#125;&quot;</span>,</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Date</span>().toString(), ttlTime, message);</span><br><span class="line">        rabbitTemplate.convertAndSend(<span class="string">&quot;X&quot;</span>, <span class="string">&quot;XC&quot;</span>, message, msg -&gt; &#123;</span><br><span class="line">            <span class="comment">//å‘é€æ¶ˆæ¯çš„æ—¶å€™çš„å»¶è¿Ÿæ—¶é•¿</span></span><br><span class="line">            msg.getMessageProperties().setExpiration(ttlTime);</span><br><span class="line">            <span class="keyword">return</span> msg;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æµ‹è¯•-1"><a href="#æµ‹è¯•-1" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><p>å‘é€è¯·æ±‚</p><ul><li><a href="http://localhost:8088/ttl/sendExpirationMsg/ä½ å¥½1/20000">http://localhost:8088/ttl/sendExpirationMsg/ä½ å¥½1/20000</a></li><li><a href="http://localhost:8088/ttl/sendExpirationMsg/ä½ å¥½2/2000">http://localhost:8088/ttl/sendExpirationMsg/ä½ å¥½2/2000</a></li></ul><blockquote><p><strong>å‡ºç°é—®é¢˜</strong>:</p><p><img src="https://www.naste.top:9000/images/1658765665496.39yyrmljat80.webp" alt="1658765665496"></p></blockquote><p>çœ‹èµ·æ¥ä¼¼ä¹æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯åœ¨æœ€å¼€å§‹çš„æ—¶å€™ï¼Œå°±ä»‹ç»è¿‡å¦‚æœä½¿ç”¨åœ¨æ¶ˆæ¯å±æ€§ä¸Šè®¾ç½® TTL çš„æ–¹å¼ï¼Œæ¶ˆæ¯å¯èƒ½å¹¶ä¸ä¼šæŒ‰æ—¶ã€Œæ­»äº¡ã€</p><blockquote><p>å› ä¸º RabbitMQ åªä¼šæ£€æŸ¥ç¬¬ä¸€ä¸ªæ¶ˆæ¯æ˜¯å¦è¿‡æœŸï¼Œå¦‚æœè¿‡æœŸåˆ™ä¸¢åˆ°æ­»ä¿¡é˜Ÿåˆ—ï¼Œ å¦‚æœç¬¬ä¸€ä¸ªæ¶ˆæ¯çš„å»¶æ—¶æ—¶é•¿å¾ˆé•¿ï¼Œè€Œç¬¬äºŒä¸ªæ¶ˆæ¯çš„å»¶æ—¶æ—¶é•¿å¾ˆçŸ­ï¼Œç¬¬äºŒä¸ªæ¶ˆæ¯å¹¶ä¸ä¼šä¼˜å…ˆå¾—åˆ°æ‰§è¡Œ</p></blockquote><p>è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆå¦‚å›¾çš„æ—¶é—´ï¼šä½ å¥½ 2 å»¶æ—¶ 2 ç§’ï¼Œå´åæ‰§è¡Œï¼Œè¿˜è¦ç­‰å¾…ä½ å¥½ 1 æ¶ˆè´¹åå†æ‰§è¡Œä½ å¥½2</p><h2 id="Rabbitmqæ’ä»¶å®ç°å»¶è¿Ÿé˜Ÿåˆ—ï¼ˆåç»­è¡¥å……æˆ–ä¿®æ”¹ï¼‰"><a href="#Rabbitmqæ’ä»¶å®ç°å»¶è¿Ÿé˜Ÿåˆ—ï¼ˆåç»­è¡¥å……æˆ–ä¿®æ”¹ï¼‰" class="headerlink" title="Rabbitmqæ’ä»¶å®ç°å»¶è¿Ÿé˜Ÿåˆ—ï¼ˆåç»­è¡¥å……æˆ–ä¿®æ”¹ï¼‰"></a>Rabbitmqæ’ä»¶å®ç°å»¶è¿Ÿé˜Ÿåˆ—ï¼ˆåç»­è¡¥å……æˆ–ä¿®æ”¹ï¼‰</h2><p>ä¸Šæ–‡ä¸­æåˆ°çš„é—®é¢˜ï¼Œç¡®å®æ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœä¸èƒ½å®ç°åœ¨æ¶ˆæ¯ç²’åº¦ä¸Šçš„ TTLï¼Œå¹¶ä½¿å…¶åœ¨è®¾ç½®çš„ TTL æ—¶é—´åŠæ—¶æ­»äº¡ï¼Œå°±æ— æ³•è®¾è®¡æˆä¸€ä¸ªé€šç”¨çš„å»¶æ—¶é˜Ÿåˆ—ã€‚é‚£å¦‚ä½•è§£å†³å‘¢ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±å»è§£å†³è¯¥é—®é¢˜ã€‚</p><p><strong>å®‰è£…å»¶æ—¶é˜Ÿåˆ—æ’ä»¶</strong></p><p>å¯å»<a href="https://www.rabbitmq.com/community-plugins.html">å®˜ç½‘ä¸‹è½½</a>æ‰¾åˆ° <strong>rabbitmq_delayed_message_exchange</strong> æ’ä»¶ï¼Œæ”¾ç½®åˆ° RabbitMQ çš„æ’ä»¶ç›®å½•ã€‚</p><p>å› ä¸ºå®˜ç½‘ä¹Ÿæ˜¯è·³è½¬å»è¯¥æ’ä»¶çš„ GitHub åœ°å€è¿›è¡Œä¸‹è½½ï¼š<a href="https://github.com/rabbitmq/rabbitmq-delayed-message-exchange/releases">ç‚¹å‡»è·³è½¬</a></p><p>æ‰“å¼€ Linuxï¼Œç”¨ <code>Xftp</code> å°†æ’ä»¶æ”¾åˆ° RabbitMQ çš„<mark>å®‰è£…ç›®å½•</mark>ä¸‹çš„ plgins ç›®å½•ï¼Œ</p><p>RabbitMQ ä¸å…¶ plgins ç›®å½•é»˜è®¤åˆ†åˆ«ä½äº</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># RabbitMQ å®‰è£…ç›®å½•</span></span><br><span class="line"><span class="built_in">cd</span> /usr/lib/rabbitmq/lib/rabbitmq_server-3.8.8   </span><br><span class="line"><span class="comment"># RabbitMQ çš„ plgins æ‰€åœ¨ç›®å½•</span></span><br><span class="line"><span class="built_in">cd</span> /usr/lib/rabbitmq/lib/rabbitmq_server-3.8.8/plugins</span><br></pre></td></tr></table></figure><p>å…¶ä¸­æˆ‘çš„ç‰ˆæœ¬æ˜¯ <code>/rabbitmq_server-3.8.8</code></p><p>è¿›å…¥ç›®å½•åæ‰§è¡Œä¸‹é¢å‘½ä»¤è®©è¯¥æ’ä»¶ç”Ÿæ•ˆï¼Œç„¶åé‡å¯ RabbitMQ</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…</span></span><br><span class="line">rabbitmq-plugins <span class="built_in">enable</span> rabbitmq_delayed_message_exchange</span><br><span class="line"><span class="comment"># é‡å¯æœåŠ¡</span></span><br><span class="line">systemctl restart rabbitmq-server</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@master plugins]<span class="comment"># rabbitmq-plugins enable rabbitmq_delayed_message_exchange</span></span><br><span class="line">Enabling plugins on node rabbit@master:</span><br><span class="line">rabbitmq_delayed_message_exchange</span><br><span class="line">The following plugins have been configured:</span><br><span class="line">  rabbitmq_delayed_message_exchange</span><br><span class="line">  rabbitmq_management</span><br><span class="line">  rabbitmq_management_agent</span><br><span class="line">  rabbitmq_web_dispatch</span><br><span class="line">Applying plugin configuration to rabbit@master...</span><br><span class="line">The following plugins have been enabled:</span><br><span class="line">  rabbitmq_delayed_message_exchange</span><br><span class="line"></span><br><span class="line">started 1 plugins.</span><br><span class="line">[root@master plugins]<span class="comment"># systemctl restart rabbitmq-server</span></span><br></pre></td></tr></table></figure><p>::: tip è§£é‡Š</p><p>å®‰è£…å‘½ä»¤ä¸èƒ½å‡ºç°æ’ä»¶ç‰ˆæœ¬å’Œåç¼€ï¼Œå¦‚ <code>rabbitmq-plugins enable rabbitmq_delayed_message_exchange-3.8.0.ez</code> ä¼šæŠ¥é”™</p><p>å¿…é¡»æ˜¯ <code>rabbitmq-plugins enable rabbitmq_delayed_message_exchange</code>ï¼Œåé¢ä¸å…è®¸å¡«å…¥ç‰ˆæœ¬å’Œæ–‡ä»¶åç¼€</p><p>:::</p><p>æ‰“å¼€ Web ç•Œé¢ï¼ŒæŸ¥çœ‹äº¤æ¢æœºçš„æ–°å¢åŠŸèƒ½åˆ—è¡¨ï¼Œå¦‚æœå¤šå‡ºäº†å¦‚å›¾æ‰€ç¤ºï¼Œä»£è¡¨æˆåŠŸæ·»åŠ æ’ä»¶</p><p><img src="https://www.naste.top:9000/images/image.3nqc69j0pws0.webp" alt="image"></p><h2 id="æ’ä»¶å®æˆ˜"><a href="#æ’ä»¶å®æˆ˜" class="headerlink" title="æ’ä»¶å®æˆ˜"></a>æ’ä»¶å®æˆ˜</h2><p>åœ¨è¿™é‡Œæ–°å¢äº†ä¸€ä¸ªé˜Ÿåˆ— delayed.queueï¼Œä¸€ä¸ªè‡ªå®šä¹‰äº¤æ¢æœº delayed.exchangeï¼Œç»‘å®šå…³ç³»å¦‚ä¸‹:</p><p><img src="https://www.naste.top:9000/images/image.1tla4z5g4yps.webp" alt="image"></p><h3 id="é…ç½®ç±»ä»£ç -1"><a href="#é…ç½®ç±»ä»£ç -1" class="headerlink" title="é…ç½®ç±»ä»£ç "></a>é…ç½®ç±»ä»£ç </h3><p>æ–°å¢ä¸€ä¸ªé…ç½®ç±» <code>DelayedQueueConfig</code>ï¼Œä¹Ÿå¯ä»¥æ”¾åœ¨åŸæ¥çš„é…ç½®æ–‡ä»¶é‡Œï¼Œä»£ç é‡Œä½¿ç”¨äº† <code>CustomExchange</code> ç±»ï¼Œé€šè¿‡å‚æ•°æ¥è‡ªå®šä¹‰ä¸€ä¸ªç±»å‹(directã€topicç­‰)</p><p>åœ¨æˆ‘ä»¬è‡ªå®šä¹‰çš„äº¤æ¢æœºä¸­ï¼Œè¿™æ˜¯ä¸€ç§æ–°çš„äº¤æ¢ç±»å‹ï¼Œè¯¥ç±»å‹æ¶ˆæ¯æ”¯æŒå»¶è¿ŸæŠ•é€’æœºåˆ¶æ¶ˆæ¯ä¼ é€’åå¹¶ä¸ä¼šç«‹å³æŠ•é€’åˆ°ç›®æ ‡é˜Ÿåˆ—ä¸­ï¼Œè€Œæ˜¯å­˜å‚¨åœ¨ mnesia(ä¸€ä¸ªåˆ†å¸ƒå¼æ•°æ®ç³»ç»Ÿ)è¡¨ä¸­ï¼Œå½“è¾¾åˆ°æŠ•é€’æ—¶é—´æ—¶ï¼Œæ‰æŠ•é€’åˆ°ç›®æ ‡é˜Ÿåˆ—ä¸­ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DelayedQueueConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//äº¤æ¢æœº</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DELAYED_EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">&quot;delayed.exchange&quot;</span>;</span><br><span class="line">    <span class="comment">//é˜Ÿåˆ—</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DELAYED_QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;delayed.queue&quot;</span>;</span><br><span class="line">    <span class="comment">//routingKey</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DELAYED_ROUTING_KEY</span> <span class="operator">=</span> <span class="string">&quot;delayed.routingkey&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">delayedQueue</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Queue</span>(DELAYED_QUEUE_NAME);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å£°æ˜äº¤æ¢æœº,åŸºäºæ’ä»¶çš„äº¤æ¢æœº</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> CustomExchange <span class="title function_">delayedExchange</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">        Map&lt;String,Object&gt; arguments = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        arguments.put(<span class="string">&quot;x-delayed-type&quot;</span>,<span class="string">&quot;direct&quot;</span>);</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 1.äº¤æ¢æœºçš„åç§°</span></span><br><span class="line"><span class="comment">         * 2.äº¤æ¢æœºçš„ç±»å‹ x-delayed-message</span></span><br><span class="line"><span class="comment">         * 3.æ˜¯å¦éœ€è¦æŒä¹…åŒ–</span></span><br><span class="line"><span class="comment">         * 4.æ˜¯å¦éœ€è¦è‡ªåŠ¨åˆ é™¤</span></span><br><span class="line"><span class="comment">         * 5.å…¶ä»–çš„å‚æ•°</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CustomExchange</span>(DELAYED_EXCHANGE_NAME,<span class="string">&quot;x-delayed-message&quot;</span>,</span><br><span class="line">                <span class="literal">true</span>,<span class="literal">false</span>,arguments);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç»‘å®š</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">delayedQueueBindingDelayedExchange</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@Qualifier(&quot;delayedQueue&quot;)</span> Queue delayedQueue,</span></span><br><span class="line"><span class="params">            <span class="meta">@Qualifier(&quot;delayedExchange&quot;)</span>CustomExchange delayedExchange)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(delayedQueue).to(delayedExchange)</span><br><span class="line">                .with(DELAYED_ROUTING_KEY).noargs();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç”Ÿäº§è€…ä»£ç </strong></p><p>åœ¨ controller é‡Œæ–°å¢ä¸€ä¸ªæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¼€å§‹å‘æ¶ˆæ¯ï¼ŒåŸºäºæ’ä»¶çš„ æ¶ˆæ¯åŠ å»¶è¿Ÿçš„æ—¶é—´</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/sendDelayMsg/&#123;message&#125;/&#123;delayTime&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendMsg</span><span class="params">(<span class="meta">@PathVariable(&quot;message&quot;)</span> String message,</span></span><br><span class="line"><span class="params">                    <span class="meta">@PathVariable(&quot;delayTime&quot;)</span> Integer delayTime)</span>&#123;</span><br><span class="line">    log.info(<span class="string">&quot;å½“å‰æ—¶é—´:&#123;&#125;,å‘é€ä¸€æ¡æ—¶é•¿æ˜¯&#123;&#125;æ¯«ç§’TTLä¿¡æ¯ç»™å»¶è¿Ÿé˜Ÿåˆ—delayed.queueï¼š&#123;&#125;&quot;</span>,</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Date</span>().toString(),delayTime,message);</span><br><span class="line"></span><br><span class="line">    rabbitTemplate.convertAndSend(DelayedQueueConfig.DELAYED_EXCHANGE_NAME,</span><br><span class="line">            DelayedQueueConfig.DELAYED_ROUTING_KEY,message, msg -&gt; &#123;</span><br><span class="line">        <span class="comment">//å‘é€æ¶ˆæ¯çš„æ—¶å€™çš„å»¶è¿Ÿæ—¶é•¿ å•ä½ms</span></span><br><span class="line">        msg.getMessageProperties().setDelay(delayTime);</span><br><span class="line">        <span class="keyword">return</span> msg;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ¶ˆè´¹è€…ä»£ç </strong></p><p>ç›‘å¬å»¶æ—¶é˜Ÿåˆ—ï¼Œå¦‚æœæœ‰æ¶ˆæ¯è¿›å…¥è¯¥é˜Ÿåˆ—ï¼Œåˆ™æ‰“å°åˆ°æ§åˆ¶å°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DelayQueueConsumer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RabbitListener(queues = DelayedQueueConfig.DELAYED_QUEUE_NAME)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">receiveDelayQueue</span><span class="params">(Message message)</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(message.getBody());</span><br><span class="line">        log.info(<span class="string">&quot;å½“å‰æ—¶é—´ï¼š&#123;&#125;,æ”¶åˆ°å»¶æ—¶é˜Ÿåˆ—çš„æ¶ˆæ¯ï¼š&#123;&#125;&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>().toString(), msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="http://localhost:8088/ttl/sendDelayMsg/hello1/20000">http://localhost:8088/ttl/sendDelayMsg/hello1/20000</a></p><p><a href="http://localhost:8088/ttl/sendDelayMsg/hello2/2000">http://localhost:8088/ttl/sendDelayMsg/hello2/2000</a></p><p><img src="https://www.naste.top:9000/images/image.17h77dwilchs.webp" alt="image"></p><p>å¯ä»¥çœ‹åˆ°å“ªæ€• hello1 éœ€è¦20ç§’å†è¿›å…¥å»¶æ—¶é˜Ÿåˆ—ï¼Œhello2 2 ç§’åç›´æ¥è¿›å…¥å»¶æ—¶é˜Ÿåˆ—ï¼Œæ— éœ€ç­‰å¾… hello1</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å»¶æ—¶é˜Ÿåˆ—åœ¨éœ€è¦å»¶æ—¶å¤„ç†çš„åœºæ™¯ä¸‹éå¸¸æœ‰ç”¨ï¼Œä½¿ç”¨ RabbitMQ æ¥å®ç°å»¶æ—¶é˜Ÿåˆ—å¯ä»¥å¾ˆå¥½çš„åˆ©ç”¨ RabbitMQ çš„ç‰¹æ€§ï¼Œå¦‚ï¼šæ¶ˆæ¯å¯é å‘é€ã€æ¶ˆæ¯å¯é æŠ•é€’ã€æ­»ä¿¡é˜Ÿåˆ—æ¥ä¿éšœæ¶ˆæ¯è‡³å°‘è¢«æ¶ˆè´¹ä¸€æ¬¡ä»¥åŠæœªè¢«æ­£ç¡®å¤„ç†çš„æ¶ˆæ¯ä¸ä¼šè¢«ä¸¢å¼ƒã€‚å¦å¤–ï¼Œé€šè¿‡ RabbitMQ é›†ç¾¤çš„ç‰¹æ€§ï¼Œå¯ä»¥å¾ˆå¥½çš„è§£å†³å•ç‚¹æ•…éšœé—®é¢˜ï¼Œä¸ä¼šå› ä¸ºå•ä¸ªèŠ‚ç‚¹æŒ‚æ‰å¯¼è‡´å»¶æ—¶é˜Ÿåˆ—ä¸å¯ç”¨æˆ–è€…æ¶ˆæ¯ä¸¢å¤±ã€‚</p><p>å½“ç„¶ï¼Œå»¶æ—¶é˜Ÿåˆ—è¿˜æœ‰å¾ˆå¤šå…¶å®ƒé€‰æ‹©ï¼Œæ¯”å¦‚åˆ©ç”¨ Java çš„ DelayQueueï¼Œåˆ©ç”¨ Redis çš„ zsetï¼Œåˆ©ç”¨ Quartz æˆ–è€…åˆ©ç”¨ kafka çš„æ—¶é—´è½®ï¼Œè¿™äº›æ–¹å¼å„æœ‰ç‰¹ç‚¹,çœ‹éœ€è¦é€‚ç”¨çš„åœºæ™¯ã€‚</p><h1 id="å‘å¸ƒç¡®è®¤é«˜çº§"><a href="#å‘å¸ƒç¡®è®¤é«˜çº§" class="headerlink" title="å‘å¸ƒç¡®è®¤é«˜çº§"></a>å‘å¸ƒç¡®è®¤é«˜çº§</h1><h2 id="å‘å¸ƒç¡®è®¤SpringBootç‰ˆæœ¬"><a href="#å‘å¸ƒç¡®è®¤SpringBootç‰ˆæœ¬" class="headerlink" title="å‘å¸ƒç¡®è®¤SpringBootç‰ˆæœ¬"></a>å‘å¸ƒç¡®è®¤SpringBootç‰ˆæœ¬</h2><h3 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h3><h3 id="å®æˆ˜"><a href="#å®æˆ˜" class="headerlink" title="å®æˆ˜"></a>å®æˆ˜</h3><h3 id="æ·»åŠ é…ç½®ç±»"><a href="#æ·»åŠ é…ç½®ç±»" class="headerlink" title="æ·»åŠ é…ç½®ç±»"></a>æ·»åŠ é…ç½®ç±»</h3><h3 id="æ¶ˆæ¯ç”Ÿäº§è€…"><a href="#æ¶ˆæ¯ç”Ÿäº§è€…" class="headerlink" title="æ¶ˆæ¯ç”Ÿäº§è€…"></a>æ¶ˆæ¯ç”Ÿäº§è€…</h3><h3 id="æ¶ˆæ¯æ¶ˆè´¹è€…"><a href="#æ¶ˆæ¯æ¶ˆè´¹è€…" class="headerlink" title="æ¶ˆæ¯æ¶ˆè´¹è€…"></a>æ¶ˆæ¯æ¶ˆè´¹è€…</h3><h3 id="æ¶ˆæ¯ç”Ÿäº§è€…å‘å¸ƒæ¶ˆæ¯åçš„å›è°ƒæ¥å£"><a href="#æ¶ˆæ¯ç”Ÿäº§è€…å‘å¸ƒæ¶ˆæ¯åçš„å›è°ƒæ¥å£" class="headerlink" title="æ¶ˆæ¯ç”Ÿäº§è€…å‘å¸ƒæ¶ˆæ¯åçš„å›è°ƒæ¥å£"></a>æ¶ˆæ¯ç”Ÿäº§è€…å‘å¸ƒæ¶ˆæ¯åçš„å›è°ƒæ¥å£</h3><h2 id="å›é€€æ¶ˆæ¯"><a href="#å›é€€æ¶ˆæ¯" class="headerlink" title="å›é€€æ¶ˆæ¯"></a>å›é€€æ¶ˆæ¯</h2><h3 id="ä»‹ç»-1"><a href="#ä»‹ç»-1" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h3><h2 id="å®æˆ˜-1"><a href="#å®æˆ˜-1" class="headerlink" title="å®æˆ˜"></a>å®æˆ˜</h2><h3 id="ä¿®æ”¹é…ç½®æ–‡ä»¶"><a href="#ä¿®æ”¹é…ç½®æ–‡ä»¶" class="headerlink" title="ä¿®æ”¹é…ç½®æ–‡ä»¶"></a>ä¿®æ”¹é…ç½®æ–‡ä»¶</h3><h3 id="ä¿®æ”¹å›è°ƒæ¥å£"><a href="#ä¿®æ”¹å›è°ƒæ¥å£" class="headerlink" title="ä¿®æ”¹å›è°ƒæ¥å£"></a>ä¿®æ”¹å›è°ƒæ¥å£</h3><h2 id="å¤‡ä»½äº¤æ¢æœº"><a href="#å¤‡ä»½äº¤æ¢æœº" class="headerlink" title="å¤‡ä»½äº¤æ¢æœº"></a>å¤‡ä»½äº¤æ¢æœº</h2><h3 id="ä»‹ç»-2"><a href="#ä»‹ç»-2" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h3><h3 id="å®æˆ˜-2"><a href="#å®æˆ˜-2" class="headerlink" title="å®æˆ˜"></a>å®æˆ˜</h3><h3 id="ä¿®æ”¹é«˜çº§ç¡®è®¤å‘å¸ƒ-é…ç½®ç±»"><a href="#ä¿®æ”¹é«˜çº§ç¡®è®¤å‘å¸ƒ-é…ç½®ç±»" class="headerlink" title="ä¿®æ”¹é«˜çº§ç¡®è®¤å‘å¸ƒ é…ç½®ç±»"></a>ä¿®æ”¹é«˜çº§ç¡®è®¤å‘å¸ƒ é…ç½®ç±»</h3><h3 id="æŠ¥è­¦æ¶ˆè´¹è€…"><a href="#æŠ¥è­¦æ¶ˆè´¹è€…" class="headerlink" title="æŠ¥è­¦æ¶ˆè´¹è€…"></a>æŠ¥è­¦æ¶ˆè´¹è€…</h3><h1 id="RabbitMQå…¶ä»–çŸ¥è¯†ç‚¹"><a href="#RabbitMQå…¶ä»–çŸ¥è¯†ç‚¹" class="headerlink" title="RabbitMQå…¶ä»–çŸ¥è¯†ç‚¹"></a>RabbitMQå…¶ä»–çŸ¥è¯†ç‚¹</h1><h2 id="å¹‚ç­‰æ€§"><a href="#å¹‚ç­‰æ€§" class="headerlink" title="å¹‚ç­‰æ€§"></a>å¹‚ç­‰æ€§</h2><h3 id="æ¦‚å¿µ-1"><a href="#æ¦‚å¿µ-1" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h3><h3 id="æ¶ˆæ¯é‡å¤æ¶ˆè´¹"><a href="#æ¶ˆæ¯é‡å¤æ¶ˆè´¹" class="headerlink" title="æ¶ˆæ¯é‡å¤æ¶ˆè´¹"></a>æ¶ˆæ¯é‡å¤æ¶ˆè´¹</h3><h3 id="è§£å†³æ€è·¯"><a href="#è§£å†³æ€è·¯" class="headerlink" title="è§£å†³æ€è·¯"></a>è§£å†³æ€è·¯</h3><h3 id="æ¶ˆè´¹ç«¯çš„å¹‚ç­‰æ€§ä¿éšœ"><a href="#æ¶ˆè´¹ç«¯çš„å¹‚ç­‰æ€§ä¿éšœ" class="headerlink" title="æ¶ˆè´¹ç«¯çš„å¹‚ç­‰æ€§ä¿éšœ"></a>æ¶ˆè´¹ç«¯çš„å¹‚ç­‰æ€§ä¿éšœ</h3><h2 id="ä¼˜å…ˆçº§é˜Ÿåˆ—"><a href="#ä¼˜å…ˆçº§é˜Ÿåˆ—" class="headerlink" title="ä¼˜å…ˆçº§é˜Ÿåˆ—"></a>ä¼˜å…ˆçº§é˜Ÿåˆ—</h2><h3 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h3><h3 id="æ·»åŠ æ–¹æ³•"><a href="#æ·»åŠ æ–¹æ³•" class="headerlink" title="æ·»åŠ æ–¹æ³•"></a>æ·»åŠ æ–¹æ³•</h3><h2 id="å®æˆ˜-3"><a href="#å®æˆ˜-3" class="headerlink" title="å®æˆ˜"></a>å®æˆ˜</h2><h3 id="ç”Ÿäº§è€…ä»£ç "><a href="#ç”Ÿäº§è€…ä»£ç " class="headerlink" title="ç”Ÿäº§è€…ä»£ç "></a>ç”Ÿäº§è€…ä»£ç </h3><h3 id="æ¶ˆè´¹è€…ä»£ç "><a href="#æ¶ˆè´¹è€…ä»£ç " class="headerlink" title="æ¶ˆè´¹è€…ä»£ç "></a>æ¶ˆè´¹è€…ä»£ç </h3><h2 id="æƒ°æ€§é˜Ÿåˆ—"><a href="#æƒ°æ€§é˜Ÿåˆ—" class="headerlink" title="æƒ°æ€§é˜Ÿåˆ—"></a>æƒ°æ€§é˜Ÿåˆ—</h2><h3 id="ä½¿ç”¨åœºæ™¯-1"><a href="#ä½¿ç”¨åœºæ™¯-1" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h3><h3 id="ä¸¤ç§æ¨¡å¼"><a href="#ä¸¤ç§æ¨¡å¼" class="headerlink" title="ä¸¤ç§æ¨¡å¼"></a>ä¸¤ç§æ¨¡å¼</h3><h3 id="å†…å­˜å¼€é”€å¯¹æ¯”"><a href="#å†…å­˜å¼€é”€å¯¹æ¯”" class="headerlink" title="å†…å­˜å¼€é”€å¯¹æ¯”"></a>å†…å­˜å¼€é”€å¯¹æ¯”</h3><blockquote><p><strong>æ­»ä¿¡é˜Ÿåˆ—ã€å»¶è¿Ÿé˜Ÿåˆ—ã€å‘å¸ƒç¡®è®¤é«˜çº§ã€RabbitmQå…¶ä»–çŸ¥è¯†ç‚¹ç­‰åç»­ä½¿ç”¨åˆ°è¿›è¡Œè¡¥å……</strong></p></blockquote>]]></content>
    
    
    <summary type="html">RabbitMQ</summary>
    
    
    
    <category term="æ¶ˆæ¯ä¸­é—´ä»¶" scheme="https://www.naste.top:1024/categories/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6/"/>
    
    
    <category term="RabbitMQ" scheme="https://www.naste.top:1024/tags/RabbitMQ/"/>
    
    <category term="SpringBoot" scheme="https://www.naste.top:1024/tags/SpringBoot/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨JavaScriptä¿®æ”¹ç½‘é¡µä»»æ„å…ƒç´ çš„æ–‡æœ¬å†…å®¹</title>
    <link href="https://www.naste.top:1024/posts/1455011995.html"/>
    <id>https://www.naste.top:1024/posts/1455011995.html</id>
    <published>2023-05-15T06:33:56.000Z</published>
    <updated>2023-05-15T06:51:42.190Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h1><p>[TOC]</p><p><img src="https://www.naste.top:9000/images/image-20230515145106241.png" alt="image-20230515145106241"></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ–¹æ³•ä¸€ï¼š</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">contentEditable</span>=<span class="string">&quot;true&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ–¹æ³•äºŒï¼š</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="property">designMode</span>=<span class="string">&#x27;on&#x27;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">ä½¿ç”¨JavaScriptä¿®æ”¹ç½‘é¡µä»»æ„å…ƒç´ çš„æ–‡æœ¬å†…å®¹</summary>
    
    
    
    <category term="å‰ç«¯" scheme="https://www.naste.top:1024/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
    <category term="JavaScript" scheme="https://www.naste.top:1024/tags/JavaScript/"/>
    
    <category term="å‰ç«¯" scheme="https://www.naste.top:1024/tags/%E5%89%8D%E7%AB%AF/"/>
    
  </entry>
  
  <entry>
    <title>pinia</title>
    <link href="https://www.naste.top:1024/posts/3038627921.html"/>
    <id>https://www.naste.top:1024/posts/3038627921.html</id>
    <published>2023-05-11T01:13:43.000Z</published>
    <updated>2023-05-11T06:18:27.174Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h1><p>[TOC]</p><h1 id="ä»€ä¹ˆæ˜¯pinia"><a href="#ä»€ä¹ˆæ˜¯pinia" class="headerlink" title="ä»€ä¹ˆæ˜¯pinia"></a>ä»€ä¹ˆæ˜¯pinia</h1><p><strong>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://pinia.web3doc.top/">https://pinia.web3doc.top/</a></strong></p><p>Pinia æ˜¯ Vue çš„ä¸“å±çŠ¶æ€ç®¡ç†åº“ï¼Œå¯ä»¥å®ç°è·¨ç»„ä»¶æˆ–é¡µé¢å…±äº«çŠ¶æ€ï¼Œæ˜¯ vuex çŠ¶æ€ç®¡ç†å·¥å…·çš„æ›¿ä»£å“ï¼Œå’Œ Vuexç›¸æ¯”ï¼Œå…·å¤‡ä»¥ä¸‹ä¼˜åŠ¿</p><ol><li>æä¾›æ›´åŠ ç®€å•çš„API ï¼ˆå»æ‰äº† mutation ï¼‰</li><li>æä¾›ç¬¦åˆç»„åˆå¼APIé£æ ¼çš„API ï¼ˆå’Œ Vue3 æ–°è¯­æ³•ç»Ÿä¸€ï¼‰</li><li>å»æ‰äº†modulesçš„æ¦‚å¿µï¼Œæ¯ä¸€ä¸ªstoreéƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æ¨¡å—</li><li>æ­é… TypeScript ä¸€èµ·ä½¿ç”¨æä¾›å¯é çš„ç±»å‹æ¨æ–­</li></ol><h1 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ›å»ºä¸€ä¸ªvue3é¡¹ç›® å…·ä½“ä½¿ç”¨æŸ¥çœ‹æœ¬ç«™vue3æ–‡æ¡£</span></span><br><span class="line">npm init vue@latest</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å®‰è£… pinia</span></span><br><span class="line">npm i pinia</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ‰“å¼€main.jsæ–‡ä»¶åŠ å…¥ä¸‹é¢ä»£ç </span></span><br><span class="line">import &#123; createPinia &#125; from &#x27;pinia&#x27;</span><br><span class="line"></span><br><span class="line">createApp(App).use(createPinia()).mount(&#x27;#app&#x27;)</span><br></pre></td></tr></table></figure><h1 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h1><ul><li><p>åˆ›å»ºstoreï¼šåœ¨srcç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªstoresæ–‡ä»¶å¤¹ï¼Œé‡Œé¢å®šä¹‰ä¸€ä¸ªä¸€ä¸ªçš„storeï¼ˆä¸€ä¸ªä¸€ä¸ªçš„jsæ–‡ä»¶ï¼Œæ¯”å¦‚ <code>userInfo.jsã€category.js</code>ç­‰ï¼‰</p>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;defineStore&#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;ref&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> usePersonStore = <span class="title function_">defineStore</span>(<span class="string">&#x27;person&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// å®šä¹‰å±æ€§</span></span><br><span class="line">    <span class="keyword">const</span> person = <span class="title function_">ref</span>(&#123;</span><br><span class="line">        <span class="attr">username</span>: <span class="string">&quot;123456&quot;</span>,</span><br><span class="line">        <span class="attr">password</span>: <span class="string">&quot;xiaofei&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">updateUsername</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">        person.<span class="property">value</span>.<span class="property">username</span> = <span class="string">&quot;xiaofei&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">updatePassword</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">        person.<span class="property">value</span>.<span class="property">password</span> = <span class="string">&quot;123456&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†å®šä¹‰çš„å±æ€§å’Œæ–¹æ³•è¿”å›</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        person, updateUsername, updatePassword</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨store</p>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123;usePersonStore&#125; <span class="keyword">from</span> <span class="string">&#x27;@/stores/person&#x27;</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">const</span> storePerson = <span class="title function_">usePersonStore</span>()</span></span><br><span class="line"><span class="language-javascript"><span class="comment">//è·å–stateé‡Œé¢çš„å˜é‡</span></span></span><br><span class="line"><span class="language-javascript"><span class="variable language_">console</span>.<span class="title function_">log</span>(storePerson.<span class="property">person</span>.<span class="property">username</span>)</span></span><br><span class="line"><span class="language-javascript"><span class="variable language_">console</span>.<span class="title function_">log</span>(storePerson.<span class="property">person</span>.<span class="property">password</span>)</span></span><br><span class="line"><span class="language-javascript"><span class="comment">//è·å–actionsé‡Œé¢çš„æ–¹æ³•</span></span></span><br><span class="line"><span class="language-javascript">storePerson.<span class="title function_">updatePassword</span>()</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- ä½¿ç”¨stateé‡Œé¢å®šä¹‰çš„å˜é‡ï¼Œè·å–ç”¨æˆ·åå’Œå¯†ç  --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123; storePerson.person.username &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123; storePerson.person.password &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- ä½¿ç”¨actionsé‡Œé¢å®šä¹‰çš„æ–¹æ³• --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;storePerson.updateUsername&quot;</span>&gt;</span>ä¿®æ”¹ç”¨æˆ·å<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h1 id="getters"><a href="#getters" class="headerlink" title="getters"></a>getters</h1><blockquote><p><strong>gettersç›´æ¥ä½¿ç”¨è®¡ç®—å±æ€§å³å¯å®ç°</strong></p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;defineStore&#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;computed, ref&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> usePersonStore = <span class="title function_">defineStore</span>(<span class="string">&#x27;person&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// å®šä¹‰å±æ€§</span></span><br><span class="line">    <span class="keyword">const</span> person = <span class="title function_">ref</span>(&#123;</span><br><span class="line">        <span class="attr">username</span>: <span class="string">&quot;123456&quot;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä½¿ç”¨è®¡ç®—å±æ€§å®šä¹‰getters</span></span><br><span class="line">    <span class="keyword">const</span> updateUsernameGetters = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> person.<span class="property">value</span>.<span class="property">username</span> + <span class="string">&quot;ï¼šè®¡ç®—å±æ€§åçš„å€¼&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">updateUsername</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">        person.<span class="property">value</span>.<span class="property">username</span> = <span class="string">&quot;xiaofei&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†å®šä¹‰çš„å±æ€§å’Œæ–¹æ³•è¿”å›</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        person, updateUsernameGetters, updateUsername</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123;usePersonStore&#125; <span class="keyword">from</span> <span class="string">&#x27;@/stores/person&#x27;</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">const</span> storePerson = <span class="title function_">usePersonStore</span>()</span></span><br><span class="line"><span class="language-javascript"><span class="comment">//è·å–stateé‡Œé¢çš„å˜é‡</span></span></span><br><span class="line"><span class="language-javascript"><span class="variable language_">console</span>.<span class="title function_">log</span>(storePerson.<span class="property">person</span>.<span class="property">username</span>)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- ä½¿ç”¨stateé‡Œé¢å®šä¹‰çš„å˜é‡ï¼Œè·å–ç”¨æˆ·åå’Œå¯†ç  --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123; storePerson.person.username &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- ä½¿ç”¨è®¡ç®—å±æ€§å®šä¹‰getters --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123; storePerson.updateUsernameGetters&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- ä½¿ç”¨actionsé‡Œé¢å®šä¹‰çš„æ–¹æ³• --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;storePerson.updateUsername&quot;</span>&gt;</span>ä¿®æ”¹ç”¨æˆ·å<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="action"><a href="#action" class="headerlink" title="action"></a>action</h1><ul><li>storeä¸­å®šä¹‰action</li><li>ç»„ä»¶ä¸­è§¦å‘action</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;defineStore&#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;ref&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&quot;axios&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> usePersonStore = <span class="title function_">defineStore</span>(<span class="string">&#x27;person&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// å®šä¹‰å±æ€§</span></span><br><span class="line">    <span class="keyword">const</span> dataList = <span class="title function_">ref</span>([])</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¼‚æ­¥ action,asyncå’Œawaitå¿…é¡»æœ‰</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">loadList</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> axios.<span class="title function_">get</span>(<span class="string">&#x27;http://geek.itheima.net/v1_0/channels&#x27;</span>)</span><br><span class="line">        dataList.<span class="property">value</span> = res.<span class="property">data</span>.<span class="property">data</span>.<span class="property">channels</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†å®šä¹‰çš„å±æ€§å’Œæ–¹æ³•è¿”å›</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        dataList, loadList</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123;usePersonStore&#125; <span class="keyword">from</span> <span class="string">&#x27;@/stores/person&#x27;</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">const</span> storePerson = <span class="title function_">usePersonStore</span>()</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// è°ƒç”¨å®šä¹‰çš„actionsæ–¹æ³•</span></span></span><br><span class="line"><span class="language-javascript">storePerson.<span class="title function_">loadList</span>()</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;item in storePerson.dataList&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;item.id&quot;</span>&gt;</span>&#123;&#123; item.name &#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="storeToRefsè·å–refå®šä¹‰æ•°æ®ï¼ˆæ¨èï¼‰"><a href="#storeToRefsè·å–refå®šä¹‰æ•°æ®ï¼ˆæ¨èï¼‰" class="headerlink" title="storeToRefsè·å–refå®šä¹‰æ•°æ®ï¼ˆæ¨èï¼‰"></a>storeToRefsè·å–refå®šä¹‰æ•°æ®ï¼ˆæ¨èï¼‰</h1><blockquote><p><strong>storeToRefsåªèƒ½è·å–stateå’Œgetters</strong></p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;defineStore&#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;ref&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&quot;axios&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> usePersonStore = <span class="title function_">defineStore</span>(<span class="string">&#x27;person&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// å®šä¹‰å±æ€§</span></span><br><span class="line">    <span class="keyword">const</span> dataList = <span class="title function_">ref</span>([])</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¼‚æ­¥ action,asyncå’Œawaitå¿…é¡»æœ‰</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">loadList</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> axios.<span class="title function_">get</span>(<span class="string">&#x27;http://geek.itheima.net/v1_0/channels&#x27;</span>)</span><br><span class="line">        dataList.<span class="property">value</span> = res.<span class="property">data</span>.<span class="property">data</span>.<span class="property">channels</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†å®šä¹‰çš„å±æ€§å’Œæ–¹æ³•è¿”å›</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        dataList, loadList</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123;usePersonStore&#125; <span class="keyword">from</span> <span class="string">&#x27;@/stores/person&#x27;</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123;storeToRefs&#125; <span class="keyword">from</span> <span class="string">&quot;pinia/dist/pinia&quot;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">const</span> storePerson = <span class="title function_">usePersonStore</span>()</span></span><br><span class="line"><span class="language-javascript"><span class="comment">//ä½¿ç”¨storeToRefsè·å–refå®šä¹‰æ•°æ®</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">const</span> &#123;dataList&#125; = <span class="title function_">storeToRefs</span>(storePerson)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">//å‡½æ•°ä¸èƒ½ä½¿ç”¨storeToRefsè·å–ï¼Œåªèƒ½ä½¿ç”¨è·å–çš„å¯¹è±¡ç›´æ¥è°ƒç”¨</span></span></span><br><span class="line"><span class="language-javascript">storePerson.<span class="title function_">loadList</span>()</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;item in dataList&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;item.id&quot;</span>&gt;</span>&#123;&#123; item.name &#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="piniaæŒä¹…åŒ–"><a href="#piniaæŒä¹…åŒ–" class="headerlink" title="piniaæŒä¹…åŒ–"></a>piniaæŒä¹…åŒ–</h1>]]></content>
    
    
    <summary type="html">pinia</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>vue3</title>
    <link href="https://www.naste.top:1024/posts/2591061011.html"/>
    <id>https://www.naste.top:1024/posts/2591061011.html</id>
    <published>2023-05-10T07:18:51.000Z</published>
    <updated>2023-05-11T02:18:41.597Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h1><p>[TOC]</p><h1 id="å®‰è£…åŠé¡¹ç›®åˆå§‹åŒ–"><a href="#å®‰è£…åŠé¡¹ç›®åˆå§‹åŒ–" class="headerlink" title="å®‰è£…åŠé¡¹ç›®åˆå§‹åŒ–"></a>å®‰è£…åŠé¡¹ç›®åˆå§‹åŒ–</h1><h2 id="è®¤è¯†create-vue"><a href="#è®¤è¯†create-vue" class="headerlink" title="è®¤è¯†create-vue"></a>è®¤è¯†create-vue</h2><blockquote><p><strong>create-vueæ˜¯Vueå®˜æ–¹æ–°çš„è„šæ‰‹æ¶å·¥å…·ï¼Œåº•å±‚åˆ‡æ¢åˆ°äº† vite ï¼ˆä¸‹ä¸€ä»£å‰ç«¯å·¥å…·é“¾ï¼‰ï¼Œä¸ºå¼€å‘æä¾›æé€Ÿå“åº”</strong></p></blockquote><p><img src="https://www.naste.top:9000/images/1678178479590-ac164009-4a72-4448-85bf-67dc13f3d0c4.png" alt="image.png"></p><h2 id="ä½¿ç”¨create-vueåˆ›å»ºé¡¹ç›®"><a href="#ä½¿ç”¨create-vueåˆ›å»ºé¡¹ç›®" class="headerlink" title="ä½¿ç”¨create-vueåˆ›å»ºé¡¹ç›®"></a>ä½¿ç”¨create-vueåˆ›å»ºé¡¹ç›®</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å‰ç½®æ¡ä»¶ - å·²å®‰è£…16.0æˆ–æ›´é«˜ç‰ˆæœ¬çš„Node.js</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œè¿™ä¸€æŒ‡ä»¤å°†ä¼šå®‰è£…å¹¶æ‰§è¡Œ create-vue</span></span><br><span class="line">npm init vue@latest</span><br></pre></td></tr></table></figure><p><img src="https://www.naste.top:9000/images/1678178685782-71a3b311-423d-4528-aae9-85e6068db452.png" alt="image.png"></p><h1 id="ç†Ÿæ‚‰é¡¹ç›®å’Œå…³é”®æ–‡ä»¶"><a href="#ç†Ÿæ‚‰é¡¹ç›®å’Œå…³é”®æ–‡ä»¶" class="headerlink" title="ç†Ÿæ‚‰é¡¹ç›®å’Œå…³é”®æ–‡ä»¶"></a>ç†Ÿæ‚‰é¡¹ç›®å’Œå…³é”®æ–‡ä»¶</h1><p><img src="https://www.naste.top:9000/images/1678178749511-f4a42cbf-987b-46a7-9a01-9cd4f00a5fcf.png" alt="image.png"></p><h1 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h1><h2 id="setup"><a href="#setup" class="headerlink" title="setup"></a>setup</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- setupå†™æ³• --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">const</span> message = <span class="string">&#x27;this is message&#x27;</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">const</span> <span class="title function_">logMessage</span> = (<span class="params"></span>) =&gt; &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">console</span>.<span class="title function_">log</span>(message)</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- æ—§ç‰ˆæœ¬å†™æ³• --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> message = <span class="string">&#x27;this is message&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> <span class="title function_">logMessage</span> = (<span class="params"></span>) =&gt; &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">console</span>.<span class="title function_">log</span>(message)</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// å¿…é¡»returnæ‰å¯ä»¥</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      message,</span></span><br><span class="line"><span class="language-javascript">      logMessage</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="reactiveå’Œrefå‡½æ•°"><a href="#reactiveå’Œrefå‡½æ•°" class="headerlink" title="reactiveå’Œrefå‡½æ•°"></a>reactiveå’Œrefå‡½æ•°</h2><h3 id="reactive"><a href="#reactive" class="headerlink" title="reactive"></a>reactive</h3><blockquote><p><strong>æ¥å—å¯¹è±¡ç±»å‹æ•°æ®çš„å‚æ•°ä¼ å…¥å¹¶è¿”å›ä¸€ä¸ªå“åº”å¼çš„å¯¹è±¡æ¥å—å¯¹è±¡ç±»å‹æ•°æ®çš„å‚æ•°ä¼ å…¥å¹¶è¿”å›ä¸€ä¸ªå“åº”å¼çš„å¯¹è±¡</strong></p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// reactiveåªèƒ½æ”¯æŒå¯¹è±¡ç±»å‹</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123;reactive&#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// reactiveé‡Œé¢å®šä¹‰å„ç§å±æ€§</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">const</span> person = <span class="title function_">reactive</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">id</span>: <span class="number">0</span>,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">username</span>: <span class="string">&#x27;XiaoFei&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">age</span>: <span class="number">18</span></span></span><br><span class="line"><span class="language-javascript">&#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// åˆ›å»ºä¸€ä¸ªå‡½æ•°</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">const</span> <span class="title function_">addAge</span> = (<span class="params"></span>) =&gt; &#123;</span></span><br><span class="line"><span class="language-javascript">  person.<span class="property">age</span>++</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span>personå¯¹è±¡ä¿¡æ¯ï¼š&#123;&#123; person &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;addAge&quot;</span>&gt;</span>ç‚¹å‡»æ·»åŠ å¹´é¾„ï¼š&#123;&#123; person.age &#125;&#125;<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="ref"><a href="#ref" class="headerlink" title="ref"></a>ref</h3><blockquote><p><strong>æ¥æ”¶ç®€å•ç±»å‹æˆ–è€…å¯¹è±¡ç±»å‹çš„æ•°æ®ä¼ å…¥å¹¶è¿”å›ä¸€ä¸ªå“åº”å¼çš„å¯¹è±¡</strong></p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// ref å‡½æ•°å¯ä»¥æ¥æ”¶æ™®é€šç±»å‹ï¼Œä¹Ÿå¯ä»¥æ¥æ”¶å¯¹è±¡ï¼Œrefå®šä¹‰çš„ï¼Œéœ€è¦åœ¨è·å–çš„æ—¶å€™ .value</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123;ref&#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// refæ¥æ”¶æ™®é€šç±»å‹å€¼</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">const</span> count = <span class="title function_">ref</span>(<span class="number">0</span>)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// refæ¥æ”¶å¯¹è±¡ç±»å‹å€¼</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">const</span> person = <span class="title function_">ref</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">id</span>: <span class="number">0</span>,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">username</span>: <span class="string">&#x27;XiaoFei&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">age</span>: <span class="number">18</span></span></span><br><span class="line"><span class="language-javascript">&#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// å®šä¹‰ä¸€ä¸ªå‡½æ•°</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">const</span> <span class="title function_">addCount</span> = (<span class="params"></span>) =&gt; &#123;</span></span><br><span class="line"><span class="language-javascript">  count.<span class="property">value</span>++</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// å®šä¹‰å‡½æ•°</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">const</span> <span class="title function_">addAge</span> = (<span class="params"></span>) =&gt; &#123;</span></span><br><span class="line"><span class="language-javascript">  person.<span class="property">value</span>.<span class="property">age</span>++</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span>æ™®é€šç±»å‹å€¼<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span>countï¼š&#123;&#123; count &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;addCount&quot;</span>&gt;</span>ç‚¹å‡»æ·»åŠ <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span>ä¼ å…¥å¯¹è±¡<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span>personï¼š&#123;&#123; person &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;addAge&quot;</span>&gt;</span>ç‚¹å‡»æ·»åŠ <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="reactiveå¯¹æ¯”ref"><a href="#reactiveå¯¹æ¯”ref" class="headerlink" title="reactiveå¯¹æ¯”ref"></a>reactiveå¯¹æ¯”ref</h3><ul><li>éƒ½æ˜¯ç”¨æ¥ç”Ÿæˆå“åº”å¼æ•°æ®</li><li>ä¸åŒç‚¹<ul><li>reactiveä¸èƒ½å¤„ç†ç®€å•ç±»å‹çš„æ•°æ®</li><li>refå‚æ•°ç±»å‹æ”¯æŒæ›´å¥½ï¼Œä½†æ˜¯å¿…é¡»é€šè¿‡.valueåšè®¿é—®ä¿®æ”¹</li><li>refå‡½æ•°å†…éƒ¨çš„å®ç°ä¾èµ–äºreactiveå‡½æ•°</li></ul></li><li>åœ¨å®é™…å·¥ä½œä¸­çš„æ¨è<ul><li>æ¨èä½¿ç”¨refå‡½æ•°ï¼Œå‡å°‘è®°å¿†è´Ÿæ‹…</li></ul></li></ul><h2 id="computed"><a href="#computed" class="headerlink" title="computed"></a>computed</h2><ul><li>è®¡ç®—å±æ€§ä¸­ä¸åº”è¯¥æœ‰â€œå‰¯ä½œç”¨â€ï¼Œ<strong>æ¯”å¦‚å¼‚æ­¥è¯·æ±‚ / ä¿®æ”¹dom</strong></li><li>é¿å…ç›´æ¥ä¿®æ”¹è®¡ç®—å±æ€§ä¸­çš„å€¼ï¼Œ<strong>è®¡ç®—å±æ€§åº”è¯¥åªè¯»çš„</strong></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// å¯¼å…¥</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123;ref, computed&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// åŸå§‹æ•°æ®</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">const</span> list = <span class="title function_">ref</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>])</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// è®¡ç®—å±æ€§åæ•°æ®</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">const</span> computedList = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// è¿”å›æ•°ç»„ä¸­ &gt; 2çš„å€¼</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">return</span> list.<span class="property">value</span>.<span class="title function_">filter</span>(<span class="function"><span class="params">item</span> =&gt;</span> item &gt; <span class="number">2</span>)</span></span><br><span class="line"><span class="language-javascript">&#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span> åŸå§‹æ•°æ® â€”â€” &#123;&#123; list &#125;&#125; <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span> è®¡ç®—å±æ€§æ•°æ® â€”â€” &#123;&#123; computedList &#125;&#125; <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="watch"><a href="#watch" class="headerlink" title="watch"></a>watch</h2><blockquote><p><strong>å±æ€§ç›‘å¬ï¼Œå½“å±æ€§çš„å€¼æ”¹å˜æ—¶ï¼Œè§¦å‘watchè®¾ç½®çš„å‡½æ•°</strong></p></blockquote><h3 id="ç›‘å¬å•ä¸ª-å¤šä¸ªæ•°æ®"><a href="#ç›‘å¬å•ä¸ª-å¤šä¸ªæ•°æ®" class="headerlink" title="ç›‘å¬å•ä¸ª / å¤šä¸ªæ•°æ®"></a>ç›‘å¬å•ä¸ª / å¤šä¸ªæ•°æ®</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// å¯¼å…¥watch</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123;ref, watch&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">const</span> count = <span class="title function_">ref</span>(<span class="number">0</span>)</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">const</span> age = <span class="title function_">ref</span>(<span class="number">0</span>)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">const</span> <span class="title function_">addCountAndAge</span> = (<span class="params"></span>) =&gt; &#123;</span></span><br><span class="line"><span class="language-javascript">  count.<span class="property">value</span>++</span></span><br><span class="line"><span class="language-javascript">  age.<span class="property">value</span>++</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// è°ƒç”¨ watch ä¾¦å¬å•ä¸ªæ•°æ®å˜åŒ–</span></span></span><br><span class="line"><span class="language-javascript"><span class="title function_">watch</span>(count, <span class="function">(<span class="params">newValue, oldValue</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;è°ƒç”¨ watch ä¾¦å¬å•ä¸ªæ•°æ®å˜åŒ–&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;count&#x27;</span>, count.<span class="property">value</span>, newValue, oldValue)</span></span><br><span class="line"><span class="language-javascript">&#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// è°ƒç”¨ watch ä¾¦å¬å¤šä¸ªæ•°æ®å˜åŒ–ã€å¤šä¸ªå€¼ä½¿ç”¨[]æ¥æ”¶ã€‘</span></span></span><br><span class="line"><span class="language-javascript"><span class="title function_">watch</span>([count, age], <span class="function">(<span class="params">[countNewValue, ageNewValue], [countOldValue, ageOldCount]</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;è°ƒç”¨ watch ä¾¦å¬å¤šä¸ªæ•°æ®å˜åŒ–&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;count&#x27;</span>, count.<span class="property">value</span>, countNewValue, countOldValue)</span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;age&#x27;</span>, age.<span class="property">value</span>, ageNewValue, ageOldCount)</span></span><br><span class="line"><span class="language-javascript">&#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;addCountAndAge&quot;</span>&gt;</span>Countï¼š&#123;&#123; count &#125;&#125;<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;addCountAndAge&quot;</span>&gt;</span>Ageï¼š&#123;&#123; age &#125;&#125;<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="immediate"><a href="#immediate" class="headerlink" title="immediate"></a>immediate</h3><blockquote><p><strong>immediateï¼šwatchçš„ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œä¼ å…¥å¯¹è±¡ï¼Œimmediateè®¾ç½®ä¸ºtrueï¼Œä¼šå…ˆæ‰§è¡Œä¸€æ¬¡watchçš„å›è°ƒå‡½æ•°ï¼Œä¸ç”¨ç­‰ç›‘å¬çš„å±æ€§å€¼æ”¹å˜</strong></p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// å¯¼å…¥watch</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123;ref, watch&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">const</span> count = <span class="title function_">ref</span>(<span class="number">0</span>)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">const</span> <span class="title function_">addCountAndAge</span> = (<span class="params"></span>) =&gt; &#123;</span></span><br><span class="line"><span class="language-javascript">  count.<span class="property">value</span>++</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// è°ƒç”¨ watch ä¾¦å¬å•ä¸ªæ•°æ®å˜åŒ– ï¼Œimmediateä¸ºwatchçš„ç¬¬ä¸‰ä¸ªå‚æ•°</span></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// immediateè®¾ç½®ä¸ºtrue ä¼šå…ˆæ‰§è¡Œä¸€æ¬¡watchçš„å›è°ƒå‡½æ•°ï¼Œä¸ç”¨ç­‰ç›‘å¬çš„å±æ€§å€¼æ”¹å˜</span></span></span><br><span class="line"><span class="language-javascript"><span class="title function_">watch</span>(count,<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;watchå›è°ƒå‡½æ•°æ‰§è¡Œäº†&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">&#125;, &#123;<span class="attr">immediate</span>: <span class="literal">true</span>&#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;addCountAndAge&quot;</span>&gt;</span>Countï¼š&#123;&#123; count &#125;&#125;<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="deep"><a href="#deep" class="headerlink" title="deep"></a>deep</h3><blockquote><p><strong>é€šè¿‡watchç›‘å¬çš„refå¯¹è±¡é»˜è®¤æ˜¯æµ…å±‚ä¾¦å¬çš„ï¼Œç›´æ¥ä¿®æ”¹åµŒå¥—çš„å¯¹è±¡å±æ€§ä¸ä¼šè§¦å‘å›è°ƒæ‰§è¡Œï¼Œéœ€è¦å¼€å¯deepï¼Œ<code>deepå¼€å¯æœ‰æ€§èƒ½æŸè€—ï¼Œå°½é‡ä¸ä½¿ç”¨deep</code></strong></p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// å¯¼å…¥watch</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123;ref, watch&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">const</span> person = <span class="title function_">ref</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">age</span>: <span class="number">18</span>,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">count</span>: <span class="number">1</span></span></span><br><span class="line"><span class="language-javascript">&#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">const</span> <span class="title function_">updateAge</span> = (<span class="params"></span>) =&gt; &#123;</span></span><br><span class="line"><span class="language-javascript">  person.<span class="property">value</span>.<span class="property">age</span>++</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">const</span> <span class="title function_">updateCount</span> = (<span class="params"></span>) =&gt; &#123;</span></span><br><span class="line"><span class="language-javascript">  person.<span class="property">value</span>.<span class="property">count</span>++</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// åœ¨watchçš„ç¬¬ä¸‰ä¸ªå‚æ•°è®¾ç½®  deep:true ï¼Œwatchæ‰èƒ½ç›‘å¬refè®¾ç½®çš„å¯¹è±¡å±æ€§ï¼Œæ­¤æ—¶ï¼Œå¯¹è±¡ä¸­æ— è®ºå“ªä¸ªå€¼æ”¹å˜éƒ½ä¼šè§¦å‘watchçš„å›è°ƒ</span></span></span><br><span class="line"><span class="language-javascript"><span class="title function_">watch</span>(</span></span><br><span class="line"><span class="language-javascript">    person,</span></span><br><span class="line"><span class="language-javascript">    <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;personä¿®æ”¹äº†&quot;</span>, person.<span class="property">value</span>)</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    &#123;<span class="attr">deep</span>: <span class="literal">true</span>&#125;</span></span><br><span class="line"><span class="language-javascript">)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// åœ¨watchçš„ç¬¬ä¸‰ä¸ªå‚æ•°è®¾ç½®  deep:true ï¼Œwatchæ‰èƒ½ç›‘å¬refè®¾ç½®çš„å¯¹è±¡å±æ€§ï¼Œæ­¤æ—¶ï¼ŒæŒ‡å®šçš„å¯¹è±¡ä¸­çš„å±æ€§çš„å€¼ä¿®æ”¹äº†æ‰èƒ½è§¦å‘watchçš„å›è°ƒ</span></span></span><br><span class="line"><span class="language-javascript"><span class="title function_">watch</span>(</span></span><br><span class="line"><span class="language-javascript">    <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      person.<span class="property">value</span>.<span class="property">age</span></span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;personä¿®æ”¹äº†&quot;</span>, person.<span class="property">value</span>)</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    &#123;<span class="attr">deep</span>: <span class="literal">true</span>&#125;</span></span><br><span class="line"><span class="language-javascript">)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;updateAge&quot;</span>&gt;</span>ä¿®æ”¹ageï¼š&#123;&#123; person.age &#125;&#125;<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;updateCount&quot;</span>&gt;</span>ä¿®æ”¹countï¼š&#123;&#123; person.count &#125;&#125;<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="ç”Ÿå‘½å‘¨æœŸå‡½æ•°"><a href="#ç”Ÿå‘½å‘¨æœŸå‡½æ•°" class="headerlink" title="ç”Ÿå‘½å‘¨æœŸå‡½æ•°"></a>ç”Ÿå‘½å‘¨æœŸå‡½æ•°</h1><blockquote><p><strong>é€‰é¡¹å¼ï¼švue2</strong></p><p><strong>ç»„åˆå¼ï¼švue3</strong></p></blockquote><p><img src="https://www.naste.top:9000/images/1678183720098-4d40e806-bc0d-4c38-bcbe-9aed440f6b23.png" alt="image.png"></p><blockquote><p><strong>ä½¿ç”¨importä»vueä¸­å¼•å…¥å„ä¸ªéœ€è¦ä½¿ç”¨çš„ç”Ÿå‘½å‘¨æœŸå‡½ï¼ŒåŒä¸€ä¸ªç”Ÿå‘½å‘¨æœŸå‡½æ•°å¯ä»¥åŒæ—¶ä½¿ç”¨å¤šæ¬¡ï¼Œè¯¥æƒ…å†µåº”ç”¨åœºæ™¯<code>å¦‚æœæ¥æ”¶åˆ«äººå†™çš„é¡¹ç›®ï¼Œä¸æ”¹åŠ¨åˆ«äººçš„ä»£ç ï¼Œåœ¨ä»–å‰é¢æ‰§è¡Œæ–°çš„åŠŸèƒ½ï¼Œå¯ä»¥åŒæ—¶ä½¿ç”¨ç›¸åŒçš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°åœ¨ä»–å‰/åæ‰§è¡Œå³å¯</code></strong></p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// ç”Ÿå‘½å‘¨æœŸ</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123;onBeforeMount, onMounted, onBeforeUpdate, onUpdated, onBeforeUnmount, onUnmounted&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="title function_">onBeforeMount</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;onBeforeMount1&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">&#125;)</span></span><br><span class="line"><span class="language-javascript"><span class="comment">//åŒä¸€ä¸ªç”Ÿå‘½å‘¨æœŸå‡½æ•°å¯ä»¥åŒæ—¶å†™å¤šä¸ªï¼Œä¼šæŒ‰ç…§é¡ºåºæ‰§è¡Œ</span></span></span><br><span class="line"><span class="language-javascript"><span class="title function_">onBeforeMount</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;onBeforeMount2&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">&#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;onMounted&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">&#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="title function_">onBeforeUpdate</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;onBeforeUpdate&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">&#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="title function_">onUpdated</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;onUpdated&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">&#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="title function_">onBeforeUnmount</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;onBeforeUnmount&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">&#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="title function_">onUnmounted</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;onUnmounted&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">&#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="ç»„ä»¶é—´é€šä¿¡"><a href="#ç»„ä»¶é—´é€šä¿¡" class="headerlink" title="ç»„ä»¶é—´é€šä¿¡"></a>ç»„ä»¶é—´é€šä¿¡</h1><h2 id="çˆ¶ä¼ å­"><a href="#çˆ¶ä¼ å­" class="headerlink" title="çˆ¶ä¼ å­"></a>çˆ¶ä¼ å­</h2><blockquote><p><strong>çˆ¶ç»„ä»¶</strong></p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// å¼•å…¥å­ç»„ä»¶</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">Son</span> <span class="keyword">from</span> <span class="string">&#x27;./Son.vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123;ref&#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">const</span> person = <span class="title function_">ref</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">name</span>: <span class="string">&quot;XiaoFei&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">age</span>: <span class="number">18</span></span></span><br><span class="line"><span class="language-javascript">&#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- å¯ä»¥ä¼ å…¥ä¸Šé¢å®šä¹‰çš„å‚æ•° --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">son</span> <span class="attr">:person</span>=<span class="string">&quot;person&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p><strong>å­ç»„ä»¶</strong></p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span>å­ç»„ä»¶æ¥æ”¶çš„æ•°æ®ï¼š&#123;&#123; props &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// å­ç»„ä»¶æ¥æ”¶æ•°æ®</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">const</span> props = <span class="title function_">defineProps</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//å‚æ•°å:å‚æ•°ç±»å‹</span></span></span><br><span class="line"><span class="language-javascript">  <span class="attr">person</span>: <span class="title class_">Object</span></span></span><br><span class="line"><span class="language-javascript">&#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="variable language_">console</span>.<span class="title function_">log</span>(props.<span class="property">person</span>)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="å­ä¼ çˆ¶"><a href="#å­ä¼ çˆ¶" class="headerlink" title="å­ä¼ çˆ¶"></a>å­ä¼ çˆ¶</h2><blockquote><p><strong>çˆ¶ç»„ä»¶</strong></p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// å¼•å…¥å­ç»„ä»¶</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">Son</span> <span class="keyword">from</span> <span class="string">&#x27;./Son.vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">const</span> <span class="title function_">getSonData</span> = (<span class="params">sonData</span>) =&gt; &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;å­ç»„ä»¶ä¼ é€’çš„æ•°æ®ï¼š&quot;</span>, sonData)</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- å¯ä»¥ä¼ å…¥ä¸Šé¢å®šä¹‰çš„å‚æ•° --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">son</span> @<span class="attr">get-son-data</span>=<span class="string">&quot;getSonData&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p><strong>å­ç»„ä»¶</strong></p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123;ref&#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">const</span> person = <span class="title function_">ref</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">name</span>: <span class="string">&quot;XiaoFei&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">age</span>: <span class="number">18</span></span></span><br><span class="line"><span class="language-javascript">&#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// é€šè¿‡ defineEmits ç¼–è¯‘å™¨å®ç”Ÿæˆemitæ–¹æ³•</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">const</span> emit = <span class="title function_">defineEmits</span>([<span class="string">&#x27;get-son-data&#x27;</span>])</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">const</span> <span class="title function_">sentMsg</span> = (<span class="params"></span>) =&gt; &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// è§¦å‘è‡ªå®šä¹‰å‡½æ•° å‘çˆ¶ç»„ä»¶ä¼ è¾“æ•°æ®</span></span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">emit</span>(<span class="string">&#x27;get-son-data&#x27;</span>, person)</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;sentMsg&quot;</span>&gt;</span>ç‚¹å‡»åï¼Œå‘çˆ¶ç»„ä»¶ä¼ é€’æ•°æ®<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="è·¨ç»„ä»¶"><a href="#è·¨ç»„ä»¶" class="headerlink" title="è·¨ç»„ä»¶"></a>è·¨ç»„ä»¶</h2><blockquote><p><strong><code>provide</code>å’Œ<code>inject</code>å®ç°è·¨ç»„ä»¶é—´çš„ä»»æ„é€šè®¯</strong></p><p><strong>å¦‚æœä¼ é€’çš„æ˜¯æ–¹æ³•ï¼Œæ–¹æ³•ä¸­æœ‰ä¿®æ”¹ä¼ é€’æ•°æ®ç»„ä»¶ä¸­çš„æ•°æ®ï¼Œæ¥æ”¶æ–¹æ³•çš„ç»„ä»¶æ‹¿åˆ°è¯¥å‡½æ•°ä¹Ÿä¼šä¿®æ”¹ä¼ é€’æ•°æ®ç»„ä»¶ä¸­çš„æ•°æ®</strong></p></blockquote><ul><li><p>ä¼ é€’æ•°æ®ç»„ä»¶</p>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">Son</span> <span class="keyword">from</span> <span class="string">&#x27;./Son.vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123;provide, ref&#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// éœ€è¦ä¼ é€’çš„å¯¹è±¡å‚æ•°</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">const</span> user = <span class="title function_">ref</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">username</span>: <span class="string">&quot;123456&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">password</span>: <span class="string">&quot;223456&quot;</span></span></span><br><span class="line"><span class="language-javascript">&#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// éœ€è¦ä¼ é€’çš„æ–¹æ³•</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">const</span> <span class="title function_">testMethod</span> = (<span class="params"></span>) =&gt; &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;ä¼ é€’æµ‹è¯•æ–¹æ³•&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// è·¨ç»„ä»¶ä¼ é€’æ•°æ®</span></span></span><br><span class="line"><span class="language-javascript"><span class="title function_">provide</span>(<span class="string">&#x27;user&#x27;</span>, user)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// è·¨ç»„ä»¶ä¼ é€’æ–¹æ³•</span></span></span><br><span class="line"><span class="language-javascript"><span class="title function_">provide</span>(<span class="string">&#x27;testMethod&#x27;</span>, testMethod)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">son</span> <span class="attr">ref</span>=<span class="string">&quot;sonRef&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>æ¥æ”¶æ•°æ®ç»„ä»¶</p>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123;inject&#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// è·¨ç»„ä»¶æ¥æ”¶å‚æ•°</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">const</span> user = <span class="title function_">inject</span>(<span class="string">&#x27;user&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// è·¨ç»„ä»¶æ¥æ”¶æ–¹æ³•</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">const</span> testMethod = <span class="title function_">inject</span>(<span class="string">&#x27;testMethod&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// åœ¨scriptä¸­ä½¿ç”¨è·¨ç»„ä»¶æ¥æ”¶çš„æ–¹æ³•</span></span></span><br><span class="line"><span class="language-javascript"><span class="title function_">testMethod</span>()</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- ä½¿ç”¨è·¨ç»„ä»¶æ¥æ”¶çš„å‚æ•° --&gt;</span></span><br><span class="line">    &#123;&#123; user &#125;&#125; <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- åœ¨templateä¸­ä½¿ç”¨è·¨ç»„ä»¶æ¥æ”¶æ–¹æ³• --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;testMethod&quot;</span>&gt;</span>ä½¿ç”¨è·¨ç»„ä»¶æ¥æ”¶æ–¹æ³•<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h1 id="æ¨¡ç‰ˆå¼•ç”¨"><a href="#æ¨¡ç‰ˆå¼•ç”¨" class="headerlink" title="æ¨¡ç‰ˆå¼•ç”¨"></a>æ¨¡ç‰ˆå¼•ç”¨</h1><blockquote><p><strong>é€šè¿‡ ref æ ‡è¯† è·å–çœŸå®çš„ dom å¯¹è±¡æˆ–è€…ç»„ä»¶å®ä¾‹å¯¹è±¡</strong></p></blockquote><h2 id="è·å–æ ‡ç­¾å¯¹è±¡dom"><a href="#è·å–æ ‡ç­¾å¯¹è±¡dom" class="headerlink" title="è·å–æ ‡ç­¾å¯¹è±¡dom"></a>è·å–æ ‡ç­¾å¯¹è±¡dom</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123;onMounted, ref&#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">const</span> h1Ref = <span class="title function_">ref</span>(<span class="literal">null</span>)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// ä½¿ç”¨refè·å–domå¯¹è±¡ï¼Œéœ€è¦åœ¨ç»„ä»¶æŒ‚è½½å®Œæˆä¹‹åæ‰èƒ½è·å–</span></span></span><br><span class="line"><span class="language-javascript"><span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">console</span>.<span class="title function_">log</span>(h1Ref.<span class="property">value</span>)</span></span><br><span class="line"><span class="language-javascript">&#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span> <span class="attr">ref</span>=<span class="string">&quot;h1Ref&quot;</span>&gt;</span>domæ ‡ç­¾<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="è·å–vueç»„ä»¶domåŠä½¿ç”¨testMessageè·å–ç»„ä»¶å±æ€§"><a href="#è·å–vueç»„ä»¶domåŠä½¿ç”¨testMessageè·å–ç»„ä»¶å±æ€§" class="headerlink" title="è·å–vueç»„ä»¶domåŠä½¿ç”¨testMessageè·å–ç»„ä»¶å±æ€§"></a>è·å–vueç»„ä»¶domåŠä½¿ç”¨testMessageè·å–ç»„ä»¶å±æ€§</h2><blockquote><p><strong>çˆ¶ç»„ä»¶ä½¿ç”¨refè·å–åˆ°çš„vueç»„ä»¶çš„domï¼Œé»˜è®¤æƒ…å†µä¸‹åœ¨ <code>script setup</code>è¯­æ³•ç³–ä¸‹ç»„ä»¶å†…éƒ¨çš„å±æ€§å’Œæ–¹æ³•æ˜¯ä¸å¼€æ”¾ç»™çˆ¶ç»„ä»¶è®¿é—®çš„ï¼Œå¯ä»¥é€šè¿‡<code>defineExpose</code>ç¼–è¯‘å®æŒ‡å®šå“ªäº›å±æ€§å’Œæ–¹æ³•å®¹è®¸è®¿é—®</strong></p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123;onMounted, ref&#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">Son</span> <span class="keyword">from</span> <span class="string">&#x27;./Son.vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">const</span> sonRef = <span class="title function_">ref</span>(<span class="literal">null</span>)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">console</span>.<span class="title function_">log</span>(sonRef.<span class="property">value</span>)</span></span><br><span class="line"><span class="language-javascript">&#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">son</span> <span class="attr">ref</span>=<span class="string">&quot;sonRef&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--Sonç»„ä»¶--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-handlebars"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">import &#123;ref&#125; from &quot;vue&quot;;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">const name = ref(&quot;XiaoFei&quot;)</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"><span class="comment">&lt;!-- å½“ä½¿ç”¨refè·å–è¯¥ç»„ä»¶çš„æ¨¡æ¿å¼•ç”¨æ—¶ï¼Œä½¿ç”¨defineExposeæŒ‡å®šå“ªäº›å±æ€§å’Œæ–¹æ³•å®¹è®¸è®¿é—® --&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">defineExpose(&#123;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">  name</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">&#125;)</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"></span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹    </p>]]></content>
    
    
    <summary type="html">vue3</summary>
    
    
    
    <category term="å‰ç«¯" scheme="https://www.naste.top:1024/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
    <category term="Vue" scheme="https://www.naste.top:1024/tags/Vue/"/>
    
  </entry>
  
  <entry>
    <title>JVM</title>
    <link href="https://www.naste.top:1024/posts/1723864827.html"/>
    <id>https://www.naste.top:1024/posts/1723864827.html</id>
    <published>2023-04-25T13:33:12.000Z</published>
    <updated>2023-04-26T04:09:02.226Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h1><p>[TOC]</p>]]></content>
    
    
    <summary type="html">JVM</summary>
    
    
    
    <category term="Java" scheme="https://www.naste.top:1024/categories/Java/"/>
    
    
    <category term="Java" scheme="https://www.naste.top:1024/tags/Java/"/>
    
    <category term="JVM" scheme="https://www.naste.top:1024/tags/JVM/"/>
    
  </entry>
  
  <entry>
    <title>å¼€æœºå¯åŠ¨Shellè„šæœ¬</title>
    <link href="https://www.naste.top:1024/posts/2098160006.html"/>
    <id>https://www.naste.top:1024/posts/2098160006.html</id>
    <published>2023-04-12T02:10:45.000Z</published>
    <updated>2023-04-12T02:20:30.819Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h1><p>[TOC]</p><h1 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h1><ol><li>ChatGPT</li><li><a href="">Linuxä¸‹è®¾ç½®å¼€æœºè‡ªåŠ¨è¿è¡Œè„šæœ¬çš„5ç§æ–¹æ³•ï¼šhttps://blog.csdn.net/qq_44839276/article/details/107622265</a></li></ol><h1 id="systemd"><a href="#systemd" class="headerlink" title="systemd"></a>systemd</h1><blockquote><p><strong>å°†Shellè„šæœ¬ä½¿ç”¨systemdï¼Œä½¿ç”¨æœåŠ¡å¯åŠ¨</strong></p></blockquote><p><strong>ä½¿ç”¨<code>vim /etc/systemd/system/my-script.service</code>ï¼Œå°†ä¸‹é¢å†…å®¹åŠ å…¥æœåŠ¡è„šæœ¬ä¸­ï¼Œå¹¶ä¸”ç»™è„šæœ¬åŠ ä¸Šå¯æ‰§è¡Œæƒé™<code>chmod +x éœ€è¦æ‰§è¡Œçš„è„šæœ¬</code></strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=My script</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Type=oneshot è¡¨ç¤ºæœåŠ¡åªè¿è¡Œä¸€æ¬¡ï¼Œå¹¶åœ¨è„šæœ¬ç»“æŸåé€€å‡ºã€‚RemainAfterExit=<span class="built_in">yes</span> åˆ™è¡¨ç¤ºæœåŠ¡åœ¨è„šæœ¬ç»“æŸååº”ä¿æŒè¿è¡ŒçŠ¶æ€ã€‚</span></span><br><span class="line">Type=oneshot</span><br><span class="line">RemainAfterExit=yes</span><br><span class="line">ExecStart=/bin/bash /root/start.sh</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=default.target</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è®¾ç½®å¼€æœºå¯åŠ¨è„šæœ¬</span></span><br><span class="line">systemctl enable my-script.service</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¯åŠ¨è„šæœ¬</span></span><br><span class="line">systemctl start my-script.service</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹è„šæœ¬æ‰§è¡Œæ—¥å¿—</span></span><br><span class="line">journalctl -u my-script.service</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æˆ–</span></span><br><span class="line">systemctl status my-script.service</span><br></pre></td></tr></table></figure><h2 id="ç›¸å…³é”™è¯¯å‚è€ƒ"><a href="#ç›¸å…³é”™è¯¯å‚è€ƒ" class="headerlink" title="ç›¸å…³é”™è¯¯å‚è€ƒ"></a>ç›¸å…³é”™è¯¯å‚è€ƒ</h2><p>å¦‚æœæœåŠ¡å·²ç»æ­£ç¡®å¯åŠ¨ï¼Œä½†æ˜¯è„šæœ¬æ²¡æœ‰è¿è¡Œï¼Œå¯èƒ½æ˜¯ç”±äºä»¥ä¸‹åŸå› ï¼š</p><ol><li><p>æ£€æŸ¥è„šæœ¬æ–‡ä»¶ä¸­çš„å‘½ä»¤æ˜¯å¦æ­£ç¡®ï¼ŒåŒ…æ‹¬å‘½ä»¤çš„è·¯å¾„ã€å‚æ•°ã€è¯­æ³•ç­‰ã€‚æ‚¨å¯ä»¥æ‰‹åŠ¨è¿è¡Œè„šæœ¬æ¥æ£€æŸ¥å®ƒæ˜¯å¦èƒ½å¤Ÿæ­£å¸¸å·¥ä½œã€‚</p></li><li><p>æ£€æŸ¥æœåŠ¡çš„å·¥ä½œç›®å½•å’Œç¯å¢ƒå˜é‡æ˜¯å¦æ­£ç¡®è®¾ç½®ã€‚å¦‚æœåœ¨è„šæœ¬ä¸­ä½¿ç”¨äº†ç›¸å¯¹è·¯å¾„æˆ–å…¶ä»–éœ€è¦ç¯å¢ƒå˜é‡æ”¯æŒçš„å‘½ä»¤ï¼Œè¿™ä¸€ç‚¹æ˜¾å¾—å°¤ä¸ºé‡è¦ã€‚</p></li><li><p>æ£€æŸ¥è„šæœ¬æ˜¯å¦éœ€è¦ä¸€äº›ç‰¹å®šçš„æƒé™æˆ–æˆæƒæ¥è¿è¡Œã€‚å¦‚æœæ‚¨é€šè¿‡ sudo æˆ–ç±»ä¼¼çš„æ–¹å¼ä»¥ root æƒé™æ‰§è¡Œè„šæœ¬ï¼Œåˆ™æœåŠ¡ä¹Ÿå¿…é¡»ä»¥ç›¸åº”çš„æƒé™çº§åˆ«è¿è¡Œã€‚</p></li><li><p>æ£€æŸ¥æœåŠ¡çš„å¯åŠ¨ç±»å‹ã€‚å¦‚æœæ‚¨çš„æœåŠ¡æ˜¯å¯åŠ¨åç«‹å³åœæ­¢çš„ï¼Œé‚£ä¹ˆè„šæœ¬åœ¨æœåŠ¡åœæ­¢æ—¶å°†è¢«æ€æ­»ã€‚æ‚¨å¯ä»¥æ›´æ”¹æœåŠ¡çš„å¯åŠ¨ç±»å‹ä¸º oneshotï¼Œè¿™æ ·è„šæœ¬åœ¨æœåŠ¡å¯åŠ¨æ—¶ä¼šè¿è¡Œå¹¶ç«‹å³é€€å‡ºï¼Œå¹¶ä¸”æœåŠ¡å°†ä¿æŒè¿è¡ŒçŠ¶æ€ã€‚</p></li><li><p>å¦‚æœæ‚¨çš„æœåŠ¡ä¾èµ–äºå…¶ä»–æœåŠ¡æˆ–è¿›ç¨‹ï¼Œè¯·ç¡®ä¿è¿™äº›æœåŠ¡æˆ–è¿›ç¨‹åœ¨ç³»ç»Ÿä¸Šå·²ç»æ­£ç¡®é…ç½®å¹¶æ­£åœ¨è¿è¡Œã€‚</p></li><li><p>å¦‚æœæ‚¨çš„è„šæœ¬éœ€è¦ä¸å…¶ä»–ç¨‹åºäº¤äº’ï¼Œè¯·ç¡®ä¿å®ƒä»¬ä¹‹é—´æ²¡æœ‰ä»»ä½•å†²çªæˆ–é”™è¯¯ã€‚</p></li></ol>]]></content>
    
    
    <summary type="html">å¼€æœºå¯åŠ¨Shellè„šæœ¬</summary>
    
    
    
    <category term="Linux" scheme="https://www.naste.top:1024/categories/Linux/"/>
    
    
    <category term="Linux" scheme="https://www.naste.top:1024/tags/Linux/"/>
    
    <category term="Shell" scheme="https://www.naste.top:1024/tags/Shell/"/>
    
  </entry>
  
  <entry>
    <title>è™šæ‹Ÿæœºå’Œç‰©ç†æœºå®‰è£…é»‘ç¾¤æ™–</title>
    <link href="https://www.naste.top:1024/posts/309368459.html"/>
    <id>https://www.naste.top:1024/posts/309368459.html</id>
    <published>2023-03-31T06:26:34.000Z</published>
    <updated>2023-04-18T06:37:50.577Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h1><p>[TOC]</p><h1 id="è§†é¢‘å‚è€ƒ"><a href="#è§†é¢‘å‚è€ƒ" class="headerlink" title="è§†é¢‘å‚è€ƒ"></a>è§†é¢‘å‚è€ƒ</h1><p>å®‰è£…é»‘ç¾¤æ™–7.1.1NASç³»ç»Ÿï¼š<a href="https://www.bilibili.com/video/BV1z8411G7Rv/">https://www.bilibili.com/video/BV1z8411G7Rv/</a></p><h1 id="å·¥å…·ä¸‹è½½"><a href="#å·¥å…·ä¸‹è½½" class="headerlink" title="å·¥å…·ä¸‹è½½"></a>å·¥å…·ä¸‹è½½</h1><p>é»‘ç¾¤æ™–å¼•å¯¼å·¥å…·ï¼š<a href="https://github.com/fbelavenuto/arpl">https://github.com/fbelavenuto/arpl</a></p><ul><li><a href="https://github.com/fbelavenuto/arpl/releases/download/v1.0-beta3/arpl-1.0-beta3.vmdk-flat.zip">VMwareè™šæ‹Ÿæœºçš„ç£ç›˜æ–‡ä»¶ï¼šhttps://github.com/fbelavenuto/arpl/releases/download/v1.0-beta3/arpl-1.0-beta3.vmdk-flat.zip</a></li><li><a href="https://github.com/fbelavenuto/arpl/releases/download/v1.0-beta3/arpl-1.0-beta3.vmdk-dyn.zip">VMwareè™šæ‹Ÿæœºçš„ç£ç›˜æ–‡ä»¶ï¼ˆä½¿ç”¨ä¸Šé¢çš„ï¼‰ï¼šhttps://github.com/fbelavenuto/arpl/releases/download/v1.0-beta3/arpl-1.0-beta3.vmdk-dyn.zip</a></li><li><a href="https://github.com/fbelavenuto/arpl/releases/download/v1.0-beta3/arpl-1.0-beta3.img.zip">åˆ¶ä½œç‰©ç†æœºUç›˜å¼•å¯¼é•œåƒæ–‡ä»¶ï¼šhttps://github.com/fbelavenuto/arpl/releases/download/v1.0-beta3/arpl-1.0-beta3.img.zip</a></li><li><a href="https://rufus.ie/zh/">Rufus Uç›˜å†™ç›˜å·¥å…· å°†arpl-1.0-beta3.img.zipé•œåƒå†™å…¥Uç›˜ä¸­ï¼šhttps://rufus.ie/zh/</a></li><li>ç¾¤æ™–æ–‡ä»¶ï¼š<a href="https://global.synologydownload.com/download/DSM/release/7.1.1/42962-1/DSM_DS918%2B_42962.pat">https://global.synologydownload.com/download/DSM/release/7.1.1/42962-1/DSM_DS918%2B_42962.pat</a></li></ul><h1 id="DS918"><a href="#DS918" class="headerlink" title="DS918+"></a>DS918+</h1><h2 id="è™šæ‹Ÿæœº"><a href="#è™šæ‹Ÿæœº" class="headerlink" title="è™šæ‹Ÿæœº"></a>è™šæ‹Ÿæœº</h2><p><img src="https://www.naste.top:9000/images/image-20230331151345216.png" alt="image-20230331151345216"></p><p><img src="https://www.naste.top:9000/images/image-20230331151356379.png" alt="image-20230331151356379"></p><p><img src="https://www.naste.top:9000/images/image-20230331151419756.png" alt="image-20230331151419756"></p><p><img src="https://www.naste.top:9000/images/image-20230331151436087.png" alt="image-20230331151436087"></p><p><img src="https://www.naste.top:9000/images/image-20230331151503155.png" alt="image-20230331151503155"></p><p><img src="https://www.naste.top:9000/images/image-20230331151554442.png" alt="image-20230331151554442"></p><p><img src="https://www.naste.top:9000/images/image-20230331151559874.png" alt="image-20230331151559874"></p><p><img src="https://www.naste.top:9000/images/image-20230331151607630.png" alt="image-20230331151607630"></p><p><img src="https://www.naste.top:9000/images/image-20230331151637802.png" alt="image-20230331151637802"></p><p><img src="https://www.naste.top:9000/images/image-20230331151647295.png" alt="image-20230331151647295"></p><p><img src="https://www.naste.top:9000/images/image-20230331151658719.png" alt="image-20230331151658719"></p><p><img src="https://www.naste.top:9000/images/image-20230331151843826.png" alt="image-20230331151843826"></p><p><img src="https://www.naste.top:9000/images/image-20230331151859857.png" alt="image-20230331151859857"></p><p><img src="https://www.naste.top:9000/images/image-20230331152129825.png" alt="image-20230331152129825"></p><p><img src="https://www.naste.top:9000/images/image-20230331152149920.png" alt="image-20230331152149920"></p><p><img src="https://www.naste.top:9000/images/image-20230331152208096.png" alt="image-20230331152208096"></p><p><img src="https://www.naste.top:9000/images/image-20230331152218721.png" alt="image-20230331152218721"></p><p><img src="https://www.naste.top:9000/images/image-20230331152241209.png" alt="image-20230331152241209"></p><p><img src="https://www.naste.top:9000/images/image-20230331152251638.png" alt="image-20230331152251638"></p><p><img src="https://www.naste.top:9000/images/image-20230331152546207.png" alt="image-20230331152546207"></p><p><img src="https://www.naste.top:9000/images/image-20230331152648974.png" alt="image-20230331152648974"></p><p><img src="https://www.naste.top:9000/images/image-20230331152659787.png" alt="image-20230331152659787"></p><p><img src="https://www.naste.top:9000/images/image-20230331152725825.png" alt="image-20230331152725825"></p><p><img src="https://www.naste.top:9000/images/image-20230331152831385.png" alt="image-20230331152831385"></p><p><img src="https://www.naste.top:9000/images/image-20230331152837715.png" alt="image-20230331152837715"></p><p><img src="https://www.naste.top:9000/images/image-20230331152859275.png" alt="image-20230331152859275"></p><p><img src="https://www.naste.top:9000/images/image-20230331152908106.png" alt="image-20230331152908106"></p><p><img src="https://www.naste.top:9000/images/image-20230331152932783.png" alt="image-20230331152932783"></p><p><img src="https://www.naste.top:9000/images/image-20230331153337923.png" alt="image-20230331153337923"></p><p><img src="https://www.naste.top:9000/images/image-20230331153443415.png" alt="image-20230331153443415"></p><p><img src="https://www.naste.top:9000/images/image-20230331154436483.png" alt="image-20230331154436483"></p><p><img src="https://www.naste.top:9000/images/image-20230331154536886.png" alt="image-20230331154536886"></p><p><img src="https://www.naste.top:9000/images/image-20230331154629522.png" alt="image-20230331154629522"></p><p><img src="https://www.naste.top:9000/images/image-20230331154642788.png" alt="image-20230331154642788"></p><p><img src="https://www.naste.top:9000/images/image-20230331154702572.png" alt="image-20230331154702572"></p><p><img src="https://www.naste.top:9000/images/image-20230331154905896.png" alt="image-20230331154905896"></p><p><img src="https://www.naste.top:9000/images/image-20230331155058633.png" alt="image-20230331155058633"></p><p><img src="https://www.naste.top:9000/images/image-20230331155143757.png" alt="image-20230331155143757"></p><p><img src="https://www.naste.top:9000/images/image-20230331155215926.png" alt="image-20230331155215926"></p><p><img src="https://www.naste.top:9000/images/image-20230331155228370.png" alt="image-20230331155228370"></p><blockquote><p><strong>ä¸‹é¢æ²¡æœ‰åˆ—å‡ºæ¥çš„ä¸€ç›´ç‚¹å‡»ä¸‹ä¸€æ­¥</strong></p></blockquote><p><img src="https://www.naste.top:9000/images/image-20230331155249485.png" alt="image-20230331155249485"></p><p><img src="https://www.naste.top:9000/images/image-20230331155303825.png" alt="image-20230331155303825"></p><p><img src="https://www.naste.top:9000/images/image-20230331155322088.png" alt="image-20230331155322088"></p><p><img src="https://www.naste.top:9000/images/image-20230331155338950.png" alt="image-20230331155338950"></p><p><img src="https://www.naste.top:9000/images/image-20230331155417700.png" alt="image-20230331155417700"></p><p><img src="https://www.naste.top:9000/images/image-20230331155528931.png" alt="image-20230331155528931"></p><p><img src="https://www.naste.top:9000/images/image-20230331155608078.png" alt="image-20230331155608078"></p><h2 id="ç‰©ç†æœº"><a href="#ç‰©ç†æœº" class="headerlink" title="ç‰©ç†æœº"></a>ç‰©ç†æœº</h2><h1 id="æ‰‹æœºå¤‡ä»½"><a href="#æ‰‹æœºå¤‡ä»½" class="headerlink" title="æ‰‹æœºå¤‡ä»½"></a>æ‰‹æœºå¤‡ä»½</h1><blockquote><p><strong>Googleå•†åº—ä¸‹è½½<code>Ds file</code>è¿›è¡Œæ•°æ®åŒæ­¥</strong></p></blockquote>]]></content>
    
    
    <summary type="html">è™šæ‹Ÿæœºå’Œç‰©ç†æœºå®‰è£…é»‘ç¾¤æ™–</summary>
    
    
    
    <category term="Linux" scheme="https://www.naste.top:1024/categories/Linux/"/>
    
    
    <category term="Linux" scheme="https://www.naste.top:1024/tags/Linux/"/>
    
    <category term="synology" scheme="https://www.naste.top:1024/tags/synology/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨Shellè„šæœ¬ä¸€é”®å®‰è£…è½¯ä»¶</title>
    <link href="https://www.naste.top:1024/posts/3361428798.html"/>
    <id>https://www.naste.top:1024/posts/3361428798.html</id>
    <published>2023-03-22T03:50:25.000Z</published>
    <updated>2023-03-22T04:50:16.541Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h1><p>[TOC]</p><h1 id="nginx"><a href="#nginx" class="headerlink" title="nginx"></a>nginx</h1><h2 id="1-22-1"><a href="#1-22-1" class="headerlink" title="1.22.1"></a>1.22.1</h2><blockquote><p><strong>ç›´æ¥ä½¿ç”¨ä¸‹é¢çš„è„šæœ¬å‘½ä»¤ï¼Œä¸€é”®å®‰è£…nginx</strong></p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install wget &amp;&amp; wget https://www.naste.top:9000/file/shell/nginx/1.22.1/install-nginx.sh --no-check-certificate &amp;&amp; chmod +x install-nginx.sh &amp;&amp; ./install-nginx.sh</span><br></pre></td></tr></table></figure><blockquote><p><strong>install-nginx.shè„šæœ¬å†…å®¹ï¼Œinstall-nginx.shä»¥è¯¥æ–‡æ¡£ä¸­çš„å†…å®¹ä¸ºå‡†</strong></p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å®‰è£…ç›¸å…³ä¾èµ–</span></span><br><span class="line">yum install -y gcc pcre pcre-devel zlib zlib-devel openssl openssl-devel vim wget</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¸‹è½½nginx</span></span><br><span class="line">wget https://nginx.org/download/nginx-1.22.1.tar.gz</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è§£å‹å‹ç¼©åŒ…</span></span><br><span class="line">tar -xvf nginx-1.22.1.tar.gz</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿›å…¥è§£å‹åçš„ç›®å½•</span></span><br><span class="line">cd nginx-1.22.1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ‰§è¡Œ`configure`ç¼–è¯‘nginxçœ‹æ˜¯å¦è¿˜æœ‰é”™è¯¯ ï¼ˆå¯ä»¥ä½¿ç”¨ã€--prefix=`æŒ‡å®šç›®å½•`ã€‘å‘½ä»¤æ¥æŒ‡å®šå®‰è£…ç›®å½•ï¼‰</span></span><br><span class="line">./configure --prefix=/usr/local/nginx --with-http_stub_status_module --with-http_ssl_module --with-http_gzip_static_module</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç¼–è¯‘å’Œå®‰è£…</span></span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ›å»ºnginxæœåŠ¡æ–‡ä»¶</span></span><br><span class="line">touch /usr/lib/systemd/system/nginx.service</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¾“å…¥å†…å®¹</span></span><br><span class="line">sudo tee /usr/lib/systemd/system/nginx.service &lt;&lt;-&#x27;EOF&#x27;</span><br><span class="line">[Unit]</span><br><span class="line">Description=nginx</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">ExecStart=/usr/local/nginx/sbin/nginx</span><br><span class="line">ExecReload=/usr/local/nginx/sbin/nginx -s reload</span><br><span class="line">ExecStop=/usr/local/nginx/sbin/nginx -s quit</span><br><span class="line">PrivateTmp=true</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line">EOF</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¯åŠ¨nginx</span></span><br><span class="line">systemctl start nginx</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è®¾ç½®nginxå¼€æœºå¯åŠ¨</span></span><br><span class="line">systemctl enable nginx</span><br></pre></td></tr></table></figure><h1 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h1><h2 id="latest"><a href="#latest" class="headerlink" title="latest"></a>latest</h2><blockquote><p><strong>ç›´æ¥ä½¿ç”¨ä¸‹é¢çš„è„šæœ¬å‘½ä»¤ï¼Œä¸€é”®å®‰è£…nginx</strong></p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install wget &amp;&amp; wget https://www.naste.top:9000/file/shell/docker/latest/install-docker.sh --no-check-certificate &amp;&amp; chmod +x install-docker.sh &amp;&amp; ./install-docker.sh</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1ã€å¸è½½æ—§ç‰ˆæœ¬</span></span><br><span class="line">    yum remove docker \</span><br><span class="line">        docker-client \</span><br><span class="line">        docker-client-latest \</span><br><span class="line">        docker-common \</span><br><span class="line">        docker-latest \</span><br><span class="line">        docker-latest-logrotate \</span><br><span class="line">        docker-logrotate \</span><br><span class="line">        docker-engine</span><br><span class="line">        </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2ã€éœ€è¦çš„å®‰è£…åŒ…</span></span><br><span class="line">yum install -y yum-utils</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">3ã€è®¾ç½®stableé•œåƒä»“åº“ï¼ˆè®¾ç½®é•œåƒä»“åº“ï¼Œèµ°è£…é˜¿é‡Œäº‘é•œåƒï¼‰</span></span><br><span class="line">yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">4ã€æ›´æ–°yumè½¯ä»¶åŒ…ç´¢å¼•</span></span><br><span class="line">yum makecache fast</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">5ã€å®‰è£…DOCKER CE</span></span><br><span class="line">yum -y install docker-ce docker-ce-cli containerd.io</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">6ã€è®¾ç½®é•œåƒåŠ é€Ÿ</span></span><br><span class="line">mkdir -p /etc/docker</span><br><span class="line"></span><br><span class="line">touch /etc/docker/daemon.json</span><br><span class="line"></span><br><span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;-&#x27;EOF&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [</span><br><span class="line">&quot;https://x3mwd92e.mirror.aliyuncs.com&quot;,</span><br><span class="line">&quot;https://docker.mirrors.ustc.edu.cn/&quot;,</span><br><span class="line">&quot;https://hub-mirror.c.163.com/&quot;,</span><br><span class="line">&quot;https://reg-mirror.qiniu.com&quot;</span><br><span class="line">]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">7ã€å¯åŠ¨docker</span></span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line"></span><br><span class="line">sudo systemctl restart docker</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">8ã€è®¾ç½®å¼€æœºå¯åŠ¨</span></span><br><span class="line">systemctl enable docker</span><br></pre></td></tr></table></figure><h1 id="Docker-Compose"><a href="#Docker-Compose" class="headerlink" title="Docker-Compose"></a>Docker-Compose</h1><p><strong>ä¸‹è½½åœ°å€ï¼š<a href="https://github.com/docker/compose/releases/">https://github.com/docker/compose/releases/</a></strong></p>]]></content>
    
    
    <summary type="html">ä½¿ç”¨Shellè„šæœ¬ä¸€é”®å®‰è£…è½¯ä»¶</summary>
    
    
    
    <category term="Linux" scheme="https://www.naste.top:1024/categories/Linux/"/>
    
    
    <category term="Linux" scheme="https://www.naste.top:1024/tags/Linux/"/>
    
    <category term="Shell" scheme="https://www.naste.top:1024/tags/Shell/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨Shellè„šæœ¬ç”Ÿæˆè‡ªç­¾åè¯ä¹¦</title>
    <link href="https://www.naste.top:1024/posts/1812228581.html"/>
    <id>https://www.naste.top:1024/posts/1812228581.html</id>
    <published>2023-03-21T09:34:08.000Z</published>
    <updated>2023-03-21T10:00:33.917Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h1><p>[TOC]</p><h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><p><strong>è„šæœ¬å‚è€ƒï¼š<a href="https://blog.csdn.net/wzysz117/article/details/118303311">https://blog.csdn.net/wzysz117/article/details/118303311</a></strong></p><p><strong>ç”Ÿæˆåä½¿ç”¨ï¼š<a href="https://blog.csdn.net/pskzs/article/details/125399874">https://blog.csdn.net/pskzs/article/details/125399874</a></strong></p><h1 id="è„šæœ¬å†…å®¹"><a href="#è„šæœ¬å†…å®¹" class="headerlink" title="è„šæœ¬å†…å®¹"></a>è„šæœ¬å†…å®¹</h1><blockquote><p><strong>åˆ›å»ºä¸€ä¸ªæ–‡ä»¶åå­—ä¸º<code>auto-generate-cert.sh</code>çš„è„šæœ¬æ–‡ä»¶</strong></p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br></pre></td><td class="code"><pre><span class="line">sudo tee auto-generate-cert.sh &lt;&lt;-&#x27;EOF&#x27;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash -e</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">help ()</span><br><span class="line">&#123;</span><br><span class="line">    echo  &#x27; ================================================================ &#x27;</span><br><span class="line">    echo  &#x27; --ssl-domain: ç”Ÿæˆsslè¯ä¹¦éœ€è¦çš„ä¸»åŸŸåï¼Œå¦‚ä¸æŒ‡å®šåˆ™é»˜è®¤ä¸ºwww.naste.topï¼Œå¦‚æœæ˜¯ipè®¿é—®æœåŠ¡ï¼Œåˆ™å¯å¿½ç•¥ï¼›&#x27;</span><br><span class="line">    echo  &#x27; --ssl-trusted-ip: ä¸€èˆ¬sslè¯ä¹¦åªä¿¡ä»»åŸŸåçš„è®¿é—®è¯·æ±‚ï¼Œæœ‰æ—¶å€™éœ€è¦ä½¿ç”¨ipå»è®¿é—®serverï¼Œé‚£ä¹ˆéœ€è¦ç»™sslè¯ä¹¦æ·»åŠ æ‰©å±•IPï¼Œå¤šä¸ªIPç”¨é€—å·éš”å¼€ï¼›&#x27;</span><br><span class="line">    echo  &#x27; --ssl-trusted-domain: å¦‚æœæƒ³å¤šä¸ªåŸŸåè®¿é—®ï¼Œåˆ™æ·»åŠ æ‰©å±•åŸŸåï¼ˆSSL_TRUSTED_DOMAINï¼‰,å¤šä¸ªæ‰©å±•åŸŸåç”¨é€—å·éš”å¼€ï¼›&#x27;</span><br><span class="line">    echo  &#x27; --ssl-size: sslåŠ å¯†ä½æ•°ï¼Œé»˜è®¤2048ï¼›&#x27;</span><br><span class="line">    echo  &#x27; --ssl-cn: å›½å®¶ä»£ç (2ä¸ªå­—æ¯çš„ä»£å·),é»˜è®¤CN;&#x27;</span><br><span class="line">    echo  &#x27; ä½¿ç”¨ç¤ºä¾‹:&#x27;</span><br><span class="line">    echo  &#x27; ./auto-generate-cert.sh --ssl-domain=www.naste.top --ssl-trusted-domain=test.naste.top \ &#x27;</span><br><span class="line">    echo  &#x27; --ssl-trusted-ip=192.168.40.1,192.168.40.2 --ssl-size=2048 --ssl-date=3650&#x27;</span><br><span class="line">    echo  &#x27; ================================================================&#x27;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">case &quot;$1&quot; in</span><br><span class="line">    -h|--help) help; exit;;</span><br><span class="line">esac</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">if [[ $1 == &#x27;&#x27; ]];then</span><br><span class="line">    help;</span><br><span class="line">    exit;</span><br><span class="line">fi</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">CMDOPTS=&quot;$*&quot;</span><br><span class="line">for OPTS in $CMDOPTS;</span><br><span class="line">do</span><br><span class="line">    key=$(echo $&#123;OPTS&#125; | awk -F&quot;=&quot; &#x27;&#123;print $1&#125;&#x27; )</span><br><span class="line">    value=$(echo $&#123;OPTS&#125; | awk -F&quot;=&quot; &#x27;&#123;print $2&#125;&#x27; )</span><br><span class="line">    case &quot;$key&quot; in</span><br><span class="line">        --ssl-domain) SSL_DOMAIN=$value ;;</span><br><span class="line">        --ssl-trusted-ip) SSL_TRUSTED_IP=$value ;;</span><br><span class="line">        --ssl-trusted-domain) SSL_TRUSTED_DOMAIN=$value ;;</span><br><span class="line">        --ssl-size) SSL_SIZE=$value ;;</span><br><span class="line">        --ssl-date) SSL_DATE=$value ;;</span><br><span class="line">        --ca-date) CA_DATE=$value ;;</span><br><span class="line">        --ssl-cn) CN=$value ;;</span><br><span class="line">    esac</span><br><span class="line">done</span><br><span class="line"> </span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">CAç›¸å…³é…ç½®</span></span><br><span class="line">CA_DATE=$&#123;CA_DATE:-3650&#125;</span><br><span class="line">CA_KEY=$&#123;CA_KEY:-cakey.pem&#125;</span><br><span class="line">CA_CERT=$&#123;CA_CERT:-cacerts.pem&#125;</span><br><span class="line">CA_DOMAIN=cattle-ca</span><br><span class="line"> </span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">sslç›¸å…³é…ç½®</span></span><br><span class="line">SSL_CONFIG=$&#123;SSL_CONFIG:-$PWD/openssl.cnf&#125;</span><br><span class="line">SSL_DOMAIN=$&#123;SSL_DOMAIN:-&#x27;www.naste.top&#x27;&#125;</span><br><span class="line">SSL_DATE=$&#123;SSL_DATE:-3650&#125;</span><br><span class="line">SSL_SIZE=$&#123;SSL_SIZE:-2048&#125;</span><br><span class="line"> </span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># å›½å®¶ä»£ç (2ä¸ªå­—æ¯çš„ä»£å·),é»˜è®¤CN;</span></span></span><br><span class="line">CN=$&#123;CN:-CN&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">SSL_KEY=$SSL_DOMAIN.key</span><br><span class="line">SSL_CSR=$SSL_DOMAIN.csr</span><br><span class="line">SSL_CERT=$SSL_DOMAIN.crt</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">echo -e &quot;\033[32m ---------------------------- \033[0m&quot;</span><br><span class="line">echo -e &quot;\033[32m       | ç”Ÿæˆ SSL Cert |       \033[0m&quot;</span><br><span class="line">echo -e &quot;\033[32m ---------------------------- \033[0m&quot;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">if [[ -e ./$&#123;CA_KEY&#125; ]]; then</span><br><span class="line">    echo -e &quot;\033[32m ====&gt; 1. å‘ç°å·²å­˜åœ¨CAç§é’¥ï¼Œå¤‡ä»½&quot;$&#123;CA_KEY&#125;&quot;ä¸º&quot;$&#123;CA_KEY&#125;&quot;-bakï¼Œç„¶åé‡æ–°åˆ›å»º \033[0m&quot;</span><br><span class="line">    mv $&#123;CA_KEY&#125; &quot;$&#123;CA_KEY&#125;&quot;-bak</span><br><span class="line">    openssl genrsa -out $&#123;CA_KEY&#125; $&#123;SSL_SIZE&#125;</span><br><span class="line">else</span><br><span class="line">    echo -e &quot;\033[32m ====&gt; 1. ç”Ÿæˆæ–°çš„CAç§é’¥ $&#123;CA_KEY&#125; \033[0m&quot;</span><br><span class="line">    openssl genrsa -out $&#123;CA_KEY&#125; $&#123;SSL_SIZE&#125;</span><br><span class="line">fi</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">if [[ -e ./$&#123;CA_CERT&#125; ]]; then</span><br><span class="line">    echo -e &quot;\033[32m ====&gt; 2. å‘ç°å·²å­˜åœ¨CAè¯ä¹¦ï¼Œå…ˆå¤‡ä»½&quot;$&#123;CA_CERT&#125;&quot;ä¸º&quot;$&#123;CA_CERT&#125;&quot;-bakï¼Œç„¶åé‡æ–°åˆ›å»º \033[0m&quot;</span><br><span class="line">    mv $&#123;CA_CERT&#125; &quot;$&#123;CA_CERT&#125;&quot;-bak</span><br><span class="line">    openssl req -x509 -sha256 -new -nodes -key $&#123;CA_KEY&#125; -days $&#123;CA_DATE&#125; -out $&#123;CA_CERT&#125; -subj &quot;/C=$&#123;CN&#125;/CN=$&#123;CA_DOMAIN&#125;&quot;</span><br><span class="line">else</span><br><span class="line">    echo -e &quot;\033[32m ====&gt; 2. ç”Ÿæˆæ–°çš„CAè¯ä¹¦ $&#123;CA_CERT&#125; \033[0m&quot;</span><br><span class="line">    openssl req -x509 -sha256 -new -nodes -key $&#123;CA_KEY&#125; -days $&#123;CA_DATE&#125; -out $&#123;CA_CERT&#125; -subj &quot;/C=$&#123;CN&#125;/CN=$&#123;CA_DOMAIN&#125;&quot;</span><br><span class="line">fi</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">echo -e &quot;\033[32m ====&gt; 3. ç”ŸæˆOpensslé…ç½®æ–‡ä»¶ $&#123;SSL_CONFIG&#125; \033[0m&quot;</span><br><span class="line">cat &gt; $&#123;SSL_CONFIG&#125; &lt;&lt;EOM</span><br><span class="line">[req]</span><br><span class="line">req_extensions = v3_req</span><br><span class="line">distinguished_name = req_distinguished_name</span><br><span class="line">[req_distinguished_name]</span><br><span class="line">[ v3_req ]</span><br><span class="line">basicConstraints = CA:FALSE</span><br><span class="line">keyUsage = nonRepudiation, digitalSignature, keyEncipherment</span><br><span class="line">extendedKeyUsage = clientAuth, serverAuth</span><br><span class="line">EOM</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">if [[ -n $&#123;SSL_TRUSTED_IP&#125; || -n $&#123;SSL_TRUSTED_DOMAIN&#125; ]]; then</span><br><span class="line">    cat &gt;&gt; $&#123;SSL_CONFIG&#125; &lt;&lt;EOM</span><br><span class="line">subjectAltName = @alt_names</span><br><span class="line">[alt_names]</span><br><span class="line">EOM</span><br><span class="line">    IFS=&quot;,&quot;</span><br><span class="line">    dns=($&#123;SSL_TRUSTED_DOMAIN&#125;)</span><br><span class="line">    dns+=($&#123;SSL_DOMAIN&#125;)</span><br><span class="line">    for i in &quot;$&#123;!dns[@]&#125;&quot;; do</span><br><span class="line">      echo DNS.$((i+1)) = $&#123;dns[$i]&#125; &gt;&gt; $&#123;SSL_CONFIG&#125;</span><br><span class="line">    done</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    if [[ -n $&#123;SSL_TRUSTED_IP&#125; ]]; then</span><br><span class="line">        ip=($&#123;SSL_TRUSTED_IP&#125;)</span><br><span class="line">        for i in &quot;$&#123;!ip[@]&#125;&quot;; do</span><br><span class="line">          echo IP.$((i+1)) = $&#123;ip[$i]&#125; &gt;&gt; $&#123;SSL_CONFIG&#125;</span><br><span class="line">        done</span><br><span class="line">    fi</span><br><span class="line">fi</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">echo -e &quot;\033[32m ====&gt; 4. ç”ŸæˆæœåŠ¡SSL KEY $&#123;SSL_KEY&#125; \033[0m&quot;</span><br><span class="line">openssl genrsa -out $&#123;SSL_KEY&#125; $&#123;SSL_SIZE&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">echo -e &quot;\033[32m ====&gt; 5. ç”ŸæˆæœåŠ¡SSL CSR $&#123;SSL_CSR&#125; \033[0m&quot;</span><br><span class="line">openssl req -sha256 -new -key $&#123;SSL_KEY&#125; -out $&#123;SSL_CSR&#125; -subj &quot;/C=$&#123;CN&#125;/CN=$&#123;SSL_DOMAIN&#125;&quot; -config $&#123;SSL_CONFIG&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">echo -e &quot;\033[32m ====&gt; 6. ç”ŸæˆæœåŠ¡SSL CERT $&#123;SSL_CERT&#125; \033[0m&quot;</span><br><span class="line">openssl x509 -sha256 -req -in $&#123;SSL_CSR&#125; -CA $&#123;CA_CERT&#125; \</span><br><span class="line">    -CAkey $&#123;CA_KEY&#125; -CAcreateserial -out $&#123;SSL_CERT&#125; \</span><br><span class="line">    -days $&#123;SSL_DATE&#125; -extensions v3_req \</span><br><span class="line">    -extfile $&#123;SSL_CONFIG&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">echo -e &quot;\033[32m ====&gt; 7. è¯ä¹¦åˆ¶ä½œå®Œæˆ \033[0m&quot;</span><br><span class="line">echo</span><br><span class="line">echo -e &quot;\033[32m ====&gt; 8. ä»¥YAMLæ ¼å¼è¾“å‡ºç»“æœ \033[0m&quot;</span><br><span class="line">echo &quot;----------------------------------------------------------&quot;</span><br><span class="line">echo &quot;ca_key: |&quot;</span><br><span class="line">cat $CA_KEY | sed &#x27;s/^/  /&#x27;</span><br><span class="line">echo</span><br><span class="line">echo &quot;ca_cert: |&quot;</span><br><span class="line">cat $CA_CERT | sed &#x27;s/^/  /&#x27;</span><br><span class="line">echo</span><br><span class="line">echo &quot;ssl_key: |&quot;</span><br><span class="line">cat $SSL_KEY | sed &#x27;s/^/  /&#x27;</span><br><span class="line">echo</span><br><span class="line">echo &quot;ssl_csr: |&quot;</span><br><span class="line">cat $SSL_CSR | sed &#x27;s/^/  /&#x27;</span><br><span class="line">echo</span><br><span class="line">echo &quot;ssl_cert: |&quot;</span><br><span class="line">cat $SSL_CERT | sed &#x27;s/^/  /&#x27;</span><br><span class="line">echo</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">echo -e &quot;\033[32m ====&gt; 9. é™„åŠ CAè¯ä¹¦åˆ°Certæ–‡ä»¶ \033[0m&quot;</span><br><span class="line">cat $&#123;CA_CERT&#125; &gt;&gt; $&#123;SSL_CERT&#125;</span><br><span class="line">echo &quot;ssl_cert: |&quot;</span><br><span class="line">cat $SSL_CERT | sed &#x27;s/^/  /&#x27;</span><br><span class="line">echo</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">echo -e &quot;\033[32m ====&gt; 10. é‡å‘½åæœåŠ¡è¯ä¹¦ \033[0m&quot;</span><br><span class="line">echo &quot;cp $&#123;SSL_DOMAIN&#125;.key tls.key&quot;</span><br><span class="line">cp $&#123;SSL_DOMAIN&#125;.key tls.key</span><br><span class="line">echo &quot;cp $&#123;SSL_DOMAIN&#125;.crt tls.crt&quot;</span><br><span class="line">cp $&#123;SSL_DOMAIN&#125;.crt tls.crt</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h1 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x auto-generate-cert.sh &amp;&amp; ./auto-generate-cert.sh --ssl-domain=www.naste.top --ssl-trusted-domain=test.naste.top --ssl-trusted-ip=192.168.40.1,192.168.40.2 --ssl-size=2048 --ssl-date=3650</span><br></pre></td></tr></table></figure><p><img src="https://www.naste.top:9000/images/image-20230321175714322.png" alt="image-20230321175714322"></p>]]></content>
    
    
    <summary type="html">ä½¿ç”¨Shellè„šæœ¬ç”Ÿæˆè‡ªç­¾åè¯ä¹¦</summary>
    
    
    
    <category term="Linux" scheme="https://www.naste.top:1024/categories/Linux/"/>
    
    
    <category term="Linux" scheme="https://www.naste.top:1024/tags/Linux/"/>
    
    <category term="Shell" scheme="https://www.naste.top:1024/tags/Shell/"/>
    
    <category term="OpenSSL" scheme="https://www.naste.top:1024/tags/OpenSSL/"/>
    
  </entry>
  
  <entry>
    <title>SpringBootå°†æ•°æ®çš„JSONå­—ç¬¦ä¸²zipå‹ç¼©åå†ç”¨BASE64ç¼–ç ä¼ è¾“</title>
    <link href="https://www.naste.top:1024/posts/4027420475.html"/>
    <id>https://www.naste.top:1024/posts/4027420475.html</id>
    <published>2023-03-17T07:31:08.000Z</published>
    <updated>2023-03-31T01:51:02.355Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h1><p>[TOC]</p><h1 id="ä¾èµ–"><a href="#ä¾èµ–" class="headerlink" title="ä¾èµ–"></a>ä¾èµ–</h1><p><a href="https://www.hutool.cn/">hutoolå®˜ç½‘ï¼šhttps://www.hutool.cn/</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.hutool<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hutool-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.8.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="å·¥å…·ç±»"><a href="#å·¥å…·ç±»" class="headerlink" title="å·¥å…·ç±»"></a>å·¥å…·ç±»</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cn.hutool.core.codec.Base64;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.util.IdUtil;</span><br><span class="line"><span class="keyword">import</span> org.apache.tomcat.util.http.fileupload.IOUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.StandardCharsets;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.zip.ZipEntry;</span><br><span class="line"><span class="keyword">import</span> java.util.zip.ZipInputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.zip.ZipOutputStream;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å‹ç¼©å·¥å…·ç±»</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> XiaoFei</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CompressionUtils</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‹ç¼©å¹¶ç”Ÿæˆbase64å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> jsons jsonæ•°ç»„</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> base64</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">zipBase64</span><span class="params">(String... jsons)</span> &#123;</span><br><span class="line">        <span class="comment">//å°†JSONæ•°ç»„æ‰¹é‡å‹ç¼©</span></span><br><span class="line">        <span class="type">byte</span>[] bytes = zips(jsons);</span><br><span class="line">        <span class="comment">//ç”Ÿæˆbase64</span></span><br><span class="line">        <span class="keyword">return</span> Base64.encode(bytes);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è§£å‹ç¼©base64</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> base64 base64å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> JSONå­—ç¬¦ä¸²æ•°ç»„</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title function_">unZipBase64</span><span class="params">(String base64)</span> &#123;</span><br><span class="line">        <span class="comment">//å°†base64 è§£ç </span></span><br><span class="line">        <span class="type">byte</span>[] bytes = Base64.decode(base64);</span><br><span class="line">        <span class="comment">//æ‰¹é‡è§£å‹</span></span><br><span class="line">        <span class="keyword">return</span> unzips(bytes);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰¹é‡å‹ç¼©byteæ•°ç»„</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> jsons jsonæ•°ç»„</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å‹ç¼©åçš„byteæ•°ç»„</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] zips(String[] jsons) &#123;</span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">baos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">ZipOutputStream</span> <span class="variable">zos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ZipOutputStream</span>(baos, StandardCharsets.UTF_8);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (String json : jsons) &#123;</span><br><span class="line">                <span class="type">ZipEntry</span> <span class="variable">ze</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ZipEntry</span>(IdUtil.randomUUID());</span><br><span class="line">                zos.putNextEntry(ze);</span><br><span class="line">                <span class="type">byte</span>[] data = json.getBytes(StandardCharsets.UTF_8);</span><br><span class="line">                zos.write(data, <span class="number">0</span>, data.length);</span><br><span class="line">            &#125;</span><br><span class="line">            zos.flush();</span><br><span class="line">            zos.close();</span><br><span class="line">            baos.flush();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            IOUtils.closeQuietly(baos);</span><br><span class="line">            IOUtils.closeQuietly(zos);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> baos.toByteArray();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰¹é‡è§£å‹ç¼©</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> data å‹ç¼©çš„byteæ•°ç»„</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> è¿”å›jsonæ•°ç»„å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title function_">unzips</span><span class="params">(<span class="type">byte</span>[] data)</span> &#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºç»“æœé›†</span></span><br><span class="line">        List&lt;String&gt; strings = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">ByteArrayInputStream</span> <span class="variable">bais</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">ZipInputStream</span> <span class="variable">zis</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            bais = <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(data);</span><br><span class="line">            zis = <span class="keyword">new</span> <span class="title class_">ZipInputStream</span>(bais, StandardCharsets.UTF_8);</span><br><span class="line">            <span class="type">ZipEntry</span> <span class="variable">ze</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">while</span> ((ze = zis.getNextEntry()) != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">// è§£ææ–‡ä»¶å¤¹</span></span><br><span class="line">                <span class="type">boolean</span> <span class="variable">directory</span> <span class="operator">=</span> ze.isDirectory();</span><br><span class="line">                <span class="keyword">if</span> (directory)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                <span class="type">InputStreamReader</span> <span class="variable">inputStreamReader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(zis, StandardCharsets.UTF_8);</span><br><span class="line">                <span class="type">BufferedReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(inputStreamReader);</span><br><span class="line">                String line;</span><br><span class="line">                <span class="keyword">while</span> ((line = reader.readLine()) != <span class="literal">null</span>) &#123;</span><br><span class="line">                    strings.add(line);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="literal">null</span> != zis) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    zis.closeEntry();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (<span class="literal">null</span> != bais) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    bais.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (<span class="literal">null</span> != zis) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    zis.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> strings;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æŸ¥è¯¢å…¨éƒ¨å¹¶å‹ç¼©</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> å…¨éƒ¨æ•°æ®</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ApiOperation(value = &quot;æŸ¥è¯¢å…¨éƒ¨å¹¶å‹ç¼©&quot;, httpMethod = &quot;GET&quot;, response = ResponseUtils.class, produces = &quot;application/json&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;list/zip&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseUtils&lt;String&gt; <span class="title function_">selectListByZip</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;UserEntity&gt; items = userService.selectList();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä½¿ç”¨å·¥å…·ç±»å°†é›†åˆè¿›è¡Œå‹ç¼©</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">base64Str</span> <span class="operator">=</span> CompressionUtils.zipBase64(JSON.toJSONString(items));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseUtils</span>&lt;String&gt;().success(base64Str);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è§£å‹æ•°æ®</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> å…¨éƒ¨æ•°æ®</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ApiOperation(value = &quot;è§£å‹æ•°æ®&quot;, httpMethod = &quot;POST&quot;, response = ResponseUtils.class, produces = &quot;application/json&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;list/unzip&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseUtils&lt;List&lt;String&gt;&gt; <span class="title function_">selectListByUnZip</span><span class="params">(<span class="meta">@RequestBody</span> String base64Str)</span> &#123;</span><br><span class="line">    <span class="comment">//è§£å‹</span></span><br><span class="line">    List&lt;String&gt; strings = CompressionUtils.unZipBase64(base64Str);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//éœ€è¦å†è¿›ä¸€æ­¥å°†syringsä¸­çš„æ¯ä¸€åˆ—å­—ç¬¦ä¸²è§£æä¸ºå¯¹åº”çš„å®ä½“ç±»</span></span><br><span class="line">    strings.forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseUtils</span>&lt;List&lt;String&gt;&gt;().success(strings);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">SpringBootå°†æ•°æ®çš„JSONå­—ç¬¦ä¸²zipå‹ç¼©åå†ç”¨BASE64ç¼–ç ä¼ è¾“</summary>
    
    
    
    <category term="Java" scheme="https://www.naste.top:1024/categories/Java/"/>
    
    
    <category term="Java" scheme="https://www.naste.top:1024/tags/Java/"/>
    
    <category term="SpringBoot" scheme="https://www.naste.top:1024/tags/SpringBoot/"/>
    
  </entry>
  
  <entry>
    <title>k8s</title>
    <link href="https://www.naste.top:1024/posts/1699766702.html"/>
    <id>https://www.naste.top:1024/posts/1699766702.html</id>
    <published>2023-03-16T14:04:34.000Z</published>
    <updated>2023-05-16T08:27:09.911Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><strong>è¯¥æ–‡æ¡£ä½¿ç”¨çš„k8sç‰ˆæœ¬ä¸º<code>1.26.0</code></strong></p></blockquote><h1 id="Kubernetes"><a href="#Kubernetes" class="headerlink" title="Kubernetes"></a>Kubernetes</h1><p>å®˜ç½‘: <a href="https://kubernetes.io/zh-cn/">https://kubernetes.io/zh-cn/</a></p><h1 id="ç¬¬ä¸€ç« -åˆè¯†-Kubernetes"><a href="#ç¬¬ä¸€ç« -åˆè¯†-Kubernetes" class="headerlink" title="ç¬¬ä¸€ç«  åˆè¯† Kubernetes"></a>ç¬¬ä¸€ç«  åˆè¯† Kubernetes</h1><ul><li>Kubernetes ç®€ä»‹</li><li>ä¸ºä»€ä¹ˆéœ€è¦ Kubernetes</li><li>Kubernetes èƒ½åšä»€ä¹ˆ</li><li>Kubernetes ä¸æ˜¯ä»€ä¹ˆ?</li></ul><h2 id="1-ç®€ä»‹"><a href="#1-ç®€ä»‹" class="headerlink" title="1 ç®€ä»‹"></a>1 ç®€ä»‹</h2><blockquote><p>æ‘˜å–å®˜ç½‘: <a href="https://kubernetes.io/zh-cn/docs/concepts/overview/">https://kubernetes.io/zh-cn/docs/concepts/overview/</a> </p></blockquote><p><strong>Kubernetes</strong> è¿™ä¸ªåå­—æºäºå¸Œè…Šè¯­ï¼Œæ„ä¸º<code>èˆµæ‰‹</code>æˆ–<code>é£è¡Œå‘˜</code>ã€‚k8s è¿™ä¸ªç¼©å†™æ˜¯å› ä¸º k å’Œ s ä¹‹é—´æœ‰å…«ä¸ªå­—ç¬¦çš„å…³ç³»ã€‚ Google åœ¨ 2014 å¹´å¼€æºäº† Kubernetes é¡¹ç›®ã€‚ Kubernetes å»ºç«‹åœ¨ <a href="https://research.google/pubs/pub43438">Google å¤§è§„æ¨¡è¿è¡Œç”Ÿäº§å·¥ä½œè´Ÿè½½åå‡ å¹´ç»éªŒ</a>çš„åŸºç¡€ä¸Šï¼Œ ç»“åˆäº†ç¤¾åŒºä¸­æœ€ä¼˜ç§€çš„æƒ³æ³•å’Œå®è·µã€‚</p><p><img src="https://www.naste.top:9000/images/image-20221227085420030.png" alt="image-20221227085420030"></p><p>Kubernetes æ˜¯ä¸€ä¸ªå¯ç§»æ¤ã€å¯æ‰©å±•çš„å¼€æºå¹³å°ï¼Œç”¨äº<code>ç®¡ç†å®¹å™¨åŒ–çš„å·¥ä½œè´Ÿè½½å’ŒæœåŠ¡ï¼Œå¯ä¿ƒè¿›å£°æ˜å¼é…ç½®å’Œè‡ªåŠ¨åŒ–</code>ã€‚ Kubernetes æ‹¥æœ‰ä¸€ä¸ªåºå¤§ä¸”å¿«é€Ÿå¢é•¿çš„ç”Ÿæ€ï¼Œå…¶æœåŠ¡ã€æ”¯æŒå’Œå·¥å…·çš„ä½¿ç”¨èŒƒå›´ç›¸å½“å¹¿æ³›ã€‚</p><p>ä» 2014 å¹´ç¬¬ä¸€ä¸ªç‰ˆæœ¬å‘å¸ƒä»¥æ¥ï¼ŒKuberetes è¿…é€Ÿè·å¾—å¼€æºç¤¾åŒºçš„è¿½æ§ï¼ŒåŒ…æ‹¬ Red Hatã€VMware åœ¨å†…çš„å¾ˆå¤šæœ‰å½±å“åŠ›çš„å…¬å¸åŠ å…¥åˆ°å¼€å‘å’Œæ¨å¹¿çš„é˜µè¥ã€‚ç›®å‰ Kubernetes å·²ç»æˆä¸ºå‘å±•æœ€å¿«ã€å¸‚åœºå æœ‰ç‡æœ€é«˜çš„å®¹å™¨ç¼–æ’å¼•æ”€äº§å“ã€‚</p><h2 id="2-ä¸ºä»€ä¹ˆéœ€è¦-k8s"><a href="#2-ä¸ºä»€ä¹ˆéœ€è¦-k8s" class="headerlink" title="2 ä¸ºä»€ä¹ˆéœ€è¦ k8s"></a>2 ä¸ºä»€ä¹ˆéœ€è¦ k8s</h2><blockquote><p>æ‘˜å–å®˜ç½‘: <a href="https://kubernetes.io/zh-cn/docs/concepts/overview/">https://kubernetes.io/zh-cn/docs/concepts/overview/</a> </p></blockquote><p><img src="https://www.naste.top:9000/images/image-20221227090056000.png" alt="image-20221227090056000"></p><p><strong>ä¼ ç»Ÿéƒ¨ç½²æ—¶ä»£ï¼š</strong></p><p>æ—©æœŸï¼Œå„ä¸ªç»„ç»‡æ˜¯åœ¨ç‰©ç†æœåŠ¡å™¨ä¸Šè¿è¡Œåº”ç”¨ç¨‹åºã€‚<code>ç”±äºæ— æ³•é™åˆ¶åœ¨ç‰©ç†æœåŠ¡å™¨ä¸­è¿è¡Œçš„åº”ç”¨ç¨‹åºèµ„æºä½¿ç”¨ï¼Œå› æ­¤ä¼šå¯¼è‡´èµ„æºåˆ†é…é—®é¢˜</code>ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœåœ¨åŒä¸€å°ç‰©ç†æœåŠ¡å™¨ä¸Šè¿è¡Œå¤šä¸ªåº”ç”¨ç¨‹åºï¼Œ åˆ™å¯èƒ½ä¼šå‡ºç°ä¸€ä¸ªåº”ç”¨ç¨‹åºå ç”¨å¤§éƒ¨åˆ†èµ„æºçš„æƒ…å†µï¼Œè€Œå¯¼è‡´å…¶ä»–åº”ç”¨ç¨‹åºçš„æ€§èƒ½ä¸‹é™ã€‚ <code>ä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯å°†æ¯ä¸ªåº”ç”¨ç¨‹åºéƒ½è¿è¡Œåœ¨ä¸åŒçš„ç‰©ç†æœåŠ¡å™¨ä¸Šï¼Œ ä½†æ˜¯å½“æŸä¸ªåº”ç”¨ç¨‹å¼èµ„æºåˆ©ç”¨ç‡ä¸é«˜æ—¶ï¼Œå‰©ä½™èµ„æºæ— æ³•è¢«åˆ†é…ç»™å…¶ä»–åº”ç”¨ç¨‹å¼ï¼Œ è€Œä¸”ç»´æŠ¤è®¸å¤šç‰©ç†æœåŠ¡å™¨çš„æˆæœ¬å¾ˆé«˜</code>ã€‚</p><p><strong>è™šæ‹ŸåŒ–éƒ¨ç½²æ—¶ä»£ï¼š</strong></p><p>å› æ­¤ï¼Œè™šæ‹ŸåŒ–æŠ€æœ¯è¢«å¼•å…¥äº†ã€‚è™šæ‹ŸåŒ–æŠ€æœ¯å…è®¸ä½ åœ¨å•ä¸ªç‰©ç†æœåŠ¡å™¨çš„ CPU ä¸Šè¿è¡Œå¤šå°è™šæ‹Ÿæœºï¼ˆVMï¼‰ã€‚ <code>è™šæ‹ŸåŒ–èƒ½ä½¿åº”ç”¨ç¨‹åºåœ¨ä¸åŒ VM ä¹‹é—´è¢«å½¼æ­¤éš”ç¦»ï¼Œä¸”èƒ½æä¾›ä¸€å®šç¨‹åº¦çš„å®‰å…¨æ€§ï¼Œ å› ä¸ºä¸€ä¸ªåº”ç”¨ç¨‹åºçš„ä¿¡æ¯ä¸èƒ½è¢«å¦ä¸€åº”ç”¨ç¨‹åºéšæ„è®¿é—®</code>ã€‚</p><p>è™šæ‹ŸåŒ–æŠ€æœ¯èƒ½å¤Ÿæ›´å¥½åœ°åˆ©ç”¨ç‰©ç†æœåŠ¡å™¨çš„èµ„æºï¼Œå¹¶ä¸”å› ä¸ºå¯è½»æ¾åœ°æ·»åŠ æˆ–æ›´æ–°åº”ç”¨ç¨‹åºï¼Œ è€Œå› æ­¤å¯ä»¥å…·æœ‰æ›´é«˜çš„å¯æ‰©ç¼©æ€§ï¼Œä»¥åŠé™ä½ç¡¬ä»¶æˆæœ¬ç­‰ç­‰çš„å¥½å¤„ã€‚ é€šè¿‡è™šæ‹ŸåŒ–ï¼Œä½ å¯ä»¥å°†ä¸€ç»„ç‰©ç†èµ„æºå‘ˆç°ä¸ºå¯ä¸¢å¼ƒçš„è™šæ‹Ÿæœºé›†ç¾¤ã€‚</p><p><code>æ¯ä¸ª VM æ˜¯ä¸€å°å®Œæ•´çš„è®¡ç®—æœºï¼Œåœ¨è™šæ‹ŸåŒ–ç¡¬ä»¶ä¹‹ä¸Šè¿è¡Œæ‰€æœ‰ç»„ä»¶ï¼ŒåŒ…æ‹¬å…¶è‡ªå·±çš„æ“ä½œç³»ç»Ÿ</code>ã€‚</p><p><strong>å®¹å™¨éƒ¨ç½²æ—¶ä»£ï¼š</strong></p><p>å®¹å™¨ç±»ä¼¼äº VMï¼Œä½†æ˜¯æ›´å®½æ¾çš„éš”ç¦»ç‰¹æ€§ï¼Œä½¿å®¹å™¨ä¹‹é—´å¯ä»¥å…±äº«æ“ä½œç³»ç»Ÿï¼ˆOSï¼‰ã€‚ å› æ­¤ï¼Œå®¹å™¨æ¯”èµ· VM è¢«è®¤ä¸ºæ˜¯æ›´è½»é‡çº§çš„ã€‚ä¸”ä¸ VM ç±»ä¼¼ï¼Œæ¯ä¸ªå®¹å™¨éƒ½å…·æœ‰è‡ªå·±çš„æ–‡ä»¶ç³»ç»Ÿã€CPUã€å†…å­˜ã€è¿›ç¨‹ç©ºé—´ç­‰ã€‚ ç”±äºå®ƒä»¬ä¸åŸºç¡€æ¶æ„åˆ†ç¦»ï¼Œå› æ­¤å¯ä»¥è·¨äº‘å’Œ OS å‘è¡Œç‰ˆæœ¬è¿›è¡Œç§»æ¤ã€‚<code>å®¹å™¨çš„å‡ºç°è§£å†³äº†åº”ç”¨å’ŒåŸºç¡€ç¯å¢ƒå¼‚æ„çš„é—®é¢˜ï¼Œè®©åº”ç”¨å¯ä»¥åšåˆ°ä¸€æ¬¡æ„å»ºï¼Œå¤šæ¬¡éƒ¨ç½²</code>ã€‚ä¸å¯å¦è®¤å®¹å™¨æ˜¯æ‰“åŒ…å’Œè¿è¡Œåº”ç”¨ç¨‹åºçš„å¥½æ–¹å¼ï¼Œå› æ­¤å®¹å™¨æ–¹å¼éƒ¨ç½²å˜å¾—æµè¡Œèµ·æ¥ã€‚ä½†éšç€å®¹å™¨éƒ¨ç½²æµè¡Œï¼Œä»…ä»…æ˜¯åŸºäºå®¹å™¨çš„éƒ¨ç½²ä»æœ‰ä¸€äº›é—®é¢˜æ²¡æœ‰è§£å†³:</p><ul><li>ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œ ä½ éœ€è¦ç®¡ç†è¿è¡Œç€åº”ç”¨ç¨‹åºçš„å®¹å™¨ï¼Œå¹¶ç¡®ä¿æœåŠ¡ä¸ä¼šä¸‹çº¿ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªå®¹å™¨å‘ç”Ÿæ•…éšœï¼Œåˆ™ä½ éœ€è¦å¯åŠ¨å¦ä¸€ä¸ªå®¹å™¨ã€‚</li><li>é«˜å¹¶å‘æ—¶ï¼Œä½ éœ€è¦å¯åŠ¨å¤šä¸ªåº”ç”¨ç¨‹åºå®¹å™¨ä¸ºç³»ç»Ÿæé«˜é«˜å¯ç”¨ï¼Œå¹¶ä¿è¯å¤šä¸ªå®¹å™¨èƒ½è´Ÿè½½å‡è¡¡ã€‚</li><li>åœ¨ç»´æŠ¤ã€å‡çº§ç‰ˆæœ¬æ—¶ï¼Œä½ éœ€è¦å°†è¿è¡Œåº”ç”¨ç¨‹åºå®¹å™¨ä»æ–°éƒ¨ç½²ï¼Œéƒ¨ç½²æ—¶å¿…é¡»å¯¹ä¹‹å‰åº”ç”¨å®¹å™¨å¤‡ä»½ï¼Œä¸€æ—¦å‡ºç°é”™è¯¯ï¼Œéœ€è¦æ‰‹åŠ¨å¯åŠ¨ä¹‹å‰å®¹å™¨ä¿è¯ç³»ç»Ÿè¿è¡Œã€‚</li></ul><p><code>å¦‚æœä»¥ä¸Šè¡Œä¸ºäº¤ç”±ç»™ç³»ç»Ÿå¤„ç†ï¼Œæ˜¯ä¸æ˜¯ä¼šæ›´å®¹æ˜“ä¸€äº›ï¼Ÿé‚£ä¹ˆè°èƒ½åšåˆ°è¿™äº›?</code></p><h2 id="3-k8s-èƒ½åšä»€ä¹ˆ"><a href="#3-k8s-èƒ½åšä»€ä¹ˆ" class="headerlink" title="3 k8s èƒ½åšä»€ä¹ˆ?"></a>3 k8s èƒ½åšä»€ä¹ˆ?</h2><blockquote><p>æ‘˜å–å®˜ç½‘: <a href="https://kubernetes.io/zh-cn/docs/concepts/overview/">https://kubernetes.io/zh-cn/docs/concepts/overview/</a> </p></blockquote><p>è¿™å°±æ˜¯ Kubernetes è¦æ¥åšçš„äº‹æƒ…ï¼ <code>Kubernetes ä¸ºä½ æä¾›äº†ä¸€ä¸ªå¯å¼¹æ€§è¿è¡Œåˆ†å¸ƒå¼ç³»ç»Ÿçš„æ¡†æ¶</code>ã€‚ Kubernetes ä¼šæ»¡è¶³ä½ çš„æ‰©å±•è¦æ±‚ã€æ•…éšœè½¬ç§»ä½ çš„åº”ç”¨ã€æä¾›éƒ¨ç½²æ¨¡å¼ç­‰ã€‚Kubernetes ä¸ºä½ æä¾›ï¼š</p><ul><li><p><strong>æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡</strong></p><p>Kubernetes å¯ä»¥ä½¿ç”¨ DNS åç§°æˆ–è‡ªå·±çš„ IP åœ°å€æ¥æš´éœ²å®¹å™¨ã€‚ å¦‚æœè¿›å…¥å®¹å™¨çš„æµé‡å¾ˆå¤§ï¼Œ Kubernetes å¯ä»¥è´Ÿè½½å‡è¡¡å¹¶åˆ†é…ç½‘ç»œæµé‡ï¼Œä»è€Œä½¿éƒ¨ç½²ç¨³å®šã€‚</p></li><li><p><strong>å­˜å‚¨ç¼–æ’</strong></p><p>Kubernetes å…è®¸ä½ è‡ªåŠ¨æŒ‚è½½ä½ é€‰æ‹©çš„å­˜å‚¨ç³»ç»Ÿï¼Œä¾‹å¦‚æœ¬åœ°å­˜å‚¨ã€å…¬å…±äº‘æä¾›å•†ç­‰ã€‚</p></li><li><p><strong>è‡ªåŠ¨éƒ¨ç½²å’Œå›æ»š</strong></p><p>ä½ å¯ä»¥ä½¿ç”¨ Kubernetes æè¿°å·²éƒ¨ç½²å®¹å™¨çš„æ‰€éœ€çŠ¶æ€ï¼Œ å®ƒå¯ä»¥ä»¥å—æ§çš„é€Ÿç‡å°†å®é™…çŠ¶æ€æ›´æ”¹ä¸ºæœŸæœ›çŠ¶æ€ã€‚ ä¾‹å¦‚ï¼Œä½ å¯ä»¥è‡ªåŠ¨åŒ– Kubernetes æ¥ä¸ºä½ çš„éƒ¨ç½²åˆ›å»ºæ–°å®¹å™¨ï¼Œ åˆ é™¤ç°æœ‰å®¹å™¨å¹¶å°†å®ƒä»¬çš„æ‰€æœ‰èµ„æºç”¨äºæ–°å®¹å™¨ã€‚</p></li><li><p><strong>è‡ªåŠ¨å®Œæˆè£…ç®±è®¡ç®—/è‡ªåŠ¨èµ„æºè°ƒåº¦</strong></p><p>ä½ ä¸º Kubernetes æä¾›è®¸å¤šèŠ‚ç‚¹ç»„æˆçš„é›†ç¾¤ï¼Œåœ¨è¿™ä¸ªé›†ç¾¤ä¸Šè¿è¡Œå®¹å™¨åŒ–çš„ä»»åŠ¡ã€‚ ä½ å‘Šè¯‰ Kubernetes æ¯ä¸ªå®¹å™¨éœ€è¦å¤šå°‘ CPU å’Œå†…å­˜ (RAM)ã€‚ Kubernetes å¯ä»¥å°†è¿™äº›å®¹å™¨æŒ‰å®é™…æƒ…å†µè°ƒåº¦åˆ°ä½ çš„èŠ‚ç‚¹ä¸Šï¼Œä»¥æœ€ä½³æ–¹å¼åˆ©ç”¨ä½ çš„èµ„æºã€‚</p></li><li><p><strong>è‡ªæˆ‘ä¿®å¤/è‡ªæ„ˆèƒ½åŠ›</strong></p><p>Kubernetes å°†é‡æ–°å¯åŠ¨å¤±è´¥çš„å®¹å™¨ã€æ›¿æ¢å®¹å™¨ã€æ€æ­»ä¸å“åº”ç”¨æˆ·å®šä¹‰çš„è¿è¡ŒçŠ¶å†µæ£€æŸ¥çš„å®¹å™¨ï¼Œ å¹¶ä¸”åœ¨å‡†å¤‡å¥½æœåŠ¡ä¹‹å‰ä¸å°†å…¶é€šå‘Šç»™å®¢æˆ·ç«¯ã€‚</p></li><li><p><strong>å¯†é’¥ä¸é…ç½®ç®¡ç†</strong></p><p>Kubernetes å…è®¸ä½ å­˜å‚¨å’Œç®¡ç†æ•æ„Ÿä¿¡æ¯ï¼Œä¾‹å¦‚å¯†ç ã€OAuth ä»¤ç‰Œå’Œ ssh å¯†é’¥ã€‚ ä½ å¯ä»¥åœ¨ä¸é‡å»ºå®¹å™¨é•œåƒçš„æƒ…å†µä¸‹éƒ¨ç½²å’Œæ›´æ–°å¯†é’¥å’Œåº”ç”¨ç¨‹åºé…ç½®ï¼Œä¹Ÿæ— éœ€åœ¨å †æ ˆé…ç½®ä¸­æš´éœ²å¯†é’¥ã€‚</p></li></ul><h2 id="4-k8s-ä¸æ˜¯ä»€ä¹ˆ"><a href="#4-k8s-ä¸æ˜¯ä»€ä¹ˆ" class="headerlink" title="4 k8s ä¸æ˜¯ä»€ä¹ˆ?"></a>4 k8s ä¸æ˜¯ä»€ä¹ˆ?</h2><p><code>Kubernetes ä¸æ˜¯ä¼ ç»Ÿçš„ã€åŒ…ç½—ä¸‡è±¡çš„ PaaSï¼ˆå¹³å°å³æœåŠ¡ï¼‰ç³»ç»Ÿ</code>ã€‚ ç”±äº Kubernetes æ˜¯åœ¨å®¹å™¨çº§åˆ«è¿è¡Œï¼Œè€Œéåœ¨ç¡¬ä»¶çº§åˆ«ï¼Œå®ƒæä¾›äº† PaaS äº§å“å…±æœ‰çš„ä¸€äº›æ™®éé€‚ç”¨çš„åŠŸèƒ½ï¼Œ ä¾‹å¦‚éƒ¨ç½²ã€æ‰©å±•ã€è´Ÿè½½å‡è¡¡ï¼Œå…è®¸ç”¨æˆ·é›†æˆä»–ä»¬çš„æ—¥å¿—è®°å½•ã€ç›‘æ§å’Œè­¦æŠ¥æ–¹æ¡ˆã€‚ ä½†æ˜¯ï¼Œ<code>Kubernetes ä¸æ˜¯å•ä½“å¼ï¼ˆmonolithicï¼‰ç³»ç»Ÿ</code>ï¼Œé‚£äº›é»˜è®¤è§£å†³æ–¹æ¡ˆéƒ½æ˜¯å¯é€‰ã€å¯æ’æ‹”çš„ã€‚ Kubernetes ä¸ºæ„å»ºå¼€å‘äººå‘˜å¹³å°æä¾›äº†åŸºç¡€ï¼Œä½†æ˜¯åœ¨é‡è¦çš„åœ°æ–¹ä¿ç•™äº†ç”¨æˆ·é€‰æ‹©æƒï¼Œèƒ½æœ‰æ›´é«˜çš„çµæ´»æ€§ã€‚</p><p>Kubernetesï¼š</p><ul><li>ä¸é™åˆ¶æ”¯æŒçš„åº”ç”¨ç¨‹åºç±»å‹ã€‚ Kubernetes æ—¨åœ¨æ”¯æŒæå…¶å¤šç§å¤šæ ·çš„å·¥ä½œè´Ÿè½½ï¼ŒåŒ…æ‹¬æ— çŠ¶æ€ã€æœ‰çŠ¶æ€å’Œæ•°æ®å¤„ç†å·¥ä½œè´Ÿè½½ã€‚ å¦‚æœåº”ç”¨ç¨‹åºå¯ä»¥åœ¨å®¹å™¨ä¸­è¿è¡Œï¼Œé‚£ä¹ˆå®ƒåº”è¯¥å¯ä»¥åœ¨ Kubernetes ä¸Šå¾ˆå¥½åœ°è¿è¡Œã€‚</li><li>ä¸éƒ¨ç½²æºä»£ç ï¼Œä¹Ÿä¸æ„å»ºä½ çš„åº”ç”¨ç¨‹åºã€‚ æŒç»­é›†æˆï¼ˆCIï¼‰ã€äº¤ä»˜å’Œéƒ¨ç½²ï¼ˆCI/CDï¼‰å·¥ä½œæµå–å†³äºç»„ç»‡çš„æ–‡åŒ–å’Œåå¥½ä»¥åŠæŠ€æœ¯è¦æ±‚ã€‚</li><li><p>ä¸æä¾›åº”ç”¨ç¨‹åºçº§åˆ«çš„æœåŠ¡ä½œä¸ºå†…ç½®æœåŠ¡ï¼Œä¾‹å¦‚ä¸­é—´ä»¶ï¼ˆä¾‹å¦‚æ¶ˆæ¯ä¸­é—´ä»¶ï¼‰ã€ æ•°æ®å¤„ç†æ¡†æ¶ï¼ˆä¾‹å¦‚ Sparkï¼‰ã€æ•°æ®åº“ï¼ˆä¾‹å¦‚ MySQLï¼‰ã€ç¼“å­˜ã€é›†ç¾¤å­˜å‚¨ç³»ç»Ÿ ï¼ˆä¾‹å¦‚ Cephï¼‰ã€‚è¿™æ ·çš„ç»„ä»¶å¯ä»¥åœ¨ Kubernetes ä¸Šè¿è¡Œï¼Œå¹¶ä¸”/æˆ–è€…å¯ä»¥ç”±è¿è¡Œåœ¨ Kubernetes ä¸Šçš„åº”ç”¨ç¨‹åºé€šè¿‡å¯ç§»æ¤æœºåˆ¶ï¼ˆä¾‹å¦‚<a href="https://openservicebrokerapi.org/">å¼€æ”¾æœåŠ¡ä»£ç†</a>ï¼‰æ¥è®¿é—®ã€‚</p></li><li><p>ä¸æ˜¯æ—¥å¿—è®°å½•ã€ç›‘è§†æˆ–è­¦æŠ¥çš„è§£å†³æ–¹æ¡ˆã€‚ å®ƒé›†æˆäº†ä¸€äº›åŠŸèƒ½ä½œä¸ºæ¦‚å¿µè¯æ˜ï¼Œå¹¶æä¾›äº†æ”¶é›†å’Œå¯¼å‡ºæŒ‡æ ‡çš„æœºåˆ¶ã€‚</p></li><li>ä¸æä¾›ä¹Ÿä¸è¦æ±‚é…ç½®ç”¨çš„è¯­è¨€ã€ç³»ç»Ÿï¼ˆä¾‹å¦‚ jsonnetï¼‰ï¼Œå®ƒæä¾›äº†å£°æ˜æ€§ APIï¼Œ è¯¥å£°æ˜æ€§ API å¯ä»¥ç”±ä»»æ„å½¢å¼çš„å£°æ˜æ€§è§„èŒƒæ‰€æ„æˆã€‚</li><li>ä¸æä¾›ä¹Ÿä¸é‡‡ç”¨ä»»ä½•å…¨é¢çš„æœºå™¨é…ç½®ã€ç»´æŠ¤ã€ç®¡ç†æˆ–è‡ªæˆ‘ä¿®å¤ç³»ç»Ÿã€‚</li><li>æ­¤å¤–ï¼ŒKubernetes ä¸ä»…ä»…æ˜¯ä¸€ä¸ªç¼–æ’ç³»ç»Ÿï¼Œå®é™…ä¸Šå®ƒæ¶ˆé™¤äº†ç¼–æ’çš„éœ€è¦ã€‚ ç¼–æ’çš„æŠ€æœ¯å®šä¹‰æ˜¯æ‰§è¡Œå·²å®šä¹‰çš„å·¥ä½œæµç¨‹ï¼šé¦–å…ˆæ‰§è¡Œ Aï¼Œç„¶åæ‰§è¡Œ Bï¼Œå†æ‰§è¡Œ Cã€‚ è€Œ Kubernetes åŒ…å«äº†ä¸€ç»„ç‹¬ç«‹å¯ç»„åˆçš„æ§åˆ¶è¿‡ç¨‹ï¼Œå¯ä»¥è¿ç»­åœ°å°†å½“å‰çŠ¶æ€é©±åŠ¨åˆ°æ‰€æä¾›çš„é¢„æœŸçŠ¶æ€ã€‚ ä½ ä¸éœ€è¦åœ¨ä¹å¦‚ä½•ä» A ç§»åŠ¨åˆ° Cï¼Œä¹Ÿä¸éœ€è¦é›†ä¸­æ§åˆ¶ï¼Œè¿™ä½¿å¾—ç³»ç»Ÿæ›´æ˜“äºä½¿ç”¨ä¸”åŠŸèƒ½æ›´å¼ºå¤§ã€ ç³»ç»Ÿæ›´å¥å£®ï¼Œæ›´ä¸ºå¼¹æ€§å’Œå¯æ‰©å±•ã€‚</li></ul><hr><h1 id="ç¬¬äºŒç« -ç»„ä»¶-amp-æ¶æ„"><a href="#ç¬¬äºŒç« -ç»„ä»¶-amp-æ¶æ„" class="headerlink" title="ç¬¬äºŒç«  ç»„ä»¶&amp;æ¶æ„"></a>ç¬¬äºŒç«  ç»„ä»¶&amp;æ¶æ„</h1><ul><li>é›†ç¾¤ç»„ä»¶</li><li>æ ¸å¿ƒæ¦‚å¿µ</li><li>é›†ç¾¤å®‰è£…</li></ul><h2 id="1-é›†ç¾¤ç»„ä»¶"><a href="#1-é›†ç¾¤ç»„ä»¶" class="headerlink" title="1 é›†ç¾¤ç»„ä»¶"></a>1 é›†ç¾¤ç»„ä»¶</h2><ul><li>é›†ç¾¤ cluster : å°†åŒä¸€ä¸ªè½¯ä»¶æœåŠ¡å¤šä¸ªèŠ‚ç‚¹ç»„ç»‡åˆ°ä¸€èµ·å…±åŒä¸ºç³»ç»Ÿæä¾›æœåŠ¡è¿‡ç¨‹ç§°ä¹‹ä¸ºè¯¥è½¯ä»¶çš„é›†ç¾¤ã€‚redis é›†ç¾¤ã€esé›†ç¾¤ã€mongo ç­‰ã€‚</li><li>k8s é›†ç¾¤: å¤šä¸ªèŠ‚ç‚¹: 3 ä¸ªèŠ‚ç‚¹  è§’è‰²:  1.master èŠ‚ç‚¹/control plane æ§åˆ¶èŠ‚ç‚¹   2. work node: å·¥ä½œèŠ‚ç‚¹(pod å®¹å™¨:åº”ç”¨ç¨‹åºå®¹å™¨)</li></ul><p>å½“éƒ¨ç½²å®Œ Kubernetesï¼Œä¾¿æ‹¥æœ‰äº†ä¸€ä¸ªå®Œæ•´çš„é›†ç¾¤ã€‚ä¸€ç»„å·¥ä½œæœºå™¨ï¼Œç§°ä¸ºèŠ‚ç‚¹ï¼Œ ä¼šè¿è¡Œå®¹å™¨åŒ–åº”ç”¨ç¨‹åºã€‚<code>æ¯ä¸ªé›†ç¾¤è‡³å°‘æœ‰ä¸€ä¸ªå·¥ä½œèŠ‚ç‚¹</code>ã€‚å·¥ä½œèŠ‚ç‚¹ä¼š<code>æ‰˜ç®¡ Pod</code>ï¼Œè€Œ Pod å°±æ˜¯ä½œä¸ºåº”ç”¨è´Ÿè½½çš„ç»„ä»¶ã€‚ <code>æ§åˆ¶å¹³é¢ç®¡ç†é›†ç¾¤ä¸­çš„å·¥ä½œèŠ‚ç‚¹å’Œ Pod</code>ã€‚</p><p><img src="https://www.naste.top:9000/images/components-of-kubernetes.svg" alt="Kubernetes çš„ç»„ä»¶"></p><h3 id="1-1-æ§åˆ¶å¹³é¢ç»„ä»¶ï¼ˆControl-Plane-Componentsï¼‰"><a href="#1-1-æ§åˆ¶å¹³é¢ç»„ä»¶ï¼ˆControl-Plane-Componentsï¼‰" class="headerlink" title="1.1 æ§åˆ¶å¹³é¢ç»„ä»¶ï¼ˆControl Plane Componentsï¼‰"></a>1.1 æ§åˆ¶å¹³é¢ç»„ä»¶ï¼ˆControl Plane Componentsï¼‰</h3><p>æ§åˆ¶å¹³é¢ç»„ä»¶ä¼šä¸ºé›†ç¾¤åšå‡ºå…¨å±€å†³ç­–ï¼Œæ¯”å¦‚<code>èµ„æºçš„è°ƒåº¦ã€‚ ä»¥åŠæ£€æµ‹å’Œå“åº”é›†ç¾¤äº‹ä»¶ï¼Œä¾‹å¦‚å½“ä¸æ»¡è¶³éƒ¨ç½²çš„ replicas å­—æ®µæ—¶ï¼Œ è¦å¯åŠ¨æ–°çš„ pod</code>ï¼‰ã€‚</p><blockquote><p>æ§åˆ¶å¹³é¢ç»„ä»¶å¯ä»¥åœ¨é›†ç¾¤ä¸­çš„ä»»ä½•èŠ‚ç‚¹ä¸Šè¿è¡Œã€‚ ç„¶è€Œï¼Œä¸ºäº†ç®€å•èµ·è§ï¼Œè®¾ç½®è„šæœ¬é€šå¸¸ä¼šåœ¨åŒä¸€ä¸ªè®¡ç®—æœºä¸Šå¯åŠ¨æ‰€æœ‰æ§åˆ¶å¹³é¢ç»„ä»¶ï¼Œ å¹¶ä¸”ä¸ä¼šåœ¨æ­¤è®¡ç®—æœºä¸Šè¿è¡Œç”¨æˆ·å®¹å™¨ã€‚</p></blockquote><ul><li><p><strong>kube-apiserver</strong></p><p>API serveræ˜¯ Kubernetes æ§åˆ¶å¹³é¢çš„ç»„ä»¶ï¼Œ <code>è¯¥ç»„ä»¶è´Ÿè´£å…¬å¼€äº† Kubernetes APIï¼Œè´Ÿè´£å¤„ç†æ¥å—è¯·æ±‚çš„å·¥ä½œ</code>ã€‚ API server æ˜¯ Kubernetes æ§åˆ¶å¹³é¢çš„å‰ç«¯ã€‚Kubernetes API æœåŠ¡å™¨çš„ä¸»è¦å®ç°æ˜¯ kube-apiserverã€‚ <code>kube-apiserver</code> è®¾è®¡ä¸Šè€ƒè™‘äº†æ°´å¹³æ‰©ç¼©ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒå¯é€šè¿‡éƒ¨ç½²å¤šä¸ªå®ä¾‹æ¥è¿›è¡Œæ‰©ç¼©ã€‚ ä½ å¯ä»¥è¿è¡Œ <code>kube-apiserver</code> çš„å¤šä¸ªå®ä¾‹ï¼Œå¹¶åœ¨è¿™äº›å®ä¾‹ä¹‹é—´å¹³è¡¡æµé‡ã€‚</p></li><li><p><strong>etcd</strong></p><p><code>ä¸€è‡´ä¸”é«˜åº¦å¯ç”¨çš„é”®å€¼å­˜å‚¨ï¼Œç”¨ä½œ Kubernetes çš„æ‰€æœ‰é›†ç¾¤æ•°æ®çš„åå°æ•°æ®åº“</code>ã€‚</p></li><li><p><strong>kube-scheduler</strong></p><p><code>kube-scheduler</code> æ˜¯æ§åˆ¶å¹³é¢çš„ç»„ä»¶ï¼Œ è´Ÿè´£ç›‘è§†æ–°åˆ›å»ºçš„ã€æœªæŒ‡å®šè¿è¡ŒèŠ‚ç‚¹ node çš„ Podsï¼Œ å¹¶é€‰æ‹©èŠ‚ç‚¹æ¥è®© Pod åœ¨ä¸Šé¢è¿è¡Œã€‚è°ƒåº¦å†³ç­–è€ƒè™‘çš„å› ç´ åŒ…æ‹¬å•ä¸ª Pod åŠ Pods é›†åˆçš„èµ„æºéœ€æ±‚ã€è½¯ç¡¬ä»¶åŠç­–ç•¥çº¦æŸã€ äº²å’Œæ€§åŠåäº²å’Œæ€§è§„èŒƒã€æ•°æ®ä½ç½®ã€å·¥ä½œè´Ÿè½½é—´çš„å¹²æ‰°åŠæœ€åæ—¶é™ã€‚</p></li><li><p><strong>kube-controller-manager</strong></p><p>kube-controller-manager æ˜¯æ§åˆ¶å¹³é¢çš„ç»„ä»¶ï¼Œ è´Ÿè´£è¿è¡Œæ§åˆ¶å™¨è¿›ç¨‹ã€‚ä»é€»è¾‘ä¸Šè®²ï¼Œ æ¯ä¸ªæ§åˆ¶å™¨éƒ½æ˜¯ä¸€ä¸ªå•ç‹¬çš„è¿›ç¨‹ï¼Œ ä½†æ˜¯ä¸ºäº†é™ä½å¤æ‚æ€§ï¼Œå®ƒä»¬éƒ½è¢«ç¼–è¯‘åˆ°åŒä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¹¶åœ¨åŒä¸€ä¸ªè¿›ç¨‹ä¸­è¿è¡Œã€‚</p><p>è¿™äº›æ§åˆ¶å™¨åŒ…æ‹¬ï¼š</p><ul><li>èŠ‚ç‚¹æ§åˆ¶å™¨ï¼ˆNode Controllerï¼‰ï¼šè´Ÿè´£åœ¨èŠ‚ç‚¹å‡ºç°æ•…éšœæ—¶è¿›è¡Œé€šçŸ¥å’Œå“åº”</li><li>ä»»åŠ¡æ§åˆ¶å™¨ï¼ˆJob Controllerï¼‰ï¼šç›‘æµ‹ä»£è¡¨ä¸€æ¬¡æ€§ä»»åŠ¡çš„ Job å¯¹è±¡ï¼Œç„¶ååˆ›å»º Pods æ¥è¿è¡Œè¿™äº›ä»»åŠ¡ç›´è‡³å®Œæˆ</li><li>ç«¯ç‚¹åˆ†ç‰‡æ§åˆ¶å™¨ï¼ˆEndpointSlice controllerï¼‰ï¼šå¡«å……ç«¯ç‚¹åˆ†ç‰‡ï¼ˆEndpointSliceï¼‰å¯¹è±¡ï¼ˆä»¥æä¾› Service å’Œ Pod ä¹‹é—´çš„é“¾æ¥ï¼‰ã€‚</li><li>æœåŠ¡è´¦å·æ§åˆ¶å™¨ï¼ˆServiceAccount controllerï¼‰ï¼šä¸ºæ–°çš„å‘½åç©ºé—´åˆ›å»ºé»˜è®¤çš„æœåŠ¡è´¦å·ï¼ˆServiceAccountï¼‰ã€‚</li></ul></li><li><p><strong>cloud-controller-manager</strong> (optional å¯é€‰)</p><p>ä¸€ä¸ª Kubernetes æ§åˆ¶å¹³é¢ç»„ä»¶ï¼Œ åµŒå…¥äº†ç‰¹å®šäºäº‘å¹³å°çš„æ§åˆ¶é€»è¾‘ã€‚ äº‘æ§åˆ¶å™¨ç®¡ç†å™¨ï¼ˆCloud Controller Managerï¼‰å…è®¸ä½ å°†ä½ çš„é›†ç¾¤è¿æ¥åˆ°äº‘æä¾›å•†çš„ API ä¹‹ä¸Šï¼Œ å¹¶å°†ä¸è¯¥äº‘å¹³å°äº¤äº’çš„ç»„ä»¶åŒä¸ä½ çš„é›†ç¾¤äº¤äº’çš„ç»„ä»¶åˆ†ç¦»å¼€æ¥ã€‚<code>cloud-controller-manager</code> ä»…è¿è¡Œç‰¹å®šäºäº‘å¹³å°çš„æ§åˆ¶å™¨ã€‚ å› æ­¤å¦‚æœä½ åœ¨è‡ªå·±çš„ç¯å¢ƒä¸­è¿è¡Œ Kubernetesï¼Œæˆ–è€…åœ¨æœ¬åœ°è®¡ç®—æœºä¸­è¿è¡Œå­¦ä¹ ç¯å¢ƒï¼Œ æ‰€éƒ¨ç½²çš„é›†ç¾¤ä¸éœ€è¦æœ‰äº‘æ§åˆ¶å™¨ç®¡ç†å™¨ã€‚ä¸ <code>kube-controller-manager</code> ç±»ä¼¼ï¼Œ<code>cloud-controller-manager</code> å°†è‹¥å¹²é€»è¾‘ä¸Šç‹¬ç«‹çš„æ§åˆ¶å›è·¯ç»„åˆåˆ°åŒä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ä¸­ï¼Œ ä¾›ä½ ä»¥åŒä¸€è¿›ç¨‹çš„æ–¹å¼è¿è¡Œã€‚ ä½ å¯ä»¥å¯¹å…¶æ‰§è¡Œæ°´å¹³æ‰©å®¹ï¼ˆè¿è¡Œä¸æ­¢ä¸€ä¸ªå‰¯æœ¬ï¼‰ä»¥æå‡æ€§èƒ½æˆ–è€…å¢å¼ºå®¹é”™èƒ½åŠ›ã€‚</p><p>ä¸‹é¢çš„æ§åˆ¶å™¨éƒ½åŒ…å«å¯¹äº‘å¹³å°é©±åŠ¨çš„ä¾èµ–ï¼š</p><ul><li><p>èŠ‚ç‚¹æ§åˆ¶å™¨ï¼ˆNode Controllerï¼‰ï¼šç”¨äºåœ¨èŠ‚ç‚¹ç»ˆæ­¢å“åº”åæ£€æŸ¥äº‘æä¾›å•†ä»¥ç¡®å®šèŠ‚ç‚¹æ˜¯å¦å·²è¢«åˆ é™¤</p></li><li><p>è·¯ç”±æ§åˆ¶å™¨ï¼ˆRoute Controllerï¼‰ï¼šç”¨äºåœ¨åº•å±‚äº‘åŸºç¡€æ¶æ„ä¸­è®¾ç½®è·¯ç”±</p></li><li><p>æœåŠ¡æ§åˆ¶å™¨ï¼ˆService Controllerï¼‰ï¼šç”¨äºåˆ›å»ºã€æ›´æ–°å’Œåˆ é™¤äº‘æä¾›å•†è´Ÿè½½å‡è¡¡å™¨</p></li></ul></li></ul><h3 id="1-2-Node-ç»„ä»¶"><a href="#1-2-Node-ç»„ä»¶" class="headerlink" title="1.2 Node ç»„ä»¶"></a>1.2 Node ç»„ä»¶</h3><blockquote><p>èŠ‚ç‚¹ç»„ä»¶ä¼šåœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œè´Ÿè´£ç»´æŠ¤è¿è¡Œçš„ Pod å¹¶æä¾› Kubernetes è¿è¡Œç¯å¢ƒã€‚</p></blockquote><ul><li><p><strong>kubelet</strong></p><p>kubelet ä¼šåœ¨é›†ç¾¤ä¸­æ¯ä¸ªèŠ‚ç‚¹ï¼ˆnodeï¼‰ä¸Šè¿è¡Œã€‚ å®ƒä¿è¯å®¹å™¨ï¼ˆcontainersï¼‰éƒ½è¿è¡Œåœ¨ Pods ä¸­ã€‚</p><p>kubelet æ¥æ”¶ä¸€ç»„é€šè¿‡å„ç±»æœºåˆ¶æä¾›ç»™å®ƒçš„ PodSpecsï¼Œ ç¡®ä¿è¿™äº› PodSpecs ä¸­æè¿°çš„å®¹å™¨å¤„äºè¿è¡ŒçŠ¶æ€ä¸”å¥åº·ã€‚ kubelet ä¸ä¼šç®¡ç†ä¸æ˜¯ç”± Kubernetes åˆ›å»ºçš„å®¹å™¨ã€‚</p></li><li><p><strong>kube-proxy</strong></p><p>kube-proxyæ˜¯é›†ç¾¤ä¸­æ¯ä¸ªèŠ‚ç‚¹ï¼ˆnodeï¼‰ä¸Šæ‰€è¿è¡Œçš„ç½‘ç»œä»£ç†ï¼Œ å®ç° Kubernetes æœåŠ¡ï¼ˆServiceï¼‰æ¦‚å¿µçš„ä¸€éƒ¨åˆ†ã€‚</p><p>kube-proxy ç»´æŠ¤èŠ‚ç‚¹ä¸Šçš„ä¸€äº›ç½‘ç»œè§„åˆ™ï¼Œ è¿™äº›ç½‘ç»œè§„åˆ™ä¼šå…è®¸ä»é›†ç¾¤å†…éƒ¨æˆ–å¤–éƒ¨çš„ç½‘ç»œä¼šè¯ä¸ Pod è¿›è¡Œç½‘ç»œé€šä¿¡ã€‚</p><p>å¦‚æœæ“ä½œç³»ç»Ÿæä¾›äº†å¯ç”¨çš„æ•°æ®åŒ…è¿‡æ»¤å±‚ï¼Œåˆ™ kube-proxy ä¼šé€šè¿‡å®ƒæ¥å®ç°ç½‘ç»œè§„åˆ™ã€‚ å¦åˆ™ï¼Œkube-proxy ä»…åšæµé‡è½¬å‘ã€‚</p></li><li><p><strong>å®¹å™¨è¿è¡Œæ—¶ï¼ˆContainer Runtimeï¼‰</strong></p><p>å®¹å™¨è¿è¡Œç¯å¢ƒæ˜¯è´Ÿè´£è¿è¡Œå®¹å™¨çš„è½¯ä»¶ã€‚</p><p>Kubernetes æ”¯æŒè®¸å¤šå®¹å™¨è¿è¡Œç¯å¢ƒï¼Œä¾‹å¦‚ containerdã€ CRI-0ã€Docker ä»¥åŠ Kubernetes CRI çš„å…¶ä»–ä»»ä½•å®ç°ã€‚</p></li></ul><h3 id="1-3-æ’ä»¶-Addons"><a href="#1-3-æ’ä»¶-Addons" class="headerlink" title="1.3 æ’ä»¶ (Addons)"></a>1.3 æ’ä»¶ (Addons)</h3><ul><li><p><strong>DNS</strong></p><p>å°½ç®¡å…¶ä»–æ’ä»¶éƒ½å¹¶éä¸¥æ ¼æ„ä¹‰ä¸Šçš„å¿…éœ€ç»„ä»¶ï¼Œä½†å‡ ä¹æ‰€æœ‰ Kubernetes é›†ç¾¤éƒ½åº”è¯¥æœ‰é›†ç¾¤ DNSå› ä¸ºå¾ˆå¤šç¤ºä¾‹éƒ½éœ€è¦ DNS æœåŠ¡ã€‚</p></li><li><p><strong>Web ç•Œé¢ï¼ˆä»ªè¡¨ç›˜ï¼‰</strong></p><p>Dashboard æ˜¯ Kubernetes é›†ç¾¤çš„é€šç”¨çš„ã€åŸºäº Web çš„ç”¨æˆ·ç•Œé¢ã€‚ å®ƒä½¿ç”¨æˆ·å¯ä»¥ç®¡ç†é›†ç¾¤ä¸­è¿è¡Œçš„åº”ç”¨ç¨‹åºä»¥åŠé›†ç¾¤æœ¬èº«ï¼Œ å¹¶è¿›è¡Œæ•…éšœæ’é™¤ã€‚</p></li><li><p><strong>å®¹å™¨èµ„æºç›‘æ§</strong></p><p>å®¹å™¨èµ„æºç›‘æ§å°†å…³äºå®¹å™¨çš„ä¸€äº›å¸¸è§çš„æ—¶é—´åºåˆ—åº¦é‡å€¼ä¿å­˜åˆ°ä¸€ä¸ªé›†ä¸­çš„æ•°æ®åº“ä¸­ï¼Œ å¹¶æä¾›æµè§ˆè¿™äº›æ•°æ®çš„ç•Œé¢ã€‚</p></li><li><p><strong>é›†ç¾¤å±‚é¢æ—¥å¿—</strong></p><p>é›†ç¾¤å±‚é¢æ—¥å¿—æœºåˆ¶è´Ÿè´£å°†å®¹å™¨çš„æ—¥å¿—æ•°æ®ä¿å­˜åˆ°ä¸€ä¸ªé›†ä¸­çš„æ—¥å¿—å­˜å‚¨ä¸­ï¼Œ è¿™ç§é›†ä¸­æ—¥å¿—å­˜å‚¨æä¾›æœç´¢å’Œæµè§ˆæ¥å£ã€‚</p></li></ul><h2 id="2-é›†ç¾¤æ¶æ„è¯¦ç»†"><a href="#2-é›†ç¾¤æ¶æ„è¯¦ç»†" class="headerlink" title="2 é›†ç¾¤æ¶æ„è¯¦ç»†"></a>2 é›†ç¾¤æ¶æ„è¯¦ç»†</h2><p><img src="https://www.naste.top:9000/images/spaces%2F-M5xTVjmK7ax94c8ZQcm%2Fuploads%2Fgit-blob-fa39039aaff07ee732a917394740cb79a4a60a64%2Fk8s_architecture.png" alt="img"></p><ul><li><strong>æ€»ç»“</strong><ul><li>Kubernetes é›†ç¾¤ç”±å¤šä¸ªèŠ‚ç‚¹ç»„æˆï¼ŒèŠ‚ç‚¹åˆ†ä¸ºä¸¤ç±»ï¼šä¸€ç±»æ˜¯å±äºç®¡ç†å¹³é¢çš„ä¸»èŠ‚ç‚¹/æ§åˆ¶èŠ‚ç‚¹ï¼ˆMaster Nodeï¼‰ï¼›ä¸€ç±»æ˜¯å±äºè¿è¡Œå¹³é¢çš„å·¥ä½œèŠ‚ç‚¹ï¼ˆWorker Nodeï¼‰ã€‚æ˜¾ç„¶ï¼Œå¤æ‚çš„å·¥ä½œè‚¯å®šéƒ½äº¤ç»™æ§åˆ¶èŠ‚ç‚¹å»åšäº†ï¼Œå·¥ä½œèŠ‚ç‚¹è´Ÿè´£æä¾›ç¨³å®šçš„æ“ä½œæ¥å£å’Œèƒ½åŠ›æŠ½è±¡å³å¯ã€‚</li></ul></li></ul><h2 id="3-é›†ç¾¤æ­å»º-é‡ç‚¹"><a href="#3-é›†ç¾¤æ­å»º-é‡ç‚¹" class="headerlink" title="3 é›†ç¾¤æ­å»º[é‡ç‚¹]"></a>3 é›†ç¾¤æ­å»º[é‡ç‚¹]</h2><ul><li><strong>minikube</strong><br>åªæ˜¯ä¸€ä¸ª K8S é›†ç¾¤æ¨¡æ‹Ÿå™¨ï¼Œåªæœ‰ä¸€ä¸ªèŠ‚ç‚¹çš„é›†ç¾¤ï¼Œåªä¸ºæµ‹è¯•ç”¨ï¼Œmaster å’Œ worker éƒ½åœ¨ä¸€èµ·ã€‚</li><li><strong>è£¸æœºå®‰è£…</strong><br>è‡³å°‘éœ€è¦ä¸¤å°æœºå™¨ï¼ˆä¸»èŠ‚ç‚¹ã€å·¥ä½œèŠ‚ç‚¹ä¸ªä¸€å°ï¼‰ï¼Œéœ€è¦è‡ªå·±å®‰è£… Kubernetes ç»„ä»¶ï¼Œé…ç½®ä¼šç¨å¾®éº»çƒ¦ç‚¹ã€‚<br>ç¼ºç‚¹ï¼šé…ç½®éº»çƒ¦ï¼Œç¼ºå°‘ç”Ÿæ€æ”¯æŒï¼Œä¾‹å¦‚è´Ÿè½½å‡è¡¡å™¨ã€äº‘å­˜å‚¨ã€‚</li><li><strong>ç›´æ¥ç”¨äº‘å¹³å° Kubernetes</strong><br>å¯è§†åŒ–æ­å»ºï¼Œåªéœ€ç®€å•å‡ æ­¥å°±å¯ä»¥åˆ›å»ºå¥½ä¸€ä¸ªé›†ç¾¤ã€‚<br>ä¼˜ç‚¹ï¼šå®‰è£…ç®€å•ï¼Œç”Ÿæ€é½å…¨ï¼Œè´Ÿè½½å‡è¡¡å™¨ã€å­˜å‚¨ç­‰éƒ½ç»™ä½ é…å¥—å¥½ï¼Œç®€å•æ“ä½œå°±æå®š</li><li><p><strong>k3s</strong></p><p>å®‰è£…ç®€å•ï¼Œè„šæœ¬è‡ªåŠ¨å®Œæˆã€‚</p><p>ä¼˜ç‚¹ï¼šè½»é‡çº§ï¼Œé…ç½®è¦æ±‚ä½ï¼Œå®‰è£…ç®€å•ï¼Œç”Ÿæ€é½å…¨ã€‚</p></li></ul><h3 id="3-1-minikube"><a href="#3-1-minikube" class="headerlink" title="3.1 minikube"></a>3.1 minikube</h3><p><img src="https://www.naste.top:9000/images/image-20221010211512078-5407715.png" alt="image-20221010211512078"></p><h3 id="3-2-è£¸æœºå®‰è£…"><a href="#3-2-è£¸æœºå®‰è£…" class="headerlink" title="3.2 è£¸æœºå®‰è£…"></a>3.2 è£¸æœºå®‰è£…</h3><h4 id="0-ç¯å¢ƒå‡†å¤‡"><a href="#0-ç¯å¢ƒå‡†å¤‡" class="headerlink" title="0 ç¯å¢ƒå‡†å¤‡"></a>0 ç¯å¢ƒå‡†å¤‡</h4><ul><li>èŠ‚ç‚¹æ•°é‡: 3 å°è™šæ‹Ÿæœº centos7</li><li>ç¡¬ä»¶é…ç½®: 2Gæˆ–æ›´å¤šçš„RAMï¼Œ2ä¸ªCPUæˆ–æ›´å¤šçš„CPUï¼Œç¡¬ç›˜è‡³å°‘30G ä»¥ä¸Š</li><li>ç½‘ç»œè¦æ±‚: å¤šä¸ªèŠ‚ç‚¹ä¹‹é—´ç½‘ç»œäº’é€šï¼Œæ¯ä¸ªèŠ‚ç‚¹èƒ½è®¿é—®å¤–ç½‘</li></ul><h4 id="1-é›†ç¾¤è§„åˆ’"><a href="#1-é›†ç¾¤è§„åˆ’" class="headerlink" title="1 é›†ç¾¤è§„åˆ’"></a>1 é›†ç¾¤è§„åˆ’</h4><ul><li>k8s-node1ï¼š10.15.0.5</li><li>k8s-node2ï¼š10.15.0.6</li><li>k8s-node3ï¼š10.15.0.7</li></ul><h4 id="2-è®¾ç½®ä¸»æœºå"><a href="#2-è®¾ç½®ä¸»æœºå" class="headerlink" title="2 è®¾ç½®ä¸»æœºå"></a>2 è®¾ç½®ä¸»æœºå</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hostnamectl set-hostname k8s-node1  </span><br><span class="line">hostnamectl set-hostname k8s-node2</span><br><span class="line">hostnamectl set-hostname k8s-node3</span><br></pre></td></tr></table></figure><h4 id="3-åŒæ­¥-hosts-æ–‡ä»¶"><a href="#3-åŒæ­¥-hosts-æ–‡ä»¶" class="headerlink" title="3 åŒæ­¥ hosts æ–‡ä»¶"></a>3 åŒæ­¥ hosts æ–‡ä»¶</h4><blockquote><p> å¦‚æœ DNS ä¸æ”¯æŒä¸»æœºåç§°è§£æï¼Œè¿˜éœ€è¦åœ¨æ¯å°æœºå™¨çš„ <code>/etc/hosts</code> æ–‡ä»¶ä¸­æ·»åŠ ä¸»æœºåå’Œ IP çš„å¯¹åº”å…³ç³»ï¼š</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cat &gt;&gt; /etc/hosts &lt;&lt;EOF</span><br><span class="line">10.15.0.5 k8s-node1</span><br><span class="line">10.15.0.6 k8s-node2</span><br><span class="line">10.15.0.7 k8s-node3</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h4 id="4-å…³é—­é˜²ç«å¢™"><a href="#4-å…³é—­é˜²ç«å¢™" class="headerlink" title="4 å…³é—­é˜²ç«å¢™"></a>4 å…³é—­é˜²ç«å¢™</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop firewalld &amp;&amp; systemctl disable firewalld</span><br></pre></td></tr></table></figure><h4 id="5-å…³é—­-SELINUX"><a href="#5-å…³é—­-SELINUX" class="headerlink" title="5 å…³é—­ SELINUX"></a>5 å…³é—­ SELINUX</h4><blockquote><p>æ³¨æ„: ARM æ¶æ„è¯·å‹¿æ‰§è¡Œ,æ‰§è¡Œä¼šå‡ºç° ip æ— æ³•è·å–é—®é¢˜!</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setenforce 0 &amp;&amp; sed -i &#x27;s/SELINUX=enforcing/SELINUX=disabled/g&#x27; /etc/selinux/config</span><br></pre></td></tr></table></figure><h4 id="6-å…³é—­-swap-åˆ†åŒº"><a href="#6-å…³é—­-swap-åˆ†åŒº" class="headerlink" title="6 å…³é—­ swap åˆ†åŒº"></a>6 å…³é—­ swap åˆ†åŒº</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">swapoff -a &amp;&amp; sed -ri &#x27;s/.*swap.*/#&amp;/&#x27; /etc/fstab</span><br></pre></td></tr></table></figure><h4 id="7-åŒæ­¥æ—¶é—´"><a href="#7-åŒæ­¥æ—¶é—´" class="headerlink" title="7 åŒæ­¥æ—¶é—´"></a>7 åŒæ­¥æ—¶é—´</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install ntpdate -y</span><br><span class="line">ntpdate time.windows.com</span><br></pre></td></tr></table></figure><h4 id="8-å®‰è£…-containerd"><a href="#8-å®‰è£…-containerd" class="headerlink" title="8 å®‰è£… containerd"></a>8 å®‰è£… containerd</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å®‰è£… yum-config-manager ç›¸å…³ä¾èµ–</span></span><br><span class="line">yum install -y yum-utils device-mapper-persistent-data lvm2</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ·»åŠ  containerd yum æº</span></span><br><span class="line">yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å®‰è£… containerd</span></span><br><span class="line">yum install  -y containerd.io cri-tools  </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é…ç½® containerd</span></span><br><span class="line">cat &gt;  /etc/containerd/config.toml &lt;&lt;EOF</span><br><span class="line">disabled_plugins = [&quot;restart&quot;]</span><br><span class="line">[plugins.linux]</span><br><span class="line">shim_debug = true</span><br><span class="line">[plugins.cri.registry.mirrors.&quot;docker.io&quot;]</span><br><span class="line">endpoint = [&quot;https://frz7i079.mirror.aliyuncs.com&quot;]</span><br><span class="line">[plugins.cri]</span><br><span class="line">sandbox_image = &quot;registry.aliyuncs.com/google_containers/pause:3.2&quot;</span><br><span class="line">EOF</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¯åŠ¨ containerd æœåŠ¡ å¹¶ å¼€æœºé…ç½®è‡ªå¯åŠ¨</span></span><br><span class="line">systemctl enable containerd &amp;&amp; systemctl start containerd &amp;&amp; systemctl status containerd </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é…ç½® containerd é…ç½®</span></span><br><span class="line">cat &gt; /etc/modules-load.d/containerd.conf &lt;&lt;EOF</span><br><span class="line">overlay</span><br><span class="line">br_netfilter</span><br><span class="line">EOF</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é…ç½® k8s ç½‘ç»œé…ç½®</span></span><br><span class="line">cat  &gt; /etc/sysctl.d/k8s.conf &lt;&lt;EOF</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="line">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="line">net.ipv4.ip_forward = 1</span><br><span class="line">EOF</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åŠ è½½ overlay br_netfilter æ¨¡å—</span></span><br><span class="line">modprobe overlay</span><br><span class="line">modprobe br_netfilter</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹å½“å‰é…ç½®æ˜¯å¦ç”Ÿæ•ˆ</span></span><br><span class="line">sysctl -p /etc/sysctl.d/k8s.conf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é‡å¯ä¸‹ä¸‰å°æœºå™¨</span></span><br><span class="line">reboot</span><br></pre></td></tr></table></figure><h4 id="9-æ·»åŠ æº"><a href="#9-æ·»åŠ æº" class="headerlink" title="9 æ·»åŠ æº"></a>9 æ·»åŠ æº</h4><ul><li>æŸ¥çœ‹æº</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum repolist</span><br></pre></td></tr></table></figure><ul><li>æ·»åŠ æº x86</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt;EOF &gt; kubernetes.repo</span><br><span class="line">[kubernetes]</span><br><span class="line">name=Kubernetes</span><br><span class="line">baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line">gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">mv kubernetes.repo /etc/yum.repos.d/</span><br></pre></td></tr></table></figure><ul><li>æ·»åŠ æº ARM</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt; EOF &gt; kubernetes.repo </span><br><span class="line">[kubernetes]</span><br><span class="line">name=Kubernetes</span><br><span class="line">baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-aarch64</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line">gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">mv kubernetes.repo /etc/yum.repos.d/</span><br></pre></td></tr></table></figure><h4 id="11-å®‰è£…-k8s"><a href="#11-å®‰è£…-k8s" class="headerlink" title="11 å®‰è£… k8s"></a>11 å®‰è£… k8s</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å®‰è£…æœ€æ–°ç‰ˆæœ¬</span></span><br><span class="line">yum install -y kubelet kubeadm kubectl</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŒ‡å®šç‰ˆæœ¬å®‰è£…</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">yum install -y kubelet-1.26.0 kubectl-1.26.0 kubeadm-1.26.0</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¯åŠ¨ kubelet</span></span><br><span class="line">sudo systemctl enable kubelet &amp;&amp; sudo systemctl start kubelet &amp;&amp; sudo systemctl status kubelet</span><br></pre></td></tr></table></figure><h4 id="12-åˆå§‹åŒ–é›†ç¾¤"><a href="#12-åˆå§‹åŒ–é›†ç¾¤" class="headerlink" title="12 åˆå§‹åŒ–é›†ç¾¤"></a>12 åˆå§‹åŒ–é›†ç¾¤</h4><ul><li><strong><code>æ³¨æ„: åˆå§‹åŒ– k8s é›†ç¾¤ä»…ä»…éœ€è¦å†åœ¨ master èŠ‚ç‚¹è¿›è¡Œé›†ç¾¤åˆå§‹åŒ–!</code></strong></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubeadm init \</span><br><span class="line">--apiserver-advertise-address=192.168.40.40 \</span><br><span class="line">--pod-network-cidr=10.244.0.0/16 \</span><br><span class="line">--image-repository registry.aliyuncs.com/google_containers </span><br></pre></td></tr></table></figure><h4 id="13-é…ç½®é›†ç¾¤ç½‘ç»œ"><a href="#13-é…ç½®é›†ç¾¤ç½‘ç»œ" class="headerlink" title="13 é…ç½®é›†ç¾¤ç½‘ç»œ"></a>13 é…ç½®é›†ç¾¤ç½‘ç»œ</h4><blockquote><p>åˆ›å»ºé…ç½®: kube-flannel.yml ,æ‰§è¡Œ kubectl apply -f kube-flannel.yml</p></blockquote><ul><li><code>æ³¨æ„: åªåœ¨ä¸»èŠ‚ç‚¹æ‰§è¡Œå³å¯!</code></li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Namespace</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kube-flannel</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">pod-security.kubernetes.io/enforce:</span> <span class="string">privileged</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">flannel</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">pods</span></span><br><span class="line">  <span class="attr">verbs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">nodes</span></span><br><span class="line">  <span class="attr">verbs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">watch</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">nodes/status</span></span><br><span class="line">  <span class="attr">verbs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">patch</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">flannel</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">flannel</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">flannel</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-flannel</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">flannel</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-flannel</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kube-flannel-cfg</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-flannel</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">tier:</span> <span class="string">node</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">flannel</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">cni-conf.json:</span> <span class="string">|</span></span><br><span class="line"><span class="string">    &#123;</span></span><br><span class="line"><span class="string">      &quot;name&quot;: &quot;cbr0&quot;,</span></span><br><span class="line"><span class="string">      &quot;cniVersion&quot;: &quot;0.3.1&quot;,</span></span><br><span class="line"><span class="string">      &quot;plugins&quot;: [</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">          &quot;type&quot;: &quot;flannel&quot;,</span></span><br><span class="line"><span class="string">          &quot;delegate&quot;: &#123;</span></span><br><span class="line"><span class="string">            &quot;hairpinMode&quot;: true,</span></span><br><span class="line"><span class="string">            &quot;isDefaultGateway&quot;: true</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">          &quot;type&quot;: &quot;portmap&quot;,</span></span><br><span class="line"><span class="string">          &quot;capabilities&quot;: &#123;</span></span><br><span class="line"><span class="string">            &quot;portMappings&quot;: true</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      ]</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"></span>  <span class="attr">net-conf.json:</span> <span class="string">|</span></span><br><span class="line"><span class="string">    &#123;</span></span><br><span class="line"><span class="string">      &quot;Network&quot;: &quot;10.244.0.0/16&quot;,</span></span><br><span class="line"><span class="string">      &quot;Backend&quot;: &#123;</span></span><br><span class="line"><span class="string">        &quot;Type&quot;: &quot;vxlan&quot;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"></span><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">DaemonSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kube-flannel-ds</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-flannel</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">tier:</span> <span class="string">node</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">flannel</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">flannel</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">tier:</span> <span class="string">node</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">flannel</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">affinity:</span></span><br><span class="line">        <span class="attr">nodeAffinity:</span></span><br><span class="line">          <span class="attr">requiredDuringSchedulingIgnoredDuringExecution:</span></span><br><span class="line">            <span class="attr">nodeSelectorTerms:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">matchExpressions:</span></span><br><span class="line">              <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">kubernetes.io/os</span></span><br><span class="line">                <span class="attr">operator:</span> <span class="string">In</span></span><br><span class="line">                <span class="attr">values:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">linux</span></span><br><span class="line">      <span class="attr">hostNetwork:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">priorityClassName:</span> <span class="string">system-node-critical</span></span><br><span class="line">      <span class="attr">tolerations:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">operator:</span> <span class="string">Exists</span></span><br><span class="line">        <span class="attr">effect:</span> <span class="string">NoSchedule</span></span><br><span class="line">      <span class="attr">serviceAccountName:</span> <span class="string">flannel</span></span><br><span class="line">      <span class="attr">initContainers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">install-cni-plugin</span></span><br><span class="line">       <span class="comment">#image: flannelcni/flannel-cni-plugin:v1.1.0 for ppc64le and mips64le (dockerhub limitations may apply)</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">docker.io/rancher/mirrored-flannelcni-flannel-cni-plugin:v1.1.0</span></span><br><span class="line">        <span class="attr">command:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">cp</span></span><br><span class="line">        <span class="attr">args:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">-f</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">/flannel</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">/opt/cni/bin/flannel</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">cni-plugin</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/opt/cni/bin</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">install-cni</span></span><br><span class="line">       <span class="comment">#image: flannelcni/flannel:v0.20.2 for ppc64le and mips64le (dockerhub limitations may apply)</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">docker.io/rancher/mirrored-flannelcni-flannel:v0.20.2</span></span><br><span class="line">        <span class="attr">command:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">cp</span></span><br><span class="line">        <span class="attr">args:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">-f</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">/etc/kube-flannel/cni-conf.json</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">/etc/cni/net.d/10-flannel.conflist</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">cni</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/etc/cni/net.d</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">flannel-cfg</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/etc/kube-flannel/</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">kube-flannel</span></span><br><span class="line">       <span class="comment">#image: flannelcni/flannel:v0.20.2 for ppc64le and mips64le (dockerhub limitations may apply)</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">docker.io/rancher/mirrored-flannelcni-flannel:v0.20.2</span></span><br><span class="line">        <span class="attr">command:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">/opt/bin/flanneld</span></span><br><span class="line">        <span class="attr">args:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">--ip-masq</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">--kube-subnet-mgr</span></span><br><span class="line">        <span class="attr">resources:</span></span><br><span class="line">          <span class="attr">requests:</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">&quot;100m&quot;</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">&quot;50Mi&quot;</span></span><br><span class="line">          <span class="attr">limits:</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">&quot;100m&quot;</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">&quot;50Mi&quot;</span></span><br><span class="line">        <span class="attr">securityContext:</span></span><br><span class="line">          <span class="attr">privileged:</span> <span class="literal">false</span></span><br><span class="line">          <span class="attr">capabilities:</span></span><br><span class="line">            <span class="attr">add:</span> [<span class="string">&quot;NET_ADMIN&quot;</span>, <span class="string">&quot;NET_RAW&quot;</span>]</span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">POD_NAME</span></span><br><span class="line">          <span class="attr">valueFrom:</span></span><br><span class="line">            <span class="attr">fieldRef:</span></span><br><span class="line">              <span class="attr">fieldPath:</span> <span class="string">metadata.name</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">POD_NAMESPACE</span></span><br><span class="line">          <span class="attr">valueFrom:</span></span><br><span class="line">            <span class="attr">fieldRef:</span></span><br><span class="line">              <span class="attr">fieldPath:</span> <span class="string">metadata.namespace</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">EVENT_QUEUE_DEPTH</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">&quot;5000&quot;</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">run</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/run/flannel</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">flannel-cfg</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/etc/kube-flannel/</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">xtables-lock</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/run/xtables.lock</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">run</span></span><br><span class="line">        <span class="attr">hostPath:</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">/run/flannel</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">cni-plugin</span></span><br><span class="line">        <span class="attr">hostPath:</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">/opt/cni/bin</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">cni</span></span><br><span class="line">        <span class="attr">hostPath:</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">/etc/cni/net.d</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">flannel-cfg</span></span><br><span class="line">        <span class="attr">configMap:</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">kube-flannel-cfg</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">xtables-lock</span></span><br><span class="line">        <span class="attr">hostPath:</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">/run/xtables.lock</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">FileOrCreate</span></span><br></pre></td></tr></table></figure><h4 id="14-æŸ¥çœ‹é›†ç¾¤çŠ¶æ€"><a href="#14-æŸ¥çœ‹é›†ç¾¤çŠ¶æ€" class="headerlink" title="14 æŸ¥çœ‹é›†ç¾¤çŠ¶æ€"></a>14 æŸ¥çœ‹é›†ç¾¤çŠ¶æ€</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹é›†ç¾¤èŠ‚ç‚¹çŠ¶æ€ å…¨éƒ¨ä¸º Ready ä»£è¡¨é›†ç¾¤æ­å»ºæˆåŠŸ</span></span><br><span class="line">kubectl get nodes</span><br><span class="line">NAME        STATUS   ROLES           AGE   VERSION</span><br><span class="line">k8s-node1   Ready    control-plane   21h   v1.26.0</span><br><span class="line">k8s-node2   Ready    &lt;none&gt;          21h   v1.26.0</span><br><span class="line">k8s-node3   Ready    &lt;none&gt;          21h   v1.26.0</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹é›†ç¾¤ç³»ç»Ÿ pod è¿è¡Œæƒ…å†µ,ä¸‹é¢æ‰€æœ‰ pod çŠ¶æ€ä¸º Running ä»£è¡¨é›†ç¾¤å¯ç”¨</span></span><br><span class="line">kubectl get pod -A</span><br><span class="line">NAMESPACE      NAME                                READY   STATUS    RESTARTS   AGE</span><br><span class="line">default        nginx                               1/1     Running   0          21h</span><br><span class="line">kube-flannel   kube-flannel-ds-gtq49               1/1     Running   0          21h</span><br><span class="line">kube-flannel   kube-flannel-ds-qpdl6               1/1     Running   0          21h</span><br><span class="line">kube-flannel   kube-flannel-ds-ttxjb               1/1     Running   0          21h</span><br><span class="line">kube-system    coredns-5bbd96d687-p7q2x            1/1     Running   0          21h</span><br><span class="line">kube-system    coredns-5bbd96d687-rzcnz            1/1     Running   0          21h</span><br><span class="line">kube-system    etcd-k8s-node1                      1/1     Running   0          21h</span><br><span class="line">kube-system    kube-apiserver-k8s-node1            1/1     Running   0          21h</span><br><span class="line">kube-system    kube-controller-manager-k8s-node1   1/1     Running   0          21h</span><br><span class="line">kube-system    kube-proxy-mtsbp                    1/1     Running   0          21h</span><br><span class="line">kube-system    kube-proxy-v2jfs                    1/1     Running   0          21h</span><br><span class="line">kube-system    kube-proxy-x6vhn                    1/1     Running   0          21h</span><br><span class="line">kube-system    kube-scheduler-k8s-node1            1/1     Running   0          21h</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ¯éš”ä¸€ç§’ï¼ŒæŸ¥çœ‹æŸä¸ªå‘½ä»¤çŠ¶æ€</span></span><br><span class="line">watch -n 1 -d æŒ‡å®šå‘½ä»¤</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ¯éš”ä¸€ç§’ï¼ŒæŸ¥çœ‹podçŠ¶æ€</span></span><br><span class="line">watch -n 1 -d kubectl get pod -A</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ¯éš”ä¸€ç§’ï¼ŒæŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€</span></span><br><span class="line">watch -n 1 -d kubectl get nodes</span><br></pre></td></tr></table></figure><hr><h1 id="ç¬¬ä¸‰ç« -Pod-amp-Container"><a href="#ç¬¬ä¸‰ç« -Pod-amp-Container" class="headerlink" title="ç¬¬ä¸‰ç«  Pod &amp; Container"></a>ç¬¬ä¸‰ç«  Pod &amp; Container</h1><p><strong>IDEAä¸­ä½¿ç”¨kubernetesæ’ä»¶å¿«é€Ÿç”Ÿæˆpodé…ç½®æ–‡ä»¶ï¼š<a href="https://www.naste.top:1024/posts/2266788211.html">https://www.naste.top:1024/posts/2266788211.html</a></strong></p><ul><li>ä»€ä¹ˆæ˜¯ Pod</li><li>Pod åŸºæœ¬æ“ä½œ</li><li>Pod çš„ Labels</li><li>Pod çš„ ç”Ÿå‘½å‘¨æœŸ</li><li>Container ç‰¹æ€§</li><li>Pod çš„èµ„æºé™åˆ¶</li><li>Pod ä¸­ Init å®¹å™¨</li><li>èŠ‚ç‚¹äº²å’Œæ€§åˆ†é… Pod</li></ul><h2 id="1-ä»€ä¹ˆæ˜¯-Pod"><a href="#1-ä»€ä¹ˆæ˜¯-Pod" class="headerlink" title="1 ä»€ä¹ˆæ˜¯ Pod"></a>1 ä»€ä¹ˆæ˜¯ Pod</h2><blockquote><p>æ‘˜å–å®˜ç½‘: <a href="https://kubernetes.io/zh-cn/docs/concepts/workloads/pods/#working-with-pods">https://kubernetes.io/zh-cn/docs/concepts/workloads/pods/#working-with-pods</a></p></blockquote><h3 id="1-1-ç®€ä»‹"><a href="#1-1-ç®€ä»‹" class="headerlink" title="1.1 ç®€ä»‹"></a>1.1 <strong>ç®€ä»‹</strong></h3><p>Pod æ˜¯å¯ä»¥åœ¨ Kubernetes ä¸­<strong>åˆ›å»ºå’Œç®¡ç†çš„ã€æœ€å°çš„å¯éƒ¨ç½²çš„è®¡ç®—å•å…ƒ</strong>ã€‚<strong>Pod</strong>ï¼ˆå°±åƒåœ¨é²¸é±¼èšæˆ–è€…è±Œè±†èšä¸­ï¼‰<strong>æ˜¯ä¸€ç»„ï¼ˆä¸€ä¸ªæˆ–å¤šä¸ªï¼‰å®¹å™¨</strong>ï¼› è¿™äº›å®¹å™¨å…±äº«å­˜å‚¨ã€ç½‘ç»œã€ä»¥åŠæ€æ ·è¿è¡Œè¿™äº›å®¹å™¨çš„å£°æ˜ã€‚ Pod ä¸­çš„<strong>å†…å®¹æ€»æ˜¯å¹¶ç½®ï¼ˆcolocatedï¼‰çš„å¹¶ä¸”ä¸€åŒè°ƒåº¦ï¼Œåœ¨å…±äº«çš„ä¸Šä¸‹æ–‡ä¸­è¿è¡Œ</strong>ã€‚ç®€è¨€ä¹‹å¦‚æœç”¨ Docker çš„æœ¯è¯­æ¥æè¿°ï¼Œ<strong>Pod ç±»ä¼¼äºå…±äº«åå­—ç©ºé—´å¹¶å…±äº«æ–‡ä»¶ç³»ç»Ÿå·çš„ä¸€ç»„å®¹å™¨ã€‚</strong></p><p><code>å®šä¹‰: Pod å°±æ˜¯ç”¨æ¥ç®¡ç†ä¸€ç»„(ä¸€ä¸ª|å¤šä¸ª)å®¹å™¨çš„é›†åˆ ç‰¹ç‚¹: å…±äº«ç½‘ç»œ å…±äº«å­˜å‚¨ å…±äº«ä¸Šä¸‹æ–‡ç¯å¢ƒ</code></p><h3 id="1-2-Pod-æ€æ ·ç®¡ç†å¤šä¸ªå®¹å™¨"><a href="#1-2-Pod-æ€æ ·ç®¡ç†å¤šä¸ªå®¹å™¨" class="headerlink" title="1.2 Pod æ€æ ·ç®¡ç†å¤šä¸ªå®¹å™¨?"></a>1.2 Pod æ€æ ·ç®¡ç†å¤šä¸ªå®¹å™¨?</h3><p>Pod ä¸­çš„å®¹å™¨è¢«è‡ªåŠ¨å®‰æ’åˆ°é›†ç¾¤ä¸­çš„åŒä¸€ç‰©ç†æœºæˆ–è™šæ‹Ÿæœºä¸Šï¼Œå¹¶å¯ä»¥ä¸€èµ·è¿›è¡Œè°ƒåº¦ã€‚ å®¹å™¨ä¹‹é—´å¯ä»¥å…±äº«èµ„æºå’Œä¾èµ–ã€å½¼æ­¤é€šä¿¡ã€åè°ƒä½•æ—¶ä»¥åŠä½•ç§æ–¹å¼ç»ˆæ­¢è‡ªèº«ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½æœ‰ä¸€ä¸ªå®¹å™¨ï¼Œä¸ºå…±äº«å·ä¸­çš„æ–‡ä»¶æä¾› Web æœåŠ¡å™¨æ”¯æŒï¼Œä»¥åŠä¸€ä¸ªå•ç‹¬çš„ â€œè¾¹è½¦ (sidercar)â€ å®¹å™¨è´Ÿè´£ä»è¿œç«¯æ›´æ–°è¿™äº›æ–‡ä»¶ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://www.naste.top:9000/images/image-20221227143250604.png" alt="image-20221227143250604"></p><h3 id="1-3-å¦‚ä½•ä½¿ç”¨-Pod"><a href="#1-3-å¦‚ä½•ä½¿ç”¨-Pod" class="headerlink" title="1.3 å¦‚ä½•ä½¿ç”¨ Pod?"></a>1.3 å¦‚ä½•ä½¿ç”¨ Pod?</h3><p>é€šå¸¸ä½ ä¸éœ€è¦ç›´æ¥åˆ›å»º Podï¼Œç”šè‡³å•å®ä¾‹ Podã€‚ ç›¸åï¼Œä½ ä¼šä½¿ç”¨è¯¸å¦‚ Deployment æˆ– Job è¿™ç±»å·¥ä½œè´Ÿè½½èµ„æºæ¥åˆ›å»º Podã€‚ å¦‚æœ Pod éœ€è¦è·Ÿè¸ªçŠ¶æ€ï¼Œå¯ä»¥è€ƒè™‘ StatefulSet èµ„æºã€‚</p><p>Kubernetes é›†ç¾¤ä¸­çš„ Pod ä¸»è¦æœ‰ä¸¤ç§ç”¨æ³•ï¼š</p><ul><li><strong>è¿è¡Œå•ä¸ªå®¹å™¨çš„ Pod</strong>ã€‚â€æ¯ä¸ª Pod ä¸€ä¸ªå®¹å™¨â€ æ¨¡å‹æ˜¯æœ€å¸¸è§çš„ Kubernetes ç”¨ä¾‹ï¼› åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥å°† Pod çœ‹ä½œå•ä¸ªå®¹å™¨çš„åŒ…è£…å™¨ï¼Œå¹¶ä¸” Kubernetes ç›´æ¥ç®¡ç† Podï¼Œè€Œä¸æ˜¯å®¹å™¨ã€‚</li><li><strong>è¿è¡Œå¤šä¸ªååŒå·¥ä½œçš„å®¹å™¨ çš„ Pod</strong>ã€‚ Pod å¯èƒ½å°è£…ç”±å¤šä¸ªç´§å¯†è€¦åˆä¸”éœ€è¦å…±äº«èµ„æºçš„å…±å¤„å®¹å™¨ç»„æˆçš„åº”ç”¨ç¨‹åºã€‚ è¿™äº›ä½äºåŒä¸€ä½ç½®çš„å®¹å™¨å¯èƒ½å½¢æˆå•ä¸ªå†…èšçš„æœåŠ¡å•å…ƒ â€”â€” ä¸€ä¸ªå®¹å™¨å°†æ–‡ä»¶ä»å…±äº«å·æä¾›ç»™å…¬ä¼—ï¼Œ è€Œå¦ä¸€ä¸ªå•ç‹¬çš„ â€œè¾¹è½¦â€ï¼ˆsidecarï¼‰å®¹å™¨åˆ™åˆ·æ–°æˆ–æ›´æ–°è¿™äº›æ–‡ä»¶ã€‚ Pod å°†è¿™äº›å®¹å™¨å’Œå­˜å‚¨èµ„æºæ‰“åŒ…ä¸ºä¸€ä¸ªå¯ç®¡ç†çš„å®ä½“ã€‚</li></ul><p><strong>è¯´æ˜: </strong></p><ul><li>å°†å¤šä¸ªå¹¶ç½®ã€åŒç®¡çš„å®¹å™¨ç»„ç»‡åˆ°ä¸€ä¸ª Pod ä¸­æ˜¯ä¸€ç§ç›¸å¯¹é«˜çº§çš„ä½¿ç”¨åœºæ™¯ã€‚ åªæœ‰åœ¨ä¸€äº›åœºæ™¯ä¸­ï¼Œå®¹å™¨ä¹‹é—´ç´§å¯†å…³è”æ—¶ä½ æ‰åº”è¯¥ä½¿ç”¨è¿™ç§æ¨¡å¼ã€‚</li><li>æ¯ä¸ª Pod éƒ½æ—¨åœ¨è¿è¡Œç»™å®šåº”ç”¨ç¨‹åºçš„å•ä¸ªå®ä¾‹ã€‚å¦‚æœå¸Œæœ›æ¨ªå‘æ‰©å±•åº”ç”¨ç¨‹åº ï¼ˆä¾‹å¦‚ï¼Œè¿è¡Œå¤šä¸ªå®ä¾‹ä»¥æä¾›æ›´å¤šçš„èµ„æºï¼‰ï¼Œåˆ™åº”è¯¥ä½¿ç”¨å¤šä¸ª Podï¼Œæ¯ä¸ªå®ä¾‹ä½¿ç”¨ä¸€ä¸ª Podã€‚ åœ¨ Kubernetes ä¸­ï¼Œè¿™é€šå¸¸è¢«ç§°ä¸º<strong>å‰¯æœ¬ï¼ˆReplicationï¼‰</strong>ã€‚ é€šå¸¸ä½¿ç”¨ä¸€ç§å·¥ä½œè´Ÿè½½èµ„æºåŠå…¶æ§åˆ¶å™¨æ¥åˆ›å»ºå’Œç®¡ç†ä¸€ç»„ Pod å‰¯æœ¬ã€‚</li></ul><h2 id="2-Pod-åŸºæœ¬æ“ä½œ"><a href="#2-Pod-åŸºæœ¬æ“ä½œ" class="headerlink" title="2 Pod åŸºæœ¬æ“ä½œ"></a>2 Pod åŸºæœ¬æ“ä½œ</h2><h3 id="2-1-æŸ¥çœ‹-pod"><a href="#2-1-æŸ¥çœ‹-pod" class="headerlink" title="2.1 æŸ¥çœ‹ pod"></a>2.1 æŸ¥çœ‹ pod</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹é»˜è®¤å‘½åç©ºé—´çš„ pod</span></span><br><span class="line">kubectl get pods|pod|po</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹æ‰€æœ‰å‘½åç©ºé—´çš„ pod</span></span><br><span class="line">kubectl get pods|pod -A</span><br><span class="line">kubectl get pods|pod|po -n å‘½åç©ºé—´åç§°</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹é»˜è®¤å‘½åç©ºé—´ä¸‹ pod çš„è¯¦ç»†ä¿¡æ¯</span></span><br><span class="line">kubectl get pods -o wide </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹æ‰€æœ‰å‘½åç©ºé—´ä¸‹ pod çš„è¯¦ç»†ä¿¡æ¯</span></span><br><span class="line">kubectl get pods -o wide -A</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å®æ—¶ç›‘æ§ pod çš„çŠ¶æ€</span></span><br><span class="line">kubectl get pod -w</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹podsçš„è¯¦ç»†ä¿¡æ¯</span></span><br><span class="line">kubectl describe pod podåç§°</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¾‹å¦‚ï¼š</span></span><br><span class="line">kubectl describe pod nginx</span><br></pre></td></tr></table></figure><h3 id="2-2-åˆ›å»º-pod"><a href="#2-2-åˆ›å»º-pod" class="headerlink" title="2.2 åˆ›å»º pod"></a>2.2 åˆ›å»º pod</h3><blockquote><p>å®˜ç½‘å‚è€ƒåœ°å€: <a href="https://kubernetes.io/zh-cn/docs/reference/kubernetes-api/workload-resources/pod-v1/">https://kubernetes.io/zh-cn/docs/reference/kubernetes-api/workload-resources/pod-v1/</a></p></blockquote><ol><li>å‘½ä»¤è¡Œï¼ˆäº†è§£ï¼Œç›¸å½“äºdocker runï¼‰ï¼š<ul><li>podï¼škubectl run nginx(podåç§°) â€”image=nginx:1.19</li><li>docker containerï¼šdocker run â€”name nginx nginx:1.19</li></ul></li><li>ymlé…ç½®æ–‡ä»¶</li></ol><p><strong>åˆ›å»ºä¸€ä¸ªfirst.ymlæ–‡ä»¶</strong></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä»£è¡¨apiç‰ˆæœ¬</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="comment"># ä»£è¡¨åˆ›å»ºçš„ç±»å‹</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="comment"># ç”¨æ¥ä¹¦å†™å¯¹åº”çš„å…ƒæ•°æ®ä¿¡æ¯ æŒ‡å®š pod åç§° ä»¥åŠ namespace</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="comment"># podåç§°</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">myapp</span></span><br><span class="line">  <span class="comment"># è‡ªå®šä¹‰å…ƒæ•°æ®ä¿¡æ¯ï¼Œå¯ä»¥åœ¨åç»­ä½¿ç”¨</span></span><br><span class="line">  <span class="attr">customer:</span> <span class="string">customer</span></span><br><span class="line"><span class="comment"># å¯¹ pod é¢„æœŸè¡Œä¸ºçš„è§„çº¦</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="comment"># ç›¸å½“äºä¸€ä¸ªä¸€ä¸ªçš„å®¹å™¨</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">nginx:1.19</span></span><br><span class="line">      <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä½¿ç”¨ kubectl apply/create -f åˆ›å»º pod</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å»ºè®®ä½¿ç”¨ apply æ¥è¿›è¡Œåˆ›å»º</span></span><br><span class="line">kubectl apply -f nginx-pod.yml</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä½¿ç”¨ create å¦‚æœåˆ›å»ºäº†å†è¿è¡Œè¯¥å‘½ä»¤ï¼Œåˆ™ä¼šæŠ¥é”™</span></span><br><span class="line">kubectl create -f nginx-pod.yml</span><br></pre></td></tr></table></figure><blockquote><p><code>æ³¨æ„: create ä»…ä»…æ˜¯ä¸å­˜åœ¨æ—¶åˆ›å»º,å¦‚æœå·²ç»å­˜åœ¨åˆ™æŠ¥é”™ï¼apply ä¸å­˜åœ¨åˆ›å»ºï¼Œå­˜åœ¨æ›´æ–°é…ç½®ã€‚æ¨èä½¿ç”¨ applyï¼</code></p></blockquote><h3 id="2-3-åˆ é™¤-pod"><a href="#2-3-åˆ é™¤-pod" class="headerlink" title="2.3 åˆ é™¤ pod"></a>2.3 åˆ é™¤ pod</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ ¹æ®é…ç½®æ–‡ä»¶åˆ é™¤</span></span><br><span class="line">kubectl delete -f pod.yml</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ é™¤æŒ‡å®špodï¼ˆäº†è§£ï¼‰</span></span><br><span class="line">kubectl delete pod podåå­—</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¾‹å¦‚ï¼š</span></span><br><span class="line">kubectl delete pod nginx</span><br></pre></td></tr></table></figure><h3 id="2-4-è¿›å…¥-pod-ä¸­å®¹å™¨"><a href="#2-4-è¿›å…¥-pod-ä¸­å®¹å™¨" class="headerlink" title="2.4 è¿›å…¥ pod ä¸­å®¹å™¨"></a>2.4 è¿›å…¥ pod ä¸­å®¹å™¨</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl exec -it nginx(podåç§°) --(å›ºå®šå†™æ­») bash(æ‰§è¡Œå‘½ä»¤)</span><br></pre></td></tr></table></figure><h3 id="2-5-æŸ¥çœ‹-pod-æ—¥å¿—"><a href="#2-5-æŸ¥çœ‹-pod-æ—¥å¿—" class="headerlink" title="2.5 æŸ¥çœ‹ pod æ—¥å¿—"></a>2.5 æŸ¥çœ‹ pod æ—¥å¿—</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl logs -f(å¯é€‰,å®æ—¶) nginx(pod åç§°)</span><br></pre></td></tr></table></figure><h3 id="2-6-æŸ¥çœ‹-pod-æè¿°ä¿¡æ¯"><a href="#2-6-æŸ¥çœ‹-pod-æè¿°ä¿¡æ¯" class="headerlink" title="2.6 æŸ¥çœ‹ pod æè¿°ä¿¡æ¯"></a>2.6 æŸ¥çœ‹ pod æè¿°ä¿¡æ¯</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl describe pod nginx(podåç§°)</span><br></pre></td></tr></table></figure><h2 id="3-Pod-è¿è¡Œå¤šä¸ªå®¹å™¨"><a href="#3-Pod-è¿è¡Œå¤šä¸ªå®¹å™¨" class="headerlink" title="3 Pod è¿è¡Œå¤šä¸ªå®¹å™¨"></a>3 Pod è¿è¡Œå¤šä¸ªå®¹å™¨</h2><h3 id="3-1-åˆ›å»º-pod"><a href="#3-1-åˆ›å»º-pod" class="headerlink" title="3.1 åˆ›å»º pod"></a>3.1 åˆ›å»º pod</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä»£è¡¨apiç‰ˆæœ¬</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="comment"># ä»£è¡¨åˆ›å»ºçš„ç±»å‹</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="comment"># ç”¨æ¥ä¹¦å†™å¯¹åº”çš„å…ƒæ•°æ®ä¿¡æ¯ æŒ‡å®š pod åç§° ä»¥åŠ namespace</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="comment"># podåç§°</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">myapp</span></span><br><span class="line"><span class="comment"># å¯¹ pod é¢„æœŸè¡Œä¸ºçš„è§„çº¦</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="comment"># ç›¸å½“äºä¸€ä¸ªä¸€ä¸ªçš„å®¹å™¨</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">nginx:1.19</span></span><br><span class="line">      <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">      <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">redis</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">redis:5.0.10</span></span><br><span class="line">      <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">6379</span></span><br><span class="line">      <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f myapp-pod.yml</span><br></pre></td></tr></table></figure><h3 id="3-2-æŸ¥çœ‹æŒ‡å®šå®¹å™¨æ—¥å¿—"><a href="#3-2-æŸ¥çœ‹æŒ‡å®šå®¹å™¨æ—¥å¿—" class="headerlink" title="3.2 æŸ¥çœ‹æŒ‡å®šå®¹å™¨æ—¥å¿—"></a>3.2 æŸ¥çœ‹æŒ‡å®šå®¹å™¨æ—¥å¿—</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹æ—¥å¿— (é»˜è®¤åªæŸ¥çœ‹ç¬¬ä¸€ä¸ªå®¹å™¨æ—¥å¿—ï¼Œè¿™é‡Œæ˜¯å±•ç¤º nginx æ—¥å¿—)</span></span><br><span class="line">kubectl logs -f podName</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹ pod ä¸­æŒ‡å®šå®¹å™¨çš„æ—¥å¿—</span></span><br><span class="line">kubectl logs -f podName -c nginx(å®¹å™¨åç§°)</span><br><span class="line">kubectl logs -f podName -c redis(å®¹å™¨åç§°)</span><br></pre></td></tr></table></figure><h3 id="3-3-è¿›å…¥å®¹å™¨"><a href="#3-3-è¿›å…¥å®¹å™¨" class="headerlink" title="3.3 è¿›å…¥å®¹å™¨"></a>3.3 è¿›å…¥å®¹å™¨</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿›å…¥ pod çš„å®¹å™¨ (é»˜è®¤è¿›å…¥ç¬¬ä¸€ä¸ªå®¹å™¨å†…éƒ¨ï¼Œè¿™é‡Œä¼šè¿›å…¥ nginx å®¹å™¨å†…éƒ¨)</span></span><br><span class="line">kubectl exec -it podName -- sh</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿›å…¥ pod ä¸­æŒ‡å®šå®¹å™¨å†…éƒ¨</span></span><br><span class="line">kubectl exec -it podName -c nginx -- sh</span><br><span class="line">kubectl exec -it podName -c redis -- sh</span><br></pre></td></tr></table></figure><h2 id="4-Pod-çš„-Labels-æ ‡ç­¾"><a href="#4-Pod-çš„-Labels-æ ‡ç­¾" class="headerlink" title="4 Pod çš„ Labels(æ ‡ç­¾)"></a>4 Pod çš„ Labels(æ ‡ç­¾)</h2><p><code>æ ‡ç­¾ï¼ˆLabelsï¼‰</code> æ˜¯é™„åŠ åˆ° Kubernetes å¯¹è±¡ï¼ˆæ¯”å¦‚ Podï¼‰ä¸Šçš„é”®å€¼å¯¹ã€‚ æ ‡ç­¾æ—¨åœ¨ç”¨äºæŒ‡å®šå¯¹ç”¨æˆ·æœ‰æ„ä¹‰ä¸”ç›¸å…³çš„å¯¹è±¡çš„æ ‡è¯†å±æ€§ã€‚æ ‡ç­¾å¯ä»¥åœ¨åˆ›å»ºæ—¶é™„åŠ åˆ°å¯¹è±¡ï¼Œéšåå¯ä»¥éšæ—¶æ·»åŠ å’Œä¿®æ”¹ã€‚æ¯ä¸ªå¯¹è±¡éƒ½å¯ä»¥å®šä¹‰ä¸€ç»„é”®(key)/å€¼(value)æ ‡ç­¾ï¼Œä½†æ˜¯æ¯ä¸ªé”®(key)å¯¹äºç»™å®šå¯¹è±¡å¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚</p><p>æ ‡ç­¾ä½œç”¨ï¼šå°±æ˜¯ç”¨æ¥ç»™k8sä¸­å¯¹è±¡èµ·åˆ«åï¼Œæœ‰äº†åˆ«åå¯ä»¥è¿‡æ»¤å’Œç­›é€‰</p><h3 id="4-1-è¯­æ³•"><a href="#4-1-è¯­æ³•" class="headerlink" title="4.1 è¯­æ³•"></a>4.1 è¯­æ³•</h3><p><code>æ ‡ç­¾ç”±é”®å€¼å¯¹ç»„æˆ</code>ï¼Œå…¶æœ‰æ•ˆæ ‡ç­¾å€¼ï¼š</p><ul><li>å¿…é¡»ä¸º 63 ä¸ªå­—ç¬¦æˆ–æ›´å°‘ï¼ˆå¯ä»¥ä¸ºç©ºï¼‰</li><li>é™¤éæ ‡ç­¾å€¼ä¸ºç©ºï¼Œå¿…é¡»ä»¥å­—æ¯æ•°å­—å­—ç¬¦ï¼ˆ<code>[a-z0-9A-Z]</code>ï¼‰å¼€å¤´å’Œç»“å°¾</li><li>åŒ…å«ç ´æŠ˜å·ï¼ˆ<code>-</code>ï¼‰ã€ä¸‹åˆ’çº¿ï¼ˆ<code>_</code>ï¼‰ã€ç‚¹ï¼ˆ<code>.</code>ï¼‰å’Œå­—æ¯æˆ–æ•°å­—</li></ul><h3 id="4-2-ç¤ºä¾‹"><a href="#4-2-ç¤ºä¾‹" class="headerlink" title="4.2 ç¤ºä¾‹"></a>4.2 ç¤ºä¾‹</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">myapp</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">myapp</span> <span class="comment">#åˆ›å»ºæ—¶æ·»åŠ </span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">nginx:1.21</span></span><br><span class="line">      <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">redis</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">redis:5.0.10</span></span><br><span class="line">      <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">  <span class="attr">restartPolicy:</span> <span class="string">Always</span></span><br></pre></td></tr></table></figure><h3 id="4-3-æ ‡ç­¾åŸºæœ¬æ“ä½œ"><a href="#4-3-æ ‡ç­¾åŸºæœ¬æ“ä½œ" class="headerlink" title="4.3 æ ‡ç­¾åŸºæœ¬æ“ä½œ"></a>4.3 æ ‡ç­¾åŸºæœ¬æ“ä½œ</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹æ ‡ç­¾</span></span><br><span class="line">kubectl get pods --show-labels</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">kubectl label pod podåç§° æ ‡ç­¾é”®å€¼å¯¹</span></span><br><span class="line">kubectl label pod myapp env=prod</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¦†ç›–æ ‡ç­¾ --overwrite</span></span><br><span class="line">kubectl label --overwrite pod myapp env=test</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ é™¤æ ‡ç­¾ -å·ä»£è¡¨åˆ é™¤æ ‡ç­¾</span></span><br><span class="line">kubectl label pod myapp env-</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ ¹æ®æ ‡ç­¾ç­›é€‰ <span class="built_in">env</span>=<span class="built_in">test</span>/env</span> </span><br><span class="line">kubectl get po -l env=test</span><br><span class="line">kubectl get po -l env</span><br><span class="line">kubectl get po -l &#x27;!env&#x27; # ä¸åŒ…å«çš„ pod</span><br><span class="line">kubectl get po -l &#x27;env in (test,prod)&#x27; #é€‰æ‹©å«æœ‰æŒ‡å®šå€¼çš„ pod</span><br><span class="line">kubectl get po -l &#x27;env notin (test,prod)&#x27; #é€‰æ‹©å«æœ‰æŒ‡å®šå€¼çš„ pod</span><br></pre></td></tr></table></figure><h2 id="5-Pod-çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#5-Pod-çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="5 Pod çš„ç”Ÿå‘½å‘¨æœŸ"></a>5 Pod çš„ç”Ÿå‘½å‘¨æœŸ</h2><blockquote><p>æ‘˜è‡ªå®˜ç½‘: <a href="https://kubernetes.io/zh-cn/docs/concepts/workloads/pods/pod-lifecycle/">https://kubernetes.io/zh-cn/docs/concepts/workloads/pods/pod-lifecycle/</a></p></blockquote><p> Pod éµå¾ªé¢„å®šä¹‰çš„ç”Ÿå‘½å‘¨æœŸï¼Œèµ·å§‹äº <code>Pending</code> é˜¶æ®µï¼Œ å¦‚æœè‡³å°‘å…¶ä¸­æœ‰ä¸€ä¸ªä¸»è¦å®¹å™¨æ­£å¸¸å¯åŠ¨ï¼Œåˆ™è¿›å…¥ <code>Running</code>ï¼Œä¹‹åå–å†³äº Pod ä¸­æ˜¯å¦æœ‰å®¹å™¨ä»¥å¤±è´¥çŠ¶æ€ç»“æŸè€Œè¿›å…¥ <code>Succeeded</code> æˆ–è€… <code>Failed</code> é˜¶æ®µã€‚ä¸æ­¤åŒæ—¶Pod åœ¨å…¶ç”Ÿå‘½å‘¨æœŸä¸­åªä¼šè¢«è°ƒåº¦ä¸€æ¬¡ã€‚ ä¸€æ—¦ Pod è¢«è°ƒåº¦ï¼ˆåˆ†æ´¾ï¼‰åˆ°æŸä¸ªèŠ‚ç‚¹ï¼ŒPod ä¼šä¸€ç›´åœ¨è¯¥èŠ‚ç‚¹è¿è¡Œï¼Œç›´åˆ° Pod åœæ­¢æˆ–è€…è¢«ç»ˆæ­¢ã€‚</p><h3 id="5-1-ç”Ÿå‘½å‘¨æœŸ"><a href="#5-1-ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="5.1 ç”Ÿå‘½å‘¨æœŸ"></a>5.1 ç”Ÿå‘½å‘¨æœŸ</h3><p>å’Œä¸€ä¸ªä¸ªç‹¬ç«‹çš„åº”ç”¨å®¹å™¨ä¸€æ ·ï¼ŒPod ä¹Ÿè¢«è®¤ä¸ºæ˜¯ç›¸å¯¹ä¸´æ—¶æ€§ï¼ˆè€Œä¸æ˜¯é•¿æœŸå­˜åœ¨ï¼‰çš„å®ä½“ã€‚ Pod ä¼šè¢«åˆ›å»ºã€èµ‹äºˆä¸€ä¸ªå”¯ä¸€çš„ ID(UID)ï¼Œ å¹¶è¢«è°ƒåº¦åˆ°èŠ‚ç‚¹ï¼Œå¹¶åœ¨ç»ˆæ­¢ï¼ˆæ ¹æ®é‡å¯ç­–ç•¥ï¼‰æˆ–åˆ é™¤ä¹‹å‰ä¸€ç›´è¿è¡Œåœ¨è¯¥èŠ‚ç‚¹ã€‚å¦‚æœä¸€ä¸ªèŠ‚ç‚¹æ­»æ‰äº†ï¼Œè°ƒåº¦åˆ°è¯¥èŠ‚ç‚¹çš„ Pod ä¹Ÿè¢«è®¡åˆ’åœ¨ç»™å®šè¶…æ—¶æœŸé™ç»“æŸååˆ é™¤ã€‚</p><p>Pod è‡ªèº«ä¸å…·æœ‰è‡ªæ„ˆèƒ½åŠ›ã€‚å¦‚æœ Pod è¢«è°ƒåº¦åˆ°æŸèŠ‚ç‚¹è€Œè¯¥èŠ‚ç‚¹ä¹‹åå¤±æ•ˆï¼Œ Pod ä¼šè¢«åˆ é™¤ï¼›ç±»ä¼¼åœ°ï¼ŒPod æ— æ³•åœ¨å› èŠ‚ç‚¹èµ„æºè€—å°½æˆ–è€…èŠ‚ç‚¹ç»´æŠ¤è€Œè¢«é©±é€æœŸé—´ç»§ç»­å­˜æ´»ã€‚ Kubernetes ä½¿ç”¨ä¸€ç§é«˜çº§æŠ½è±¡æ¥ç®¡ç†è¿™äº›ç›¸å¯¹è€Œè¨€å¯éšæ—¶ä¸¢å¼ƒçš„ Pod å®ä¾‹ï¼Œ ç§°ä½œæ§åˆ¶å™¨ã€‚</p><p>ä»»ä½•ç»™å®šçš„ Pod ï¼ˆç”± UID å®šä¹‰ï¼‰ä»ä¸ä¼šè¢«â€œé‡æ–°è°ƒåº¦ï¼ˆrescheduledï¼‰â€åˆ°ä¸åŒçš„èŠ‚ç‚¹ï¼› ç›¸åï¼Œè¿™ä¸€ Pod å¯ä»¥è¢«ä¸€ä¸ªæ–°çš„ã€å‡ ä¹å®Œå…¨ç›¸åŒçš„ Pod æ›¿æ¢æ‰ã€‚ å¦‚æœéœ€è¦ï¼Œæ–° Pod çš„åå­—å¯ä»¥ä¸å˜ï¼Œä½†æ˜¯å…¶ UID ä¼šä¸åŒã€‚</p><p>å¦‚æœæŸç‰©å£°ç§°å…¶ç”Ÿå‘½æœŸä¸æŸ Pod ç›¸åŒï¼Œä¾‹å¦‚å­˜å‚¨å·ï¼Œ è¿™å°±æ„å‘³ç€è¯¥å¯¹è±¡åœ¨æ­¤ Pod ï¼ˆUID äº¦ç›¸åŒï¼‰å­˜åœ¨æœŸé—´ä¹Ÿä¸€ç›´å­˜åœ¨ã€‚ å¦‚æœ Pod å› ä¸ºä»»ä½•åŸå› è¢«åˆ é™¤ï¼Œç”šè‡³æŸå®Œå…¨ç›¸åŒçš„æ›¿ä»£ Pod è¢«åˆ›å»ºæ—¶ï¼Œ è¿™ä¸ªç›¸å…³çš„å¯¹è±¡ï¼ˆä¾‹å¦‚è¿™é‡Œçš„å·ï¼‰ä¹Ÿä¼šè¢«åˆ é™¤å¹¶é‡å»ºã€‚</p><h3 id="5-2-pod-é˜¶æ®µ"><a href="#5-2-pod-é˜¶æ®µ" class="headerlink" title="5.2 pod é˜¶æ®µ"></a>5.2 pod é˜¶æ®µ</h3><p>Pod é˜¶æ®µçš„æ•°é‡å’Œå«ä¹‰æ˜¯ä¸¥æ ¼å®šä¹‰çš„ã€‚ é™¤äº†æœ¬æ–‡æ¡£ä¸­åˆ—ä¸¾çš„å†…å®¹å¤–ï¼Œä¸åº”è¯¥å†å‡å®š Pod æœ‰å…¶ä»–çš„ <code>phase</code> å€¼ã€‚</p><div class="table-container"><table><thead><tr><th style="text-align:left">å–å€¼</th><th style="text-align:left">æè¿°</th></tr></thead><tbody><tr><td style="text-align:left"><code>Pending</code>ï¼ˆæ‚¬å†³ï¼‰</td><td style="text-align:left">Pod å·²è¢« Kubernetes ç³»ç»Ÿæ¥å—ï¼Œä½†æœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ªå®¹å™¨å°šæœªåˆ›å»ºäº¦æœªè¿è¡Œã€‚æ­¤é˜¶æ®µåŒ…æ‹¬ç­‰å¾… Pod è¢«è°ƒåº¦çš„æ—¶é—´å’Œé€šè¿‡ç½‘ç»œä¸‹è½½é•œåƒçš„æ—¶é—´ã€‚</td></tr><tr><td style="text-align:left"><code>Running</code>ï¼ˆè¿è¡Œä¸­ï¼‰</td><td style="text-align:left">Pod å·²ç»ç»‘å®šåˆ°äº†æŸä¸ªèŠ‚ç‚¹ï¼ŒPod ä¸­æ‰€æœ‰çš„å®¹å™¨éƒ½å·²è¢«åˆ›å»ºã€‚è‡³å°‘æœ‰ä¸€ä¸ªå®¹å™¨ä»åœ¨è¿è¡Œï¼Œæˆ–è€…æ­£å¤„äºå¯åŠ¨æˆ–é‡å¯çŠ¶æ€ã€‚</td></tr><tr><td style="text-align:left"><code>Succeeded</code>ï¼ˆæˆåŠŸï¼‰</td><td style="text-align:left">Pod ä¸­çš„æ‰€æœ‰å®¹å™¨éƒ½å·²æˆåŠŸç»ˆæ­¢ï¼Œå¹¶ä¸”ä¸ä¼šå†é‡å¯ã€‚</td></tr><tr><td style="text-align:left"><code>Failed</code>ï¼ˆå¤±è´¥ï¼‰</td><td style="text-align:left">Pod ä¸­çš„æ‰€æœ‰å®¹å™¨éƒ½å·²ç»ˆæ­¢ï¼Œå¹¶ä¸”è‡³å°‘æœ‰ä¸€ä¸ªå®¹å™¨æ˜¯å› ä¸ºå¤±è´¥ç»ˆæ­¢ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®¹å™¨ä»¥é 0 çŠ¶æ€é€€å‡ºæˆ–è€…è¢«ç³»ç»Ÿç»ˆæ­¢ã€‚</td></tr><tr><td style="text-align:left"><code>Unknown</code>ï¼ˆæœªçŸ¥ï¼‰</td><td style="text-align:left">å› ä¸ºæŸäº›åŸå› æ— æ³•å–å¾— Pod çš„çŠ¶æ€ã€‚è¿™ç§æƒ…å†µé€šå¸¸æ˜¯å› ä¸ºä¸ Pod æ‰€åœ¨ä¸»æœºé€šä¿¡å¤±è´¥ã€‚</td></tr></tbody></table></div><blockquote><p><strong>è¯´æ˜ï¼š</strong></p><ol><li><p>å½“ä¸€ä¸ª Pod è¢«åˆ é™¤æ—¶ï¼Œæ‰§è¡Œä¸€äº› kubectl å‘½ä»¤ä¼šå±•ç¤ºè¿™ä¸ª Pod çš„çŠ¶æ€ä¸º <code>Terminating</code>ï¼ˆç»ˆæ­¢ï¼‰ã€‚ è¿™ä¸ª <code>Terminating</code> çŠ¶æ€å¹¶ä¸æ˜¯ Pod é˜¶æ®µä¹‹ä¸€ã€‚ Pod è¢«èµ‹äºˆä¸€ä¸ªå¯ä»¥ä½“é¢ç»ˆæ­¢çš„æœŸé™ï¼Œé»˜è®¤ä¸º 30 ç§’ã€‚ ä½ å¯ä»¥ä½¿ç”¨ <code>--force</code> å‚æ•°æ¥å¼ºåˆ¶ç»ˆæ­¢ Podã€‚</p></li><li><p>å¦‚æœæŸèŠ‚ç‚¹æ­»æ‰æˆ–è€…ä¸é›†ç¾¤ä¸­å…¶ä»–èŠ‚ç‚¹å¤±è”ï¼ŒKubernetes ä¼šå®æ–½ä¸€ç§ç­–ç•¥ï¼Œå°†å¤±å»çš„èŠ‚ç‚¹ä¸Šè¿è¡Œçš„æ‰€æœ‰ Pod çš„ <code>phase</code> è®¾ç½®ä¸º <code>Failed</code>ã€‚</p></li></ol></blockquote><h2 id="6-Contrainer-ç‰¹æ€§"><a href="#6-Contrainer-ç‰¹æ€§" class="headerlink" title="6 Contrainer ç‰¹æ€§"></a>6 Contrainer ç‰¹æ€§</h2><h3 id="6-1-å®¹å™¨ç”Ÿå‘½å‘¨æœŸ"><a href="#6-1-å®¹å™¨ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="6.1 å®¹å™¨ç”Ÿå‘½å‘¨æœŸ"></a>6.1 å®¹å™¨ç”Ÿå‘½å‘¨æœŸ</h3><p>Kubernetes ä¼šè·Ÿè¸ª Pod ä¸­æ¯ä¸ªå®¹å™¨çš„çŠ¶æ€ï¼Œå°±åƒå®ƒè·Ÿè¸ª Pod æ€»ä½“ä¸Šçš„é˜¶æ®µä¸€æ ·ã€‚ ä½ å¯ä»¥ä½¿ç”¨å®¹å™¨ç”Ÿå‘½å‘¨æœŸå›è°ƒæ¥åœ¨å®¹å™¨ç”Ÿå‘½å‘¨æœŸä¸­çš„ç‰¹å®šæ—¶é—´ç‚¹è§¦å‘äº‹ä»¶ã€‚</p><p>ä¸€æ—¦è°ƒåº¦å™¨å°† Pod åˆ†æ´¾ç»™æŸä¸ªèŠ‚ç‚¹ï¼Œ<code>kubelet</code> å°±é€šè¿‡å®¹å™¨è¿è¡Œæ—¶å¼€å§‹ä¸º Pod åˆ›å»ºå®¹å™¨ã€‚å®¹å™¨çš„çŠ¶æ€æœ‰ä¸‰ç§ï¼š<code>Waiting</code>ï¼ˆç­‰å¾…ï¼‰ã€<code>Running</code>ï¼ˆè¿è¡Œä¸­ï¼‰å’Œ <code>Terminated</code>ï¼ˆå·²ç»ˆæ­¢ï¼‰ã€‚</p><p>è¦æ£€æŸ¥ Pod ä¸­å®¹å™¨çš„çŠ¶æ€ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>kubectl describe pod &lt;pod åç§°&gt;</code>ã€‚ å…¶è¾“å‡ºä¸­åŒ…å« Pod ä¸­æ¯ä¸ªå®¹å™¨çš„çŠ¶æ€ã€‚</p><p>æ¯ç§çŠ¶æ€éƒ½æœ‰ç‰¹å®šçš„å«ä¹‰ï¼š</p><ul><li><code>Waiting</code> ï¼ˆç­‰å¾…ï¼‰</li></ul><p>å¦‚æœå®¹å™¨å¹¶ä¸å¤„åœ¨ <code>Running</code> æˆ– <code>Terminated</code> çŠ¶æ€ä¹‹ä¸€ï¼Œå®ƒå°±å¤„åœ¨ <code>Waiting</code> çŠ¶æ€ã€‚ å¤„äº <code>Waiting</code> çŠ¶æ€çš„å®¹å™¨ä»åœ¨è¿è¡Œå®ƒå®Œæˆå¯åŠ¨æ‰€éœ€è¦çš„æ“ä½œï¼šä¾‹å¦‚ï¼Œ ä»æŸä¸ªå®¹å™¨é•œåƒä»“åº“æ‹‰å–å®¹å™¨é•œåƒï¼Œæˆ–è€…å‘å®¹å™¨åº”ç”¨ Secret æ•°æ®ç­‰ç­‰ã€‚ å½“ä½ ä½¿ç”¨ <code>kubectl</code> æ¥æŸ¥è¯¢åŒ…å« <code>Waiting</code> çŠ¶æ€çš„å®¹å™¨çš„ Pod æ—¶ï¼Œä½ ä¹Ÿä¼šçœ‹åˆ°ä¸€ä¸ª Reason å­—æ®µï¼Œå…¶ä¸­ç»™å‡ºäº†å®¹å™¨å¤„äºç­‰å¾…çŠ¶æ€çš„åŸå› ã€‚</p><ul><li><code>Running</code>ï¼ˆè¿è¡Œä¸­ï¼‰</li></ul><p><code>Running</code> çŠ¶æ€è¡¨æ˜å®¹å™¨æ­£åœ¨æ‰§è¡ŒçŠ¶æ€å¹¶ä¸”æ²¡æœ‰é—®é¢˜å‘ç”Ÿã€‚ å¦‚æœé…ç½®äº† <code>postStart</code> å›è°ƒï¼Œé‚£ä¹ˆè¯¥å›è°ƒå·²ç»æ‰§è¡Œä¸”å·²å®Œæˆã€‚ å¦‚æœä½ ä½¿ç”¨ <code>kubectl</code> æ¥æŸ¥è¯¢åŒ…å« <code>Running</code> çŠ¶æ€çš„å®¹å™¨çš„ Pod æ—¶ï¼Œ ä½ ä¹Ÿä¼šçœ‹åˆ°å…³äºå®¹å™¨è¿›å…¥ <code>Running</code> çŠ¶æ€çš„ä¿¡æ¯ã€‚</p><ul><li><code>Terminated</code>ï¼ˆå·²ç»ˆæ­¢ï¼‰</li></ul><p>å¤„äº <code>Terminated</code> çŠ¶æ€çš„å®¹å™¨å·²ç»å¼€å§‹æ‰§è¡Œå¹¶ä¸”æˆ–è€…æ­£å¸¸ç»“æŸæˆ–è€…å› ä¸ºæŸäº›åŸå› å¤±è´¥ã€‚ å¦‚æœä½ ä½¿ç”¨ <code>kubectl</code> æ¥æŸ¥è¯¢åŒ…å« <code>Terminated</code> çŠ¶æ€çš„å®¹å™¨çš„ Pod æ—¶ï¼Œ ä½ ä¼šçœ‹åˆ°å®¹å™¨è¿›å…¥æ­¤çŠ¶æ€çš„åŸå› ã€é€€å‡ºä»£ç ä»¥åŠå®¹å™¨æ‰§è¡ŒæœŸé—´çš„èµ·æ­¢æ—¶é—´ã€‚</p><p>å¦‚æœå®¹å™¨é…ç½®äº† <code>preStop</code> å›è°ƒï¼Œåˆ™è¯¥å›è°ƒä¼šåœ¨å®¹å™¨è¿›å…¥ <code>Terminated</code> çŠ¶æ€ä¹‹å‰æ‰§è¡Œã€‚</p><h3 id="6-2-å®¹å™¨ç”Ÿå‘½å‘¨æœŸå›è°ƒ-äº‹ä»¶-é’©å­"><a href="#6-2-å®¹å™¨ç”Ÿå‘½å‘¨æœŸå›è°ƒ-äº‹ä»¶-é’©å­" class="headerlink" title="6.2 å®¹å™¨ç”Ÿå‘½å‘¨æœŸå›è°ƒ/äº‹ä»¶/é’©å­"></a>6.2 å®¹å™¨ç”Ÿå‘½å‘¨æœŸå›è°ƒ/äº‹ä»¶/é’©å­</h3><blockquote><p><strong>å¯ä»¥æŒ‡å®šå®¹å™¨åœ¨æŒ‡å®šæ—¶å€™æ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤å®Œæˆç›¸åº”çš„æ“ä½œ</strong></p></blockquote><p>ç±»ä¼¼äºè®¸å¤šå…·æœ‰ç”Ÿå‘½å‘¨æœŸå›è°ƒç»„ä»¶çš„ç¼–ç¨‹è¯­è¨€æ¡†æ¶ï¼Œä¾‹å¦‚ Angularã€Vueã€Kubernetes ä¸ºå®¹å™¨æä¾›äº†ç”Ÿå‘½å‘¨æœŸå›è°ƒã€‚ å›è°ƒä½¿å®¹å™¨èƒ½å¤Ÿäº†è§£å…¶ç®¡ç†ç”Ÿå‘½å‘¨æœŸä¸­çš„äº‹ä»¶ï¼Œå¹¶åœ¨æ‰§è¡Œç›¸åº”çš„ç”Ÿå‘½å‘¨æœŸå›è°ƒæ—¶è¿è¡Œåœ¨å¤„ç†ç¨‹åºä¸­å®ç°çš„ä»£ç ã€‚</p><p>æœ‰ä¸¤ä¸ªå›è°ƒæš´éœ²ç»™å®¹å™¨ï¼š</p><ul><li><p><code>PostStart</code> è¿™ä¸ªå›è°ƒåœ¨å®¹å™¨è¢«åˆ›å»ºä¹‹åç«‹å³è¢«æ‰§è¡Œã€‚ ä½†æ˜¯ï¼Œä¸èƒ½ä¿è¯å›è°ƒä¼šåœ¨å®¹å™¨å…¥å£ç‚¹ï¼ˆENTRYPOINTï¼‰ä¹‹å‰æ‰§è¡Œã€‚ æ²¡æœ‰å‚æ•°ä¼ é€’ç»™å¤„ç†ç¨‹åºã€‚</p></li><li><p><code>PreStop</code> åœ¨å®¹å™¨å›  API è¯·æ±‚æˆ–è€…ç®¡ç†äº‹ä»¶ï¼ˆè¯¸å¦‚å­˜æ´»æ€æ¢é’ˆã€å¯åŠ¨æ¢é’ˆå¤±è´¥ã€èµ„æºæŠ¢å ã€èµ„æºç«äº‰ç­‰ï¼‰ è€Œè¢«ç»ˆæ­¢ä¹‹å‰ï¼Œæ­¤å›è°ƒä¼šè¢«è°ƒç”¨ã€‚ å¦‚æœå®¹å™¨å·²ç»å¤„äºå·²ç»ˆæ­¢æˆ–è€…å·²å®ŒæˆçŠ¶æ€ï¼Œåˆ™å¯¹ preStop å›è°ƒçš„è°ƒç”¨å°†å¤±è´¥ã€‚ åœ¨ç”¨æ¥åœæ­¢å®¹å™¨çš„ TERM ä¿¡å·è¢«å‘å‡ºä¹‹å‰ï¼Œå›è°ƒå¿…é¡»æ‰§è¡Œç»“æŸã€‚ Pod çš„ç»ˆæ­¢å®½é™å‘¨æœŸåœ¨ <code>PreStop</code> å›è°ƒè¢«æ‰§è¡Œä¹‹å‰å³å¼€å§‹è®¡æ•°ï¼Œ æ‰€ä»¥æ— è®ºå›è°ƒå‡½æ•°çš„æ‰§è¡Œç»“æœå¦‚ä½•ï¼Œå®¹å™¨æœ€ç»ˆéƒ½ä¼šåœ¨ Pod çš„ç»ˆæ­¢å®½é™æœŸå†…è¢«ç»ˆæ­¢ã€‚ æ²¡æœ‰å‚æ•°ä¼šè¢«ä¼ é€’ç»™å¤„ç†ç¨‹åºã€‚</p></li><li><p><strong>ä½¿ç”¨å®¹å™¨ç”Ÿå‘½å‘¨æœŸå›è°ƒ</strong></p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nginx-pod.yml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">nginx:1.19</span></span><br><span class="line">      <span class="attr">lifecycle:</span></span><br><span class="line">        <span class="attr">postStart:</span> <span class="comment">#å®¹å™¨åˆ›å»ºè¿‡ç¨‹ä¸­æ‰§è¡Œ</span></span><br><span class="line">          <span class="attr">exec:</span></span><br><span class="line">            <span class="attr">command:</span> [<span class="string">&quot;/bin/sh&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;echo postStart &gt;&gt; /start.txt&quot;</span>]</span><br><span class="line">        <span class="attr">preStop:</span>  <span class="comment">#å®¹å™¨ç»ˆæ­¢ä¹‹å‰æ‰§è¡Œ</span></span><br><span class="line">          <span class="attr">exec:</span></span><br><span class="line">            <span class="attr">command:</span> [<span class="string">&quot;/bin/sh&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;echo postStop &gt;&gt; /stop.txt &amp;&amp; sleep 5&quot;</span>]</span><br><span class="line">      <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure><h3 id="6-3-å®¹å™¨é‡å¯ç­–ç•¥"><a href="#6-3-å®¹å™¨é‡å¯ç­–ç•¥" class="headerlink" title="6.3 å®¹å™¨é‡å¯ç­–ç•¥"></a>6.3 å®¹å™¨é‡å¯ç­–ç•¥</h3><blockquote><p><strong>ä¸€ä¸ªpodä¸­åªèƒ½æœ‰ä¸€ä¸ªé‡å¯ç­–ç•¥ï¼Œå¯¹è¯¥podä¸­çš„æ‰€æœ‰å®¹å™¨éƒ½æœ‰æ•ˆæœ</strong></p></blockquote><p>Pod çš„ <code>spec</code> ä¸­åŒ…å«ä¸€ä¸ª <code>restartPolicy</code> å­—æ®µï¼Œå…¶å¯èƒ½å–å€¼åŒ…æ‹¬ <code>Always(æ€»æ˜¯é‡å¯)ã€OnFailure(å®¹å™¨å¼‚å¸¸é€€å‡ºçŠ¶æ€ç é 0,é‡å¯) å’Œ Never</code>ã€‚é»˜è®¤å€¼æ˜¯ <code>Always</code>ã€‚</p><p><code>restartPolicy</code> é€‚ç”¨äº Pod ä¸­çš„æ‰€æœ‰å®¹å™¨ã€‚<code>restartPolicy</code> ä»…é’ˆå¯¹åŒä¸€èŠ‚ç‚¹ä¸Š <code>kubelet</code> çš„å®¹å™¨é‡å¯åŠ¨ä½œã€‚å½“ Pod ä¸­çš„å®¹å™¨é€€å‡ºæ—¶ï¼Œ<code>kubelet</code> ä¼šæŒ‰æŒ‡æ•°å›é€€æ–¹å¼è®¡ç®—é‡å¯çš„å»¶è¿Ÿï¼ˆ10sã€20sã€40sã€â€¦ï¼‰ï¼Œå…¶æœ€é•¿å»¶è¿Ÿä¸º 5 åˆ†é’Ÿã€‚ ä¸€æ—¦æŸå®¹å™¨æ‰§è¡Œäº† 10 åˆ†é’Ÿå¹¶ä¸”æ²¡æœ‰å‡ºç°é—®é¢˜ï¼Œ<code>kubelet</code> å¯¹è¯¥å®¹å™¨çš„é‡å¯å›é€€è®¡æ—¶å™¨æ‰§è¡Œé‡ç½®æ“ä½œã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">nginx:1.19</span></span><br><span class="line">      <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">  <span class="comment"># restartPolicy å¯é€‰å€¼ä¸ºï¼šAlwaysã€Never</span></span><br><span class="line">  <span class="attr">restartPolicy:</span> <span class="string">Always</span> <span class="comment"># OnFailure Never</span></span><br></pre></td></tr></table></figure><h3 id="6-4-è‡ªå®šä¹‰å®¹å™¨å¯åŠ¨å‘½ä»¤"><a href="#6-4-è‡ªå®šä¹‰å®¹å™¨å¯åŠ¨å‘½ä»¤" class="headerlink" title="6.4 è‡ªå®šä¹‰å®¹å™¨å¯åŠ¨å‘½ä»¤"></a>6.4 è‡ªå®šä¹‰å®¹å™¨å¯åŠ¨å‘½ä»¤</h3><p>å’Œ Docker å®¹å™¨ä¸€æ ·,k8sä¸­å®¹å™¨ä¹Ÿå¯ä»¥é€šè¿‡commandã€args ç”¨æ¥ä¿®æ”¹å®¹å™¨å¯åŠ¨é»˜è®¤æ‰§è¡Œå‘½ä»¤ä»¥åŠä¼ é€’ç›¸å…³å‚æ•°ã€‚<strong>ä½†ä¸€èˆ¬æ¨èä½¿ç”¨ command ä¿®æ”¹å¯åŠ¨å‘½ä»¤ï¼Œä½¿ç”¨ args ä¸ºå¯åŠ¨å‘½ä»¤ä¼ é€’å‚æ•°ã€‚</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">redis</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">redis</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">redis</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">redis:5.0.10</span></span><br><span class="line">      <span class="attr">command:</span> [<span class="string">&quot;redis-server&quot;</span>] <span class="comment">#ç”¨æ¥æŒ‡å®šå¯åŠ¨å‘½ä»¤</span></span><br><span class="line">      <span class="attr">args:</span> [<span class="string">&quot;--appendonly yes&quot;</span>] <span class="comment"># ç”¨æ¥ä¸ºå¯åŠ¨å‘½ä»¤ä¼ é€’å‚æ•°</span></span><br><span class="line">      <span class="comment">#args: [&quot;redis-server&quot;,&quot;--appendonly yes&quot;] # å•ç‹¬ä½¿ç”¨ä¿®æ”¹å¯åŠ¨å‘½ä»¤å¹¶ä¼ é€’å‚æ•°</span></span><br><span class="line">      <span class="comment">#args:                                     # å¦ä¸€ç§è¯­æ³•æ ¼å¼</span></span><br><span class="line">      <span class="comment">#  - redis-server</span></span><br><span class="line">      <span class="comment">#  - &quot;--appendonly yes&quot;</span></span><br><span class="line">      <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">  <span class="attr">restartPolicy:</span> <span class="string">Always</span></span><br></pre></td></tr></table></figure><h3 id="6-5-å®¹å™¨æ¢é’ˆ"><a href="#6-5-å®¹å™¨æ¢é’ˆ" class="headerlink" title="6.5 å®¹å™¨æ¢é’ˆ"></a>6.5 å®¹å™¨æ¢é’ˆ</h3><p>probe æ˜¯ç”± kubeletå¯¹å®¹å™¨æ‰§è¡Œçš„å®šæœŸè¯Šæ–­ã€‚ è¦æ‰§è¡Œè¯Šæ–­ï¼Œkubelet æ—¢å¯ä»¥åœ¨å®¹å™¨å†…æ‰§è¡Œä»£ç ï¼Œä¹Ÿå¯ä»¥å‘å‡ºä¸€ä¸ªç½‘ç»œè¯·æ±‚ã€‚</p><p>å®šä¹‰: å®¹å™¨æ¢é’ˆ å°±æ˜¯ç”¨æ¥å®šæœŸå¯¹å®¹å™¨è¿›è¡Œå¥åº·æ£€æŸ¥çš„ã€‚</p><p><strong>æ¢æµ‹ç±»å‹</strong></p><p>é’ˆå¯¹è¿è¡Œä¸­çš„å®¹å™¨ï¼Œ<code>kubelet</code> å¯ä»¥é€‰æ‹©æ˜¯å¦æ‰§è¡Œä»¥ä¸‹ä¸‰ç§æ¢é’ˆï¼Œä»¥åŠå¦‚ä½•é’ˆå¯¹æ¢æµ‹ç»“æœä½œå‡ºååº”ï¼š</p><ul><li><code>livenessProbe</code> <strong>æŒ‡ç¤ºå®¹å™¨æ˜¯å¦æ­£åœ¨è¿è¡Œ</strong>ã€‚å¦‚æœå­˜æ´»æ€æ¢æµ‹å¤±è´¥ï¼Œåˆ™ kubelet ä¼šæ€æ­»å®¹å™¨ï¼Œ å¹¶ä¸”å®¹å™¨å°†æ ¹æ®å…¶é‡å¯ç­–ç•¥å†³å®šæœªæ¥ã€‚å¦‚æœå®¹å™¨ä¸æä¾›å­˜æ´»æ¢é’ˆï¼Œ åˆ™é»˜è®¤çŠ¶æ€ä¸º <code>Success</code>ã€‚</li><li><code>readinessProbe</code><strong>æŒ‡ç¤ºå®¹å™¨æ˜¯å¦å‡†å¤‡å¥½ä¸ºè¯·æ±‚æä¾›æœ</strong>ã€‚å¦‚æœå°±ç»ªæ€æ¢æµ‹å¤±è´¥ï¼Œ ç«¯ç‚¹æ§åˆ¶å™¨å°†ä»ä¸ Pod åŒ¹é…çš„æ‰€æœ‰æœåŠ¡çš„ç«¯ç‚¹åˆ—è¡¨ä¸­åˆ é™¤è¯¥ Pod çš„ IP åœ°å€ã€‚ åˆå§‹å»¶è¿Ÿä¹‹å‰çš„å°±ç»ªæ€çš„çŠ¶æ€å€¼é»˜è®¤ä¸º <code>Failure</code>ã€‚ å¦‚æœå®¹å™¨ä¸æä¾›å°±ç»ªæ€æ¢é’ˆï¼Œåˆ™é»˜è®¤çŠ¶æ€ä¸º <code>Success</code>ã€‚</li><li><code>startupProbe 1.7+</code><strong>æŒ‡ç¤ºå®¹å™¨ä¸­çš„åº”ç”¨æ˜¯å¦å·²ç»å¯åŠ¨</strong>ã€‚å¦‚æœæä¾›äº†å¯åŠ¨æ¢é’ˆï¼Œåˆ™æ‰€æœ‰å…¶ä»–æ¢é’ˆéƒ½ä¼šè¢« ç¦ç”¨ï¼Œç›´åˆ°æ­¤æ¢é’ˆæˆåŠŸä¸ºæ­¢ã€‚å¦‚æœå¯åŠ¨æ¢æµ‹å¤±è´¥ï¼Œ<code>kubelet</code> å°†æ€æ­»å®¹å™¨ï¼Œ è€Œå®¹å™¨ä¾å…¶é‡å¯ç­–ç•¥è¿›è¡Œé‡å¯ã€‚ å¦‚æœå®¹å™¨æ²¡æœ‰æä¾›å¯åŠ¨æ¢æµ‹ï¼Œåˆ™é»˜è®¤çŠ¶æ€ä¸º <code>Success</code>ã€‚</li></ul><p><strong>æ¢é’ˆæœºåˆ¶</strong></p><p>ä½¿ç”¨æ¢é’ˆæ¥æ£€æŸ¥å®¹å™¨æœ‰å››ç§ä¸åŒçš„æ–¹æ³•ã€‚ æ¯ä¸ªæ¢é’ˆéƒ½å¿…é¡»å‡†ç¡®å®šä¹‰ä¸ºè¿™å››ç§æœºåˆ¶ä¸­çš„ä¸€ç§ï¼š</p><ul><li><p><code>exec</code></p><p>åœ¨å®¹å™¨å†…æ‰§è¡ŒæŒ‡å®šå‘½ä»¤ã€‚å¦‚æœå‘½ä»¤é€€å‡ºæ—¶è¿”å›ç ä¸º 0 åˆ™è®¤ä¸ºè¯Šæ–­æˆåŠŸã€‚</p></li><li><p><code>grpc</code></p><p>ä½¿ç”¨ gRPC æ‰§è¡Œä¸€ä¸ªè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ã€‚ ç›®æ ‡åº”è¯¥å®ç° gRPCå¥åº·æ£€æŸ¥ã€‚ å¦‚æœå“åº”çš„çŠ¶æ€æ˜¯ â€œSERVINGâ€ï¼Œåˆ™è®¤ä¸ºè¯Šæ–­æˆåŠŸã€‚ gRPC æ¢é’ˆæ˜¯ä¸€ä¸ª Alpha ç‰¹æ€§ï¼Œåªæœ‰åœ¨ä½ å¯ç”¨äº† â€œGRPCContainerProbeâ€ ç‰¹æ€§é—¨æ§æ—¶æ‰èƒ½ä½¿ç”¨ã€‚</p></li><li><p><code>httpGet</code></p><p>å¯¹å®¹å™¨çš„ IP åœ°å€ä¸ŠæŒ‡å®šç«¯å£å’Œè·¯å¾„æ‰§è¡Œ HTTP <code>GET</code> è¯·æ±‚ã€‚å¦‚æœå“åº”çš„çŠ¶æ€ç å¤§äºç­‰äº 200 ä¸”å°äº 400ï¼Œåˆ™è¯Šæ–­è¢«è®¤ä¸ºæ˜¯æˆåŠŸçš„ã€‚</p></li><li><p><code>tcpSocket</code></p><p>å¯¹å®¹å™¨çš„ IP åœ°å€ä¸Šçš„æŒ‡å®šç«¯å£æ‰§è¡Œ TCP æ£€æŸ¥ã€‚å¦‚æœç«¯å£æ‰“å¼€ï¼Œåˆ™è¯Šæ–­è¢«è®¤ä¸ºæ˜¯æˆåŠŸçš„ã€‚ å¦‚æœè¿œç¨‹ç³»ç»Ÿï¼ˆå®¹å™¨ï¼‰åœ¨æ‰“å¼€è¿æ¥åç«‹å³å°†å…¶å…³é—­ï¼Œè¿™ç®—ä½œæ˜¯å¥åº·çš„ã€‚</p></li></ul><p><strong>æ¢é’ˆç»“æœ</strong></p><p>æ¯æ¬¡æ¢æµ‹éƒ½å°†è·å¾—ä»¥ä¸‹ä¸‰ç§ç»“æœä¹‹ä¸€ï¼š</p><ul><li><code>Success</code>ï¼ˆæˆåŠŸï¼‰å®¹å™¨é€šè¿‡äº†è¯Šæ–­ã€‚</li><li><code>Failure</code>ï¼ˆå¤±è´¥ï¼‰å®¹å™¨æœªé€šè¿‡è¯Šæ–­ã€‚</li><li><code>Unknown</code>ï¼ˆæœªçŸ¥ï¼‰è¯Šæ–­å¤±è´¥ï¼Œå› æ­¤ä¸ä¼šé‡‡å–ä»»ä½•è¡ŒåŠ¨ã€‚</li></ul><p><strong>æ¢é’ˆå‚æ•°</strong></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">initialDelaySeconds:</span> <span class="number">5</span>   <span class="comment">#åˆå§‹åŒ–æ—¶é—´5s</span></span><br><span class="line"><span class="attr">periodSeconds:</span> <span class="number">4</span>     <span class="comment">#æ£€æµ‹é—´éš”æ—¶é—´4s</span></span><br><span class="line"><span class="attr">timeoutSeconds:</span> <span class="number">1</span>   <span class="comment">#é»˜è®¤æ£€æµ‹è¶…æ—¶æ—¶é—´ä¸º1s</span></span><br><span class="line"><span class="attr">failureThreshold:</span> <span class="number">3</span>   <span class="comment">#é»˜è®¤å¤±è´¥æ¬¡æ•°ä¸º3æ¬¡ï¼Œè¾¾åˆ°3æ¬¡åé‡å¯pod</span></span><br><span class="line"><span class="attr">successThreshold:</span> <span class="number">1</span>    <span class="comment">#é»˜è®¤æˆåŠŸæ¬¡æ•°ä¸º1æ¬¡ï¼Œ1æ¬¡ç›‘æµ‹æˆåŠŸä»£è¡¨æˆåŠŸ</span></span><br></pre></td></tr></table></figure><p><strong>ä½¿ç”¨æ¢é’ˆ</strong></p><ul><li><strong>exec</strong></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">liveness-exec</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">exec:</span> <span class="string">exec</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:1.19</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">args:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/bin/sh</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">-c</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">sleep</span> <span class="number">7</span><span class="string">;nginx</span> <span class="string">-g</span> <span class="string">&quot;daemon off;&quot;</span> <span class="comment">#è¿™ä¸€æ­¥ä¼šå’Œåˆå§‹åŒ–åŒæ—¶å¼€å§‹è¿è¡Œï¼Œä¹Ÿå°±æ˜¯åœ¨åˆå§‹åŒ–5såå’Œ7ç§’ä¹‹é—´ï¼Œä¼šæ£€æµ‹å‡ºä¸€æ¬¡å¤±è´¥ï¼Œ7ç§’åå¯åŠ¨åæ£€æµ‹æ­£å¸¸ï¼Œæ‰€ä»¥podä¸ä¼šé‡å¯</span></span><br><span class="line">    <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">    <span class="comment"># æ¢æµ‹ç±»å‹ï¼šlivenessProbe | readinessProbe | startupProbe</span></span><br><span class="line">    <span class="attr">livenessProbe:</span></span><br><span class="line">      <span class="attr">exec:</span>    <span class="comment">#è¿™é‡Œä½¿ç”¨ exec æ‰§è¡Œ shell å‘½ä»¤æ£€æµ‹å®¹å™¨çŠ¶æ€</span></span><br><span class="line">        <span class="attr">command:</span>  </span><br><span class="line">        <span class="bullet">-</span> <span class="string">ls</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">/var/run/nginx.pid</span>  <span class="comment">#æŸ¥çœ‹æ˜¯å¦æœ‰pidæ–‡ä»¶</span></span><br><span class="line">      <span class="attr">initialDelaySeconds:</span> <span class="number">5</span>   <span class="comment">#åˆå§‹åŒ–æ—¶é—´5s</span></span><br><span class="line">      <span class="attr">periodSeconds:</span> <span class="number">4</span>    <span class="comment">#æ£€æµ‹é—´éš”æ—¶é—´4s</span></span><br><span class="line">      <span class="attr">timeoutSeconds:</span> <span class="number">1</span>   <span class="comment">#é»˜è®¤æ£€æµ‹è¶…æ—¶æ—¶é—´ä¸º1s</span></span><br><span class="line">      <span class="attr">failureThreshold:</span> <span class="number">3</span>   <span class="comment">#é»˜è®¤å¤±è´¥æ¬¡æ•°ä¸º3æ¬¡ï¼Œè¾¾åˆ°3æ¬¡åé‡å¯pod</span></span><br><span class="line">      <span class="attr">successThreshold:</span> <span class="number">1</span>   <span class="comment">#é»˜è®¤æˆåŠŸæ¬¡æ•°ä¸º1æ¬¡ï¼Œ1 æ¬¡ä»£è¡¨æˆåŠŸ</span></span><br></pre></td></tr></table></figure><blockquote><p><code>è¯´æ˜ï¼š</code></p><pre><code>1. å¦‚æœ sleep 7sï¼Œç¬¬ä¸€æ¬¡æ£€æµ‹å‘ç°å¤±è´¥ï¼Œä½†æ˜¯ç¬¬äºŒæ¬¡æ£€æµ‹å‘ç°æˆåŠŸåå®¹å™¨å°±ä¸€ç›´å¤„äºå¥åº·çŠ¶æ€ä¸ä¼šé‡å¯ã€‚1. å¦‚æœ sleep 30sï¼Œç¬¬ä¸€æ¬¡æ£€æµ‹å¤±è´¥ï¼Œè¶…è¿‡ 3 æ¬¡æ£€æµ‹åŒæ ·å¤±è´¥ï¼Œk8s å°±å›æ€æ­»å®¹å™¨è¿›è¡Œé‡å¯ï¼Œåå¤å¾ªç¯è¿™ä¸ªè¿‡ç¨‹ã€‚</code></pre></blockquote><ul><li><strong>tcpSocket</strong></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">liveness-tcpsocket</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">tcpsocket:</span> <span class="string">tcpsocket</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:1.19</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">args:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/bin/sh</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">-c</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">sleep</span> <span class="number">7</span><span class="string">;nginx</span> <span class="string">-g</span> <span class="string">&quot;daemon off;&quot;</span>  <span class="comment">#è¿™ä¸€æ­¥ä¼šå’Œåˆå§‹åŒ–åŒæ—¶å¼€å§‹è¿è¡Œï¼Œä¹Ÿå°±æ˜¯åœ¨åˆå§‹åŒ–5såå’Œ7ç§’ä¹‹é—´ï¼Œä¼šæ£€æµ‹å‡ºä¸€æ¬¡å¤±è´¥ï¼Œ7ç§’åå¯åŠ¨åæ£€æµ‹æ­£å¸¸ï¼Œæ‰€ä»¥podä¸ä¼šé‡å¯</span></span><br><span class="line">    <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">    <span class="comment"># æ¢æµ‹ç±»å‹ï¼šlivenessProbe | readinessProbe | startupProbe</span></span><br><span class="line">    <span class="attr">livenessProbe:</span></span><br><span class="line">      <span class="attr">tcpSocket:</span></span><br><span class="line">        <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">      <span class="attr">initialDelaySeconds:</span> <span class="number">5</span>   <span class="comment">#åˆå§‹åŒ–æ—¶é—´5s</span></span><br><span class="line">      <span class="attr">periodSeconds:</span> <span class="number">4</span>    <span class="comment">#æ£€æµ‹é—´éš”æ—¶é—´4s</span></span><br><span class="line">      <span class="attr">timeoutSeconds:</span> <span class="number">1</span>   <span class="comment">#é»˜è®¤æ£€æµ‹è¶…æ—¶æ—¶é—´ä¸º1s</span></span><br><span class="line">      <span class="attr">failureThreshold:</span> <span class="number">3</span>   <span class="comment">#é»˜è®¤å¤±è´¥æ¬¡æ•°ä¸º3æ¬¡ï¼Œè¾¾åˆ°3æ¬¡åé‡å¯pod</span></span><br><span class="line">      <span class="attr">successThreshold:</span> <span class="number">1</span>   <span class="comment">#é»˜è®¤æˆåŠŸæ¬¡æ•°ä¸º1æ¬¡ï¼Œ1 æ¬¡ä»£è¡¨æˆåŠŸ</span></span><br></pre></td></tr></table></figure><ul><li><strong>httpGet</strong></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># probe-liveness-httget.yml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">liveness-httpget</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">httpget:</span> <span class="string">httpget</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:1.19</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">args:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/bin/sh</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">-c</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">sleep</span> <span class="number">7</span><span class="string">;nginx</span> <span class="string">-g</span> <span class="string">&quot;daemon off;&quot;</span> <span class="comment">#è¿™ä¸€æ­¥ä¼šå’Œåˆå§‹åŒ–åŒæ—¶å¼€å§‹è¿è¡Œï¼Œä¹Ÿå°±æ˜¯åœ¨åˆå§‹åŒ–5såå’Œ7ç§’ä¹‹é—´ï¼Œä¼šæ£€æµ‹å‡ºä¸€æ¬¡å¤±è´¥ï¼Œ7ç§’åå¯åŠ¨åæ£€æµ‹æ­£å¸¸ï¼Œæ‰€ä»¥podä¸ä¼šé‡å¯</span></span><br><span class="line">    <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">    <span class="comment"># æ¢æµ‹ç±»å‹ï¼šlivenessProbe | readinessProbe | startupProbe</span></span><br><span class="line">    <span class="attr">livenessProbe:</span></span><br><span class="line">      <span class="attr">httpGet:</span>     <span class="comment">#httpget</span></span><br><span class="line">        <span class="attr">port:</span> <span class="number">80</span>   <span class="comment">#è®¿é—®çš„ç«¯å£</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/index.html</span>   <span class="comment">#è®¿é—®çš„è·¯å¾„</span></span><br><span class="line">      <span class="attr">initialDelaySeconds:</span> <span class="number">5</span>   <span class="comment">#åˆå§‹åŒ–æ—¶é—´5s</span></span><br><span class="line">      <span class="attr">periodSeconds:</span> <span class="number">4</span>    <span class="comment">#æ£€æµ‹é—´éš”æ—¶é—´4s</span></span><br><span class="line">      <span class="attr">timeoutSeconds:</span> <span class="number">1</span>   <span class="comment">#é»˜è®¤æ£€æµ‹è¶…æ—¶æ—¶é—´ä¸º1s</span></span><br><span class="line">      <span class="attr">failureThreshold:</span> <span class="number">3</span>   <span class="comment">#é»˜è®¤å¤±è´¥æ¬¡æ•°ä¸º3æ¬¡ï¼Œè¾¾åˆ°3æ¬¡åé‡å¯pod</span></span><br><span class="line">      <span class="attr">successThreshold:</span> <span class="number">1</span>   <span class="comment">#é»˜è®¤æˆåŠŸæ¬¡æ•°ä¸º1æ¬¡ï¼Œ1 æ¬¡ä»£è¡¨æˆåŠŸ</span></span><br></pre></td></tr></table></figure><ul><li><p>GRPC æ¢é’ˆ</p><blockquote><p> å®˜æ–¹å‚è€ƒåœ°å€: <a href="https://kubernetes.io/zh-cn/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/">https://kubernetes.io/zh-cn/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/</a></p></blockquote></li></ul><h3 id="6-6-èµ„æºé™åˆ¶"><a href="#6-6-èµ„æºé™åˆ¶" class="headerlink" title="6.6 èµ„æºé™åˆ¶"></a>6.6 èµ„æºé™åˆ¶</h3><p>åœ¨k8sä¸­å¯¹äºå®¹å™¨èµ„æºé™åˆ¶ä¸»è¦åˆ†ä¸ºä»¥ä¸‹ä¸¤ç±»:</p><ul><li>å†…å­˜èµ„æºé™åˆ¶: å†…å­˜<strong>è¯·æ±‚</strong>ï¼ˆrequestï¼‰å’Œå†…å­˜<strong>é™åˆ¶</strong>ï¼ˆlimitï¼‰åˆ†é…ç»™ä¸€ä¸ªå®¹å™¨ã€‚ æˆ‘ä»¬ä¿éšœå®¹å™¨æ‹¥æœ‰å®ƒè¯·æ±‚æ•°é‡çš„å†…å­˜ï¼Œä½†ä¸å…è®¸ä½¿ç”¨è¶…è¿‡é™åˆ¶æ•°é‡çš„å†…å­˜ã€‚<ul><li>å®˜ç½‘å‚è€ƒåœ°å€: <a href="https://kubernetes.io/zh-cn/docs/tasks/configure-pod-container/assign-memory-resource/">https://kubernetes.io/zh-cn/docs/tasks/configure-pod-container/assign-memory-resource/</a></li></ul></li><li>CPU èµ„æºé™åˆ¶: ä¸ºå®¹å™¨è®¾ç½® CPU <strong>requestï¼ˆè¯·æ±‚ï¼‰</strong> å’Œ CPU <strong>limitï¼ˆé™åˆ¶ï¼‰</strong>ã€‚ å®¹å™¨ä½¿ç”¨çš„ CPU ä¸èƒ½è¶…è¿‡æ‰€é…ç½®çš„é™åˆ¶ã€‚ å¦‚æœç³»ç»Ÿæœ‰ç©ºé—²çš„ CPU æ—¶é—´ï¼Œåˆ™å¯ä»¥ä¿è¯ç»™å®¹å™¨åˆ†é…å…¶æ‰€è¯·æ±‚æ•°é‡çš„ CPU èµ„æºã€‚<ul><li>å®˜ç½‘å‚è€ƒåœ°å€: <a href="https://kubernetes.io/zh-cn/docs/tasks/configure-pod-container/assign-cpu-resource/">https://kubernetes.io/zh-cn/docs/tasks/configure-pod-container/assign-cpu-resource/</a></li></ul></li></ul><p>è¯·æ±‚ï¼ˆæœ€å°é™åˆ¶å†…å­˜ï¼‰ request memory cpu :å¯ä»¥ä½¿ç”¨çš„åŸºç¡€èµ„æº  100M</p><p>é™åˆ¶ï¼ˆæœ€å¤§é™åˆ¶å†…å­˜ï¼‰ limit   memory cpu :å¯ä»¥ä½¿ç”¨çš„æœ€å¤§èµ„æº  200M è¶…è¿‡æœ€å¤§èµ„æºä¹‹åå®¹å™¨ä¼šè¢« kill , OOM é”™è¯¯</p><h4 id="1-metrics-server"><a href="#1-metrics-server" class="headerlink" title="1 metrics-server"></a><strong>1 metrics-server</strong></h4><blockquote><p>å®˜ç½‘åœ°å€: <a href="https://github.com/kubernetes-sigs/metrics-server">https://github.com/kubernetes-sigs/metrics-server</a></p></blockquote><p><strong>Kubernetes Metrics Server</strong> (KubernetesæŒ‡æ ‡æœåŠ¡å™¨)ï¼Œå®ƒæ˜¯ä¸€ä¸ª<strong>å¯æ‰©å±•çš„ã€é«˜æ•ˆçš„å®¹å™¨èµ„æºåº¦é‡æº</strong>ã€‚Metrics Server ç”¨äºç›‘æ§æ¯ä¸ª Node å’Œ Pod çš„è´Ÿè½½ï¼ˆç”¨äºKuberneteså†…ç½®è‡ªåŠ¨æ‰©ç¼©ç®¡é“ï¼‰ã€‚Metrics Server ä»Kubelets æ”¶é›†èµ„æºæŒ‡æ ‡ï¼Œå¹¶é€šè¿‡ Metrics API åœ¨Kubernetes apiserverä¸­å…¬å¼€ï¼Œä¾› Horizontal Pod Autoscaler å’Œ Vertical Pod Autoscaler ä½¿ç”¨ã€‚Metrics API ä¹Ÿå¯ä»¥é€šè¿‡ kubectl top è®¿é—®ï¼Œä½¿å…¶æ›´å®¹æ˜“è°ƒè¯•è‡ªåŠ¨æ‰©ç¼©ç®¡é“ã€‚</p><ul><li>æŸ¥çœ‹ metrics-serverï¼ˆæˆ–è€…å…¶ä»–èµ„æºæŒ‡æ ‡ API <code>metrics.k8s.io</code> æœåŠ¡æä¾›è€…ï¼‰æ˜¯å¦æ­£åœ¨è¿è¡Œï¼Œ è¯·é”®å…¥ä»¥ä¸‹å‘½ä»¤ï¼š</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get apiservices</span><br></pre></td></tr></table></figure><ul><li>å¦‚æœèµ„æºæŒ‡æ ‡ API å¯ç”¨ï¼Œåˆ™ä¼šè¾“å‡ºå°†åŒ…å«ä¸€ä¸ªå¯¹ <code>metrics.k8s.io</code> çš„å¼•ç”¨ã€‚</li></ul><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">NAME</span><br><span class="line">v1beta1<span class="selector-class">.metrics</span><span class="selector-class">.k8s</span>.io</span><br></pre></td></tr></table></figure><ul><li>å®‰è£… metrics-server</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># components.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">k8s-app:</span> <span class="string">metrics-server</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">metrics-server</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">k8s-app:</span> <span class="string">metrics-server</span></span><br><span class="line">    <span class="attr">rbac.authorization.k8s.io/aggregate-to-admin:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line">    <span class="attr">rbac.authorization.k8s.io/aggregate-to-edit:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line">    <span class="attr">rbac.authorization.k8s.io/aggregate-to-view:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">system:aggregated-metrics-reader</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">metrics.k8s.io</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">pods</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">nodes</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">watch</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">k8s-app:</span> <span class="string">metrics-server</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">system:metrics-server</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">nodes/metrics</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">pods</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">nodes</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">watch</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">RoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">k8s-app:</span> <span class="string">metrics-server</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">metrics-server-auth-reader</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">Role</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">extension-apiserver-authentication-reader</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">metrics-server</span></span><br><span class="line">    <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">k8s-app:</span> <span class="string">metrics-server</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">metrics-server:system:auth-delegator</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">system:auth-delegator</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">metrics-server</span></span><br><span class="line">    <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">k8s-app:</span> <span class="string">metrics-server</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">system:metrics-server</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">system:metrics-server</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">metrics-server</span></span><br><span class="line">    <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">k8s-app:</span> <span class="string">metrics-server</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">metrics-server</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">https</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">443</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="string">https</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">k8s-app:</span> <span class="string">metrics-server</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">k8s-app:</span> <span class="string">metrics-server</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">metrics-server</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">k8s-app:</span> <span class="string">metrics-server</span></span><br><span class="line">  <span class="attr">strategy:</span></span><br><span class="line">    <span class="attr">rollingUpdate:</span></span><br><span class="line">      <span class="attr">maxUnavailable:</span> <span class="number">0</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">k8s-app:</span> <span class="string">metrics-server</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">args:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">--cert-dir=/tmp</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">--secure-port=4443</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">--kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">--kubelet-use-node-status-port</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">--metric-resolution=15s</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">--kubelet-insecure-tls</span> <span class="comment">#ä¿®æ”¹å»æ‰è¯ä¹¦éªŒè¯</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">dyrnq/metrics-server:v0.6.2</span> <span class="comment">#ä¿®æ”¹å®˜æ–¹æ— æ³•ä¸‹è½½</span></span><br><span class="line">          <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">          <span class="attr">livenessProbe:</span></span><br><span class="line">            <span class="attr">failureThreshold:</span> <span class="number">3</span></span><br><span class="line">            <span class="attr">httpGet:</span></span><br><span class="line">              <span class="attr">path:</span> <span class="string">/livez</span></span><br><span class="line">              <span class="attr">port:</span> <span class="string">https</span></span><br><span class="line">              <span class="attr">scheme:</span> <span class="string">HTTPS</span></span><br><span class="line">            <span class="attr">periodSeconds:</span> <span class="number">10</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">metrics-server</span></span><br><span class="line">          <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">4443</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">https</span></span><br><span class="line">              <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">          <span class="attr">readinessProbe:</span></span><br><span class="line">            <span class="attr">failureThreshold:</span> <span class="number">3</span></span><br><span class="line">            <span class="attr">httpGet:</span></span><br><span class="line">              <span class="attr">path:</span> <span class="string">/readyz</span></span><br><span class="line">              <span class="attr">port:</span> <span class="string">https</span></span><br><span class="line">              <span class="attr">scheme:</span> <span class="string">HTTPS</span></span><br><span class="line">            <span class="attr">initialDelaySeconds:</span> <span class="number">20</span></span><br><span class="line">            <span class="attr">periodSeconds:</span> <span class="number">10</span></span><br><span class="line">          <span class="attr">resources:</span></span><br><span class="line">            <span class="attr">requests:</span></span><br><span class="line">              <span class="attr">cpu:</span> <span class="string">100m</span></span><br><span class="line">              <span class="attr">memory:</span> <span class="string">200Mi</span></span><br><span class="line">          <span class="attr">securityContext:</span></span><br><span class="line">            <span class="attr">allowPrivilegeEscalation:</span> <span class="literal">false</span></span><br><span class="line">            <span class="attr">readOnlyRootFilesystem:</span> <span class="literal">true</span></span><br><span class="line">            <span class="attr">runAsNonRoot:</span> <span class="literal">true</span></span><br><span class="line">            <span class="attr">runAsUser:</span> <span class="number">1000</span></span><br><span class="line">          <span class="attr">volumeMounts:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/tmp</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">tmp-dir</span></span><br><span class="line">      <span class="attr">hostNetwork:</span> <span class="literal">true</span>  <span class="comment">#å¿…é¡»æŒ‡å®šè¿™ä¸ªæ‰è¡Œ</span></span><br><span class="line">      <span class="attr">nodeSelector:</span></span><br><span class="line">        <span class="attr">kubernetes.io/os:</span> <span class="string">linux</span></span><br><span class="line">      <span class="attr">priorityClassName:</span> <span class="string">system-cluster-critical</span></span><br><span class="line">      <span class="attr">serviceAccountName:</span> <span class="string">metrics-server</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">emptyDir:</span> &#123;&#125;</span><br><span class="line">          <span class="attr">name:</span> <span class="string">tmp-dir</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apiregistration.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">APIService</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">k8s-app:</span> <span class="string">metrics-server</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">v1beta1.metrics.k8s.io</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">group:</span> <span class="string">metrics.k8s.io</span></span><br><span class="line">  <span class="attr">groupPriorityMinimum:</span> <span class="number">100</span></span><br><span class="line">  <span class="attr">insecureSkipTLSVerify:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">service:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">metrics-server</span></span><br><span class="line">    <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line">  <span class="attr">version:</span> <span class="string">v1beta1</span></span><br><span class="line">  <span class="attr">versionPriority:</span> <span class="number">100</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl appply -f components.yaml</span><br></pre></td></tr></table></figure><h4 id="2-æŒ‡å®šå†…å­˜è¯·æ±‚å’Œé™åˆ¶"><a href="#2-æŒ‡å®šå†…å­˜è¯·æ±‚å’Œé™åˆ¶" class="headerlink" title="2 æŒ‡å®šå†…å­˜è¯·æ±‚å’Œé™åˆ¶"></a><strong>2 æŒ‡å®šå†…å­˜è¯·æ±‚å’Œé™åˆ¶</strong></h4><p>å®˜ç½‘: <a href="https://kubernetes.io/zh-cn/docs/tasks/configure-pod-container/assign-memory-resource/">https://kubernetes.io/zh-cn/docs/tasks/configure-pod-container/assign-memory-resource/</a></p><p>ä¸ºå®¹å™¨æŒ‡å®šå†…å­˜è¯·æ±‚ï¼Œè¯·åœ¨å®¹å™¨èµ„æºæ¸…å•ä¸­åŒ…å« <code>resourcesï¼šrequests</code> å­—æ®µã€‚ åŒç†ï¼Œè¦æŒ‡å®šå†…å­˜é™åˆ¶ï¼Œè¯·åŒ…å« <code>resourcesï¼šlimits</code>ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nginx-memory-demo.yaml</span></span><br><span class="line"><span class="comment">#å†…å­˜èµ„æºçš„åŸºæœ¬å•ä½æ˜¯å­—èŠ‚ï¼ˆbyteï¼‰ã€‚ä½ å¯ä»¥ä½¿ç”¨è¿™äº›åç¼€ä¹‹ä¸€ï¼Œå°†å†…å­˜è¡¨ç¤ºä¸º çº¯æ•´æ•°æˆ–å®šç‚¹æ•´æ•°ï¼šEã€Pã€Tã€Gã€Mã€Kã€Eiã€Piã€Tiã€Giã€Miã€Kiã€‚ ä¾‹å¦‚ï¼Œä¸‹é¢æ˜¯ä¸€äº›è¿‘ä¼¼ç›¸åŒçš„å€¼ï¼š128974848, 129e6, 129M, 123Mi</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-memory-demo</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx-memory-demo</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:1.19</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="attr">requests:</span></span><br><span class="line">        <span class="attr">memory:</span> <span class="string">&quot;100Mi&quot;</span> </span><br><span class="line">      <span class="attr">limits:</span></span><br><span class="line">        <span class="attr">memory:</span> <span class="string">&quot;200Mi&quot;</span></span><br></pre></td></tr></table></figure><ul><li><code>æŸ¥çœ‹å®¹å™¨å†…å­˜ä½¿ç”¨æƒ…å†µ</code></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pod nginx-memory-demo --output=yaml</span><br></pre></td></tr></table></figure><ul><li><code>æŸ¥çœ‹å®¹å™¨æ­£åœ¨ä½¿ç”¨å†…å­˜æƒ…å†µ</code></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl top pod nginx-memory-demo </span><br></pre></td></tr></table></figure><ul><li><p><code>å†…å­˜è¯·æ±‚å’Œé™åˆ¶çš„ç›®çš„</code></p><p>é€šè¿‡ä¸ºé›†ç¾¤ä¸­è¿è¡Œçš„å®¹å™¨é…ç½®å†…å­˜è¯·æ±‚å’Œé™åˆ¶ï¼Œä½ å¯ä»¥æœ‰æ•ˆåˆ©ç”¨é›†ç¾¤èŠ‚ç‚¹ä¸Šå¯ç”¨çš„å†…å­˜èµ„æºã€‚ é€šè¿‡å°† Pod çš„å†…å­˜è¯·æ±‚ä¿æŒåœ¨è¾ƒä½æ°´å¹³ï¼Œä½ å¯ä»¥æ›´å¥½åœ°å®‰æ’ Pod è°ƒåº¦ã€‚ é€šè¿‡è®©å†…å­˜é™åˆ¶å¤§äºå†…å­˜è¯·æ±‚ï¼Œä½ å¯ä»¥å®Œæˆä¸¤ä»¶äº‹ï¼š</p><ul><li>Pod å¯ä»¥è¿›è¡Œä¸€äº›çªå‘æ´»åŠ¨ï¼Œä»è€Œæ›´å¥½çš„åˆ©ç”¨å¯ç”¨å†…å­˜ã€‚</li><li>Pod åœ¨çªå‘æ´»åŠ¨æœŸé—´ï¼Œå¯ä½¿ç”¨çš„å†…å­˜è¢«é™åˆ¶ä¸ºåˆç†çš„æ•°é‡ã€‚</li></ul></li><li><p><code>æ²¡æœ‰æŒ‡å®šå†…å­˜é™åˆ¶</code></p><p>å¦‚æœä½ æ²¡æœ‰ä¸ºä¸€ä¸ªå®¹å™¨æŒ‡å®šå†…å­˜é™åˆ¶ï¼Œåˆ™è‡ªåŠ¨éµå¾ªä»¥ä¸‹æƒ…å†µä¹‹ä¸€ï¼š</p><ul><li>å®¹å™¨å¯æ— é™åˆ¶åœ°ä½¿ç”¨å†…å­˜ã€‚å®¹å™¨å¯ä»¥ä½¿ç”¨å…¶æ‰€åœ¨èŠ‚ç‚¹æ‰€æœ‰çš„å¯ç”¨å†…å­˜ï¼Œ è¿›è€Œå¯èƒ½å¯¼è‡´è¯¥èŠ‚ç‚¹è°ƒç”¨ OOM Killerã€‚ æ­¤å¤–ï¼Œå¦‚æœå‘ç”Ÿ OOM Killï¼Œæ²¡æœ‰èµ„æºé™åˆ¶çš„å®¹å™¨å°†è¢«æ€æ‰çš„å¯è¡Œæ€§æ›´å¤§ã€‚</li><li>è¿è¡Œçš„å®¹å™¨æ‰€åœ¨å‘½åç©ºé—´æœ‰é»˜è®¤çš„å†…å­˜é™åˆ¶ï¼Œé‚£ä¹ˆè¯¥å®¹å™¨ä¼šè¢«è‡ªåŠ¨åˆ†é…é»˜è®¤é™åˆ¶ã€‚</li></ul></li></ul><h4 id="3-æŒ‡å®š-CPU-è¯·æ±‚å’Œé™åˆ¶"><a href="#3-æŒ‡å®š-CPU-è¯·æ±‚å’Œé™åˆ¶" class="headerlink" title="3 æŒ‡å®š CPU è¯·æ±‚å’Œé™åˆ¶"></a><strong>3 æŒ‡å®š CPU è¯·æ±‚å’Œé™åˆ¶</strong></h4><p>å®˜ç½‘: <a href="https://kubernetes.io/zh-cn/docs/tasks/configure-pod-container/assign-cpu-resource/">https://kubernetes.io/zh-cn/docs/tasks/configure-pod-container/assign-cpu-resource/</a></p><p>ä¸ºå®¹å™¨æŒ‡å®š CPU è¯·æ±‚ï¼Œè¯·åœ¨å®¹å™¨èµ„æºæ¸…å•ä¸­åŒ…å« <code>resources: requests</code> å­—æ®µã€‚ è¦æŒ‡å®š CPU é™åˆ¶ï¼Œè¯·åŒ…å« <code>resources:limits</code>ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nginx-cpu-demo.yaml</span></span><br><span class="line"><span class="comment">#CPU èµ„æºä»¥ CPU å•ä½åº¦é‡ã€‚å°æ•°å€¼æ˜¯å¯ä»¥ä½¿ç”¨çš„ã€‚ä¸€ä¸ªè¯·æ±‚ 0.5 CPU çš„å®¹å™¨ä¿è¯ä¼šè·å¾—è¯·æ±‚ 1 ä¸ª CPU çš„å®¹å™¨çš„ CPU çš„ä¸€åŠã€‚ ä½ å¯ä»¥ä½¿ç”¨åç¼€ m è¡¨ç¤ºæ¯«ã€‚ä¾‹å¦‚ 100m CPUã€100 milliCPU å’Œ 0.1 CPU éƒ½ç›¸åŒã€‚ CPU è¯·æ±‚åªèƒ½ä½¿ç”¨ç»å¯¹æ•°é‡ï¼Œè€Œä¸æ˜¯ç›¸å¯¹æ•°é‡ã€‚0.1 åœ¨å•æ ¸ã€åŒæ ¸æˆ– 48 æ ¸è®¡ç®—æœºä¸Šçš„ CPU æ•°é‡å€¼æ˜¯ä¸€æ ·çš„ã€‚</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-cpu-demo</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx-cpu-demo</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:1.19</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="attr">limits:</span></span><br><span class="line">        <span class="attr">cpu:</span> <span class="string">&quot;1&quot;</span></span><br><span class="line">      <span class="attr">requests:</span></span><br><span class="line">        <span class="attr">cpu:</span> <span class="string">&quot;0.5&quot;</span></span><br></pre></td></tr></table></figure><ul><li>æ˜¾ç¤º pod è¯¦ç»†ä¿¡æ¯</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pod nginx-cpu-demo --output=yaml </span><br></pre></td></tr></table></figure><ul><li>æ˜¾ç¤º pod è¿è¡ŒæŒ‡æ ‡</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl top pod nginx-cpu-demo</span><br></pre></td></tr></table></figure><ul><li><p><code>CPU è¯·æ±‚å’Œé™åˆ¶çš„åˆè¡·</code></p><p>é€šè¿‡é…ç½®ä½ çš„é›†ç¾¤ä¸­è¿è¡Œçš„å®¹å™¨çš„ CPU è¯·æ±‚å’Œé™åˆ¶ï¼Œä½ å¯ä»¥æœ‰æ•ˆåˆ©ç”¨é›†ç¾¤ä¸Šå¯ç”¨çš„ CPU èµ„æºã€‚ é€šè¿‡å°† Pod CPU è¯·æ±‚ä¿æŒåœ¨è¾ƒä½æ°´å¹³ï¼Œå¯ä»¥ä½¿ Pod æ›´æœ‰æœºä¼šè¢«è°ƒåº¦ã€‚ é€šè¿‡ä½¿ CPU é™åˆ¶å¤§äº CPU è¯·æ±‚ï¼Œä½ å¯ä»¥å®Œæˆä¸¤ä»¶äº‹ï¼š</p><ul><li>Pod å¯èƒ½ä¼šæœ‰çªå‘æ€§çš„æ´»åŠ¨ï¼Œå®ƒå¯ä»¥åˆ©ç”¨ç¢°å·§å¯ç”¨çš„ CPU èµ„æºã€‚</li><li>Pod åœ¨çªå‘è´Ÿè½½æœŸé—´å¯ä»¥ä½¿ç”¨çš„ CPU èµ„æºæ•°é‡ä»è¢«é™åˆ¶ä¸ºåˆç†çš„æ•°é‡ã€‚</li></ul></li><li><p><code>å¦‚æœä¸æŒ‡å®š CPU é™åˆ¶</code></p><p>å¦‚æœä½ æ²¡æœ‰ä¸ºå®¹å™¨æŒ‡å®š CPU é™åˆ¶ï¼Œåˆ™ä¼šå‘ç”Ÿä»¥ä¸‹æƒ…å†µä¹‹ä¸€ï¼š</p><ul><li><p>å®¹å™¨åœ¨å¯ä»¥ä½¿ç”¨çš„ CPU èµ„æºä¸Šæ²¡æœ‰ä¸Šé™ã€‚å› è€Œå¯ä»¥ä½¿ç”¨æ‰€åœ¨èŠ‚ç‚¹ä¸Šæ‰€æœ‰çš„å¯ç”¨ CPU èµ„æºã€‚</p></li><li><p>å®¹å™¨åœ¨å…·æœ‰é»˜è®¤ CPU é™åˆ¶çš„åå­—ç©ºé—´ä¸­è¿è¡Œï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä¸ºå®¹å™¨è®¾ç½®é»˜è®¤é™åˆ¶ã€‚</p></li></ul></li><li><p><code>å¦‚æœä½ è®¾ç½®äº† CPU é™åˆ¶ä½†æœªè®¾ç½® CPU è¯·æ±‚</code></p></li></ul><p>â€‹    å¦‚æœä½ ä¸ºå®¹å™¨æŒ‡å®šäº† CPU é™åˆ¶å€¼ä½†æœªä¸ºå…¶è®¾ç½® CPU è¯·æ±‚ï¼ŒKubernetes ä¼šè‡ªåŠ¨ä¸ºå…¶ è®¾ç½®ä¸ CPU é™åˆ¶ç›¸åŒçš„ CPU è¯·æ±‚å€¼ã€‚ç±»ä¼¼çš„ï¼Œå¦‚æœå®¹å™¨è®¾ç½®äº†å†…å­˜é™åˆ¶å€¼ä½†æœªè®¾ç½® å†…å­˜è¯·æ±‚å€¼ï¼ŒKubernetes ä¹Ÿä¼šä¸ºå…¶è®¾ç½®ä¸å†…å­˜é™åˆ¶å€¼ç›¸åŒçš„å†…å­˜è¯·æ±‚ã€‚</p><h2 id="7-Pod-ä¸­-init-å®¹å™¨"><a href="#7-Pod-ä¸­-init-å®¹å™¨" class="headerlink" title="7 Pod ä¸­ init å®¹å™¨"></a>7 Pod ä¸­ init å®¹å™¨</h2><p>Init å®¹å™¨æ˜¯ä¸€ç§ç‰¹æ®Šå®¹å™¨ï¼Œåœ¨Pod å†…çš„åº”ç”¨å®¹å™¨å¯åŠ¨ä¹‹å‰è¿è¡Œã€‚Init å®¹å™¨å¯ä»¥åŒ…æ‹¬ä¸€äº›åº”ç”¨é•œåƒä¸­ä¸å­˜åœ¨çš„å®ç”¨å·¥å…·å’Œå®‰è£…è„šæœ¬ã€‚</p><h3 id="7-1-init-å®¹å™¨ç‰¹ç‚¹"><a href="#7-1-init-å®¹å™¨ç‰¹ç‚¹" class="headerlink" title="7.1 init å®¹å™¨ç‰¹ç‚¹"></a>7.1 init å®¹å™¨ç‰¹ç‚¹</h3><p>init å®¹å™¨ä¸æ™®é€šçš„å®¹å™¨éå¸¸åƒï¼Œé™¤äº†å¦‚ä¸‹å‡ ç‚¹ï¼š</p><ul><li>å®ƒä»¬æ€»æ˜¯è¿è¡Œåˆ°å®Œæˆã€‚å¦‚æœ Pod çš„ Init å®¹å™¨å¤±è´¥ï¼Œkubelet ä¼šä¸æ–­åœ°é‡å¯è¯¥ Init å®¹å™¨ç›´åˆ°è¯¥å®¹å™¨æˆåŠŸä¸ºæ­¢ã€‚ ç„¶è€Œï¼Œå¦‚æœ Pod å¯¹åº”çš„ <code>restartPolicy</code> å€¼ä¸º â€œNeverâ€ï¼Œå¹¶ä¸” Pod çš„ Init å®¹å™¨å¤±è´¥ï¼Œ åˆ™ Kubernetes ä¼šå°†æ•´ä¸ª Pod çŠ¶æ€è®¾ç½®ä¸ºå¤±è´¥ã€‚</li><li>æ¯ä¸ªéƒ½å¿…é¡»åœ¨ä¸‹ä¸€ä¸ªå¯åŠ¨ä¹‹å‰æˆåŠŸå®Œæˆã€‚</li><li>åŒæ—¶ Init å®¹å™¨ä¸æ”¯æŒ <code>lifecycle</code>ã€<code>livenessProbe</code>ã€<code>readinessProbe</code> å’Œ <code>startupProbe</code>ï¼Œ å› ä¸ºå®ƒä»¬å¿…é¡»åœ¨ Pod å°±ç»ªä¹‹å‰è¿è¡Œå®Œæˆã€‚</li><li>å¦‚æœä¸ºä¸€ä¸ª Pod æŒ‡å®šäº†å¤šä¸ª Init å®¹å™¨ï¼Œè¿™äº›å®¹å™¨ä¼šæŒ‰é¡ºåºé€ä¸ªè¿è¡Œã€‚ æ¯ä¸ª Init å®¹å™¨å¿…é¡»è¿è¡ŒæˆåŠŸï¼Œä¸‹ä¸€ä¸ªæ‰èƒ½å¤Ÿè¿è¡Œã€‚å½“æ‰€æœ‰çš„ Init å®¹å™¨è¿è¡Œå®Œæˆæ—¶ï¼Œ Kubernetes æ‰ä¼šä¸º Pod åˆå§‹åŒ–åº”ç”¨å®¹å™¨å¹¶åƒå¹³å¸¸ä¸€æ ·è¿è¡Œã€‚</li><li>Init å®¹å™¨æ”¯æŒåº”ç”¨å®¹å™¨çš„å…¨éƒ¨å­—æ®µå’Œç‰¹æ€§ï¼ŒåŒ…æ‹¬èµ„æºé™åˆ¶ã€æ•°æ®å·å’Œå®‰å…¨è®¾ç½®ã€‚ ç„¶è€Œï¼ŒInit å®¹å™¨å¯¹èµ„æºè¯·æ±‚å’Œé™åˆ¶çš„å¤„ç†ç¨æœ‰ä¸åŒã€‚</li></ul><h3 id="7-2-ä½¿ç”¨-init-å®¹å™¨"><a href="#7-2-ä½¿ç”¨-init-å®¹å™¨" class="headerlink" title="7.2 ä½¿ç”¨ init å®¹å™¨"></a>7.2 ä½¿ç”¨ init å®¹å™¨</h3><blockquote><p>å®˜ç½‘åœ°å€: <a href="https://kubernetes.io/zh-cn/docs/concepts/workloads/pods/init-containers/">https://kubernetes.io/zh-cn/docs/concepts/workloads/pods/init-containers/</a></p></blockquote><p>åœ¨ Pod çš„è§„çº¦ä¸­ä¸ç”¨æ¥æè¿°åº”ç”¨å®¹å™¨çš„ <code>containers</code> æ•°ç»„å¹³è¡Œçš„ä½ç½®æŒ‡å®š Init å®¹å™¨ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">init-demo</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">myapp-container</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busybox:1.28</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&#x27;sh&#x27;</span>, <span class="string">&#x27;-c&#x27;</span>, <span class="string">&#x27;echo The app is running! &amp;&amp; sleep 3600&#x27;</span>]</span><br><span class="line">  <span class="attr">initContainers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">init-myservice</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busybox:1.28</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&#x27;sh&#x27;</span>, <span class="string">&#x27;-c&#x27;</span>, <span class="string">&#x27;echo init-myservice is running! &amp;&amp; sleep 5&#x27;</span>]</span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">init-mydb</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busybox:1.28</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&#x27;sh&#x27;</span>, <span class="string">&#x27;-c&#x27;</span>, <span class="string">&#x27;echo init-mydb is running! &amp;&amp; sleep 10&#x27;</span>]</span><br></pre></td></tr></table></figure><ul><li>æŸ¥çœ‹å¯åŠ¨è¯¦ç»†</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">kubectl describe pod init-demo</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">éƒ¨åˆ†ç»“æœ</span></span><br><span class="line">Events:</span><br><span class="line">  Type    Reason     Age    From               Message</span><br><span class="line">  ----    ------     ----   ----               -------</span><br><span class="line">  Normal  Scheduled  2m16s  default-scheduler  Successfully assigned default/init-demo to k8s-node2</span><br><span class="line">  Normal  Pulling    2m16s  kubelet            Pulling image &quot;busybox:1.28&quot;</span><br><span class="line">  Normal  Pulled     118s   kubelet            Successfully pulled image &quot;busybox:1.28&quot; in 17.370617268s (17.370620685s including waiting)</span><br><span class="line">  Normal  Created    118s   kubelet            Created container init-myservice</span><br><span class="line">  Normal  Started    118s   kubelet            Started container init-myservice</span><br><span class="line">  Normal  Pulled     112s   kubelet            Container image &quot;busybox:1.28&quot; already present on machine</span><br><span class="line">  Normal  Created    112s   kubelet            Created container init-mydb</span><br><span class="line">  Normal  Started    112s   kubelet            Started container init-mydb</span><br><span class="line">  Normal  Pulled     101s   kubelet            Container image &quot;busybox:1.28&quot; already present on machine</span><br><span class="line">  Normal  Created    101s   kubelet            Created container myapp-container</span><br><span class="line">  Normal  Started    101s   kubelet            Started container myapp-container</span><br></pre></td></tr></table></figure><h2 id="8-èŠ‚ç‚¹äº²å’Œæ€§åˆ†é…-Pod"><a href="#8-èŠ‚ç‚¹äº²å’Œæ€§åˆ†é…-Pod" class="headerlink" title="8 èŠ‚ç‚¹äº²å’Œæ€§åˆ†é… Pod"></a>8 èŠ‚ç‚¹äº²å’Œæ€§åˆ†é… Pod</h2><blockquote><p> å®˜æ–¹åœ°å€: <a href="http://kubernetes.p2hp.com/docs/concepts/scheduling-eviction/assign-pod-node.html">http://kubernetes.p2hp.com/docs/concepts/scheduling-eviction/assign-pod-node.html</a></p></blockquote><p>ä½ å¯ä»¥çº¦æŸä¸€ä¸ª Pod ä»¥ä¾¿ <strong>é™åˆ¶</strong> å…¶åªèƒ½åœ¨ç‰¹å®šçš„èŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œ æˆ–ä¼˜å…ˆåœ¨ç‰¹å®šçš„èŠ‚ç‚¹ä¸Šè¿è¡Œã€‚ æœ‰å‡ ç§æ–¹æ³•å¯ä»¥å®ç°è¿™ç‚¹ï¼Œæ¨èçš„æ–¹æ³•éƒ½æ˜¯ç”¨ <strong>æ ‡ç­¾é€‰æ‹©ç®—ç¬¦</strong>æ¥è¿›è¡Œé€‰æ‹©ã€‚ é€šå¸¸è¿™æ ·çš„çº¦æŸä¸æ˜¯å¿…é¡»çš„ï¼Œå› ä¸ºè°ƒåº¦å™¨å°†è‡ªåŠ¨è¿›è¡Œåˆç†çš„æ”¾ç½®ï¼ˆæ¯”å¦‚ï¼Œå°† Pod åˆ†æ•£åˆ°èŠ‚ç‚¹ä¸Šï¼Œ è€Œä¸æ˜¯å°† Pod æ”¾ç½®åœ¨å¯ç”¨èµ„æºä¸è¶³çš„èŠ‚ç‚¹ä¸Šç­‰ç­‰ï¼‰ã€‚ä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½éœ€è¦è¿›ä¸€æ­¥æ§åˆ¶ Pod è¢«éƒ¨ç½²åˆ°å“ªä¸ªèŠ‚ç‚¹ã€‚ä¾‹å¦‚ï¼Œç¡®ä¿ Pod æœ€ç»ˆè½åœ¨è¿æ¥äº† SSD çš„æœºå™¨ä¸Šï¼Œ æˆ–è€…å°†æ¥è‡ªä¸¤ä¸ªä¸åŒçš„æœåŠ¡ä¸”æœ‰å¤§é‡é€šä¿¡çš„ Pods è¢«æ”¾ç½®åœ¨åŒä¸€ä¸ªå¯ç”¨åŒºã€‚</p><p>ä½ å¯ä»¥ä½¿ç”¨ä¸‹åˆ—æ–¹æ³•ä¸­çš„ä»»ä½•ä¸€ç§æ¥é€‰æ‹© Kubernetes å¯¹ç‰¹å®š Pod çš„è°ƒåº¦ï¼š</p><ul><li>ä¸èŠ‚ç‚¹æ ‡ç­¾åŒ¹é…çš„ nodeSelector  <strong>æ¨è</strong></li><li>äº²å’Œæ€§ä¸åäº²å’Œæ€§ <strong>æ¨è</strong></li><li>nodeName</li><li>Pod æ‹“æ‰‘åˆ†å¸ƒçº¦æŸ <strong>æ¨è</strong></li></ul><blockquote><p> <strong><code>å®šä¹‰: ä½¿ç”¨èŠ‚ç‚¹äº²å’Œæ€§å¯ä»¥æŠŠ Kubernetes Pod åˆ†é…åˆ°ç‰¹å®šèŠ‚ç‚¹ã€‚</code></strong></p></blockquote><h3 id="8-1-ç»™èŠ‚ç‚¹æ·»åŠ æ ‡ç­¾"><a href="#8-1-ç»™èŠ‚ç‚¹æ·»åŠ æ ‡ç­¾" class="headerlink" title="8.1 ç»™èŠ‚ç‚¹æ·»åŠ æ ‡ç­¾"></a>8.1 ç»™èŠ‚ç‚¹æ·»åŠ æ ‡ç­¾</h3><ul><li><p>åˆ—å‡ºé›†ç¾¤ä¸­çš„èŠ‚ç‚¹åŠå…¶æ ‡ç­¾ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">kubectl get nodes --show-labels</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">è¾“å‡ºç±»ä¼¼äºæ­¤ï¼š</span></span><br><span class="line">NAME        STATUS   ROLES           AGE   VERSION   LABELS</span><br><span class="line">k8s-node1   Ready    control-plane   10d   v1.26.0   beta.kubernetes.io/arch=arm64,beta.kubernetes.io/os=linux...</span><br><span class="line">k8s-node2   Ready    &lt;none&gt;          10d   v1.26.0   beta.kubernetes.io/arch=arm64,beta.kubernetes.io/os=linux...</span><br><span class="line">k8s-node3   Ready    &lt;none&gt;          10d   v1.26.0   beta.kubernetes.io/arch=arm64,beta.kubernetes.io/os=linux...</span><br></pre></td></tr></table></figure></li><li><p>é€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹ï¼Œç»™å®ƒæ·»åŠ ä¸€ä¸ªæ ‡ç­¾ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl label nodes k8s-node1(èŠ‚ç‚¹åç§°) disktype=ssd</span><br></pre></td></tr></table></figure></li><li><p>éªŒè¯ä½ æ‰€é€‰èŠ‚ç‚¹å…·æœ‰ <code>disktype=ssd</code> æ ‡ç­¾ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">kubectl get nodes --show-labels</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">è¾“å‡ºç±»ä¼¼äºæ­¤ï¼š</span></span><br><span class="line">NAME        STATUS   ROLES           AGE   VERSION   LABELS</span><br><span class="line">k8s-node1   Ready    control-plane   10d   v1.26.0   beta.kubernetes.io/arch=arm64,beta.kubernetes.io/os=linux,disktype=ssd...</span><br><span class="line">k8s-node2   Ready    &lt;none&gt;          10d   v1.26.0   beta.kubernetes.io/arch=arm64,beta.kubernetes.io/os=linux...</span><br><span class="line">k8s-node3   Ready    &lt;none&gt;          10d   v1.26.0   beta.kubernetes.io/arch=arm64,beta.kubernetes.io/os=linux...</span><br></pre></td></tr></table></figure></li></ul><h3 id="8-2-æ ¹æ®é€‰æ‹©èŠ‚ç‚¹æ ‡ç­¾æŒ‡æ´¾-pod-åˆ°æŒ‡å®šèŠ‚ç‚¹-nodeSelector"><a href="#8-2-æ ¹æ®é€‰æ‹©èŠ‚ç‚¹æ ‡ç­¾æŒ‡æ´¾-pod-åˆ°æŒ‡å®šèŠ‚ç‚¹-nodeSelector" class="headerlink" title="8.2 æ ¹æ®é€‰æ‹©èŠ‚ç‚¹æ ‡ç­¾æŒ‡æ´¾ pod åˆ°æŒ‡å®šèŠ‚ç‚¹[nodeSelector]"></a>8.2 æ ¹æ®é€‰æ‹©èŠ‚ç‚¹æ ‡ç­¾æŒ‡æ´¾ pod åˆ°æŒ‡å®šèŠ‚ç‚¹[nodeSelector]</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">env:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:1.19</span></span><br><span class="line">    <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">  <span class="attr">nodeSelector:</span></span><br><span class="line">    <span class="attr">disktype:</span> <span class="string">ssd</span>  <span class="comment"># é€‰æ‹©èŠ‚ç‚¹ä¸ºæ ‡ç­¾ä¸º ssd çš„èŠ‚ç‚¹</span></span><br></pre></td></tr></table></figure><h3 id="8-3-æ ¹æ®èŠ‚ç‚¹åç§°æŒ‡æ´¾-pod-åˆ°æŒ‡å®šèŠ‚ç‚¹-nodeName"><a href="#8-3-æ ¹æ®èŠ‚ç‚¹åç§°æŒ‡æ´¾-pod-åˆ°æŒ‡å®šèŠ‚ç‚¹-nodeName" class="headerlink" title="8.3 æ ¹æ®èŠ‚ç‚¹åç§°æŒ‡æ´¾ pod åˆ°æŒ‡å®šèŠ‚ç‚¹[nodeName]"></a>8.3 æ ¹æ®èŠ‚ç‚¹åç§°æŒ‡æ´¾ pod åˆ°æŒ‡å®šèŠ‚ç‚¹[nodeName]</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">nodeName:</span> <span class="string">worker1</span>    <span class="comment"># è°ƒåº¦ Pod åˆ°ç‰¹å®šçš„èŠ‚ç‚¹</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br></pre></td></tr></table></figure><h3 id="8-4-æ ¹æ®-äº²å’Œæ€§å’Œåäº²å’Œæ€§-æŒ‡æ´¾-pod-åˆ°æŒ‡å®šèŠ‚ç‚¹"><a href="#8-4-æ ¹æ®-äº²å’Œæ€§å’Œåäº²å’Œæ€§-æŒ‡æ´¾-pod-åˆ°æŒ‡å®šèŠ‚ç‚¹" class="headerlink" title="8.4 æ ¹æ® äº²å’Œæ€§å’Œåäº²å’Œæ€§ æŒ‡æ´¾ pod åˆ°æŒ‡å®šèŠ‚ç‚¹"></a>8.4 æ ¹æ® äº²å’Œæ€§å’Œåäº²å’Œæ€§ æŒ‡æ´¾ pod åˆ°æŒ‡å®šèŠ‚ç‚¹</h3><p>å®˜ç½‘åœ°å€: <a href="http://kubernetes.p2hp.com/docs/concepts/scheduling-eviction/assign-pod-node.html">http://kubernetes.p2hp.com/docs/concepts/scheduling-eviction/assign-pod-node.html</a></p><p><strong>è¯´æ˜</strong></p><p><code>nodeSelector</code> æä¾›äº†ä¸€ç§æœ€ç®€å•çš„æ–¹æ³•æ¥å°† Pod çº¦æŸåˆ°å…·æœ‰ç‰¹å®šæ ‡ç­¾çš„èŠ‚ç‚¹ä¸Šã€‚ äº²å’Œæ€§å’Œåäº²å’Œæ€§æ‰©å±•äº†ä½ å¯ä»¥å®šä¹‰çš„çº¦æŸç±»å‹ã€‚ä½¿ç”¨äº²å’Œæ€§ä¸åäº²å’Œæ€§çš„ä¸€äº›å¥½å¤„æœ‰ï¼š</p><ul><li>äº²å’Œæ€§ã€åäº²å’Œæ€§è¯­è¨€çš„è¡¨è¾¾èƒ½åŠ›æ›´å¼ºã€‚<code>nodeSelector</code> åªèƒ½é€‰æ‹©æ‹¥æœ‰æ‰€æœ‰æŒ‡å®šæ ‡ç­¾çš„èŠ‚ç‚¹ã€‚ äº²å’Œæ€§ã€åäº²å’Œæ€§ä¸ºä½ æä¾›å¯¹é€‰æ‹©é€»è¾‘çš„æ›´å¼ºæ§åˆ¶èƒ½åŠ›ã€‚</li><li>ä½ å¯ä»¥æ ‡æ˜æŸè§„åˆ™æ˜¯â€œè½¯éœ€æ±‚â€æˆ–è€…â€œåå¥½â€ï¼Œè¿™æ ·è°ƒåº¦å™¨åœ¨æ— æ³•æ‰¾åˆ°åŒ¹é…èŠ‚ç‚¹æ—¶ä»ç„¶è°ƒåº¦è¯¥ Podã€‚</li><li>ä½ å¯ä»¥ä½¿ç”¨èŠ‚ç‚¹ä¸Šï¼ˆæˆ–å…¶ä»–æ‹“æ‰‘åŸŸä¸­ï¼‰è¿è¡Œçš„å…¶ä»– Pod çš„æ ‡ç­¾æ¥å®æ–½è°ƒåº¦çº¦æŸï¼Œ è€Œä¸æ˜¯åªèƒ½ä½¿ç”¨èŠ‚ç‚¹æœ¬èº«çš„æ ‡ç­¾ã€‚è¿™ä¸ªèƒ½åŠ›è®©ä½ èƒ½å¤Ÿå®šä¹‰è§„åˆ™å…è®¸å“ªäº› Pod å¯ä»¥è¢«æ”¾ç½®åœ¨ä¸€èµ·ã€‚</li></ul><p><strong>äº²å’Œæ€§åŠŸèƒ½ç”±ä¸¤ç§ç±»å‹çš„äº²å’Œæ€§ç»„æˆï¼š</strong></p><ul><li><strong>èŠ‚ç‚¹äº²å’Œæ€§</strong>åŠŸèƒ½ç±»ä¼¼äº <code>nodeSelector</code> å­—æ®µï¼Œä½†å®ƒçš„è¡¨è¾¾èƒ½åŠ›æ›´å¼ºï¼Œå¹¶ä¸”å…è®¸ä½ æŒ‡å®šè½¯è§„åˆ™ã€‚</li><li>Pod é—´äº²å’Œæ€§/åäº²å’Œæ€§å…è®¸ä½ æ ¹æ®å…¶ä»– Pod çš„æ ‡ç­¾æ¥çº¦æŸ Podã€‚</li></ul><p>èŠ‚ç‚¹äº²å’Œæ€§æ¦‚å¿µä¸Šç±»ä¼¼äº <code>nodeSelector</code>ï¼Œ å®ƒä½¿ä½ å¯ä»¥æ ¹æ®èŠ‚ç‚¹ä¸Šçš„æ ‡ç­¾æ¥çº¦æŸ Pod å¯ä»¥è°ƒåº¦åˆ°å“ªäº›èŠ‚ç‚¹ä¸Šã€‚ èŠ‚ç‚¹äº²å’Œæ€§æœ‰ä¸¤ç§ï¼š</p><ul><li><code>requiredDuringSchedulingIgnoredDuringExecution</code>ï¼š è°ƒåº¦å™¨åªæœ‰åœ¨è§„åˆ™è¢«æ»¡è¶³çš„æ—¶å€™æ‰èƒ½æ‰§è¡Œè°ƒåº¦ã€‚æ­¤åŠŸèƒ½ç±»ä¼¼äº <code>nodeSelector</code>ï¼Œ ä½†å…¶è¯­æ³•è¡¨è¾¾èƒ½åŠ›æ›´å¼ºã€‚</li><li><code>preferredDuringSchedulingIgnoredDuringExecution</code>ï¼š è°ƒåº¦å™¨ä¼šå°è¯•å¯»æ‰¾æ»¡è¶³å¯¹åº”è§„åˆ™çš„èŠ‚ç‚¹ã€‚å¦‚æœæ‰¾ä¸åˆ°åŒ¹é…çš„èŠ‚ç‚¹ï¼Œè°ƒåº¦å™¨ä»ç„¶ä¼šè°ƒåº¦è¯¥ Podã€‚</li></ul><p><strong>æ³¨æ„ï¼šåœ¨ä¸Šè¿°ç±»å‹ä¸­ï¼Œ<code>IgnoredDuringExecution</code> æ„å‘³ç€å¦‚æœèŠ‚ç‚¹æ ‡ç­¾åœ¨ Kubernetes è°ƒåº¦ Pod åå‘ç”Ÿäº†å˜æ›´ï¼ŒPod ä»å°†ç»§ç»­è¿è¡Œã€‚</strong></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">with-node-affinity</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">affinity:</span></span><br><span class="line">    <span class="attr">nodeAffinity:</span></span><br><span class="line">    <span class="comment">#èŠ‚ç‚¹å¿…é¡»åŒ…å«ä¸€ä¸ªé”®åä¸º ssd çš„æ ‡ç­¾ï¼Œ å¹¶ä¸”è¯¥æ ‡ç­¾çš„å–å€¼å¿…é¡»ä¸º fast æˆ– superfastã€‚</span></span><br><span class="line">      <span class="attr">requiredDuringSchedulingIgnoredDuringExecution:</span> </span><br><span class="line">        <span class="attr">nodeSelectorTerms:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">matchExpressions:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">ssd</span></span><br><span class="line">            <span class="attr">operator:</span> <span class="string">In</span></span><br><span class="line">            <span class="attr">values:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">fast</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">superfast</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:1.19</span></span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„: ä½ å¯ä»¥ä½¿ç”¨ <code>In</code>ã€<code>NotIn</code>ã€<code>Exists</code>ã€<code>DoesNotExist</code>ã€<code>Gt</code> å’Œ <code>Lt</code> ä¹‹ä¸€ä½œä¸ºæ“ä½œç¬¦ã€‚<code>NotIn</code> å’Œ <code>DoesNotExist</code> å¯ç”¨æ¥å®ç°èŠ‚ç‚¹åäº²å’Œæ€§è¡Œä¸ºã€‚</strong></p><h3 id="8-5-èŠ‚ç‚¹äº²å’Œæ€§æƒé‡"><a href="#8-5-èŠ‚ç‚¹äº²å’Œæ€§æƒé‡" class="headerlink" title="8.5 èŠ‚ç‚¹äº²å’Œæ€§æƒé‡"></a>8.5 èŠ‚ç‚¹äº²å’Œæ€§æƒé‡</h3><p>ä½ å¯ä»¥ä¸º <code>preferredDuringSchedulingIgnoredDuringExecution</code> äº²å’Œæ€§ç±»å‹çš„æ¯ä¸ªå®ä¾‹è®¾ç½® <code>weight</code> å­—æ®µï¼Œå…¶å–å€¼èŒƒå›´æ˜¯ 1 åˆ° 100ã€‚ </p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">with-node-affinity</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">affinity:</span></span><br><span class="line">    <span class="attr">nodeAffinity:</span></span><br><span class="line">      <span class="comment">#èŠ‚ç‚¹æœ€å¥½å…·æœ‰ä¸€ä¸ªé”®åä¸º app ä¸”å–å€¼ä¸º fast çš„æ ‡ç­¾ã€‚</span></span><br><span class="line">      <span class="attr">preferredDuringSchedulingIgnoredDuringExecution:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">weight:</span> <span class="number">1</span> <span class="comment">#å–å€¼èŒƒå›´æ˜¯ 1 åˆ° 100</span></span><br><span class="line">        <span class="attr">preference:</span></span><br><span class="line">          <span class="attr">matchExpressions:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">ssd</span></span><br><span class="line">            <span class="attr">operator:</span> <span class="string">In</span></span><br><span class="line">            <span class="attr">values:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">fast</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">weight:</span> <span class="number">50</span></span><br><span class="line">        <span class="attr">preference:</span></span><br><span class="line">          <span class="attr">matchExpressions:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">app</span></span><br><span class="line">            <span class="attr">operator:</span> <span class="string">In</span></span><br><span class="line">            <span class="attr">values:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">demo</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:1.19</span></span><br></pre></td></tr></table></figure><h3 id="8-6-pod-é—´äº²å’Œæ€§å’Œåäº²å’Œæ€§åŠæƒé‡"><a href="#8-6-pod-é—´äº²å’Œæ€§å’Œåäº²å’Œæ€§åŠæƒé‡" class="headerlink" title="8.6 pod é—´äº²å’Œæ€§å’Œåäº²å’Œæ€§åŠæƒé‡"></a>8.6 pod é—´äº²å’Œæ€§å’Œåäº²å’Œæ€§åŠæƒé‡</h3><p>ä¸èŠ‚ç‚¹äº²å’Œæ€§ç±»ä¼¼ï¼ŒPod çš„äº²å’Œæ€§ä¸åäº²å’Œæ€§ä¹Ÿæœ‰ä¸¤ç§ç±»å‹ï¼š</p><ul><li><code>requiredDuringSchedulingIgnoredDuringExecution</code></li><li><code>preferredDuringSchedulingIgnoredDuringExecution</code></li></ul><p>ä¾‹å¦‚ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>requiredDuringSchedulingIgnoredDuringExecution</code> äº²å’Œæ€§æ¥å‘Šè¯‰è°ƒåº¦å™¨ï¼Œ å°†ä¸¤ä¸ªæœåŠ¡çš„ Pod æ”¾åˆ°åŒä¸€ä¸ªäº‘æä¾›å•†å¯ç”¨åŒºå†…ï¼Œå› ä¸ºå®ƒä»¬å½¼æ­¤ä¹‹é—´é€šä¿¡éå¸¸é¢‘ç¹ã€‚ ç±»ä¼¼åœ°ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>preferredDuringSchedulingIgnoredDuringExecution</code> åäº²å’Œæ€§æ¥å°†åŒä¸€æœåŠ¡çš„å¤šä¸ª Pod åˆ†å¸ƒåˆ°å¤šä¸ªäº‘æä¾›å•†å¯ç”¨åŒºä¸­ã€‚</p><p>è¦ä½¿ç”¨ Pod é—´äº²å’Œæ€§ï¼Œå¯ä»¥ä½¿ç”¨ Pod è§„çº¦ä¸­çš„ <code>spec.affinity.podAffinity</code> å­—æ®µã€‚ å¯¹äº Pod é—´åäº²å’Œæ€§ï¼Œå¯ä»¥ä½¿ç”¨ Pod è§„çº¦ä¸­çš„ <code>spec.affinity.podAntiAffinity</code> å­—æ®µã€‚</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">redis</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">redis</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">redis</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">redis:5.0.10</span></span><br><span class="line">      <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">  <span class="attr">restartPolicy:</span> <span class="string">Always</span></span><br><span class="line">  <span class="attr">affinity:</span></span><br><span class="line">    <span class="attr">podAffinity:</span></span><br><span class="line">      <span class="attr">requiredDuringSchedulingIgnoredDuringExecution:</span></span><br><span class="line">        <span class="comment">#æ›´ç¡®åˆ‡çš„è¯´ï¼Œè°ƒåº¦å™¨å¿…é¡»å°† Pod è°ƒåº¦åˆ°å…·æœ‰ cpu æ ‡ç­¾çš„èŠ‚ç‚¹ä¸Šï¼Œå¹¶ä¸”é›†ç¾¤ä¸­è‡³å°‘æœ‰ä¸€ä¸ªä½äºè¯¥å¯ç”¨åŒºçš„èŠ‚ç‚¹ä¸Šè¿è¡Œç€å¸¦æœ‰ app=nginx æ ‡ç­¾çš„ Podã€‚</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">topologyKey:</span> <span class="string">cpu</span></span><br><span class="line">          <span class="attr">labelSelector:</span></span><br><span class="line">            <span class="attr">matchExpressions:</span></span><br><span class="line">              <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">app</span></span><br><span class="line">                <span class="attr">operator:</span> <span class="string">In</span></span><br><span class="line">                <span class="attr">values:</span></span><br><span class="line">                  <span class="bullet">-</span> <span class="string">nginx</span></span><br></pre></td></tr></table></figure><ul><li><strong>pod é—´äº²å’Œæ€§æƒé‡</strong></li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">redis</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">redis</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">redis</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">redis:5.0.10</span></span><br><span class="line">      <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">  <span class="attr">restartPolicy:</span> <span class="string">Always</span></span><br><span class="line">  <span class="attr">affinity:</span></span><br><span class="line">    <span class="attr">podAffinity:</span></span><br><span class="line">      <span class="attr">preferredDuringSchedulingIgnoredDuringExecution:</span></span><br><span class="line">        <span class="comment">#æ›´ç¡®åˆ‡çš„è¯´ï¼Œè°ƒåº¦å™¨å¿…é¡»å°† Pod è°ƒåº¦åˆ°å…·æœ‰ cpu æ ‡ç­¾çš„èŠ‚ç‚¹ä¸Šï¼Œå¹¶ä¸”é›†ç¾¤ä¸­è‡³å°‘æœ‰ä¸€ä¸ªä½äºè¯¥å¯ç”¨åŒºçš„èŠ‚ç‚¹ä¸Šè¿è¡Œç€å¸¦æœ‰ app=nginx æ ‡ç­¾çš„ Podã€‚</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">podAffinityTerm:</span></span><br><span class="line">            <span class="attr">topologyKey:</span> <span class="string">cpu</span></span><br><span class="line">            <span class="attr">labelSelector:</span></span><br><span class="line">              <span class="attr">matchExpressions:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">app</span></span><br><span class="line">                  <span class="attr">operator:</span> <span class="string">In</span></span><br><span class="line">                  <span class="attr">values:</span></span><br><span class="line">                    <span class="bullet">-</span> <span class="string">nginx</span></span><br><span class="line">          <span class="attr">weight:</span> <span class="number">1</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">podAffinityTerm:</span></span><br><span class="line">            <span class="attr">topologyKey:</span> <span class="string">cpu</span></span><br><span class="line">            <span class="attr">labelSelector:</span></span><br><span class="line">              <span class="attr">matchExpressions:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">app</span></span><br><span class="line">                  <span class="attr">operator:</span> <span class="string">In</span></span><br><span class="line">                  <span class="attr">values:</span></span><br><span class="line">                    <span class="bullet">-</span> <span class="string">web</span></span><br><span class="line">          <span class="attr">weight:</span> <span class="number">30</span></span><br></pre></td></tr></table></figure><h3 id="8-7-æ±¡ç‚¹å’Œå®¹å¿åº¦"><a href="#8-7-æ±¡ç‚¹å’Œå®¹å¿åº¦" class="headerlink" title="8.7 æ±¡ç‚¹å’Œå®¹å¿åº¦"></a>8.7 æ±¡ç‚¹å’Œå®¹å¿åº¦</h3><p>å‚è€ƒ: <a href="http://kubernetes.p2hp.com/docs/concepts/scheduling-eviction/taint-and-toleration.html">http://kubernetes.p2hp.com/docs/concepts/scheduling-eviction/taint-and-toleration.html</a></p><h3 id="8-8-Pod-æ‹“æ‰‘åˆ†å¸ƒçº¦æŸ"><a href="#8-8-Pod-æ‹“æ‰‘åˆ†å¸ƒçº¦æŸ" class="headerlink" title="8.8 Pod æ‹“æ‰‘åˆ†å¸ƒçº¦æŸ"></a>8.8 Pod æ‹“æ‰‘åˆ†å¸ƒçº¦æŸ</h3><p>å‚è€ƒ: <a href="http://kubernetes.p2hp.com/docs/concepts/scheduling-eviction/topology-spread-constraints/">http://kubernetes.p2hp.com/docs/concepts/scheduling-eviction/topology-spread-constraints/</a></p><h1 id="ç¬¬å››ç« -Controller-æ§åˆ¶å™¨"><a href="#ç¬¬å››ç« -Controller-æ§åˆ¶å™¨" class="headerlink" title="ç¬¬å››ç«  Controller æ§åˆ¶å™¨"></a>ç¬¬å››ç«  Controller æ§åˆ¶å™¨</h1><ul><li>ä»€ä¹ˆæ˜¯ Controller ä»¥åŠä½œç”¨</li><li>å¸¸è§çš„ Controller æ§åˆ¶å™¨</li><li>Controller å¦‚ä½•ç®¡ç† Pod</li><li>Deployment åŸºæœ¬æ“ä½œä¸åº”ç”¨</li><li>é€šè¿‡æ§åˆ¶å™¨å®ç° Pod å‡çº§å›æ»šå’Œå¼¹æ€§ä¼¸ç¼©</li><li>StatefulSet åŸºæœ¬æ“ä½œä¸åº”ç”¨</li><li>Daemonset åŸºæœ¬æ“ä½œä¸åº”ç”¨</li><li>Job åŸºæœ¬æ“ä½œä¸åº”ç”¨</li><li>Controller æ— æ³•è§£å†³é—®é¢˜</li></ul><h2 id="1-Controller-æ§åˆ¶å™¨"><a href="#1-Controller-æ§åˆ¶å™¨" class="headerlink" title="1 Controller æ§åˆ¶å™¨"></a>1 Controller æ§åˆ¶å™¨</h2><p>å®˜ç½‘: <a href="http://kubernetes.p2hp.com/docs/concepts/architecture/controller.html">http://kubernetes.p2hp.com/docs/concepts/architecture/controller.html</a></p><h3 id="1-1-ä»€ä¹ˆæ˜¯-Controller"><a href="#1-1-ä»€ä¹ˆæ˜¯-Controller" class="headerlink" title="1.1 ä»€ä¹ˆæ˜¯ Controller"></a>1.1 ä»€ä¹ˆæ˜¯ Controller</h3><p><code>Kubernetes é€šå¸¸ä¸ä¼šç›´æ¥åˆ›å»º Podï¼Œ è€Œæ˜¯é€šè¿‡ Controller æ¥ç®¡ç† Pod çš„ã€‚</code><strong>Controller ä¸­å®šä¹‰äº† Pod çš„éƒ¨ç½²ç‰¹æ€§ï¼Œæ¯”å¦‚æœ‰å‡ ä¸ªå‰¯æœ¬ã€åœ¨ä»€ä¹ˆæ ·çš„ Node ä¸Šè¿è¡Œç­‰</strong>ã€‚é€šä¿—çš„è¯´å¯ä»¥è®¤ä¸º Controller å°±æ˜¯ç”¨æ¥ç®¡ç† Pod ä¸€ä¸ªå¯¹è±¡ã€‚å…¶æ ¸å¿ƒä½œç”¨å¯ä»¥é€šè¿‡ä¸€å¥è¯æ€»ç»“ï¼š <strong><code>é€šè¿‡ç›‘æ§é›†ç¾¤çš„å…¬å…±çŠ¶æ€ï¼Œå¹¶è‡´åŠ›äºå°†å½“å‰çŠ¶æ€è½¬å˜ä¸ºæœŸæœ›çš„çŠ¶æ€ã€‚</code></strong></p><p><strong>é€šä¿—å®šä¹‰:  controller å¯ä»¥ç®¡ç† pod è®© pod æ›´å…·æœ‰è¿ç»´èƒ½åŠ›</strong></p><h3 id="1-2-å¸¸è§çš„-Controller-æ§åˆ¶å™¨"><a href="#1-2-å¸¸è§çš„-Controller-æ§åˆ¶å™¨" class="headerlink" title="1.2 å¸¸è§çš„ Controller æ§åˆ¶å™¨"></a>1.2 å¸¸è§çš„ Controller æ§åˆ¶å™¨</h3><ul><li><p><code>Deployment</code> æ˜¯æœ€å¸¸ç”¨çš„ Controllerã€‚Deployment å¯ä»¥ç®¡ç† Pod çš„å¤šä¸ªå‰¯æœ¬ï¼Œå¹¶ç¡®ä¿ Pod æŒ‰ç…§æœŸæœ›çš„çŠ¶æ€è¿è¡Œã€‚</p><ul><li>ReplicaSet å®ç°äº† Pod çš„å¤šå‰¯æœ¬ç®¡ç†ã€‚ä½¿ç”¨ Deployment æ—¶ä¼šè‡ªåŠ¨åˆ›å»º ReplicaSet,ä¹Ÿå°±æ˜¯è¯´ Deployment æ˜¯é€šè¿‡ ReplicaSet æ¥ç®¡ç† Pod çš„å¤šä¸ªå‰¯æœ¬çš„ï¼Œæˆ‘ä»¬é€šå¸¸ä¸éœ€è¦ç›´æ¥ä½¿ç”¨ ReplicaSetã€‚</li></ul></li><li><p><code>Daemonset</code> ç”¨äºæ¯ä¸ªNode æœ€å¤šåªè¿è¡Œä¸€ä¸ª Pod å‰¯æœ¬çš„åœºæ™¯ã€‚æ­£å¦‚å…¶åç§°æ‰€æ­ç¤ºçš„ï¼ŒDaemonSet é€šå¸¸ç”¨äºè¿è¡Œ daemonã€‚</p></li><li><code>Statefuleset</code> èƒ½å¤Ÿä¿è¯ Pod çš„æ¯ä¸ªå‰¯æœ¬åœ¨æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­åç§°æ˜¯ä¸å˜çš„ï¼Œè€Œå…¶ä»–Controller ä¸æä¾›è¿™ä¸ªåŠŸèƒ½ã€‚å½“æŸä¸ª Pod å‘ç”Ÿæ•…éšœéœ€è¦åˆ é™¤å¹¶é‡æ–°å¯åŠ¨æ—¶ï¼ŒPod çš„åç§°ä¼šå‘ç”Ÿå˜åŒ–ï¼ŒåŒæ—¶ StatefuleSet ä¼šä¿è¯å‰¯æœ¬æŒ‰ç…§å›ºå®šçš„é¡ºåºå¯åŠ¨ã€æ›´æ–°æˆ–è€…åˆ é™¤ã€‚</li><li><code>Job</code>  ç”¨äºè¿è¡Œç»“æŸå°±åˆ é™¤çš„åº”ç”¨ï¼Œè€Œå…¶ä»– Controller ä¸­çš„ Pod é€šå¸¸æ˜¯é•¿æœŸæŒç»­è¿è¡Œã€‚</li></ul><h3 id="1-3-Controller-å¦‚ä½•ç®¡ç†-Pod"><a href="#1-3-Controller-å¦‚ä½•ç®¡ç†-Pod" class="headerlink" title="1.3 Controller å¦‚ä½•ç®¡ç† Pod"></a>1.3 Controller å¦‚ä½•ç®¡ç† Pod</h3><p><strong><code>æ³¨æ„: Controller é€šè¿‡ label å…³è”èµ·æ¥ Pods</code></strong></p><p><img src="https://www.naste.top:9000/images/image-20230307105007568.png" alt="image-20230307105007568"></p><h2 id="2-Deployment"><a href="#2-Deployment" class="headerlink" title="2 Deployment"></a>2 Deployment</h2><p>å®˜æ–¹åœ°å€: <a href="http://kubernetes.p2hp.com/docs/concepts/workloads/controllers/deployment.html">http://kubernetes.p2hp.com/docs/concepts/workloads/controllers/deployment.html</a></p><p>ä¸€ä¸ª Deployment ä¸º Pod å’Œ ReplicaSetæä¾›å£°æ˜å¼çš„æ›´æ–°èƒ½åŠ›ã€‚</p><p>ä½ è´Ÿè´£æè¿° Deployment ä¸­çš„ <strong>ç›®æ ‡çŠ¶æ€</strong>ï¼Œè€Œ Deployment æ§åˆ¶å™¨ï¼ˆControllerï¼‰ä»¥å—æ§é€Ÿç‡æ›´æ”¹å®é™…çŠ¶æ€ï¼Œ ä½¿å…¶å˜ä¸ºæœŸæœ›çŠ¶æ€ã€‚ä½ å¯ä»¥å®šä¹‰ Deployment ä»¥åˆ›å»ºæ–°çš„ ReplicaSetï¼Œæˆ–åˆ é™¤ç°æœ‰ Deploymentï¼Œ å¹¶é€šè¿‡æ–°çš„ Deployment æ”¶å…»å…¶èµ„æºã€‚</p><h3 id="2-1-åˆ›å»º-deployment"><a href="#2-1-åˆ›å»º-deployment" class="headerlink" title="2.1 åˆ›å»º deployment"></a>2.1 åˆ›å»º deployment</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-deployment</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">nginx:1.19</span></span><br><span class="line">          <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure><h3 id="2-2-æŸ¥çœ‹-deployment"><a href="#2-2-æŸ¥çœ‹-deployment" class="headerlink" title="2.2 æŸ¥çœ‹ deployment"></a>2.2 æŸ¥çœ‹ deployment</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">éƒ¨ç½²åº”ç”¨</span></span><br><span class="line">kubectl apply -f app.yaml</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹ deployment</span></span><br><span class="line">kubectl get deployment</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹ pod</span></span><br><span class="line">kubectl get pod -o wide</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹ pod è¯¦æƒ…</span></span><br><span class="line">kubectl describe pod pod-name</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹ deployment è¯¦ç»†</span></span><br><span class="line">kubectl describe deployment åç§°</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹ <span class="built_in">log</span></span></span><br><span class="line">kubectl logs pod-name</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿›å…¥ Pod å®¹å™¨ç»ˆç«¯ï¼Œ -c container-name å¯ä»¥æŒ‡å®šè¿›å…¥å“ªä¸ªå®¹å™¨ã€‚</span></span><br><span class="line">kubectl exec -it pod-name -- bash</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¾“å‡ºåˆ°æ–‡ä»¶</span></span><br><span class="line">kubectl get deployment nginx-deployment -o yaml &gt;&gt; test.yaml</span><br></pre></td></tr></table></figure><ul><li><code>NAME</code> åˆ—å‡ºäº†åå­—ç©ºé—´ä¸­ Deployment çš„åç§°ã€‚</li><li><code>READY</code> æ˜¾ç¤ºåº”ç”¨ç¨‹åºçš„å¯ç”¨çš„â€œå‰¯æœ¬â€æ•°ã€‚æ˜¾ç¤ºçš„æ¨¡å¼æ˜¯â€œå°±ç»ªä¸ªæ•°/æœŸæœ›ä¸ªæ•°â€ã€‚</li><li><code>UP-TO-DATE</code> æ˜¾ç¤ºä¸ºäº†è¾¾åˆ°æœŸæœ›çŠ¶æ€å·²ç»æ›´æ–°çš„å‰¯æœ¬æ•°ã€‚</li><li><code>AVAILABLE</code> æ˜¾ç¤ºåº”ç”¨å¯ä¾›ç”¨æˆ·ä½¿ç”¨çš„å‰¯æœ¬æ•°ã€‚</li><li><code>AGE</code> æ˜¾ç¤ºåº”ç”¨ç¨‹åºè¿è¡Œçš„æ—¶é—´ã€‚</li></ul><blockquote><p>è¯·æ³¨æ„æœŸæœ›å‰¯æœ¬æ•°æ˜¯æ ¹æ® <code>.spec.replicas</code> å­—æ®µè®¾ç½® 3ã€‚</p></blockquote><h3 id="2-3-æ‰©ç¼©-deployment"><a href="#2-3-æ‰©ç¼©-deployment" class="headerlink" title="2.3 æ‰©ç¼© deployment"></a>2.3 æ‰©ç¼© deployment</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥è¯¢å‰¯æœ¬</span></span><br><span class="line">kubectl get rs|replicaset</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¼¸ç¼©æ‰©å±•å‰¯æœ¬</span></span><br><span class="line">kubectl scale deployment nginx --replicas=5</span><br></pre></td></tr></table></figure><h3 id="2-4-å›æ»š-deployment"><a href="#2-4-å›æ»š-deployment" class="headerlink" title="2.4 å›æ»š deployment"></a>2.4 å›æ»š deployment</h3><blockquote><p><strong>è¯´æ˜ï¼š</strong></p><p>ä»…å½“ Deployment Pod æ¨¡æ¿ï¼ˆå³ <code>.spec.template</code>ï¼‰å‘ç”Ÿæ”¹å˜æ—¶ï¼Œä¾‹å¦‚æ¨¡æ¿çš„æ ‡ç­¾æˆ–å®¹å™¨é•œåƒè¢«æ›´æ–°ï¼Œ æ‰ä¼šè§¦å‘ Deployment ä¸Šçº¿ã€‚å…¶ä»–æ›´æ–°ï¼ˆå¦‚å¯¹ Deployment æ‰§è¡Œæ‰©ç¼©å®¹çš„æ“ä½œï¼‰ä¸ä¼šè§¦å‘ä¸Šçº¿åŠ¨ä½œã€‚</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹ä¸Šçº¿çŠ¶æ€</span></span><br><span class="line">kubectl rollout status [deployment nginx-deployment | deployment/nginx]</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹å†å²</span></span><br><span class="line">kubectl rollout history deployment nginx-deployment</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹æŸæ¬¡å†å²çš„è¯¦ç»†ä¿¡æ¯</span></span><br><span class="line">kubectl rollout history deployment/nginx-deployment --revision=2</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å›åˆ°ä¸Šä¸ªç‰ˆæœ¬</span></span><br><span class="line">kubectl rollout undo deployment nginx-deployment</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å›åˆ°æŒ‡å®šç‰ˆæœ¬</span></span><br><span class="line">kubectl rollout undo deployment nginx-deployment --to-revision=2</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é‡æ–°éƒ¨ç½²</span></span><br><span class="line">kubectl rollout restart deployment nginx-deployment</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æš‚åœè¿è¡Œï¼Œæš‚åœåï¼Œå¯¹ deployment çš„ä¿®æ”¹ä¸ä¼šç«‹åˆ»ç”Ÿæ•ˆï¼Œæ¢å¤åæ‰åº”ç”¨è®¾ç½®</span></span><br><span class="line">kubectl rollout pause deployment ngixn-deployment</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ¢å¤</span></span><br><span class="line">kubectl rollout resume deployment nginx-deployment</span><br></pre></td></tr></table></figure><h3 id="2-5-åˆ é™¤-deployment"><a href="#2-5-åˆ é™¤-deployment" class="headerlink" title="2.5 åˆ é™¤ deployment"></a>2.5 åˆ é™¤ deployment</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ é™¤ Deployment</span></span><br><span class="line">kubectl delete deployment nginx-deployment</span><br><span class="line">kubect delete -f nginx-deployment.yml</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ é™¤é»˜è®¤å‘½åç©ºé—´ä¸‹å…¨éƒ¨èµ„æº</span></span><br><span class="line">kubectl delete all --all</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ é™¤æŒ‡å®šå‘½åç©ºé—´çš„èµ„æº</span></span><br><span class="line">kubectl delete all --all -n å‘½åç©ºé—´çš„åç§°</span><br></pre></td></tr></table></figure><h2 id="3-StatefulSet"><a href="#3-StatefulSet" class="headerlink" title="3 StatefulSet"></a>3 StatefulSet</h2><h3 id="3-1-ä»€ä¹ˆæ˜¯-StatefulSet"><a href="#3-1-ä»€ä¹ˆæ˜¯-StatefulSet" class="headerlink" title="3.1 ä»€ä¹ˆæ˜¯ StatefulSet"></a>3.1 ä»€ä¹ˆæ˜¯ StatefulSet</h3><p>å®˜æ–¹åœ°å€ï¼š <a href="https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/statefulset/">https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/statefulset/</a></p><p><strong>StatefulSet æ˜¯ç”¨æ¥ç®¡ç†<code>æœ‰çŠ¶æ€åº”ç”¨</code>çš„å·¥ä½œè´Ÿè½½ API å¯¹è±¡ã€‚</strong></p><p><strong>æ— çŠ¶æ€åº”ç”¨: åº”ç”¨æœ¬èº«ä¸å­˜å‚¨ä»»ä½•æ•°æ®çš„åº”ç”¨ç§°ä¹‹ä¸ºæ— çŠ¶æ€åº”ç”¨ã€‚</strong></p><p><strong>æœ‰çŠ¶æ€åº”ç”¨: åº”ç”¨æœ¬èº«éœ€è¦å­˜å‚¨ç›¸å…³æ•°æ®åº”ç”¨ç§°ä¹‹ä¸ºæœ‰çŠ¶æ€åº”ç”¨ã€‚</strong></p><p>åšå®¢: å‰ç«¯vue  åç«¯ java   mysql redis es â€¦.</p><p>æ•°æ®é‡‡é›†:  é‡‡é›†ç¨‹åº æœ‰çŠ¶æ€åº”ç”¨</p><p>StatefulSet ç”¨æ¥ç®¡ç†æŸ Pod é›†åˆçš„éƒ¨ç½²å’Œæ‰©ç¼©ï¼Œ <strong>å¹¶ä¸ºè¿™äº› Pod æä¾›æŒä¹…å­˜å‚¨å’ŒæŒä¹…æ ‡è¯†ç¬¦ã€‚</strong></p><p>å’Œ Deployment ç±»ä¼¼ï¼Œ StatefulSet ç®¡ç†åŸºäºç›¸åŒå®¹å™¨è§„çº¦çš„ä¸€ç»„ Podã€‚ä½†å’Œ Deployment ä¸åŒçš„æ˜¯ï¼Œ <strong>StatefulSet ä¸ºå®ƒä»¬çš„æ¯ä¸ª Pod ç»´æŠ¤äº†ä¸€ä¸ªæœ‰ç²˜æ€§çš„ IDã€‚è¿™äº› Pod æ˜¯åŸºäºç›¸åŒçš„è§„çº¦æ¥åˆ›å»ºçš„ï¼Œ ä½†æ˜¯ä¸èƒ½ç›¸äº’æ›¿æ¢ï¼šæ— è®ºæ€ä¹ˆè°ƒåº¦ï¼Œæ¯ä¸ª Pod éƒ½æœ‰ä¸€ä¸ªæ°¸ä¹…ä¸å˜çš„ IDã€‚</strong></p><p>å¦‚æœå¸Œæœ›ä½¿ç”¨å­˜å‚¨å·ä¸ºå·¥ä½œè´Ÿè½½æä¾›æŒä¹…å­˜å‚¨ï¼Œå¯ä»¥ä½¿ç”¨ StatefulSet ä½œä¸ºè§£å†³æ–¹æ¡ˆçš„ä¸€éƒ¨åˆ†ã€‚ å°½ç®¡ StatefulSet ä¸­çš„å•ä¸ª Pod ä»å¯èƒ½å‡ºç°æ•…éšœï¼Œ ä½†æŒä¹…çš„ Pod æ ‡è¯†ç¬¦ä½¿å¾—å°†ç°æœ‰å·ä¸æ›¿æ¢å·²å¤±è´¥ Pod çš„æ–° Pod ç›¸åŒ¹é…å˜å¾—æ›´åŠ å®¹æ˜“ã€‚</p><h3 id="3-2-StatefulSet-ç‰¹ç‚¹"><a href="#3-2-StatefulSet-ç‰¹ç‚¹" class="headerlink" title="3.2 StatefulSet ç‰¹ç‚¹"></a>3.2 StatefulSet ç‰¹ç‚¹</h3><p>StatefulSet å¯¹äºéœ€è¦æ»¡è¶³ä»¥ä¸‹ä¸€ä¸ªæˆ–å¤šä¸ªéœ€æ±‚çš„åº”ç”¨ç¨‹åºå¾ˆæœ‰ä»·å€¼ï¼š</p><ul><li>ç¨³å®šçš„ã€å”¯ä¸€çš„ç½‘ç»œæ ‡è¯†ç¬¦ã€‚</li><li>ç¨³å®šçš„ã€æŒä¹…çš„å­˜å‚¨ã€‚</li><li>æœ‰åºçš„ã€ä¼˜é›…çš„éƒ¨ç½²å’Œæ‰©ç¼©ã€‚</li><li>æœ‰åºçš„ã€è‡ªåŠ¨çš„æ»šåŠ¨æ›´æ–°ã€‚</li></ul><p>åœ¨ä¸Šé¢æè¿°ä¸­ï¼Œâ€œç¨³å®šçš„â€æ„å‘³ç€ Pod è°ƒåº¦æˆ–é‡è°ƒåº¦çš„æ•´ä¸ªè¿‡ç¨‹æ˜¯æœ‰æŒä¹…æ€§çš„ã€‚ å¦‚æœåº”ç”¨ç¨‹åºä¸éœ€è¦ä»»ä½•ç¨³å®šçš„æ ‡è¯†ç¬¦æˆ–æœ‰åºçš„éƒ¨ç½²ã€åˆ é™¤æˆ–æ‰©ç¼©ï¼Œ åˆ™åº”è¯¥ä½¿ç”¨ç”±ä¸€ç»„æ— çŠ¶æ€çš„å‰¯æœ¬æ§åˆ¶å™¨æä¾›çš„å·¥ä½œè´Ÿè½½æ¥éƒ¨ç½²åº”ç”¨ç¨‹åºï¼Œæ¯”å¦‚ Deploymentæˆ–è€… ReplicaSet å¯èƒ½æ›´é€‚ç”¨äºä½ çš„æ— çŠ¶æ€åº”ç”¨éƒ¨ç½²éœ€è¦ã€‚</p><h3 id="3-3-é™åˆ¶"><a href="#3-3-é™åˆ¶" class="headerlink" title="3.3 é™åˆ¶"></a>3.3 é™åˆ¶</h3><ul><li>ç»™å®š Pod çš„å­˜å‚¨å¿…é¡»ç”± PersistentVolume Provisioner åŸºäºæ‰€è¯·æ±‚çš„ <code>storage class</code> æ¥åˆ¶å¤‡ï¼Œæˆ–è€…ç”±ç®¡ç†å‘˜é¢„å…ˆåˆ¶å¤‡ã€‚</li><li>åˆ é™¤æˆ–è€…æ‰©ç¼© StatefulSet å¹¶<strong>ä¸ä¼š</strong>åˆ é™¤å®ƒå…³è”çš„å­˜å‚¨å·ã€‚ è¿™æ ·åšæ˜¯ä¸ºäº†ä¿è¯æ•°æ®å®‰å…¨ï¼Œå®ƒé€šå¸¸æ¯”è‡ªåŠ¨æ¸…é™¤ StatefulSet æ‰€æœ‰ç›¸å…³çš„èµ„æºæ›´æœ‰ä»·å€¼ã€‚</li><li>StatefulSet å½“å‰éœ€è¦<a href="https://kubernetes.io/zh-cn/docs/concepts/services-networking/service/#headless-services">æ— å¤´æœåŠ¡</a>æ¥è´Ÿè´£ Pod çš„ç½‘ç»œæ ‡è¯†ã€‚ä½ éœ€è¦è´Ÿè´£åˆ›å»ºæ­¤æœåŠ¡ã€‚</li><li>å½“åˆ é™¤ä¸€ä¸ª StatefulSet æ—¶ï¼Œè¯¥ StatefulSet ä¸æä¾›ä»»ä½•ç»ˆæ­¢ Pod çš„ä¿è¯ã€‚ ä¸ºäº†å®ç° StatefulSet ä¸­çš„ Pod å¯ä»¥æœ‰åºä¸”ä½“é¢åœ°ç»ˆæ­¢ï¼Œå¯ä»¥åœ¨åˆ é™¤ä¹‹å‰å°† StatefulSet ç¼©å®¹åˆ° 0ã€‚</li><li>åœ¨é»˜è®¤ Pod ç®¡ç†ç­–ç•¥(<code>OrderedReady</code>) æ—¶ä½¿ç”¨æ»šåŠ¨æ›´æ–°ï¼Œ å¯èƒ½è¿›å…¥éœ€è¦äººå·¥å¹²é¢„æ‰èƒ½ä¿®å¤çš„æŸåçŠ¶æ€ã€‚</li></ul><h3 id="3-4-ä½¿ç”¨-StatefulSet"><a href="#3-4-ä½¿ç”¨-StatefulSet" class="headerlink" title="3.4 ä½¿ç”¨ StatefulSet"></a>3.4 ä½¿ç”¨ StatefulSet</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">web</span></span><br><span class="line">  <span class="attr">clusterIP:</span> <span class="string">None</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StatefulSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">web</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">nginx</span> <span class="comment"># å¿…é¡»åŒ¹é… .spec.template.metadata.labels</span></span><br><span class="line">  <span class="attr">serviceName:</span> <span class="string">&quot;nginx&quot;</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span> <span class="comment"># é»˜è®¤å€¼æ˜¯ 1</span></span><br><span class="line">  <span class="comment"># æœ€çŸ­å°±ç»ªæ—¶é—´æ˜¯ä¸€ä¸ªå¯é€‰å­—æ®µã€‚ å®ƒæŒ‡å®šæ–°åˆ›å»ºçš„ Pod åº”è¯¥åœ¨æ²¡æœ‰ä»»ä½•å®¹å™¨å´©æºƒçš„æƒ…å†µä¸‹è¿è¡Œå¹¶å‡†å¤‡å°±ç»ªï¼Œæ‰èƒ½è¢«è®¤ä¸ºæ˜¯å¯ç”¨çš„ã€‚</span></span><br><span class="line">  <span class="attr">minReadySeconds:</span> <span class="number">10</span> <span class="comment"># é»˜è®¤å€¼æ˜¯ 0 æŒ‡å°±ç»ªå¯ç”¨</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nginx</span> <span class="comment"># å¿…é¡»åŒ¹é… .spec.selector.matchLabels</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">terminationGracePeriodSeconds:</span> <span class="number">10</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">registry.k8s.io/nginx-slim:0.8</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">web</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">www</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/usr/share/nginx/html</span></span><br><span class="line">  <span class="attr">volumeClaimTemplates:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">www</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">accessModes:</span> [ <span class="string">&quot;ReadWriteOnce&quot;</span> ]</span><br><span class="line">      <span class="attr">storageClassName:</span> <span class="string">&quot;my-storage-class&quot;</span></span><br><span class="line">      <span class="attr">resources:</span></span><br><span class="line">        <span class="attr">requests:</span></span><br><span class="line">          <span class="attr">storage:</span> <span class="string">1Gi</span></span><br></pre></td></tr></table></figure><h2 id="4-DaemonSet"><a href="#4-DaemonSet" class="headerlink" title="4 DaemonSet"></a>4 DaemonSet</h2><h3 id="4-1-ä»€ä¹ˆæ˜¯-DaemonSet"><a href="#4-1-ä»€ä¹ˆæ˜¯-DaemonSet" class="headerlink" title="4.1 ä»€ä¹ˆæ˜¯ DaemonSet"></a>4.1 ä»€ä¹ˆæ˜¯ DaemonSet</h3><p><a href="https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/daemonset/">https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/daemonset/</a></p><p><strong>DaemonSet</strong> ç¡®ä¿å…¨éƒ¨ï¼ˆæˆ–è€…æŸäº›ï¼‰èŠ‚ç‚¹ä¸Šè¿è¡Œä¸€ä¸ª Pod çš„å‰¯æœ¬ã€‚ å½“æœ‰èŠ‚ç‚¹åŠ å…¥é›†ç¾¤æ—¶ï¼Œ ä¹Ÿä¼šä¸ºä»–ä»¬æ–°å¢ä¸€ä¸ª Pod ã€‚ å½“æœ‰èŠ‚ç‚¹ä»é›†ç¾¤ç§»é™¤æ—¶ï¼Œè¿™äº› Pod ä¹Ÿä¼šè¢«å›æ”¶ã€‚åˆ é™¤ DaemonSet å°†ä¼šåˆ é™¤å®ƒåˆ›å»ºçš„æ‰€æœ‰ Podã€‚</p><p>DaemonSet çš„ä¸€äº›å…¸å‹ç”¨æ³•ï¼š</p><ul><li>åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œé›†ç¾¤å®ˆæŠ¤è¿›ç¨‹</li><li>åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œæ—¥å¿—æ”¶é›†å®ˆæŠ¤è¿›ç¨‹</li><li>åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œç›‘æ§å®ˆæŠ¤è¿›ç¨‹</li></ul><p>ä¸€ç§ç®€å•çš„ç”¨æ³•æ˜¯ä¸ºæ¯ç§ç±»å‹çš„å®ˆæŠ¤è¿›ç¨‹åœ¨æ‰€æœ‰çš„èŠ‚ç‚¹ä¸Šéƒ½å¯åŠ¨ä¸€ä¸ª DaemonSetã€‚ ä¸€ä¸ªç¨å¾®å¤æ‚çš„ç”¨æ³•æ˜¯ä¸ºåŒä¸€ç§å®ˆæŠ¤è¿›ç¨‹éƒ¨ç½²å¤šä¸ª DaemonSetï¼›æ¯ä¸ªå…·æœ‰ä¸åŒçš„æ ‡å¿—ï¼Œ å¹¶ä¸”å¯¹ä¸åŒç¡¬ä»¶ç±»å‹å…·æœ‰ä¸åŒçš„å†…å­˜ã€CPU è¦æ±‚ã€‚</p><h3 id="4-2-ä½¿ç”¨-DaemonSet"><a href="#4-2-ä½¿ç”¨-DaemonSet" class="headerlink" title="4.2 ä½¿ç”¨ DaemonSet"></a>4.2 ä½¿ç”¨ DaemonSet</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">DaemonSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">nginx:1.19</span></span><br><span class="line">        <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">resources:</span> &#123;&#125;</span><br><span class="line">        <span class="attr">terminationMessagePath:</span> <span class="string">/dev/termination-log</span></span><br><span class="line">        <span class="attr">terminationMessagePolicy:</span> <span class="string">File</span></span><br><span class="line">      <span class="attr">dnsPolicy:</span> <span class="string">ClusterFirst</span></span><br><span class="line">      <span class="attr">restartPolicy:</span> <span class="string">Always</span></span><br><span class="line">      <span class="attr">schedulerName:</span> <span class="string">default-scheduler</span></span><br><span class="line">      <span class="attr">securityContext:</span> &#123;&#125;</span><br><span class="line">      <span class="attr">terminationGracePeriodSeconds:</span> <span class="number">30</span></span><br></pre></td></tr></table></figure><h2 id="5-Job"><a href="#5-Job" class="headerlink" title="5 Job"></a>5 Job</h2><h3 id="5-1-ä»€ä¹ˆæ˜¯-Job"><a href="#5-1-ä»€ä¹ˆæ˜¯-Job" class="headerlink" title="5.1 ä»€ä¹ˆæ˜¯ Job"></a>5.1 ä»€ä¹ˆæ˜¯ Job</h3><p><a href="https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/job/">https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/job/</a></p><p>Job ä¼šåˆ›å»ºä¸€ä¸ªæˆ–è€…å¤šä¸ª Podï¼Œå¹¶å°†ç»§ç»­é‡è¯• Pod çš„æ‰§è¡Œï¼Œç›´åˆ°æŒ‡å®šæ•°é‡çš„ Pod æˆåŠŸç»ˆæ­¢ã€‚ éšç€ Pod æˆåŠŸç»“æŸï¼ŒJob è·Ÿè¸ªè®°å½•æˆåŠŸå®Œæˆçš„ Pod ä¸ªæ•°ã€‚ å½“æ•°é‡è¾¾åˆ°æŒ‡å®šçš„æˆåŠŸä¸ªæ•°é˜ˆå€¼æ—¶ï¼Œä»»åŠ¡ï¼ˆå³ Jobï¼‰ç»“æŸã€‚ åˆ é™¤ Job çš„æ“ä½œä¼šæ¸…é™¤æ‰€åˆ›å»ºçš„å…¨éƒ¨ Podã€‚ æŒ‚èµ· Job çš„æ“ä½œä¼šåˆ é™¤ Job çš„æ‰€æœ‰æ´»è·ƒ Podï¼Œç›´åˆ° Job è¢«å†æ¬¡æ¢å¤æ‰§è¡Œã€‚</p><p>ä¸€ç§ç®€å•çš„ä½¿ç”¨åœºæ™¯ä¸‹ï¼Œä½ ä¼šåˆ›å»ºä¸€ä¸ª Job å¯¹è±¡ä»¥ä¾¿ä»¥ä¸€ç§å¯é çš„æ–¹å¼è¿è¡ŒæŸ Pod ç›´åˆ°å®Œæˆã€‚ å½“ç¬¬ä¸€ä¸ª Pod å¤±è´¥æˆ–è€…è¢«åˆ é™¤ï¼ˆæ¯”å¦‚å› ä¸ºèŠ‚ç‚¹ç¡¬ä»¶å¤±æ•ˆæˆ–è€…é‡å¯ï¼‰æ—¶ï¼ŒJob å¯¹è±¡ä¼šå¯åŠ¨ä¸€ä¸ªæ–°çš„ Podã€‚</p><p>ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ Job ä»¥å¹¶è¡Œçš„æ–¹å¼è¿è¡Œå¤šä¸ª Podã€‚</p><h3 id="5-2-ä½¿ç”¨-Job"><a href="#5-2-ä½¿ç”¨-Job" class="headerlink" title="5.2 ä½¿ç”¨ Job"></a>5.2 ä½¿ç”¨ Job</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">batch/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Job</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pi</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">pi</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">perl:5.34.0</span></span><br><span class="line">        <span class="attr">command:</span> [<span class="string">&quot;perl&quot;</span>,  <span class="string">&quot;-Mbignum=bpi&quot;</span>, <span class="string">&quot;-wle&quot;</span>, <span class="string">&quot;print bpi(2000)&quot;</span>]</span><br><span class="line">      <span class="attr">restartPolicy:</span> <span class="string">Never</span></span><br><span class="line">  <span class="attr">backoffLimit:</span> <span class="number">4</span></span><br></pre></td></tr></table></figure><h3 id="5-3-è‡ªåŠ¨æ¸…ç†å®Œæˆçš„-Job"><a href="#5-3-è‡ªåŠ¨æ¸…ç†å®Œæˆçš„-Job" class="headerlink" title="5.3 è‡ªåŠ¨æ¸…ç†å®Œæˆçš„ Job"></a>5.3 è‡ªåŠ¨æ¸…ç†å®Œæˆçš„ Job</h3><p>å®Œæˆçš„ Job é€šå¸¸ä¸éœ€è¦ç•™å­˜åœ¨ç³»ç»Ÿä¸­ã€‚åœ¨ç³»ç»Ÿä¸­ä¸€ç›´ä¿ç•™å®ƒä»¬ä¼šç»™ API æœåŠ¡å™¨å¸¦æ¥é¢å¤–çš„å‹åŠ›ã€‚ å¦‚æœ Job ç”±æŸç§æ›´é«˜çº§åˆ«çš„æ§åˆ¶å™¨æ¥ç®¡ç†ï¼Œä¾‹å¦‚ <a href="https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/cron-jobs/">CronJob</a>ï¼Œ åˆ™ Job å¯ä»¥è¢« CronJob åŸºäºç‰¹å®šçš„æ ¹æ®å®¹é‡è£å®šçš„æ¸…ç†ç­–ç•¥æ¸…ç†æ‰ã€‚</p><ul><li><strong>å·²å®Œæˆ Job çš„ TTL æœºåˆ¶</strong><ul><li>è‡ªåŠ¨æ¸…ç†å·²å®Œæˆ Job ï¼ˆçŠ¶æ€ä¸º <code>Complete</code> æˆ– <code>Failed</code>ï¼‰çš„å¦ä¸€ç§æ–¹å¼æ˜¯ä½¿ç”¨ç”± TTL æ§åˆ¶å™¨æ‰€æä¾›çš„ TTL æœºåˆ¶ã€‚ é€šè¿‡è®¾ç½® Job çš„ <code>.spec.ttlSecondsAfterFinished</code> å­—æ®µï¼Œå¯ä»¥è®©è¯¥æ§åˆ¶å™¨æ¸…ç†æ‰å·²ç»“æŸçš„èµ„æºã€‚TTL æ§åˆ¶å™¨æ¸…ç† Job æ—¶ï¼Œä¼šçº§è”å¼åœ°åˆ é™¤ Job å¯¹è±¡ã€‚ æ¢è¨€ä¹‹ï¼Œå®ƒä¼šåˆ é™¤æ‰€æœ‰ä¾èµ–çš„å¯¹è±¡ï¼ŒåŒ…æ‹¬ Pod åŠ Job æœ¬èº«ã€‚ æ³¨æ„ï¼Œå½“ Job è¢«åˆ é™¤æ—¶ï¼Œç³»ç»Ÿä¼šè€ƒè™‘å…¶ç”Ÿå‘½å‘¨æœŸä¿éšœï¼Œä¾‹å¦‚å…¶ Finalizersã€‚</li></ul></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">batch/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Job</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pi-with-ttl</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ttlSecondsAfterFinished:</span> <span class="number">100</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">pi</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">perl:5.34.0</span></span><br><span class="line">        <span class="attr">command:</span> [<span class="string">&quot;perl&quot;</span>,  <span class="string">&quot;-Mbignum=bpi&quot;</span>, <span class="string">&quot;-wle&quot;</span>, <span class="string">&quot;print bpi(2000)&quot;</span>]</span><br><span class="line">      <span class="attr">restartPolicy:</span> <span class="string">Never</span></span><br></pre></td></tr></table></figure><p>Job <code>pi-with-ttl</code> åœ¨ç»“æŸ 100 ç§’ä¹‹åï¼Œå¯ä»¥æˆä¸ºè¢«è‡ªåŠ¨åˆ é™¤çš„å¯¹è±¡ã€‚å¦‚æœè¯¥å­—æ®µè®¾ç½®ä¸º <code>0</code>ï¼ŒJob åœ¨ç»“æŸä¹‹åç«‹å³æˆä¸ºå¯è¢«è‡ªåŠ¨åˆ é™¤çš„å¯¹è±¡ã€‚ å¦‚æœè¯¥å­—æ®µæ²¡æœ‰è®¾ç½®ï¼ŒJob ä¸ä¼šåœ¨ç»“æŸä¹‹åè¢« TTL æ§åˆ¶å™¨è‡ªåŠ¨æ¸…é™¤ã€‚</p><h2 id="6-æ§åˆ¶å™¨æ— æ³•è§£å†³é—®é¢˜"><a href="#6-æ§åˆ¶å™¨æ— æ³•è§£å†³é—®é¢˜" class="headerlink" title="6 æ§åˆ¶å™¨æ— æ³•è§£å†³é—®é¢˜"></a>6 æ§åˆ¶å™¨æ— æ³•è§£å†³é—®é¢˜</h2><ul><li>å¦‚ä½•ä¸º Pod æä¾›ç½‘ç»œæœåŠ¡</li><li>å¦‚ä½•å®ç°å¤šä¸ª Pod é—´è´Ÿè½½å‡è¡¡</li></ul><h1 id="ç¬¬äº”ç« -Service"><a href="#ç¬¬äº”ç« -Service" class="headerlink" title="ç¬¬äº”ç«  Service"></a>ç¬¬äº”ç«  Service</h1><ul><li>ä»€ä¹ˆæ˜¯ Service </li><li>ä¸ºä»€ä¹ˆéœ€è¦ Service</li><li>Service ç‰¹æ€§ </li><li>Service ä¸ Pod å…³è”</li><li>Service type ç±»å‹</li><li>å¦‚ä½•ä½¿ç”¨ Service</li><li>å¤šç«¯å£é…ç½®</li></ul><h2 id="1-ä»€ä¹ˆæ˜¯-Service"><a href="#1-ä»€ä¹ˆæ˜¯-Service" class="headerlink" title="1 ä»€ä¹ˆæ˜¯ Service"></a>1 ä»€ä¹ˆæ˜¯ Service</h2><h3 id="1-1-å®šä¹‰"><a href="#1-1-å®šä¹‰" class="headerlink" title="1.1 å®šä¹‰"></a>1.1 å®šä¹‰</h3><p>å®˜ç½‘åœ°å€: <a href="https://kubernetes.io/zh-cn/docs/concepts/services-networking/service/">https://kubernetes.io/zh-cn/docs/concepts/services-networking/service/</a></p><p>å°†è¿è¡Œåœ¨ä¸€ä¸ªæˆ–ä¸€ç»„ Pod ä¸Šçš„ç½‘ç»œåº”ç”¨ç¨‹åºå…¬å¼€ä¸ºç½‘ç»œæœåŠ¡çš„æ–¹æ³•ã€‚</p><p><strong>é€šä¿—å®šä¹‰: Service ç”¨æ¥ä¸º pod æä¾›ç½‘ç»œæœåŠ¡çš„ä¸€ç§æ–¹å¼ã€‚</strong></p><h3 id="1-2-ä¸ºä»€ä¹ˆéœ€è¦-Service"><a href="#1-2-ä¸ºä»€ä¹ˆéœ€è¦-Service" class="headerlink" title="1.2 ä¸ºä»€ä¹ˆéœ€è¦ Service"></a>1.2 ä¸ºä»€ä¹ˆéœ€è¦ Service</h3><p>é—®é¢˜:  å¦‚æœä¸€ç»„ Podï¼ˆç§°ä¸ºâ€œåç«¯â€ï¼‰ä¸ºé›†ç¾¤å†…çš„å…¶ä»– Podï¼ˆç§°ä¸ºâ€œå‰ç«¯â€ï¼‰æä¾›åŠŸèƒ½ï¼Œ é‚£ä¹ˆå‰ç«¯å¦‚ä½•æ‰¾å‡ºå¹¶è·Ÿè¸ªè¦è¿æ¥çš„ IP åœ°å€ï¼Œä»¥ä¾¿å‰ç«¯å¯ä»¥ä½¿ç”¨æä¾›å·¥ä½œè´Ÿè½½çš„åç«¯éƒ¨åˆ†ï¼Ÿ</p><p><img src="https://www.naste.top:9000/images/image-20230307133342270.png" alt="image-20230307133342270"></p><p>å¦‚æœè¿™æ˜¯ä¸€ä¸ªå›¾ç‰‡å¤„ç†åç«¯ï¼Œå®ƒè¿è¡Œäº† 3 ä¸ªå‰¯æœ¬ã€‚è¿™äº›å‰¯æœ¬æ˜¯å¯äº’æ¢çš„ â€”â€” å‰ç«¯ä¸éœ€è¦å…³å¿ƒå®ƒä»¬è°ƒç”¨äº†å“ªä¸ªåç«¯å‰¯æœ¬ã€‚ ç„¶è€Œç»„æˆè¿™ä¸€ç»„åç«¯ç¨‹åºçš„ Pod å®é™…ä¸Šå¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–ï¼Œ å‰ç«¯å®¢æˆ·ç«¯ä¸åº”è¯¥ä¹Ÿæ²¡å¿…è¦çŸ¥é“ï¼Œè€Œä¸”ä¹Ÿä¸éœ€è¦è·Ÿè¸ªè¿™ä¸€ç»„åç«¯çš„çŠ¶æ€ã€‚<strong>Service å®šä¹‰çš„æŠ½è±¡èƒ½å¤Ÿè§£è€¦è¿™ç§å…³è”</strong>ã€‚</p><p><img src="https://www.naste.top:9000/images/image-20230307134050380.png" alt="image-20230307134050380"></p><h2 id="2-ç‰¹æ€§"><a href="#2-ç‰¹æ€§" class="headerlink" title="2 ç‰¹æ€§"></a>2 ç‰¹æ€§</h2><ul><li>Service é€šè¿‡ label å…³è”å¯¹åº”çš„ Pod</li><li>Servcie ç”Ÿå‘½å‘¨æœŸä¸è·Ÿ Pod ç»‘å®šï¼Œä¸ä¼šå› ä¸º Pod é‡æ–°åˆ›å»ºè€Œæ”¹å˜ IP</li><li>æä¾›äº†è´Ÿè½½å‡è¡¡åŠŸèƒ½ï¼Œè‡ªåŠ¨è½¬å‘æµé‡åˆ°ä¸åŒ Pod</li><li>å¯å¯¹é›†ç¾¤å¤–éƒ¨æä¾›è®¿é—®ç«¯å£</li><li>é›†ç¾¤å†…éƒ¨å¯é€šè¿‡æœåŠ¡åå­—è®¿é—®</li></ul><h2 id="3-Service-å’Œ-Pod-å…³ç³»"><a href="#3-Service-å’Œ-Pod-å…³ç³»" class="headerlink" title="3 Service å’Œ Pod å…³ç³»"></a>3 Service å’Œ Pod å…³ç³»</h2><p><img src="https://www.naste.top:9000/images/image-20230307132243053.png" alt="image-20230307132243053"></p><h2 id="4-ä½¿ç”¨-Service"><a href="#4-ä½¿ç”¨-Service" class="headerlink" title="4 ä½¿ç”¨ Service"></a>4 ä½¿ç”¨ Service</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">nginx:1.19</span></span><br><span class="line">          <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">          <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">      <span class="attr">restartPolicy:</span> <span class="string">Always</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">8080</span> <span class="comment">#service ç«¯å£</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">80</span> <span class="comment">#å®¹å™¨ç«¯å£</span></span><br><span class="line">      <span class="attr">nodePort:</span> <span class="number">31001</span> <span class="comment">#node èŠ‚ç‚¹ç«¯å£ å›ºå®šåœ¨ 30000-32767 ä¹‹é—´</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span></span><br></pre></td></tr></table></figure><p><strong><code>æ³¨æ„:èŠ‚ç‚¹ç«¯å£å›ºå®šåœ¨ 30000-32767 ä¹‹é—´</code></strong></p><h2 id="5-å¤šç«¯å£"><a href="#5-å¤šç«¯å£" class="headerlink" title="5 å¤šç«¯å£"></a>5 å¤šç«¯å£</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">nginx:1.19</span></span><br><span class="line">          <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">          <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">      <span class="attr">restartPolicy:</span> <span class="string">Always</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">8080</span> <span class="comment">#service ç«¯å£</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">write</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">80</span> <span class="comment">#å®¹å™¨ç«¯å£</span></span><br><span class="line">      <span class="attr">nodePort:</span> <span class="number">31001</span> <span class="comment">#node èŠ‚ç‚¹ç«¯å£ å›ºå®šåœ¨ 30000-32767 ä¹‹é—´</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">8081</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">read</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">80</span></span><br><span class="line">      <span class="attr">nodePort:</span> <span class="number">31002</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span></span><br></pre></td></tr></table></figure><h2 id="6-ç±»å‹-type"><a href="#6-ç±»å‹-type" class="headerlink" title="6 ç±»å‹ type"></a>6 ç±»å‹ type</h2><p><a href="https://kubernetes.io/zh-cn/docs/concepts/services-networking/service/">https://kubernetes.io/zh-cn/docs/concepts/services-networking/service/</a></p><p>å¯¹ä¸€äº›åº”ç”¨çš„æŸäº›éƒ¨åˆ†ï¼ˆå¦‚å‰ç«¯ï¼‰ï¼Œå¯èƒ½å¸Œæœ›å°†å…¶æš´éœ²ç»™ Kubernetes é›†ç¾¤å¤–éƒ¨çš„ IP åœ°å€ã€‚</p><p>Kubernetes <code>ServiceTypes</code> å…è®¸æŒ‡å®šä½ æ‰€éœ€è¦çš„ Service ç±»å‹ã€‚</p><ul><li><code>ClusterIP</code>ï¼šåœ¨é›†ç¾¤å†…éƒ¨æš´éœ² Serviceï¼Œåªèƒ½è¢«é›†ç¾¤å†…éƒ¨çš„å…¶ä»–å¯¹è±¡è®¿é—®ï¼Œé€šå¸¸ç”¨äºå†…éƒ¨æœåŠ¡å‘ç°ï¼Œä¸ä¼šå‘é›†ç¾¤å¤–éƒ¨æš´éœ²ã€‚</li><li><code>NodePort</code>ï¼šå°† Service æš´éœ²åœ¨ Node çš„æŸä¸ªç«¯å£ä¸Šï¼Œä»è€Œå¯ä»¥é€šè¿‡ Node çš„ IP åœ°å€å’Œç«¯å£å·æ¥è®¿é—® Serviceï¼Œé€šå¸¸ç”¨äºå¼€å‘å’Œæµ‹è¯•ç¯å¢ƒã€‚</li><li><code>LoadBalancer</code>ï¼šé€šè¿‡äº‘æœåŠ¡å•†æä¾›çš„è´Ÿè½½å‡è¡¡å™¨æ¥å°† Service æš´éœ²åˆ°å…¬ç½‘ä¸Šï¼Œä½¿å¾—å¤–éƒ¨ç”¨æˆ·å¯ä»¥è®¿é—® Serviceã€‚</li><li><code>ExternalName</code>ï¼šå°† Service æ˜ å°„åˆ°ä¸€ä¸ª DNS åç§°ä¸Šï¼Œä»è€Œå¯ä»¥é€šè¿‡ DNS åç§°æ¥è®¿é—® Serviceï¼Œé€šå¸¸ç”¨äºè®¿é—®å¤–éƒ¨æœåŠ¡ã€‚</li></ul><h3 id="6-1-ClusterIP-ç±»å‹"><a href="#6-1-ClusterIP-ç±»å‹" class="headerlink" title="6.1 ClusterIP ç±»å‹"></a>6.1 ClusterIP ç±»å‹</h3><ul><li><code>è¿™æ˜¯æœ€å¸¸ç”¨çš„ Service ç±»å‹ä¹‹ä¸€</code>ã€‚åœ¨é›†ç¾¤å†…éƒ¨åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿ IP åœ°å€ï¼Œå®ƒå¯ä»¥è¢«å…¶ä»–åœ¨åŒä¸€é›†ç¾¤å†…çš„ Pod è®¿é—®ï¼Œä½†ä¸èƒ½è¢«é›†ç¾¤å¤–éƒ¨çš„è¯·æ±‚æ‰€è®¿é—®ã€‚è¿™ç§ç±»å‹çš„æœåŠ¡é€šå¸¸ç”¨äºå†…éƒ¨æœåŠ¡çš„æš´éœ²ï¼Œä¾‹å¦‚æ•°æ®åº“æˆ–è€…ç¼“å­˜æœåŠ¡ã€‚æ¯”å¦‚åœ¨ä¸€ä¸ª Web åº”ç”¨ä¸­ï¼Œä½ å¯èƒ½éœ€è¦è¿æ¥åˆ°ä¸€ä¸ªæ•°æ®åº“ï¼Œä½†æ˜¯è¿™ä¸ªæ•°æ®åº“å¹¶ä¸éœ€è¦åœ¨åº”ç”¨ä¹‹å¤–æš´éœ²ã€‚è¿™æ—¶å€™ï¼Œä½ å¯ä»¥ä½¿ç”¨ ClusterIP ç±»å‹çš„ Serviceï¼Œè®©åº”ç”¨å¯ä»¥è®¿é—®åˆ°æ•°æ®åº“ã€‚</li></ul><h3 id="6-2-NodePort-ç±»å‹"><a href="#6-2-NodePort-ç±»å‹" class="headerlink" title="6.2 NodePort ç±»å‹"></a>6.2 NodePort ç±»å‹</h3><ul><li><p>è¿™ç§ç±»å‹çš„ Service å°†ä¼šåˆ›å»ºä¸€ä¸ªç«¯å£ï¼Œå¹¶ç»‘å®šåˆ°æ¯ä¸ªé›†ç¾¤èŠ‚ç‚¹ä¸Šï¼Œä»è€Œå…è®¸å¤–éƒ¨æµé‡è®¿é—® Serviceã€‚è¿™ä¸ªç±»å‹é€šå¸¸ç”¨äºå…¬å…±æœåŠ¡çš„æš´éœ²ï¼Œä¾‹å¦‚ Web åº”ç”¨æˆ–è€… APIã€‚æ¯”å¦‚ä½ éœ€è¦åœ¨é›†ç¾¤å¤–éƒ¨è®¿é—®åˆ°ä¸€ä¸ªè¿è¡Œåœ¨é›†ç¾¤ä¸­çš„ Web åº”ç”¨ï¼Œä½ å°±å¯ä»¥åˆ›å»ºä¸€ä¸ª NodePort ç±»å‹çš„ Serviceï¼Œé€šè¿‡æŒ‡å®š Service çš„ <code>nodePort</code> å­—æ®µï¼Œæ¥å°† Service æš´éœ²ç»™é›†ç¾¤å¤–éƒ¨ã€‚</p></li><li><p>å¦‚æœä½ å°† <code>type</code> å­—æ®µè®¾ç½®ä¸º <code>NodePort</code>ï¼Œåˆ™ Kubernetes æ§åˆ¶å¹³é¢å°†åœ¨ <code>--service-node-port-range</code> æ ‡å¿—æŒ‡å®šçš„èŒƒå›´å†…åˆ†é…ç«¯å£ï¼ˆé»˜è®¤å€¼ï¼š30000-32767ï¼‰ã€‚ </p></li></ul><h3 id="6-3-LoadBalancer-ç±»å‹"><a href="#6-3-LoadBalancer-ç±»å‹" class="headerlink" title="6.3 LoadBalancer ç±»å‹"></a>6.3 LoadBalancer ç±»å‹</h3><ul><li>è¿™ç§ç±»å‹çš„ Service ç±»ä¼¼äº NodePortï¼Œä½†æ˜¯ä¼šåœ¨äº‘å‚å•†ä¸­åˆ›å»ºä¸€ä¸ªè´Ÿè½½å‡è¡¡å™¨ã€‚è¿™ä¸ªç±»å‹é€šå¸¸ç”¨äºåœ¨äº‘å¹³å°ä¸Šéƒ¨ç½²åº”ç”¨ã€‚äº‘å¹³å°çš„è´Ÿè½½å‡è¡¡å™¨å°†æµé‡åˆ†å‘åˆ°é›†ç¾¤ä¸­çš„èŠ‚ç‚¹ã€‚è¿™ä¸ªç±»å‹çš„ Service åªèƒ½åœ¨äº‘å¹³å°ä¸Šä½¿ç”¨ï¼Œå¹¶ä¸”éœ€è¦äº‘å‚å•†æä¾›æ”¯æŒã€‚</li></ul><h3 id="6-4-ExternalName-ç±»å‹"><a href="#6-4-ExternalName-ç±»å‹" class="headerlink" title="6.4 ExternalName ç±»å‹"></a>6.4 ExternalName ç±»å‹</h3><ul><li>è¿™ç§ç±»å‹çš„ Service å…è®¸ Service åˆ°ä»»ä½•éœ€è¦è®¿é—®çš„ CNAME DNS æ¡ç›®çš„è½¬å‘ã€‚ä¸å…¶å®ƒç±»å‹çš„ Service ä¸åŒï¼Œå®ƒå¹¶ä¸ä¼šä»£ç†è¯·æ±‚åˆ°ä»»ä½• Podã€‚ç›¸åï¼Œå®ƒå°†è¯·æ±‚è½¬å‘åˆ°é…ç½®çš„å¤–éƒ¨åœ°å€ã€‚è¿™ç§ç±»å‹çš„ Service é€šå¸¸ç”¨äºå°†æœåŠ¡ä»£ç†åˆ°é›†ç¾¤å¤–éƒ¨çš„å…¶ä»–æœåŠ¡ã€‚æ¯”å¦‚ä½ æœ‰ä¸€ä¸ªè¿è¡Œåœ¨å¤–éƒ¨ç½‘ç»œä¸Šçš„æœåŠ¡ï¼Œä½ å¸Œæœ›åœ¨ Kubernetes é›†ç¾¤ä¸­ä½¿ç”¨è¯¥æœåŠ¡ï¼Œè¿™æ—¶å€™ä½ å¯ä»¥åˆ›å»ºä¸€ä¸ª ExternalName ç±»å‹çš„ Serviceï¼Œå°†æœåŠ¡çš„ DNS è§£æåˆ° Kubernetes é›†ç¾¤ä¸­ã€‚</li></ul><h2 id="7-å†…éƒ¨é€šä¿¡"><a href="#7-å†…éƒ¨é€šä¿¡" class="headerlink" title="7 å†…éƒ¨é€šä¿¡"></a>7 å†…éƒ¨é€šä¿¡</h2><h3 id="7-1-åˆ›å»º-pod"><a href="#7-1-åˆ›å»º-pod" class="headerlink" title="7.1 åˆ›å»º pod"></a>7.1 åˆ›å»º pod</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mysql</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">mysql</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">mysql</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">mysql</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mysql</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">mysql:8.0</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">MYSQL_ROOT_PASSWORD</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mysql</span></span><br><span class="line">          <span class="attr">containerPort:</span> <span class="number">3306</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mysql</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">mysql</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mysql</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">3306</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">3306</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">ClusterIP</span></span><br></pre></td></tr></table></figure><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">nginx:latest</span></span><br><span class="line">        <span class="attr">command:</span> [<span class="string">&quot;/bin/sh&quot;</span>, <span class="string">&quot;-c&quot;</span>]</span><br><span class="line">        <span class="attr">args:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">apt-get</span> <span class="string">update</span> <span class="string">&amp;&amp;</span> <span class="string">apt-get</span> <span class="string">install</span> <span class="string">-y</span> <span class="string">mysql-client</span> <span class="string">&amp;&amp;</span> <span class="string">nginx</span> <span class="string">-g</span> <span class="string">&#x27;daemon off;&#x27;</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">http</span></span><br><span class="line">          <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">http</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">80</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">ClusterIP</span></span><br></pre></td></tr></table></figure><h3 id="7-2-ç›¸äº’è®¿é—®"><a href="#7-2-ç›¸äº’è®¿é—®" class="headerlink" title="7.2 ç›¸äº’è®¿é—®"></a>7.2 ç›¸äº’è®¿é—®</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿›å…¥ nginx è®¿é—®mysql</span></span><br><span class="line">mysql -h mysql -uroot -ppassword</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ³¨æ„ï¼šè¿™é‡Œçš„ mysql æ˜¯ MySQL Service çš„åç§°ï¼Œè€Œä¸æ˜¯ Pod çš„åç§°ã€‚</span></span><br></pre></td></tr></table></figure><h1 id="ç¬¬å…­ç« -å­˜å‚¨"><a href="#ç¬¬å…­ç« -å­˜å‚¨" class="headerlink" title="ç¬¬å…­ç«  å­˜å‚¨"></a>ç¬¬å…­ç«  å­˜å‚¨</h1><ul><li>ä»€ä¹ˆæ˜¯å· Volume</li><li>å¸¸ç”¨å·çš„ç±»å‹</li><li>ä½¿ç”¨æ–¹å¼</li><li>Persistent Volume å’Œ Persistent Volume Claim</li><li>é™æ€ä¾›ç»™</li><li>åŠ¨æ€ä¾›ç»™</li></ul><h2 id="1-å·-Volume"><a href="#1-å·-Volume" class="headerlink" title="1 å· Volume"></a>1 å· Volume</h2><p>å®˜ç½‘åœ°å€: <a href="https://kubernetes.io/zh-cn/docs/concepts/storage/volumes/">https://kubernetes.io/zh-cn/docs/concepts/storage/volumes/</a></p><p>Container ä¸­çš„æ–‡ä»¶åœ¨ç£ç›˜ä¸Šæ˜¯ä¸´æ—¶å­˜æ”¾çš„ï¼Œè¿™ç»™ Container ä¸­è¿è¡Œçš„è¾ƒé‡è¦çš„åº”ç”¨ç¨‹åºå¸¦æ¥ä¸€äº›é—®é¢˜ã€‚ é—®é¢˜ä¹‹ä¸€æ˜¯å½“å®¹å™¨å´©æºƒæ—¶æ–‡ä»¶ä¸¢å¤±ã€‚ kubelet ä¼šé‡æ–°å¯åŠ¨å®¹å™¨ï¼Œä½†å®¹å™¨ä¼šä»¥å¹²å‡€çš„çŠ¶æ€é‡å¯ã€‚ ç¬¬äºŒä¸ªé—®é¢˜ä¼šåœ¨åŒä¸€ <code>Pod</code> ä¸­è¿è¡Œå¤šä¸ªå®¹å™¨å¹¶å…±äº«æ–‡ä»¶æ—¶å‡ºç°ã€‚ <strong><code>Kubernetes Volume è¿™ä¸€æŠ½è±¡æ¦‚å¿µèƒ½å¤Ÿè§£å†³è¿™ä¸¤ä¸ªé—®é¢˜ã€‚</code></strong></p><h2 id="2-å·çš„ç±»å‹"><a href="#2-å·çš„ç±»å‹" class="headerlink" title="2 å·çš„ç±»å‹"></a>2 å·çš„ç±»å‹</h2><p>Kubernetes æ”¯æŒå¾ˆå¤šç±»å‹çš„å·ã€‚ Pod å¯ä»¥åŒæ—¶ä½¿ç”¨ä»»æ„æ•°ç›®çš„å·ç±»å‹ã€‚ ä¸´æ—¶å·ç±»å‹çš„ç”Ÿå‘½å‘¨æœŸä¸ Pod ç›¸åŒï¼Œä½†æŒä¹…å·å¯ä»¥æ¯” Pod çš„å­˜æ´»æœŸé•¿ã€‚ å½“ Pod ä¸å†å­˜åœ¨æ—¶ï¼ŒKubernetes ä¹Ÿä¼šé”€æ¯ä¸´æ—¶å·ï¼›ä¸è¿‡ Kubernetes ä¸ä¼šé”€æ¯æŒä¹…å·ã€‚ å¯¹äºç»™å®š Pod ä¸­ä»»ä½•ç±»å‹çš„å·ï¼Œåœ¨å®¹å™¨é‡å¯æœŸé—´æ•°æ®éƒ½ä¸ä¼šä¸¢å¤±ã€‚</p><p>å·çš„æ ¸å¿ƒæ˜¯ä¸€ä¸ªç›®å½•ï¼Œå…¶ä¸­å¯èƒ½å­˜æœ‰æ•°æ®ï¼ŒPod ä¸­çš„å®¹å™¨å¯ä»¥è®¿é—®è¯¥ç›®å½•ä¸­çš„æ•°æ®ã€‚ æ‰€é‡‡ç”¨çš„ä¸åŒå·çš„ç±»å‹å°†å†³å®šè¯¥ç›®å½•å¦‚ä½•å½¢æˆçš„ã€ä½¿ç”¨ä½•ç§ä»‹è´¨ä¿å­˜æ•°æ®ä»¥åŠç›®å½•ä¸­å­˜æ”¾çš„å†…å®¹ã€‚å¸¸ç”¨çš„å·ç±»å‹æœ‰ <strong>configMapã€emptyDirã€localã€nfsã€secret</strong> ç­‰ã€‚</p><ul><li>ConfigMapï¼šå¯ä»¥å°†é…ç½®æ–‡ä»¶ä»¥é”®å€¼å¯¹çš„å½¢å¼ä¿å­˜åˆ° ConfigMap ä¸­ï¼Œå¹¶ä¸”å¯ä»¥åœ¨ Pod ä¸­ä»¥æ–‡ä»¶æˆ–ç¯å¢ƒå˜é‡çš„å½¢å¼ä½¿ç”¨ã€‚ConfigMap å¯ä»¥ç”¨æ¥å­˜å‚¨ä¸æ•æ„Ÿçš„é…ç½®ä¿¡æ¯ï¼Œå¦‚åº”ç”¨ç¨‹åºçš„é…ç½®æ–‡ä»¶ã€‚</li><li>EmptyDirï¼šæ˜¯ä¸€ä¸ªç©ºç›®å½•ï¼Œå¯ä»¥åœ¨ Pod ä¸­ç”¨æ¥å­˜å‚¨ä¸´æ—¶æ•°æ®ï¼Œå½“ Pod è¢«åˆ é™¤æ—¶ï¼Œè¯¥ç›®å½•ä¹Ÿä¼šè¢«åˆ é™¤ã€‚</li><li>Localï¼šå°†æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿçš„ç›®å½•æˆ–æ–‡ä»¶æ˜ å°„åˆ° Pod ä¸­çš„ä¸€ä¸ª Volume ä¸­ï¼Œå¯ä»¥ç”¨æ¥åœ¨ Pod ä¸­å…±äº«æ–‡ä»¶æˆ–æ•°æ®ã€‚</li><li>NFSï¼šå°†ç½‘ç»œä¸Šçš„ä¸€ä¸ªæˆ–å¤šä¸ª NFS å…±äº«ç›®å½•æŒ‚è½½åˆ° Pod ä¸­çš„ Volume ä¸­ï¼Œå¯ä»¥ç”¨æ¥åœ¨å¤šä¸ª Pod ä¹‹é—´å…±äº«æ•°æ®ã€‚</li><li>Secretï¼šå°†æ•æ„Ÿä¿¡æ¯ä»¥å¯†æ–‡çš„å½¢å¼ä¿å­˜åˆ° Secret ä¸­ï¼Œå¹¶ä¸”å¯ä»¥åœ¨ Pod ä¸­ä»¥æ–‡ä»¶æˆ–ç¯å¢ƒå˜é‡çš„å½¢å¼ä½¿ç”¨ã€‚Secret å¯ä»¥ç”¨æ¥å­˜å‚¨æ•æ„Ÿä¿¡æ¯ï¼Œå¦‚ç”¨æˆ·åå¯†ç ã€è¯ä¹¦ç­‰ã€‚</li></ul><h2 id="3-ä½¿ç”¨æ–¹å¼"><a href="#3-ä½¿ç”¨æ–¹å¼" class="headerlink" title="3 ä½¿ç”¨æ–¹å¼"></a>3 ä½¿ç”¨æ–¹å¼</h2><p>ä½¿ç”¨å·æ—¶, åœ¨ <code>.spec.volumes</code> å­—æ®µä¸­è®¾ç½®ä¸º Pod æä¾›çš„å·ï¼Œå¹¶åœ¨ <code>.spec.containers[*].volumeMounts</code> å­—æ®µä¸­å£°æ˜å·åœ¨å®¹å™¨ä¸­çš„æŒ‚è½½ä½ç½®ã€‚ å®¹å™¨ä¸­çš„è¿›ç¨‹çœ‹åˆ°çš„æ–‡ä»¶ç³»ç»Ÿè§†å›¾æ˜¯ç”±å®ƒä»¬çš„å®¹å™¨é•œåƒçš„åˆå§‹å†…å®¹ä»¥åŠæŒ‚è½½åœ¨å®¹å™¨ä¸­çš„å·ï¼ˆå¦‚æœå®šä¹‰äº†çš„è¯ï¼‰æ‰€ç»„æˆçš„ã€‚ å…¶ä¸­æ ¹æ–‡ä»¶ç³»ç»ŸåŒå®¹å™¨é•œåƒçš„å†…å®¹ç›¸å»åˆã€‚ ä»»ä½•åœ¨è¯¥æ–‡ä»¶ç³»ç»Ÿä¸‹çš„å†™å…¥æ“ä½œï¼Œå¦‚æœè¢«å…è®¸çš„è¯ï¼Œéƒ½ä¼šå½±å“æ¥ä¸‹æ¥å®¹å™¨ä¸­è¿›ç¨‹è®¿é—®æ–‡ä»¶ç³»ç»Ÿæ—¶æ‰€çœ‹åˆ°çš„å†…å®¹ã€‚</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">configmap-pod</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">test</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">busybox:1.28</span></span><br><span class="line">      <span class="attr">volumeMounts:</span></span><br><span class="line">     <span class="string">..........</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">  <span class="string">............</span></span><br></pre></td></tr></table></figure><h2 id="4-å¸¸è§ç±»å‹"><a href="#4-å¸¸è§ç±»å‹" class="headerlink" title="4 å¸¸è§ç±»å‹"></a>4 å¸¸è§ç±»å‹</h2><h3 id="4-1-emptyDir"><a href="#4-1-emptyDir" class="headerlink" title="4.1 emptyDir"></a>4.1 emptyDir</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">emptydir-example</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">writer</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">busybox</span></span><br><span class="line">      <span class="attr">command:</span> [<span class="string">&quot;/bin/sh&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;echo &#x27;Hello World!&#x27; &gt; /data/hello.txt ; sleep 3600&quot;</span>]</span><br><span class="line">      <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">shared-data</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/data</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">reader</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">busybox</span></span><br><span class="line">      <span class="attr">command:</span> [<span class="string">&quot;/bin/sh&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;cat /data/hello.txt ; sleep 3600&quot;</span>]</span><br><span class="line">      <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">shared-data</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/data</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">shared-data</span></span><br><span class="line">      <span class="attr">emptyDir:</span> &#123;&#125;</span><br></pre></td></tr></table></figure><p><code>æ€»ç»“: emptyDir æ˜¯ Host ä¸Šåˆ›å»ºçš„ä¸´æ—¶ç›®å½•ï¼Œå…¶ä¼˜ç‚¹æ˜¯èƒ½å¤Ÿæ–¹ä¾¿åœ°ä¸º Pod ä¸­çš„å®¹å™¨æä¾›å…±äº«å­˜å‚¨ï¼Œä¸éœ€è¦é¢å¤–çš„é…ç½®ã€‚å®ƒä¸å…·å¤‡æŒä¹…æ€§ï¼Œå¦‚æœPod ä¸å­˜åœ¨äº†ï¼ŒemptyDir ä¹Ÿå°±æ²¡æœ‰äº†ã€‚æ ¹æ®è¿™ä¸ªç‰¹æ€§ï¼ŒemptyDir ç‰¹åˆ«é€‚åˆ Pod ä¸­çš„å®¹å™¨éœ€è¦ä¸´æ—¶å…±äº«å­˜å‚¨ç©ºé—´çš„åœºæ™¯ï¼Œæ¯”å¦‚å‰é¢çš„ç”Ÿäº§è€…æ¶ˆè´¹è€…ç”¨ä¾‹ã€‚</code></p><h3 id="4-2-hostPath"><a href="#4-2-hostPath" class="headerlink" title="4.2 hostPath"></a>4.2 hostPath</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">busybox-hostpath</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;/bin/sh&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;echo &#x27;hello&#x27; &gt; /data/data.txt &amp;&amp; sleep 3600&quot;</span>]</span><br><span class="line">    <span class="attr">volumeMounts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">data</span></span><br><span class="line">      <span class="attr">mountPath:</span> <span class="string">/data</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">data</span></span><br><span class="line">    <span class="attr">hostPath:</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">/data/hostpath</span></span><br></pre></td></tr></table></figure><p><code>æ€»ç»“: å¦‚æœ Pod è¢«é”€æ¯€äº†ï¼ŒhostPath å¯¹åº”çš„ç›®å½•è¿˜æ˜¯ä¼šè¢«ä¿ç•™ï¼Œä»è¿™ä¸€ç‚¹æ¥çœ‹ï¼ŒhostPath çš„æŒä¹…æ€§æ¯”emptyDir å¼ºã€‚ä¸è¿‡ä¸€æ—¦Host å´©æºƒï¼ŒhostPath ä¹Ÿå°±æ— æ³•è®¿é—®äº†ã€‚ä½†æ˜¯è¿™ç§æ–¹å¼ä¹Ÿå¸¦æ¥å¦å¤–ä¸€ä¸ªé—®é¢˜å¢åŠ äº† pod ä¸èŠ‚ç‚¹çš„è€¦åˆã€‚</code></p><h3 id="4-3-nfs"><a href="#4-3-nfs" class="headerlink" title="4.3 nfs"></a>4.3 nfs</h3><p>nfs: network filesystem : ç½‘ç»œæ–‡ä»¶å­˜å‚¨ç³»ç»Ÿ</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nfs-test</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">command:</span> [ <span class="string">&quot;/bin/sh&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;while true; do sleep 3600; done&quot;</span> ]</span><br><span class="line">    <span class="attr">volumeMounts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nfs-volume</span></span><br><span class="line">      <span class="attr">mountPath:</span> <span class="string">/mnt/nfs</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nfs-volume</span></span><br><span class="line">    <span class="attr">nfs:</span></span><br><span class="line">      <span class="attr">server:</span> <span class="string">&lt;NFS_SERVER_IP&gt;</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">/path/to/nfs/share</span></span><br></pre></td></tr></table></figure><p><code>æ€»ç»“: ç›¸å¯¹äº emptyDir å’Œ hostPathï¼Œè¿™ç§ volume ç±»å‹çš„æœ€å¤§ç‰¹ç‚¹å°±æ˜¯ä¸ä¾èµ– Kuberees Volume çš„åº•å±‚åŸºç¡€è®¾æ–½ç”±ç‹¬ç«‹çš„å­˜å‚¨ç³»ç»Ÿç®¡ç†ï¼Œä¸ Kubernetes é›†ç¾¤æ˜¯åˆ†ç¦»çš„ã€‚æ•°æ®è¢«æŒä¹…åŒ–åï¼Œå³ä½¿æ•´ä¸ª Kubernetes å´©æºƒä¹Ÿä¸ä¼šå—æŸã€‚å½“ç„¶ï¼Œè¿ç»´è¿™æ ·çš„å­˜å‚¨ç³»ç»Ÿé€šå¸¸ä¸æ˜¯ä¸€é¡¹ç®€å•çš„å·¥ä½œï¼Œç‰¹åˆ«æ˜¯å¯¹å¯é æ€§ã€å¯ç”¨æ€§å’Œæ‰©å±•æ€§ æœ‰è¾ƒé«˜è¦æ±‚çš„æ—¶å€™ã€‚</code></p><h2 id="5-PV-amp-PVC"><a href="#5-PV-amp-PVC" class="headerlink" title="5 PV &amp;  PVC"></a>5 PV &amp;  PVC</h2><h3 id="5-1-é—®é¢˜"><a href="#5-1-é—®é¢˜" class="headerlink" title="5.1 é—®é¢˜"></a>5.1 é—®é¢˜</h3><p>Volume æä¾›äº†éå¸¸å¥½çš„æ•°æ®æŒä¹…åŒ–æ–¹æ¡ˆï¼Œä¸è¿‡åœ¨å¯ç®¡ç†æ€§ä¸Šè¿˜æœ‰ä¸è¶³ã€‚å‰é¢ nfs ä¾‹å­æ¥è¯´ï¼Œè¦ä½¿ç”¨ Volumeï¼Œ Pod å¿…é¡»äº‹å…ˆçŸ¥é“ä»¥ä¸‹ä¿¡æ¯ï¼š</p><ul><li>å½“å‰çš„ Volume ç±»å‹å¹¶æ˜ç¡® Volume å·²ç»åˆ›å»ºå¥½ã€‚</li><li>å¿…é¡»çŸ¥é“ Volume çš„å…·ä½“åœ°å€ä¿¡æ¯ã€‚</li></ul><p>ä½†æ˜¯ Pod é€šå¸¸æ˜¯ç”±åº”ç”¨çš„å¼€å‘äººå‘˜ç»´æŠ¤ï¼Œè€Œ Volume åˆ™é€šå¸¸æ˜¯ç”±å­˜å‚¨ç³»ç»Ÿçš„ç®¡ç†å‘˜ç»´æŠ¤ã€‚å¼€å‘äººå‘˜è¦è·å¾—ä¸Šé¢çš„ä¿¡æ¯ï¼Œè¦ä¹ˆè¯¢é—®ç®¡ç†å‘˜ï¼Œè¦ä¹ˆè‡ªå·±å°±æ˜¯ç®¡ç†å‘˜ã€‚è¿™æ ·å°±å¸¦æ¥ä¸€ä¸ªç®¡ç†ä¸Šçš„é—®é¢˜ï¼šåº”ç”¨å¼€å‘äººå‘˜å’Œç³»ç»Ÿç®¡ç†å‘˜çš„èŒè´£è€¦åˆåœ¨ä¸€èµ·äº†ã€‚å¦‚æœç³»ç»Ÿè§„æ¨¡è¾ƒå°æˆ–è€…å¯¹äºå¼€å‘ç¯å¢ƒï¼Œè¿™æ ·çš„æƒ…å†µè¿˜å¯ä»¥æ¥å—ï¼Œå½“é›†ç¾¤è§„æ¨¡å˜å¤§ï¼Œç‰¹åˆ«æ˜¯å¯¹äºç”Ÿäº§ç¯å¢ƒï¼Œè€ƒè™‘åˆ°æ•ˆç‡å’Œå®‰å…¨æ€§ï¼Œè¿™å°±æˆäº†å¿…é¡»è¦è§£å†³çš„é—®é¢˜ã€‚</p><h3 id="5-2-PV-amp-PVC"><a href="#5-2-PV-amp-PVC" class="headerlink" title="5.2 PV &amp;  PVC"></a>5.2 PV &amp;  PVC</h3><p>Kubernetes ç»™å‡ºçš„è§£å†³æ–¹æ¡ˆæ˜¯ <code>Persistent Volume å’Œ Persistent Volume Claim</code>ã€‚</p><p>PersistentVolume(PVï¼‰æ˜¯å¤–éƒ¨å­˜å‚¨ç³»ç»Ÿä¸­çš„ä¸€å—å­˜å‚¨ç©ºé—´ï¼Œç”±ç®¡ç†å‘˜åˆ›å»ºå’Œç»´æŠ¤ã€‚ä¸ Volume ä¸€æ ·ï¼ŒPV å…·æœ‰æŒä¹…æ€§ï¼Œç”Ÿå‘½å‘¨æœŸç‹¬ç«‹äº Podã€‚</p><p>Persistent Volume Claim (PVC)æ˜¯å¯¹ PV çš„ç”³è¯· (Claimï¼‰ã€‚PVC é€šå¸¸ç”±æ™®é€šç”¨æˆ·åˆ›å»ºå’Œç»´æŠ¤ã€‚éœ€è¦ä¸º Pod åˆ†é…å­˜å‚¨èµ„æºæ—¶ï¼Œç”¨æˆ·å¯ä»¥åˆ›å»ºä¸€ä¸ªPVCï¼ŒæŒ‡æ˜å­˜å‚¨èµ„æºçš„å®¹é‡å¤§å°å’Œè®¿é—®æ¨¡å¼ ï¼ˆæ¯”å¦‚åªè¯»ï¼‰ç­‰ä¿¡æ¯ï¼ŒKubernetes ä¼šæŸ¥æ‰¾å¹¶æä¾›æ»¡è¶³æ¡ä»¶çš„ PVã€‚æœ‰äº† PersistentVolumeClaimï¼Œç”¨æˆ·åªéœ€è¦å‘Šè¯‰ Kubernetes éœ€è¦ä»€ä¹ˆæ ·çš„å­˜å‚¨èµ„æºï¼Œè€Œä¸å¿…å…³å¿ƒçœŸæ­£çš„ç©ºé—´ä»å“ªé‡Œåˆ†é…ã€å¦‚ä½•è®¿é—®ç­‰åº•å±‚ç»†èŠ‚ä¿¡æ¯ã€‚è¿™äº› Storage Provider çš„åº•å±‚ä¿¡æ¯äº¤ç»™ç®¡ç†å‘˜æ¥å¤„ç†ï¼Œåªæœ‰ç®¡ç†å‘˜æ‰åº”è¯¥å…³å¿ƒåˆ›å»º PersistentVolume çš„ç»†èŠ‚ä¿¡æ¯ã€‚</p><h3 id="5-3-åŸºæœ¬ä½¿ç”¨"><a href="#5-3-åŸºæœ¬ä½¿ç”¨" class="headerlink" title="5.3 åŸºæœ¬ä½¿ç”¨"></a>5.3 åŸºæœ¬ä½¿ç”¨</h3><ul><li>åˆ›å»º PV</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolume</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nfs-pv</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">capacity:</span></span><br><span class="line">    <span class="attr">storage:</span> <span class="string">1Gi</span> <span class="comment">#æŒ‡å®šå®¹é‡å¤§å°</span></span><br><span class="line">  <span class="attr">accessModes:</span> <span class="comment"># è®¿é—®æ¨¡å¼ </span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ReadWriteMany</span></span><br><span class="line">  <span class="attr">persistentVolumeReclaimPolicy:</span> <span class="string">Retain</span></span><br><span class="line">  <span class="attr">storageClassName:</span> <span class="string">nfs</span></span><br><span class="line">  <span class="attr">nfs:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/&#123;nfs-serverç›®å½•åç§°&#125;</span></span><br><span class="line">    <span class="attr">server:</span> &#123;<span class="string">nfs-server</span> <span class="string">IP</span> <span class="string">åœ°å€</span>&#125;</span><br></pre></td></tr></table></figure><ul><li><p><strong>accessModes: </strong> æ”¯æŒçš„è®¿é—®æ¨¡å¼æœ‰3ç§ï¼š</p><ul><li>ReadWriteOnce è¡¨ç¤º PV èƒ½ä»¥ readwrite æ¨¡å¼ mount åˆ°å•ä¸ªèŠ‚ç‚¹<ul><li>è¿™ä¸ªPVåªèƒ½è¢«æŸä¸ªèŠ‚ç‚¹ä»¥è¯»å†™æ–¹å¼æŒ‚è½½ï¼Œæ„å‘³ç€è¿™ä¸ªPVåªèƒ½è¢«ä¸€ä¸ªPodæŒ‚è½½åˆ°æŸä¸ªèŠ‚ç‚¹ä¸Šï¼Œå¹¶ä¸”è¿™ä¸ªPodå¯ä»¥å¯¹è¿™ä¸ªPVè¿›è¡Œè¯»å†™æ“ä½œã€‚å¦‚æœå°è¯•åœ¨å…¶ä»–èŠ‚ç‚¹ä¸ŠæŒ‚è½½è¿™ä¸ªPVï¼Œå°±ä¼šå¤±è´¥ã€‚</li></ul></li><li>ReadOnlyMany  è¡¨ç¤º PV èƒ½ä»¥ read-only æ¨¡å¼ mount åˆ°å¤šä¸ªèŠ‚ç‚¹ï¼Œ<ul><li>è¿™ä¸ªPVèƒ½è¢«å¤šä¸ªèŠ‚ç‚¹ä»¥åªè¯»æ–¹å¼æŒ‚è½½ï¼Œæ„å‘³ç€è¿™ä¸ªPVå¯ä»¥è¢«å¤šä¸ªPodæŒ‚è½½åˆ°å¤šä¸ªèŠ‚ç‚¹ä¸Šã€‚</li></ul></li><li>ReadWriteMany è¡¨ç¤º PV èƒ½ä»¥ read-write æ¨¡å¼ mount åˆ°å¤šä¸ªèŠ‚ç‚¹ã€‚<ul><li>è¿™ä¸ªPVèƒ½è¢«å¤šä¸ªèŠ‚ç‚¹ä»¥è¯»å†™æ–¹å¼æŒ‚è½½ï¼Œæ„å‘³ç€è¿™ä¸ªPVå¯ä»¥è¢«å¤šä¸ªPodæŒ‚è½½åˆ°å¤šä¸ªèŠ‚ç‚¹ä¸Šã€‚</li></ul></li></ul></li><li><p><strong>persistentVolumeReclaimPolicy:</strong> æŒ‡å®šå½“ PV çš„å›æ”¶ç­–ç•¥æ”¯æŒçš„ç­–ç•¥æœ‰3ç§ï¼š</p><ul><li><p>Retainï¼šåœ¨ PVC è¢«åˆ é™¤åï¼Œä¿ç•™ PV å’Œå…¶æ•°æ®ï¼Œæ‰‹åŠ¨æ¸…ç† PV ä¸­çš„æ•°æ®ã€‚</p></li><li><p>Deleteï¼šåœ¨ PVC è¢«åˆ é™¤åï¼Œè‡ªåŠ¨åˆ é™¤ PV å’Œå…¶æ•°æ®ã€‚</p></li><li><p>Recycleï¼šåœ¨ PVC è¢«åˆ é™¤åï¼Œé€šè¿‡åˆ é™¤ PV ä¸­çš„æ•°æ®æ¥å‡†å¤‡ PV ä»¥ä¾›é‡æ–°ä½¿ç”¨ã€‚</p><p><code>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ</code>persistentVolumeReclaimPolicy<code>åªé€‚ç”¨äºä¸€äº›ç±»å‹çš„ PVï¼Œå¦‚ NFSã€HostPathã€iSCSI ç­‰ã€‚å¯¹äºä¸€äº›äº‘å¹³å°æä¾›çš„å­˜å‚¨ï¼Œå¦‚ AWS EBS å’Œ Azure Diskï¼Œç”±äºåº•å±‚æä¾›å•†ä¼šè‡ªåŠ¨å¤„ç† PV çš„å›æ”¶é—®é¢˜ï¼Œå› æ­¤è¯¥å±æ€§ä¸é€‚ç”¨ã€‚</code></p></li></ul></li><li><p><strong>storageClassName:</strong> æŒ‡å®š PV çš„class ä¸º nfsã€‚ç›¸å½“äºä¸º PV è®¾ç½®äº†ä¸€ä¸ªåˆ†ç±»ï¼ŒPVCå¯ä»¥æŒ‡å®š class ç”³è¯·ç›¸åº” class çš„ PVã€‚</p></li><li><p>åˆ›å»º PVC</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolumeClaim</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nfs-pvc</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">accessModes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ReadWriteMany</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">    <span class="attr">requests:</span></span><br><span class="line">      <span class="attr">storage:</span> <span class="string">1Gi</span></span><br><span class="line">  <span class="attr">storageClassName:</span> <span class="string">nfs</span> <span class="comment"># é€šè¿‡åå­—è¿›è¡Œé€‰æ‹©</span></span><br><span class="line">  <span class="comment">#selector:  é€šè¿‡æ ‡ç­¾å½¢å¼</span></span><br><span class="line">  <span class="comment">#  matchLabels:</span></span><br><span class="line">  <span class="comment">#    pv-name: nfs-pv</span></span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨ PVC</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">busybox-nfs</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;/bin/sh&quot;</span>]</span><br><span class="line">    <span class="attr">args:</span> [<span class="string">&quot;-c&quot;</span>, <span class="string">&quot;while true; do echo &#x27;Hello NFS!&#x27; &gt;&gt; /data/index.html; sleep 1; done&quot;</span>]</span><br><span class="line">    <span class="attr">volumeMounts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nfs-volume</span></span><br><span class="line">      <span class="attr">mountPath:</span> <span class="string">/data</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nfs-volume</span></span><br><span class="line">    <span class="attr">persistentVolumeClaim:</span></span><br><span class="line">      <span class="attr">claimName:</span> <span class="string">nfs-pvc</span></span><br></pre></td></tr></table></figure><h3 id="5-4-åŠ¨æ€ä¾›ç»™"><a href="#5-4-åŠ¨æ€ä¾›ç»™" class="headerlink" title="5.4 åŠ¨æ€ä¾›ç»™"></a>5.4 åŠ¨æ€ä¾›ç»™</h3><p>åœ¨å‰é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æå‰åˆ›å»ºäº†PVï¼Œç„¶åé€šè¿‡ PVC ç”³è¯· PV å¹¶åœ¨Pod ä¸­ä½¿ç”¨ï¼Œè¿™ç§æ–¹å¼å«ä½œé™æ€ä¾›ç»™ ( Static Provision)ä¸ä¹‹å¯¹åº”çš„æ˜¯åŠ¨æ€ä¾›ç»™ (Dynamical Provisionï¼‰ï¼Œå³å¦‚æœæ²¡æœ‰æ»¡è¶³PVC æ¡ä»¶çš„PVï¼Œä¼šåŠ¨æ€åˆ›å»º PVã€‚ç›¸æ¯”é™æ€ä¾›ç»™ï¼ŒåŠ¨æ€ä¾›ç»™æœ‰æ˜æ˜¾çš„ä¼˜åŠ¿ï¼šä¸éœ€è¦æå‰åˆ›å»º PVï¼Œå‡å°‘äº†ç®¡ç†å‘˜<br>çš„å·¥ä½œé‡ï¼Œæ•ˆç‡é«˜ã€‚åŠ¨æ€ä¾›ç»™æ˜¯é€šè¿‡ StorageClass å®ç°çš„ï¼ŒStorageClass å®šä¹‰äº†å¦‚ä½•åˆ›å»º PVï¼Œä½†éœ€è¦æ³¨æ„çš„æ˜¯æ¯ä¸ª StorageClass éƒ½æœ‰ä¸€ä¸ªåˆ¶å¤‡å™¨ï¼ˆProvisionerï¼‰ï¼Œç”¨æ¥å†³å®šä½¿ç”¨å“ªä¸ªå·æ’ä»¶åˆ¶å¤‡ PVã€‚ è¯¥å­—æ®µå¿…é¡»æŒ‡å®šã€‚(<a href="https://kubernetes.io/zh-cn/docs/concepts/storage/storage-classes/">https://kubernetes.io/zh-cn/docs/concepts/storage/storage-classes/</a>) æ‰èƒ½å®ç°åŠ¨æ€åˆ›å»ºï¼Œä¸‹é¢æˆ‘ä»¬ä»¥ NFS ä¸ºä¾‹ï¼š</p><ul><li><p>å®šä¹‰ NFS Provider</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nfs-client-provisioner</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nfs-client-provisioner</span></span><br><span class="line">  <span class="comment"># replace with namespace where provisioner is deployed</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">strategy:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">Recreate</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">nfs-client-provisioner</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nfs-client-provisioner</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">serviceAccountName:</span> <span class="string">nfs-client-provisioner</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nfs-client-provisioner</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">chronolaw/nfs-subdir-external-provisioner:v4.0.2</span></span><br><span class="line">          <span class="attr">volumeMounts:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nfs-client-root</span></span><br><span class="line">              <span class="attr">mountPath:</span> <span class="string">/persistentvolumes</span></span><br><span class="line">          <span class="attr">env:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">PROVISIONER_NAME</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">k8s-sigs.io/nfs-subdir-external-provisioner</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">NFS_SERVER</span></span><br><span class="line">              <span class="attr">value:</span> <span class="number">10.15</span><span class="number">.0</span><span class="number">.25</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">NFS_PATH</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">/root/nfs/data</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nfs-client-root</span></span><br><span class="line">          <span class="attr">nfs:</span></span><br><span class="line">            <span class="attr">server:</span> <span class="number">10.15</span><span class="number">.0</span><span class="number">.25</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/root/nfs/data</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nfs-client-provisioner</span></span><br><span class="line">  <span class="comment"># replace with namespace where provisioner is deployed</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nfs-client-provisioner-runner</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span> [<span class="string">&quot;nodes&quot;</span>]</span><br><span class="line">    <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;list&quot;</span>, <span class="string">&quot;watch&quot;</span>]</span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span> [<span class="string">&quot;persistentvolumes&quot;</span>]</span><br><span class="line">    <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;list&quot;</span>, <span class="string">&quot;watch&quot;</span>, <span class="string">&quot;create&quot;</span>, <span class="string">&quot;delete&quot;</span>]</span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span> [<span class="string">&quot;persistentvolumeclaims&quot;</span>]</span><br><span class="line">    <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;list&quot;</span>, <span class="string">&quot;watch&quot;</span>, <span class="string">&quot;update&quot;</span>]</span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;storage.k8s.io&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span> [<span class="string">&quot;storageclasses&quot;</span>]</span><br><span class="line">    <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;list&quot;</span>, <span class="string">&quot;watch&quot;</span>]</span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span> [<span class="string">&quot;events&quot;</span>]</span><br><span class="line">    <span class="attr">verbs:</span> [<span class="string">&quot;create&quot;</span>, <span class="string">&quot;update&quot;</span>, <span class="string">&quot;patch&quot;</span>]</span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">run-nfs-client-provisioner</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nfs-client-provisioner</span></span><br><span class="line">    <span class="comment"># replace with namespace where provisioner is deployed</span></span><br><span class="line">    <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nfs-client-provisioner-runner</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Role</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">leader-locking-nfs-client-provisioner</span></span><br><span class="line">  <span class="comment"># replace with namespace where provisioner is deployed</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span> [<span class="string">&quot;endpoints&quot;</span>]</span><br><span class="line">    <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;list&quot;</span>, <span class="string">&quot;watch&quot;</span>, <span class="string">&quot;create&quot;</span>, <span class="string">&quot;update&quot;</span>, <span class="string">&quot;patch&quot;</span>]</span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">RoleBinding</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">leader-locking-nfs-client-provisioner</span></span><br><span class="line">  <span class="comment"># replace with namespace where provisioner is deployed</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nfs-client-provisioner</span></span><br><span class="line">    <span class="comment"># replace with namespace where provisioner is deployed</span></span><br><span class="line">    <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">Role</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">leader-locking-nfs-client-provisioner</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br></pre></td></tr></table></figure></li><li><p>å®šä¹‰ StorageClass</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">storage.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StorageClass</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mysql-nfs-sc</span></span><br><span class="line"><span class="attr">provisioner:</span> <span class="string">k8s-sigs.io/nfs-subdir-external-provisioner</span></span><br><span class="line"><span class="attr">parameters:</span></span><br><span class="line">  <span class="attr">onDelete:</span> <span class="string">&quot;remain&quot;</span></span><br></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨ StorageClass åŠ¨æ€åˆ›å»º</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StatefulSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mysql</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">mysql</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">serviceName:</span> <span class="string">mysql</span> <span class="comment">#headless æ— å¤´æœåŠ¡  ä¿è¯ç½‘ç»œæ ‡è¯†ç¬¦å”¯ä¸€  å¿…é¡»å­˜åœ¨</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">mysql</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">mysql</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mysql</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">mysql/mysql-server:8.0</span></span><br><span class="line">          <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">          <span class="attr">env:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">MYSQL_ROOT_PASSWORD</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">root</span></span><br><span class="line">          <span class="attr">volumeMounts:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/var/lib/mysql</span> <span class="comment">#è‡ªå·±å®¹å™¨å†™å…¥æ•°æ®ç›®å½•</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">data</span>    <span class="comment">#ä¿å­˜åˆ°æŒ‡å®šä¸€ä¸ªå˜é‡ä¸­ å˜é‡åå­—å°±æ˜¯ data</span></span><br><span class="line">          <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">3306</span></span><br><span class="line">      <span class="attr">restartPolicy:</span> <span class="string">Always</span></span><br><span class="line">  <span class="attr">volumeClaimTemplates:</span>  <span class="comment">#å£°æ˜åŠ¨æ€åˆ›å»ºæ•°æ®å·æ¨¡æ¿</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">metadata:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">data</span>      <span class="comment"># æ•°æ®å·å˜é‡åç§°</span></span><br><span class="line">      <span class="attr">spec:</span></span><br><span class="line">        <span class="attr">accessModes:</span>    <span class="comment"># è®¿é—®æ¨¡å¼</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">ReadWriteMany</span></span><br><span class="line">        <span class="attr">storageClassName:</span> <span class="string">mysql-nfs-sc</span> <span class="comment"># ä½¿ç”¨å“ªä¸ª storage class æ¨¡æ¿å­˜å‚¨æ•°æ®</span></span><br><span class="line">        <span class="attr">resources:</span></span><br><span class="line">          <span class="attr">requests:</span></span><br><span class="line">            <span class="attr">storage:</span> <span class="string">2G</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">mysql</span></span><br></pre></td></tr></table></figure></li></ul><h1 id="ç¬¬ä¸ƒç« -ConfigMap-amp-Secret"><a href="#ç¬¬ä¸ƒç« -ConfigMap-amp-Secret" class="headerlink" title="ç¬¬ä¸ƒç«  ConfigMap &amp; Secret"></a>ç¬¬ä¸ƒç«  ConfigMap &amp; Secret</h1><ul><li>ConfigMap </li><li>Secret</li></ul><h2 id="1-ConfigMap"><a href="#1-ConfigMap" class="headerlink" title="1 ConfigMap"></a>1 ConfigMap</h2><h3 id="1-1-ç®€ä»‹-1"><a href="#1-1-ç®€ä»‹-1" class="headerlink" title="1.1 ç®€ä»‹"></a>1.1 ç®€ä»‹</h3><p>åœ¨ Kubernetes ä¸­ï¼Œ<strong>ConfigMap æ˜¯ä¸€ç§ç”¨äºå­˜å‚¨éæ•æ„Ÿä¿¡æ¯çš„ Kubernetes å¯¹è±¡</strong>ã€‚å®ƒç”¨äºå­˜å‚¨é…ç½®æ•°æ®ï¼Œå¦‚é”®å€¼å¯¹ã€æ•´ä¸ªé…ç½®æ–‡ä»¶æˆ– JSON æ•°æ®ç­‰ã€‚ConfigMap é€šå¸¸ç”¨äºå®¹å™¨é•œåƒä¸­çš„é…ç½®æ–‡ä»¶ã€å‘½ä»¤è¡Œå‚æ•°å’Œç¯å¢ƒå˜é‡ç­‰ã€‚</p><p>ConfigMap å¯ä»¥é€šè¿‡ä¸‰ç§æ–¹å¼è¿›è¡Œé…ç½®æ•°æ®çš„æ³¨å…¥ï¼š</p><ol><li>ç¯å¢ƒå˜é‡æ³¨å…¥ï¼šå°†é…ç½®æ•°æ®æ³¨å…¥åˆ° Pod ä¸­çš„å®¹å™¨ç¯å¢ƒå˜é‡ä¸­ã€‚</li><li>é…ç½®æ–‡ä»¶æ³¨å…¥ï¼šå°†é…ç½®æ•°æ®æ³¨å…¥åˆ° Pod ä¸­çš„å®¹å™¨æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œå®¹å™¨å¯ä»¥è¯»å–è¿™äº›æ–‡ä»¶ã€‚</li><li>å‘½ä»¤è¡Œå‚æ•°æ³¨å…¥ï¼šå°†é…ç½®æ•°æ®æ³¨å…¥åˆ°å®¹å™¨çš„å‘½ä»¤è¡Œå‚æ•°ä¸­ã€‚</li></ol><h3 id="1-2-ä¼˜ç‚¹"><a href="#1-2-ä¼˜ç‚¹" class="headerlink" title="1.2 ä¼˜ç‚¹"></a>1.2 ä¼˜ç‚¹</h3><ol><li>é¿å…äº†ç¡¬ç¼–ç ï¼Œå°†é…ç½®æ•°æ®ä¸åº”ç”¨ä»£ç åˆ†ç¦»ã€‚</li><li>ä¾¿äºç»´æŠ¤å’Œæ›´æ–°ï¼Œå¯ä»¥å•ç‹¬ä¿®æ”¹ ConfigMap è€Œä¸éœ€è¦é‡æ–°æ„å»ºé•œåƒã€‚</li><li>å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼æ³¨å…¥é…ç½®æ•°æ®ï¼Œæ›´åŠ çµæ´»ã€‚</li><li>å¯ä»¥é€šè¿‡ Kubernetes çš„è‡ªåŠ¨åŒ–æœºåˆ¶å¯¹ ConfigMap è¿›è¡Œç‰ˆæœ¬æ§åˆ¶å’Œå›æ»šã€‚</li><li>ConfigMap å¯ä»¥è¢«å¤šä¸ª Pod å…±äº«ï¼Œå‡å°‘äº†é…ç½®æ•°æ®çš„é‡å¤å­˜å‚¨ã€‚</li></ol><h3 id="1-3-å®šä¹‰-ConfigMap"><a href="#1-3-å®šä¹‰-ConfigMap" class="headerlink" title="1.3 å®šä¹‰ ConfigMap"></a>1.3 å®šä¹‰ ConfigMap</h3><ul><li><p><strong>åŸºæœ¬æ“ä½œ</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹ configmap</span></span><br><span class="line">kubectl get configmap/cm  </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹è¯¦ç»†</span></span><br><span class="line">kubectl describe configmap/cm my-config</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ é™¤ cm</span></span><br><span class="line">kubectl delete cm my-config</span><br></pre></td></tr></table></figure></li><li><p><strong>å‘½ä»¤è¡Œåˆ›å»º</strong>ï¼š</p><ul><li><p>å¯ä»¥ä½¿ç”¨<code>kubectl create configmap</code>å‘½ä»¤æ¥åˆ›å»ºconfigmapï¼Œå…·ä½“å‘½ä»¤å¦‚ä¸‹ï¼š</p></li><li><p>```shell<br>kubectl create configmap my-config â€”from-literal=key1=value1 â€”from-literal=key2=value2</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="string">**é€šè¿‡é…ç½®æ–‡ä»¶åˆ›å»º**ï¼š**æ¨è**</span></span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="string">å¯ä»¥é€šè¿‡åˆ›å»ºYAMLæ–‡ä»¶çš„æ–¹å¼æ¥å®šä¹‰configmapçš„å†…å®¹ã€‚ä¾‹å¦‚ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º`my-config`çš„configmapï¼Œå†…å®¹å¦‚ä¸‹ï¼š</span></span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="string">```yaml</span></span><br><span class="line">    <span class="attribute">apiVersion</span><span class="punctuation">:</span> <span class="string">v1</span></span><br><span class="line">    <span class="attribute">kind</span><span class="punctuation">:</span> <span class="string">ConfigMap</span></span><br><span class="line">    <span class="attribute">metadata</span><span class="punctuation">:</span></span><br><span class="line">      <span class="attribute">name</span><span class="punctuation">:</span> <span class="string">my-config</span></span><br><span class="line">    <span class="attribute">data</span><span class="punctuation">:</span></span><br><span class="line">      <span class="attribute">key1</span><span class="punctuation">:</span> <span class="string">value1</span></span><br><span class="line">      <span class="attribute">key2</span><span class="punctuation">:</span> <span class="string">value2</span></span><br></pre></td></tr></table></figure></li><li><p>```yaml<br>apiVersion: v1<br>kind: ConfigMap<br>metadata:<br>  name: app-config<br>data:<br>  application.yml: |</p><pre><code>name: xiaochen</code></pre><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  - ç„¶åä½¿ç”¨`kubectl apply -f`å‘½ä»¤æ¥åˆ›å»ºconfigmapã€‚</span><br><span class="line"></span><br><span class="line">- **é€šè¿‡æ–‡ä»¶åˆ›å»º:**</span><br><span class="line"></span><br><span class="line">  - ```shell</span><br><span class="line">    <span class="keyword">echo</span> -n admin &gt;<span class="string">./username</span></span><br><span class="line">    <span class="keyword">echo</span> -n 123456 &gt; <span class="string">./password</span></span><br><span class="line">    kubectl create configmap myconfigmap <span class="params">--from-file=</span><span class="string">./username</span> <span class="params">--from-file=</span><span class="string">./password</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>é€šè¿‡æ–‡ä»¶å¤¹åˆ›å»º</strong>ï¼š</p><ul><li><p>å¯ä»¥å°†å¤šä¸ªé…ç½®æ–‡ä»¶æ”¾åœ¨åŒä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹ï¼Œç„¶åä½¿ç”¨<code>kubectl create configmap</code>å‘½ä»¤æ¥åˆ›å»ºconfigmapï¼Œä¾‹å¦‚ï¼š</p></li><li><p>```shell<br>kubectl create configmap my-config â€”from-file=config-files/</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="bullet">  -</span> è¿™å°†åˆ›å»ºä¸€ä¸ªåä¸º<span class="code">`my-config`</span>çš„configmapï¼Œå…¶ä¸­åŒ…å«<span class="code">`config-files/`</span>æ–‡ä»¶å¤¹ä¸‹æ‰€æœ‰çš„æ–‡ä»¶å†…å®¹ä½œä¸ºé”®å€¼å¯¹ã€‚</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="strong">**é€šè¿‡ç¯å¢ƒå˜é‡åˆ›å»º**</span>ï¼š</span><br><span class="line"></span><br><span class="line"><span class="bullet">  -</span> å¯ä»¥å°†ç¯å¢ƒå˜é‡çš„å€¼è½¬æ¢ä¸ºconfigmapã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°†å½“å‰ç¯å¢ƒå˜é‡çš„å€¼è½¬æ¢ä¸ºconfigmapï¼š</span><br><span class="line"></span><br><span class="line"><span class="bullet">  -</span> <span class="code">```shell</span></span><br><span class="line"><span class="code">    kubectl create configmap my-config --from-env-file=&lt;(env)</span></span><br></pre></td></tr></table></figure></li></ul></li></ul><h3 id="1-4-ä½¿ç”¨"><a href="#1-4-ä½¿ç”¨" class="headerlink" title="1.4 ä½¿ç”¨"></a>1.4 ä½¿ç”¨</h3><ul><li>ç¯å¢ƒå˜é‡ä¸­ä½¿ç”¨</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-pod</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">my-container</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;/bin/sh&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;echo $BUSY_NAME ; sleep 3600;&quot;</span>]</span><br><span class="line">    <span class="attr">env:</span></span><br><span class="line">    <span class="comment"># name: æ˜¯å®¹å™¨éœ€è¦ç¯å¢ƒå˜é‡åç§°</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">BUSY_NAME</span></span><br><span class="line">    <span class="comment"># valueForm: value æ¥æºä¸ä»€ä¹ˆ</span></span><br><span class="line">      <span class="attr">valueFrom:</span></span><br><span class="line">        <span class="attr">configMapKeyRef:</span>  <span class="comment"># å€¼æ¥æºä¸ configmap  æ¥æºä¸å“ªä¸ª configmap æ¥æºä¸å“ªä¸ª configmap ä¸­ key</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">app-cm</span></span><br><span class="line">          <span class="attr">key:</span> <span class="string">name</span></span><br><span class="line">    <span class="comment"># ä¸€æ¬¡æ€§æ³¨å…¥è¿™ä¸ª configmap</span></span><br><span class="line">    <span class="attr">envFrom:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">configMapRef:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">my-config</span></span><br></pre></td></tr></table></figure><p><code>æ³¨æ„: env æ˜¯æŒ‡å®š configmap ä¸­æŸä¸ª key è¿›è¡Œæ³¨å…¥  envForm å°† configmap ä¸­å†…å®¹å…¨éƒ¨æ³¨å…¥</code></p><ul><li>é€šè¿‡ Volume ä½¿ç”¨é…ç½®</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">myapp-pod</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">myapp-container</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">busybox</span></span><br><span class="line">      <span class="attr">command:</span> [<span class="string">&quot;/bin/sh&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;sleep 3600&quot;</span>]</span><br><span class="line">      <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">data-volume</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/data</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">data-volume</span></span><br><span class="line">      <span class="attr">configMap:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">application-cm</span></span><br></pre></td></tr></table></figure><h2 id="2-Secret"><a href="#2-Secret" class="headerlink" title="2 Secret"></a>2 Secret</h2><p>2.1 ç®€ä»‹</p><p>åœ¨ Kubernetes ä¸­ï¼ŒSecret æ˜¯ä¸€ç§ç”¨äºå­˜å‚¨å’Œç®¡ç†æ•æ„Ÿä¿¡æ¯çš„å¯¹è±¡ç±»å‹ï¼Œå¦‚å¯†ç ã€APIå¯†é’¥ã€è¯ä¹¦ç­‰ç­‰ã€‚å®ƒä»¬ä¸ ConfigMap ç›¸ä¼¼ï¼Œä½†åœ¨å¤„ç†æ•æ„Ÿä¿¡æ¯æ—¶ï¼ŒSecret ä¼šæä¾›æ›´é«˜çš„å®‰å…¨æ€§å’Œä¿å¯†æ€§ã€‚</p><p>Secret å¯ä»¥ç”¨äºå°†è¿™äº›æ•æ„Ÿä¿¡æ¯æ³¨å…¥åˆ°å®¹å™¨ä¸­ï¼Œå¹¶ç¡®ä¿è¿™äº›ä¿¡æ¯åœ¨è¿è¡Œæ—¶ä¸ä¼šè¢«æ„å¤–æ³„æ¼æˆ–æš´éœ²ç»™å…¶ä»–äººã€‚Secret å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼å®šä¹‰å’Œä½¿ç”¨ï¼Œä¾‹å¦‚ç›´æ¥å®šä¹‰ã€ä»æ–‡ä»¶ä¸­åŠ è½½ã€ä»ç¯å¢ƒå˜é‡ä¸­åŠ è½½ç­‰ã€‚</p><p>åœ¨ Kubernetes ä¸­ï¼ŒSecrets é€šå¸¸è¢«ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š</p><ul><li>ä½œä¸ºå·æŒ‚è½½åˆ° Pod ä¸­ï¼Œç”¨äºå­˜å‚¨è¯ä¹¦ã€å¯†é’¥ç­‰æ•æ„Ÿæ–‡ä»¶</li><li>åœ¨ Pod ä¸­ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼Œç”¨äºå­˜å‚¨ç”¨æˆ·åå’Œå¯†ç ç­‰æ•æ„Ÿä¿¡æ¯</li><li>ç”¨äºå­˜å‚¨ Docker é•œåƒä»“åº“çš„ç™»å½•ä¿¡æ¯</li><li>ç”¨äºå­˜å‚¨å¤–éƒ¨æœåŠ¡çš„ API å¯†é’¥</li></ul><p>Secrets å¯ä»¥åœ¨ Pod çš„ spec ä¸­é€šè¿‡ volume å’Œç¯å¢ƒå˜é‡çš„æ–¹å¼å¼•ç”¨ã€‚å½“å®¹å™¨ä½¿ç”¨ volume æ¥å¼•ç”¨ Secret æ—¶ï¼ŒSecret ä¼šä»¥æ–‡ä»¶çš„å½¢å¼æŒ‚è½½åˆ°å®¹å™¨ä¸­ã€‚å½“å®¹å™¨ä½¿ç”¨ç¯å¢ƒå˜é‡æ¥å¼•ç”¨ Secret æ—¶ï¼ŒSecret ä¸­çš„æ•°æ®ä¼šä»¥ base64 ç¼–ç åï¼Œä»¥é”®å€¼å¯¹çš„å½¢å¼æ³¨å…¥åˆ°å®¹å™¨çš„ç¯å¢ƒå˜é‡ä¸­ã€‚</p><p><code>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒSecret å¹¶ä¸æä¾›å¼ºå¤§çš„å®‰å…¨ä¿è¯ï¼Œåªæ˜¯ç®€å•åœ°å°†æ•°æ®å­˜å‚¨åœ¨ base64 ç¼–ç çš„å½¢å¼ä¸‹ï¼Œå¹¶ä¸æä¾›åŠ å¯†æˆ–å…¶ä»–å®‰å…¨æªæ–½ï¼Œå› æ­¤ä¸è¦å°†é«˜åº¦æ•æ„Ÿçš„ä¿¡æ¯å­˜å‚¨åœ¨ Secret ä¸­ã€‚åœ¨å¤„ç†é«˜åº¦æ•æ„Ÿçš„ä¿¡æ¯æ—¶ï¼Œéœ€è¦ä½¿ç”¨æ›´é«˜çº§åˆ«çš„ä¿æŠ¤æœºåˆ¶ï¼Œå¦‚ä½¿ç”¨åŠ å¯†æ•°æ®çš„ Volume ç±»å‹ï¼Œæˆ–è€…ä½¿ç”¨ç¬¬ä¸‰æ–¹åŠ å¯†è§£å†³æ–¹æ¡ˆç­‰ã€‚</code></p><h3 id="2-1-å®šä¹‰-Secret"><a href="#2-1-å®šä¹‰-Secret" class="headerlink" title="2.1 å®šä¹‰ Secret"></a>2.1 å®šä¹‰ Secret</h3><ul><li><p><strong>ä½¿ç”¨å‘½ä»¤è¡Œåˆ›å»º</strong>ï¼š</p><ul><li><p>å¯ä»¥ä½¿ç”¨ kubectl create secret å‘½ä»¤æ¥åˆ›å»º secretï¼Œä¾‹å¦‚ï¼š</p></li><li><p>```shell<br>kubectl create secret generic my-secret â€”from-literal=username=admin â€”from-literal=password=admin123</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="string">**ä½¿ç”¨ YAML æ–‡ä»¶å®šä¹‰**ï¼š</span></span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="string">å¯ä»¥åˆ›å»ºä¸€ä¸ª YAML æ–‡ä»¶æ¥å®šä¹‰ Secret å¯¹è±¡ï¼Œä¾‹å¦‚ï¼š</span></span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="string">```yaml</span></span><br><span class="line">    <span class="attribute">apiVersion</span><span class="punctuation">:</span> <span class="string">v1</span></span><br><span class="line">    <span class="attribute">kind</span><span class="punctuation">:</span> <span class="string">Secret</span></span><br><span class="line">    <span class="attribute">metadata</span><span class="punctuation">:</span></span><br><span class="line">      <span class="attribute">name</span><span class="punctuation">:</span> <span class="string">my-secret</span></span><br><span class="line">    <span class="attribute">type</span><span class="punctuation">:</span> <span class="string">Opaque</span></span><br><span class="line">    <span class="attribute">data</span><span class="punctuation">:</span></span><br><span class="line">      <span class="attribute">username</span><span class="punctuation">:</span> <span class="string">YWRtaW4= # base64 ç¼–ç åçš„ç”¨æˆ·å admin</span></span><br><span class="line">      <span class="attribute">password</span><span class="punctuation">:</span> <span class="string">MWYyZDFlMmU2N2Rm # base64 ç¼–ç åçš„å¯†ç  1f2d1e2e67df</span></span><br></pre></td></tr></table></figure></li><li><p><code>æ³¨æ„: è¿™ä¸ª YAML æ–‡ä»¶å®šä¹‰äº†ä¸€ä¸ªåä¸º my-secret çš„ Secret å¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«äº†ä¸¤ä¸ª base64 ç¼–ç åçš„ key-value å¯¹ï¼šusername å’Œ passwordã€‚</code></p></li></ul></li><li><p><strong>ä½¿ç”¨æ–‡ä»¶åˆ›å»º:</strong></p><ul><li>```shell<br>echo -n admin &gt;./username<br>echo -n 123456 &gt; ./password<br>kubectl create secret generic mysecret â€”from-file=./username â€”from-file=./password<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="strong">**é€šè¿‡ç¯å¢ƒå˜é‡åˆ›å»º**</span>ï¼š</span><br><span class="line"></span><br><span class="line"><span class="bullet">  -</span> å¯ä»¥å°†ç¯å¢ƒå˜é‡çš„å€¼è½¬æ¢ä¸ºsecretã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°†å½“å‰ç¯å¢ƒå˜é‡çš„å€¼è½¬æ¢ä¸ºsecretï¼š</span><br><span class="line"></span><br><span class="line"><span class="bullet">  -</span> <span class="code">```shell</span></span><br><span class="line"><span class="code">    kubectl create secret generic  my-config --from-env-file=&lt;(env)</span></span><br></pre></td></tr></table></figure></li></ul></li></ul><h3 id="2-2-ä½¿ç”¨"><a href="#2-2-ä½¿ç”¨" class="headerlink" title="2.2 ä½¿ç”¨"></a>2.2 ä½¿ç”¨</h3><ul><li>ç¯å¢ƒå˜é‡,å‘½ä»¤è¡Œå‚æ•°ä½¿ç”¨ Secret</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-pod</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">myapp-container</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">busybox</span></span><br><span class="line">      <span class="attr">command:</span> [<span class="string">&quot;/bin/sh&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;sleep 3600&quot;</span>]</span><br><span class="line">      <span class="comment"># æ³¨å…¥æŒ‡å®šæŸä¸ª Secret ä¸€ä¸ªä¸€ä¸ªæ³¨å…¥</span></span><br><span class="line">      <span class="attr">env:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">USERNAME</span></span><br><span class="line">          <span class="attr">valueFrom:</span></span><br><span class="line">            <span class="attr">secretKeyRef:</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">my-secret</span></span><br><span class="line">              <span class="attr">key:</span> <span class="string">username</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">PASSWORD</span></span><br><span class="line">          <span class="attr">valueFrom:</span></span><br><span class="line">            <span class="attr">secretKeyRef:</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">my-secret</span></span><br><span class="line">              <span class="attr">key:</span> <span class="string">password</span></span><br><span class="line">      <span class="comment"># ä¸€æ¬¡æ€§æ³¨å…¥è¿™ä¸ª secret</span></span><br><span class="line">      <span class="attr">envFrom:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">secretRef:</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">my-secret</span></span><br><span class="line">  <span class="attr">restartPolicy:</span> <span class="string">Never</span></span><br></pre></td></tr></table></figure><ul><li>volume ä½¿ç”¨</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">myapp-pod</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">myapp-container</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">busybox</span></span><br><span class="line">      <span class="attr">command:</span> [<span class="string">&quot;/bin/sh&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;sleep 3600&quot;</span>]</span><br><span class="line">      <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">secret-volume</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/data</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">secret-volume</span></span><br><span class="line">      <span class="attr">secret:</span></span><br><span class="line">        <span class="attr">secretName:</span> <span class="string">aaa</span></span><br></pre></td></tr></table></figure><h1 id="ç¬¬å…«ç« -Ingress"><a href="#ç¬¬å…«ç« -Ingress" class="headerlink" title="ç¬¬å…«ç«  Ingress"></a>ç¬¬å…«ç«  Ingress</h1><ul><li>ä»€ä¹ˆæ˜¯ Ingress</li><li>Ingress å’Œ Service åŒºåˆ«</li><li>Ingress æ§åˆ¶å™¨ Traefik ä½¿ç”¨</li><li>Ingress Routeçš„å®šä¹‰</li></ul><h2 id="1-ç®€ä»‹-1"><a href="#1-ç®€ä»‹-1" class="headerlink" title="1 ç®€ä»‹"></a>1 ç®€ä»‹</h2><p><a href="https://kubernetes.io/zh-cn/docs/concepts/services-networking/ingress/">https://kubernetes.io/zh-cn/docs/concepts/services-networking/ingress/</a></p><p><strong>Ingress æ˜¯ä¸€ç§ Kubernetes èµ„æºç±»å‹ï¼Œå®ƒå…è®¸åœ¨ Kubernetes é›†ç¾¤ä¸­æš´éœ² HTTP å’Œ HTTPS æœåŠ¡</strong>ã€‚é€šè¿‡ Ingressï¼Œæ‚¨å¯ä»¥å°†æµé‡è·¯ç”±åˆ°ä¸åŒçš„æœåŠ¡å’Œç«¯ç‚¹ï¼Œè€Œæ— éœ€ä½¿ç”¨ä¸åŒçš„è´Ÿè½½å‡è¡¡å™¨ã€‚Ingress é€šå¸¸ä½¿ç”¨ Ingress Controller å®ç°ï¼Œå®ƒæ˜¯ä¸€ä¸ªè¿è¡Œåœ¨ Kubernetes é›†ç¾¤ä¸­çš„è´Ÿè½½å‡è¡¡å™¨ï¼Œå®ƒæ ¹æ®Ingress è§„åˆ™é…ç½®è·¯ç”±è§„åˆ™å¹¶å°†æµé‡è½¬å‘åˆ°ç›¸åº”çš„æœåŠ¡ã€‚</p><p>åœ¨ Kubernetes ä¸­ï¼Œä¸€ä¸ª Ingress èµ„æºå®šä¹‰äº†ä¸€ç»„è§„åˆ™ï¼Œè¿™äº›è§„åˆ™ç”¨äºæŒ‡å®šå¤–éƒ¨æµé‡å¦‚ä½•åˆ°è¾¾é›†ç¾¤ä¸­çš„æœåŠ¡ã€‚Ingress èµ„æºå®šä¹‰åŒ…æ‹¬åŸŸåã€æœåŠ¡ã€è·¯å¾„å’Œå…¶ä»–ä¿¡æ¯ï¼Œé€šè¿‡è¿™äº›ä¿¡æ¯ï¼ŒIngress Controller å°±èƒ½å¤Ÿå°†è¯·æ±‚è·¯ç”±åˆ°æ­£ç¡®çš„æœåŠ¡ã€‚åŒæ—¶ï¼ŒIngress è¿˜æä¾›äº† TLS é€‰é¡¹ï¼Œå¯ä»¥ä½¿ç”¨ SSL/TLS æ¥åŠ å¯†ä¼ è¾“æ•°æ®ã€‚</p><p>æ€»ä¹‹ï¼ŒIngress æ˜¯ä¸€ç§å¼ºå¤§çš„ Kubernetes èµ„æºç±»å‹ï¼Œå¯ä»¥å¸®åŠ©æ‚¨åœ¨ Kubernetes é›†ç¾¤ä¸­è½»æ¾åœ°ç®¡ç† HTTP å’Œ HTTPS æœåŠ¡ï¼Œå¹¶æä¾›çµæ´»çš„è·¯ç”±å’Œè´Ÿè½½å‡è¡¡é€‰é¡¹ã€‚</p><p>Ingress ç®€å•ç¤ºä¾‹ï¼š</p><p><img src="https://www.naste.top:9000/images/image-20230422104305506.png" alt="image-20230422104305506"></p><h2 id="2-Ingress-å’Œ-Service-åŒºåˆ«"><a href="#2-Ingress-å’Œ-Service-åŒºåˆ«" class="headerlink" title="2 Ingress å’Œ Service åŒºåˆ«"></a>2 Ingress å’Œ Service åŒºåˆ«</h2><p>Ingress å’Œ Serviceéƒ½æ˜¯ Kubernetes ä¸­ç”¨äºå°†æµé‡è·¯ç”±åˆ°åº”ç”¨ç¨‹åºçš„æœºåˆ¶ï¼Œä½†å®ƒä»¬åœ¨è·¯ç”±å±‚é¢ä¸Šæœ‰æ‰€ä¸åŒï¼š</p><ul><li>Service æ˜¯ Kubernetes ä¸­æŠ½è±¡çš„åº”ç”¨ç¨‹åºæœåŠ¡ï¼Œå®ƒå…¬å¼€äº†ä¸€ä¸ªå•ä¸€çš„IPåœ°å€å’Œç«¯å£ï¼Œå¯ä»¥ç”¨äºåœ¨ Kubernetes é›†ç¾¤å†…éƒ¨çš„ Pod ä¹‹é—´è¿›è¡Œæµé‡è·¯ç”±ã€‚</li><li>Ingress æ˜¯ä¸€ä¸ª Kubernetes èµ„æºå¯¹è±¡ï¼Œå®ƒæä¾›äº†å¯¹é›†ç¾¤å¤–éƒ¨æµé‡è·¯ç”±çš„è§„åˆ™ã€‚Ingress é€šè¿‡ä¸€ä¸ªå…¬å…±IPåœ°å€å’Œç«¯å£å°†æµé‡è·¯ç”±åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªServiceã€‚</li></ul><h2 id="3-Ingress-Controller"><a href="#3-Ingress-Controller" class="headerlink" title="3 Ingress Controller"></a>3 Ingress Controller</h2><p>Ingress Controller æ˜¯ Kubernetes ä¸­çš„ä¸€ç§èµ„æºï¼Œå®ƒè´Ÿè´£å°†å¤–éƒ¨è¯·æ±‚è½¬å‘åˆ°é›†ç¾¤å†…éƒ¨çš„ Service ä¸­ï¼Œå¹¶æä¾›è´Ÿè½½å‡è¡¡ã€SSL ç»ˆæ­¢ç­‰åŠŸèƒ½ã€‚Ingress Controller é€šå¸¸ä¼šè¿è¡Œåœ¨ Kubernetes é›†ç¾¤ä¸­ï¼Œä½œä¸ºä¸€ç»„ Deployment å’Œ Service çš„å½¢å¼éƒ¨ç½²ã€‚</p><p>å¸¸è§çš„ Ingress Controller åŒ…æ‹¬ï¼š</p><ol><li>Nginx Ingress Controller æ˜¯ç”± Kubernetes ç¤¾åŒºç»´æŠ¤çš„å¦ä¸€ä¸ª Ingress Controllerï¼Œå®ƒä¹Ÿæ˜¯ä½¿ç”¨ Nginx ä½œä¸ºåå‘ä»£ç†å®ç°çš„ï¼Œå¯ä»¥æ”¯æŒ HTTP å’Œ HTTPS ç­‰åè®®ï¼Œæ”¯æŒè´Ÿè½½å‡è¡¡ã€è·¯ç”±ã€HTTPSè¯ä¹¦ç®¡ç†ç­‰åŠŸèƒ½ã€‚</li><li>Ingress Nginx Controller æ˜¯å®˜æ–¹ç»´æŠ¤çš„ä¸€ä¸ª Ingress Controllerï¼Œå®ƒæ˜¯ä½¿ç”¨ Nginx ä½œä¸ºåå‘ä»£ç†å®ç°çš„ï¼Œå¯ä»¥æ”¯æŒ HTTP å’Œ HTTPS ç­‰åè®®ï¼Œæ”¯æŒè´Ÿè½½å‡è¡¡ã€è·¯ç”±ã€HTTPSè¯ä¹¦ç®¡ç†ç­‰åŠŸèƒ½ã€‚</li><li>Traefik Ingress Controllerï¼šåŸºäº Go è¯­è¨€å¼€å‘çš„ Ingress Controllerï¼Œæ”¯æŒå¤šç§è·¯ç”±åŒ¹é…æ–¹å¼å’Œå¤šç§åç«¯æœåŠ¡å‘ç°æ–¹å¼ã€‚<ul><li><strong>Traefik Ingress Controller: æ ‡å‡†å®ç° æ”¯æŒ å®˜æ–¹ Ingress è·¯ç”±è§„åˆ™ æ³¨æ„: è¿™ç§æ–¹å¼ä½¿ç”¨ç¹ç!</strong></li><li><strong>Traefik Route CRD(customer resuource definition)è‡ªå®šä¹‰èµ„æº  æ³¨æ„: ä½¿ç”¨è¿™ç§æ–¹å¼ç®€å•,è‡ªå®šä¹‰èµ„æºæ–¹å¼å®šä¹‰è·¯ç”±è§„åˆ™ã€‚</strong></li></ul></li><li>Istio Ingress Controllerï¼šåŸºäº Istio Service Mesh å®ç°çš„ Ingress Controllerï¼Œæä¾›äº†æ›´ä¸°å¯Œçš„è´Ÿè½½å‡è¡¡ã€æµé‡æ§åˆ¶å’Œå®‰å…¨åŠŸèƒ½ã€‚</li><li>Kong Ingress Controllerï¼šä½¿ç”¨ Kong ä½œä¸ºåå‘ä»£ç†å®ç° Ingress åŠŸèƒ½ï¼Œæ”¯æŒ API ç®¡ç†å’Œ Gateway åŠŸèƒ½ã€‚</li></ol><h2 id="4-ä½¿ç”¨-Traefik-Ingress-CRD-æ–¹å¼"><a href="#4-ä½¿ç”¨-Traefik-Ingress-CRD-æ–¹å¼" class="headerlink" title="4 ä½¿ç”¨ Traefik Ingress CRD æ–¹å¼"></a>4 ä½¿ç”¨ Traefik Ingress CRD æ–¹å¼</h2><p>å®˜æ–¹ç½‘ç«™: <a href="https://doc.traefik.io/traefik/">https://doc.traefik.io/traefik/</a></p><p>å…·ä½“å‚è€ƒ: <a href="https://doc.traefik.io/traefik/user-guides/crd-acme/">https://doc.traefik.io/traefik/user-guides/crd-acme/</a></p><h3 id="1-pod-æ— æ³•è®¿é—®-Service-è§£å†³æ–¹æ¡ˆ"><a href="#1-pod-æ— æ³•è®¿é—®-Service-è§£å†³æ–¹æ¡ˆ" class="headerlink" title="1 pod æ— æ³•è®¿é—® Service è§£å†³æ–¹æ¡ˆ"></a>1 pod æ— æ³•è®¿é—® Service è§£å†³æ–¹æ¡ˆ</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">kubectl edit cm kube-proxy -n kube-system</span><br><span class="line">ipvs:</span><br><span class="line">excludeCIDRs: null</span><br><span class="line">minSyncPeriod: 0s</span><br><span class="line">scheduler: &quot;&quot;</span><br><span class="line">strictARP: false</span><br><span class="line">syncPeriod: 0s</span><br><span class="line">tcpFinTimeout: 0s</span><br><span class="line">tcpTimeout: 0s</span><br><span class="line">udpTimeout: 0s</span><br><span class="line">kind: KubeProxyConfiguration</span><br><span class="line">metricsBindAddress: &quot;&quot;</span><br><span class="line">mode: &quot;ipvs&quot; #è¿™é‡Œé»˜è®¤ä¸ºç©ºï¼Œå¡«å†™ipvsä¿å­˜</span><br><span class="line"></span><br><span class="line">cat &gt; /etc/sysconfig/modules/ipvs.modules &lt;&lt; EOF</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">modprobe -- ip_vs</span><br><span class="line">modprobe -- ip_vs_rr</span><br><span class="line">modprobe -- ip_vs_wrr</span><br><span class="line">modprobe -- ip_vs_sh</span><br><span class="line">modprobe -- nf_conntrack</span><br><span class="line">modprobe -- br_netfilter</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">chmod 755 /etc/sysconfig/modules/ipvs.modules &amp;&amp; bash /etc/sysconfig/modules/ipvs.modules &amp;&amp; lsmod | grep -e ip_vs -e nf_conntrack_ipv4</span><br><span class="line"></span><br><span class="line">kubectl get pod -n kube-system | grep kube-proxy |awk &#x27;&#123;system(&quot;kubectl delete pod &quot;$1&quot; -n kube-system&quot;)&#125;&#x27;</span><br></pre></td></tr></table></figure><h1 id="ç¬¬ä¹ç« -å‘½åç©ºé—´"><a href="#ç¬¬ä¹ç« -å‘½åç©ºé—´" class="headerlink" title="ç¬¬ä¹ç«  å‘½åç©ºé—´"></a>ç¬¬ä¹ç«  å‘½åç©ºé—´</h1><ul><li>å‘½åç©ºé—´ ä»¥åŠ ä½œç”¨</li><li>å‘½åç©ºé—´åŸºæœ¬æ“ä½œ</li><li>è·¨å‘½åç©ºé—´è¯´æ˜</li></ul><h3 id="1-å‘½åç©ºé—´"><a href="#1-å‘½åç©ºé—´" class="headerlink" title="1 å‘½åç©ºé—´"></a>1 å‘½åç©ºé—´</h3><p>Kubernetes ä¸­å‘½åç©ºé—´ï¼ˆNamespaceï¼‰æ˜¯ç”¨æ¥éš”ç¦» Kubernetes é›†ç¾¤å†…çš„ä¸åŒèµ„æºå¯¹è±¡çš„ä¸€ç§æ–¹å¼ã€‚æ¯ä¸ª Kubernetes å¯¹è±¡éƒ½å¿…é¡»è¢«åˆ†é…åˆ°ä¸€ä¸ªå‘½åç©ºé—´ä¸­ï¼Œè€Œä¸”é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸€ä¸ªå¯¹è±¡åªèƒ½è¢«åŒä¸€å‘½åç©ºé—´å†…çš„å…¶ä»–å¯¹è±¡è®¿é—®ã€‚Kubernetes å¯ä»¥å¸®åŠ©ç”¨æˆ·åœ¨åŒä¸€é›†ç¾¤å†…éƒ¨éƒ¨ç½²å¤šä¸ªç‹¬ç«‹çš„åº”ç”¨ç¨‹åºï¼Œæ¯ä¸ªåº”ç”¨ç¨‹åºéƒ½åœ¨è‡ªå·±çš„å‘½åç©ºé—´å†…è¿è¡Œã€‚</p><h3 id="2-åŸºæœ¬æ“ä½œ"><a href="#2-åŸºæœ¬æ“ä½œ" class="headerlink" title="2 åŸºæœ¬æ“ä½œ"></a>2 åŸºæœ¬æ“ä½œ</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ›å»ºå‘½åç©ºé—´</span></span><br><span class="line">kubectl create namespace|ns testapp</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">éƒ¨ç½²åº”ç”¨åˆ°æŒ‡å®šçš„å‘½åç©ºé—´</span></span><br><span class="line">kubectl apply -f app.yml --namespace testapp</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥è¯¢</span></span><br><span class="line">kubectl get pod --namespace kube-system</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨ yml å½¢å¼åˆ›å»º</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Namespace</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ems</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥ç”¨ <a href="https://github.com/ahmetb/kubectx">kubens</a> å¿«é€Ÿåˆ‡æ¢ namespace</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ—å‡ºæ‰€æœ‰å‘½åç©ºé—´</span></span><br><span class="line">kubens</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ‡æ¢å‘½åç©ºé—´</span></span><br><span class="line">kubens kube-system</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å›åˆ°ä¸Šä¸ªå‘½åç©ºé—´</span></span><br><span class="line">kubens -</span><br></pre></td></tr></table></figure><h3 id="3-å‘½åç©ºé—´è¯´æ˜"><a href="#3-å‘½åç©ºé—´è¯´æ˜" class="headerlink" title="3 å‘½åç©ºé—´è¯´æ˜"></a>3 å‘½åç©ºé—´è¯´æ˜</h3><p>ä¸‹é¢æ˜¯ä¸€äº›å¸¸è§çš„å¯ä»¥è·¨å‘½åç©ºé—´çš„èµ„æºå¯¹è±¡ï¼š</p><ul><li><code>Node</code></li><li><code>Namespace</code></li><li><code>ClusterRole</code></li><li><code>ClusterRoleBinding</code></li><li><code>CustomResourceDefinition</code></li></ul><p>ä¸‹é¢æ˜¯ä¸€äº›ä¸èƒ½è·¨å‘½åç©ºé—´çš„èµ„æºå¯¹è±¡ï¼š</p><ul><li><code>Pod</code></li><li><code>ReplicaSet</code></li><li><code>Deployment</code></li><li><code>Service</code></li><li><code>ConfigMap</code></li><li><code>Secret</code></li><li><code>Ingress</code></li><li><code>PersistentVolume</code></li><li><code>PersistentVolumeClaim</code></li><li><code>Role</code></li><li><code>RoleBinding</code></li><li><code>ServiceAccount</code></li></ul><h1 id="ç¬¬åç« -Helm"><a href="#ç¬¬åç« -Helm" class="headerlink" title="ç¬¬åç«  Helm"></a>ç¬¬åç«  Helm</h1><ul><li>ä»€ä¹ˆæ˜¯ Helm</li><li>å®‰è£… Helm</li><li>é‡è¦æ¦‚å¿µ</li><li>ä½¿ç”¨ Helm</li></ul><h2 id="1-ç®€ä»‹-2"><a href="#1-ç®€ä»‹-2" class="headerlink" title="1 ç®€ä»‹"></a>1 ç®€ä»‹</h2><p>â€‹    å®˜ç½‘åœ°å€: <a href="https://helm.sh/zh/">https://helm.sh/zh/</a></p><p>â€‹    Helmæ˜¯ä¸€ä¸ªKubernetesåº”ç”¨ç¨‹åºåŒ…ç®¡ç†å·¥å…·ï¼Œå®ƒå…è®¸ä½ è½»æ¾ç®¡ç†å’Œéƒ¨ç½²Kubernetesåº”ç”¨ç¨‹åºã€‚Helmé€šè¿‡ä½¿ç”¨ç§°ä¸ºChartsçš„é¢„å®šä¹‰æ¨¡æ¿æ¥ç®€åŒ–Kubernetesåº”ç”¨ç¨‹åºçš„éƒ¨ç½²å’Œç®¡ç†ã€‚ChartåŒ…å«äº†ä¸€ç»„Kuberneteså¯¹è±¡å®šä¹‰ï¼Œå¯ä»¥æè¿°ä¸€ä¸ªåº”ç”¨ç¨‹åºçš„å®Œæ•´éƒ¨ç½²å’Œèµ„æºéœ€æ±‚ï¼ŒåŒ…æ‹¬Deploymentã€Serviceã€ConfigMapã€Secretç­‰ã€‚ä½¿ç”¨Helmï¼Œä½ å¯ä»¥è½»æ¾åœ°å®‰è£…ã€å‡çº§ã€å¸è½½å’Œå›æ»šKubernetesåº”ç”¨ç¨‹åºã€‚</p><p>åŒæ—¶ï¼ŒHelmè¿˜æä¾›äº†ä¸€äº›ä¾¿æ·çš„åŠŸèƒ½ï¼Œå¦‚ä¾èµ–ç®¡ç†ã€å…¨å±€å˜é‡ã€æ¡ä»¶æ¸²æŸ“ç­‰ï¼Œå¯ä»¥å¸®åŠ©ä½ æ›´å¥½åœ°ç®¡ç†åº”ç”¨ç¨‹åºçš„éƒ¨ç½²ã€‚Helmæœ‰ä¸¤ä¸ªä¸»è¦çš„ç»„ä»¶ï¼šHelmå®¢æˆ·ç«¯ï¼ˆhelmï¼‰å’ŒHelmæœåŠ¡å™¨ï¼ˆTillerï¼‰ã€‚Helmå®¢æˆ·ç«¯å¯ä»¥åœ¨æœ¬åœ°è¿è¡Œï¼Œè€ŒTilleråˆ™è¿è¡Œåœ¨Kubernetesé›†ç¾¤ä¸­ï¼Œå¹¶è´Ÿè´£å°†Chartsè½¬æ¢ä¸ºKuberneteså¯¹è±¡ã€‚</p><h2 id="2-å®‰è£…"><a href="#2-å®‰è£…" class="headerlink" title="2 å®‰è£…"></a>2 å®‰è£…</h2><p>ä¸‹è½½åœ°å€: <a href="https://github.com/helm/helm/releases">https://github.com/helm/helm/releases</a></p><blockquote><p>æ¯ä¸ªHelm <a href="https://github.com/helm/helm/releases">ç‰ˆæœ¬</a>éƒ½æä¾›äº†å„ç§æ“ä½œç³»ç»Ÿçš„äºŒè¿›åˆ¶ç‰ˆæœ¬ï¼Œè¿™äº›ç‰ˆæœ¬å¯ä»¥æ‰‹åŠ¨ä¸‹è½½å’Œå®‰è£…ã€‚</p></blockquote><ol><li>ä¸‹è½½ <a href="https://github.com/helm/helm/releases">éœ€è¦çš„ç‰ˆæœ¬</a></li><li>è§£å‹(<code>tar -zxvf helm-v3.0.0-linux-amd64.tar.gz</code>)</li><li>åœ¨è§£å‹ç›®å½•ä¸­æ‰¾åˆ°<code>helm</code>ç¨‹åºï¼Œç§»åŠ¨åˆ°éœ€è¦çš„ç›®å½•ä¸­(<code>mv linux-amd64/helm /usr/local/bin/helm</code>)</li><li><p>æ·»åŠ ä»“åº“: helm repo add bitnami <a href="https://charts.bitnami.com/bitnami">https://charts.bitnami.com/bitnami</a></p></li><li><p>éªŒè¯å®‰è£…: <code>helm help</code>.</p></li></ol><h2 id="3-é‡è¦æ¦‚å¿µ"><a href="#3-é‡è¦æ¦‚å¿µ" class="headerlink" title="3 é‡è¦æ¦‚å¿µ"></a>3 é‡è¦æ¦‚å¿µ</h2><ul><li><p><strong><em>Chart</em></strong> ä»£è¡¨ç€ Helm åŒ…ã€‚å®ƒåŒ…å«åœ¨ Kubernetes é›†ç¾¤å†…éƒ¨è¿è¡Œåº”ç”¨ç¨‹åºï¼Œå·¥å…·æˆ–æœåŠ¡æ‰€éœ€çš„æ‰€æœ‰èµ„æºå®šä¹‰ã€‚ä½ å¯ä»¥æŠŠå®ƒçœ‹ä½œæ˜¯ Homebrew formulaï¼ŒApt dpkgï¼Œæˆ– Yum RPM åœ¨Kubernetes ä¸­çš„ç­‰ä»·ç‰©ã€‚</p></li><li><p><strong>*Repository</strong>ï¼ˆä»“åº“ï¼‰* æ˜¯ç”¨æ¥å­˜æ”¾å’Œå…±äº« charts çš„åœ°æ–¹ã€‚å®ƒå°±åƒ Perl çš„ <a href="https://www.cpan.org/">CPAN æ¡£æ¡ˆåº“ç½‘ç»œ</a> æˆ–æ˜¯ Fedora çš„ <a href="https://src.fedoraproject.org/">è½¯ä»¶åŒ…ä»“åº“</a>ï¼Œåªä¸è¿‡å®ƒæ˜¯ä¾› Kubernetes åŒ…æ‰€ä½¿ç”¨çš„ã€‚</p></li><li><p><strong><em>Release</em></strong> æ˜¯è¿è¡Œåœ¨ Kubernetes é›†ç¾¤ä¸­çš„ chart çš„å®ä¾‹ã€‚ä¸€ä¸ª chart é€šå¸¸å¯ä»¥åœ¨åŒä¸€ä¸ªé›†ç¾¤ä¸­å®‰è£…å¤šæ¬¡ã€‚æ¯ä¸€æ¬¡å®‰è£…éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ <em>release</em>ã€‚ä»¥ MySQL chartä¸ºä¾‹ï¼Œå¦‚æœä½ æƒ³åœ¨ä½ çš„é›†ç¾¤ä¸­è¿è¡Œä¸¤ä¸ªæ•°æ®åº“ï¼Œä½ å¯ä»¥å®‰è£…è¯¥chartä¸¤æ¬¡ã€‚æ¯ä¸€ä¸ªæ•°æ®åº“éƒ½ä¼šæ‹¥æœ‰å®ƒè‡ªå·±çš„ <em>release</em> å’Œ <em>release name</em>ã€‚</p></li></ul><h2 id="4-ä½¿ç”¨"><a href="#4-ä½¿ç”¨" class="headerlink" title="4 ä½¿ç”¨"></a>4 ä½¿ç”¨</h2><h3 id="4-1-æœç´¢-charts"><a href="#4-1-æœç´¢-charts" class="headerlink" title="4.1 æœç´¢ charts"></a>4.1 æœç´¢ charts</h3><p>Helm è‡ªå¸¦ä¸€ä¸ªå¼ºå¤§çš„æœç´¢å‘½ä»¤ï¼Œå¯ä»¥ç”¨æ¥ä»ä¸¤ç§æ¥æºä¸­è¿›è¡Œæœç´¢ï¼š</p><ul><li><code>helm search hub</code> ä» <a href="https://artifacthub.io/">Artifact Hub</a> ä¸­æŸ¥æ‰¾å¹¶åˆ—å‡º helm chartsã€‚ Artifact Hubä¸­å­˜æ”¾äº†å¤§é‡ä¸åŒçš„ä»“åº“ã€‚</li><li><code>helm search repo</code> ä»ä½ æ·»åŠ ï¼ˆä½¿ç”¨ <code>helm repo add</code>ï¼‰åˆ°æœ¬åœ° helm å®¢æˆ·ç«¯ä¸­çš„ä»“åº“ä¸­è¿›è¡ŒæŸ¥æ‰¾ã€‚è¯¥å‘½ä»¤åŸºäºæœ¬åœ°æ•°æ®è¿›è¡Œæœç´¢ï¼Œæ— éœ€è¿æ¥äº’è”ç½‘ã€‚</li></ul><h3 id="4-2-å®‰è£…"><a href="#4-2-å®‰è£…" class="headerlink" title="4.2 å®‰è£…"></a>4.2 å®‰è£…</h3><p>ä½¿ç”¨ <code>helm install</code> å‘½ä»¤æ¥å®‰è£…ä¸€ä¸ªæ–°çš„ helm åŒ…ã€‚æœ€ç®€å•çš„ä½¿ç”¨æ–¹æ³•åªéœ€è¦ä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼šä½ å‘½åçš„releaseåå­—å’Œä½ æƒ³å®‰è£…çš„chartçš„åç§°ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">helm install nginx bitnami/nginx</span></span><br><span class="line">NAME: nginx</span><br><span class="line">LAST DEPLOYED: Wed Apr  5 07:18:04 2023</span><br><span class="line">NAMESPACE: kube-system</span><br><span class="line">STATUS: deployed</span><br><span class="line">REVISION: 1</span><br><span class="line">TEST SUITE: None</span><br><span class="line">NOTES:</span><br><span class="line">CHART NAME: nginx</span><br><span class="line">CHART VERSION: 13.2.34</span><br><span class="line">APP VERSION: 1.23.4</span><br><span class="line"></span><br><span class="line">** Please be patient while the chart is being deployed **</span><br><span class="line">NGINX can be accessed through the following DNS name from within your cluster:</span><br><span class="line"></span><br><span class="line">    nginx.kube-system.svc.cluster.local (port 80)</span><br><span class="line"></span><br><span class="line">To access NGINX from outside the cluster, follow the steps below:</span><br><span class="line"></span><br><span class="line">1. Get the NGINX URL by running these commands:</span><br><span class="line"></span><br><span class="line">  NOTE: It may take a few minutes for the LoadBalancer IP to be available.</span><br><span class="line">        Watch the status with: &#x27;kubectl get svc --namespace kube-system -w nginx&#x27;</span><br><span class="line"></span><br><span class="line">    export SERVICE_PORT=$(kubectl get --namespace kube-system -o jsonpath=&quot;&#123;.spec.ports[0].port&#125;&quot; services nginx)</span><br><span class="line">    export SERVICE_IP=$(kubectl get svc --namespace kube-system nginx -o jsonpath=&#x27;&#123;.status.loadBalancer.ingress[0].ip&#125;&#x27;)</span><br><span class="line">    echo &quot;http://$&#123;SERVICE_IP&#125;:$&#123;SERVICE_PORT&#125;&quot;</span><br></pre></td></tr></table></figure><blockquote><p> æ³¨æ„: å®‰è£…chartæ—¶åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ <em>release</em> å¯¹è±¡ã€‚ä¸Šè¿°å‘å¸ƒè¢«å‘½åä¸º <code>nginx</code>ã€‚ ï¼ˆå¦‚æœæƒ³è®©Helmç”Ÿæˆä¸€ä¸ªåç§°ï¼Œåˆ é™¤å‘å¸ƒåç§°å¹¶ä½¿ç”¨<code>--generate-name</code>ã€‚ï¼‰</p></blockquote><p>helm å®‰è£…é¡ºåº:     <a href="https://helm.sh/zh/docs/intro/using_helm/">https://helm.sh/zh/docs/intro/using_helm/</a></p><hr><h3 id="4-3-æŸ¥çœ‹åˆ—è¡¨"><a href="#4-3-æŸ¥çœ‹åˆ—è¡¨" class="headerlink" title="4.3 æŸ¥çœ‹åˆ—è¡¨"></a>4.3 æŸ¥çœ‹åˆ—è¡¨</h3><p>ä½ å¯ä»¥é€šè¿‡ <code>helm list</code> å‘½ä»¤çœ‹åˆ°å½“å‰éƒ¨ç½²çš„æ‰€æœ‰ releaseï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">helm list</span></span><br><span class="line">NAME    NAMESPACE       REVISION        UPDATED                                 STATUS          CHART           APP VERSION</span><br><span class="line">nginx   kube-system     1               2023-04-05 07:34:48.421708425 -0400 EDT deployed        nginx-13.2.34   1.23.4 </span><br></pre></td></tr></table></figure><h3 id="4-4-æŸ¥çœ‹çŠ¶æ€"><a href="#4-4-æŸ¥çœ‹çŠ¶æ€" class="headerlink" title="4.4 æŸ¥çœ‹çŠ¶æ€"></a>4.4 æŸ¥çœ‹çŠ¶æ€</h3><p>ä½ å¯ä»¥ä½¿ç”¨ <code>helm status</code> æ¥è¿½è¸ª release çš„çŠ¶æ€ï¼Œæˆ–æ˜¯é‡æ–°è¯»å–é…ç½®ä¿¡æ¯ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">helm status nginx</span></span><br><span class="line">NAME: nginx</span><br><span class="line">LAST DEPLOYED: Wed Apr  5 07:18:04 2023</span><br><span class="line">NAMESPACE: kube-system</span><br><span class="line">STATUS: deployed</span><br><span class="line">REVISION: 1</span><br><span class="line">TEST SUITE: None</span><br><span class="line">NOTES:</span><br><span class="line">CHART NAME: nginx</span><br><span class="line">CHART VERSION: 13.2.34</span><br><span class="line">APP VERSION: 1.23.4</span><br><span class="line"></span><br><span class="line">** Please be patient while the chart is being deployed **</span><br><span class="line">NGINX can be accessed through the following DNS name from within your cluster:</span><br><span class="line"></span><br><span class="line">    nginx.kube-system.svc.cluster.local (port 80)</span><br><span class="line"></span><br><span class="line">To access NGINX from outside the cluster, follow the steps below:</span><br><span class="line"></span><br><span class="line">1. Get the NGINX URL by running these commands:</span><br><span class="line"></span><br><span class="line">  NOTE: It may take a few minutes for the LoadBalancer IP to be available.</span><br><span class="line">        Watch the status with: &#x27;kubectl get svc --namespace kube-system -w nginx&#x27;</span><br><span class="line"></span><br><span class="line">    export SERVICE_PORT=$(kubectl get --namespace kube-system -o jsonpath=&quot;&#123;.spec.ports[0].port&#125;&quot; services nginx)</span><br><span class="line">    export SERVICE_IP=$(kubectl get svc --namespace kube-system nginx -o jsonpath=&#x27;&#123;.status.loadBalancer.ingress[0].ip&#125;&#x27;)</span><br><span class="line">    echo &quot;http://$&#123;SERVICE_IP&#125;:$&#123;SERVICE_PORT&#125;&quot;</span><br></pre></td></tr></table></figure><h3 id="4-5-å¸è½½"><a href="#4-5-å¸è½½" class="headerlink" title="4.5 å¸è½½"></a>4.5 å¸è½½</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">helm uninstall nginx</span></span><br><span class="line">release &quot;nginx&quot; uninstalled</span><br></pre></td></tr></table></figure><h2 id="5-å®‰è£…è‡ªå®šä¹‰-Chart"><a href="#5-å®‰è£…è‡ªå®šä¹‰-Chart" class="headerlink" title="5 å®‰è£…è‡ªå®šä¹‰ Chart"></a>5 å®‰è£…è‡ªå®šä¹‰ Chart</h2><p>ä¸Šè¿°å®‰è£…æ–¹å¼åªä¼šä½¿ç”¨ chart çš„é»˜è®¤é…ç½®é€‰é¡¹ã€‚å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰ chart æ¥æŒ‡å®šæˆ‘ä»¬æƒ³è¦çš„é…ç½®ã€‚</p><h3 id="5-1-æ‹‰å–è‡ªå®šä¹‰çš„-chart"><a href="#5-1-æ‹‰å–è‡ªå®šä¹‰çš„-chart" class="headerlink" title="5.1 æ‹‰å–è‡ªå®šä¹‰çš„ chart"></a>5.1 æ‹‰å–è‡ªå®šä¹‰çš„ chart</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">helm create app</span></span><br></pre></td></tr></table></figure><blockquote><p><code>æ³¨æ„: å½“å‰ç›®å½•ä¸­ä¼šå‡ºç°ä¸€ä¸ª nginx-xxx.tgz æ–‡ä»¶ è¿™ä¸ªæ–‡ä»¶å°±æ˜¯ charts çš„åŒ…ã€‚</code></p></blockquote><h3 id="5-2-æŸ¥çœ‹-chart-ç›®å½•ç»“æ„"><a href="#5-2-æŸ¥çœ‹-chart-ç›®å½•ç»“æ„" class="headerlink" title="5.2 æŸ¥çœ‹ chart ç›®å½•ç»“æ„"></a>5.2 æŸ¥çœ‹ chart ç›®å½•ç»“æ„</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">app/</span><br><span class="line">  Chart.yaml</span><br><span class="line">  values.yaml</span><br><span class="line">  charts/</span><br><span class="line">  templates/</span><br><span class="line">  ...</span><br></pre></td></tr></table></figure><ul><li><p><code>templates/</code> ç›®å½•åŒ…æ‹¬äº†æ¨¡æ¿æ–‡ä»¶ã€‚å½“Helmè¯„ä¼°chartæ—¶ï¼Œä¼šé€šè¿‡æ¨¡æ¿æ¸²æŸ“å¼•æ“å°†æ‰€æœ‰æ–‡ä»¶å‘é€åˆ°<code>templates/</code>ç›®å½•ä¸­ã€‚ ç„¶åæ”¶é›†æ¨¡æ¿çš„ç»“æœå¹¶å‘é€ç»™Kubernetesã€‚</p></li><li><p><code>values.yaml</code> æ–‡ä»¶ä¹Ÿå¯¼å…¥åˆ°äº†æ¨¡æ¿ã€‚è¿™ä¸ªæ–‡ä»¶åŒ…å«äº†chartçš„ <em>é»˜è®¤å€¼</em> ã€‚è¿™äº›å€¼ä¼šåœ¨ç”¨æˆ·æ‰§è¡Œ<code>helm install</code> æˆ– <code>helm upgrade</code>æ—¶è¢«è¦†ç›–ã€‚</p></li><li><p><code>Chart.yaml</code> æ–‡ä»¶åŒ…å«äº†è¯¥chartçš„æè¿°ã€‚ä½ å¯ä»¥ä»æ¨¡æ¿ä¸­è®¿é—®å®ƒã€‚<code>charts/</code>ç›®å½• <em>å¯ä»¥</em> åŒ…å«å…¶ä»–çš„chart(ç§°ä¹‹ä¸º <em>å­chart</em>)ã€‚ </p></li></ul><h3 id="5-3-è‡ªå®šä¹‰æ¨¡æ¿"><a href="#5-3-è‡ªå®šä¹‰æ¨¡æ¿" class="headerlink" title="5.3 è‡ªå®šä¹‰æ¨¡æ¿"></a>5.3 è‡ªå®šä¹‰æ¨¡æ¿</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm -rf mychart/templates/*</span><br></pre></td></tr></table></figure><ul><li>ç¼–å†™ namespace.yaml</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Namespace</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> &#123;&#123; <span class="string">.Chart.Name</span> &#125;&#125;</span><br><span class="line">  <span class="attr">namespace:</span> &#123;&#123; <span class="string">.Values.namespace</span> &#125;&#125;</span><br></pre></td></tr></table></figure><ul><li>ç¼–å†™ deployment.yml</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> &#123;&#123; <span class="string">.Chart.Name</span>&#125;&#125;</span><br><span class="line">  <span class="attr">namespace:</span> &#123;&#123;<span class="string">.Values.namespace</span>&#125;&#125;</span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> &#123;&#123; <span class="string">.Chart.Name</span>&#125;&#125;</span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> &#123;&#123; <span class="string">.Values.replicas</span> &#125;&#125;</span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">name:</span> &#123;&#123; <span class="string">.Chart.Name</span>&#125;&#125;</span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> &#123;&#123; <span class="string">.Chart.Name</span>&#125;&#125;</span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> &#123;&#123; <span class="string">.Chart.Name</span>&#125;&#125;</span><br><span class="line">          <span class="attr">image:</span> &#123;&#123; <span class="string">.Values.image</span>&#125;&#125;</span><br><span class="line">          <span class="attr">imagePullPolicy:</span> &#123;&#123;<span class="string">.Values.imagePullPolicy</span>&#125;&#125;</span><br><span class="line">          <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">containerPort:</span> &#123;&#123;<span class="string">.Values.containerPort</span>&#125;&#125;</span><br><span class="line">      <span class="attr">restartPolicy:</span> &#123;&#123; <span class="string">.Values.restartPolicy</span> &#125;&#125;</span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> &#123;&#123; <span class="string">.Chart.Name</span>&#125;&#125;</span><br></pre></td></tr></table></figure><ul><li>ç¼–å†™ service.yml</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> &#123;&#123;<span class="string">.Chart.Name</span>&#125;&#125;</span><br><span class="line">  <span class="attr">namespace:</span> &#123;&#123;<span class="string">.Values.namespace</span>&#125;&#125;</span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> &#123;&#123;<span class="string">.Chart.Name</span>&#125;&#125;</span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> &#123;&#123;<span class="string">.Values.service.port</span>&#125;&#125;</span><br><span class="line">      <span class="attr">targetPort:</span> &#123;&#123;<span class="string">.Values.containerPort</span>&#125;&#125;</span><br><span class="line">  <span class="attr">type:</span> &#123;&#123; <span class="string">.Values.service.type</span> &#125;&#125;</span><br></pre></td></tr></table></figure><ul><li>ç¼–å†™ Chart.yml</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v2</span></span><br><span class="line"><span class="attr">name:</span> <span class="string">app</span></span><br><span class="line"><span class="attr">description:</span> <span class="string">A</span> <span class="string">Helm</span> <span class="string">chart</span> <span class="string">for</span> <span class="string">Kubernetes</span></span><br><span class="line"><span class="comment"># A chart can be either an &#x27;application&#x27; or a &#x27;library&#x27; chart.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Application charts are a collection of templates that can be packaged into versioned archives</span></span><br><span class="line"><span class="comment"># to be deployed.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Library charts provide useful utilities or functions for the chart developer. They&#x27;re included as</span></span><br><span class="line"><span class="comment"># a dependency of application charts to inject those utilities and functions into the rendering</span></span><br><span class="line"><span class="comment"># pipeline. Library charts do not define any templates and therefore cannot be deployed.</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">application</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># This is the chart version. This version number should be incremented each time you make changes</span></span><br><span class="line"><span class="comment"># to the chart and its templates, including the app version.</span></span><br><span class="line"><span class="comment"># Versions are expected to follow Semantic Versioning (https://semver.org/)</span></span><br><span class="line"><span class="attr">version:</span> <span class="number">0.1</span><span class="number">.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># This is the version number of the application being deployed. This version number should be</span></span><br><span class="line"><span class="comment"># incremented each time you make changes to the application. Versions are not expected to</span></span><br><span class="line"><span class="comment"># follow Semantic Versioning. They should reflect the version the application is using.</span></span><br><span class="line"><span class="comment"># It is recommended to use it with quotes.</span></span><br><span class="line"><span class="attr">appVersion:</span> <span class="string">&quot;1.16.0&quot;</span></span><br></pre></td></tr></table></figure><ul><li>ç¼–å†™ values.yaml</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">namespace:</span> <span class="string">app</span></span><br><span class="line"><span class="attr">image:</span> <span class="string">nginx:1.19</span></span><br><span class="line"><span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line"><span class="attr">restartPolicy:</span> <span class="string">Always</span></span><br><span class="line"><span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="attr">service:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">ClusterIP</span></span><br></pre></td></tr></table></figure><h3 id="5-4-éªŒè¯æ˜¯å¦å­˜åœ¨é”™è¯¯"><a href="#5-4-éªŒè¯æ˜¯å¦å­˜åœ¨é”™è¯¯" class="headerlink" title="5.4 éªŒè¯æ˜¯å¦å­˜åœ¨é”™è¯¯"></a>5.4 éªŒè¯æ˜¯å¦å­˜åœ¨é”™è¯¯</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm lint app</span><br></pre></td></tr></table></figure><h3 id="5-5-æ‰“åŒ…è‡ªå®šä¹‰-chart"><a href="#5-5-æ‰“åŒ…è‡ªå®šä¹‰-chart" class="headerlink" title="5.5 æ‰“åŒ…è‡ªå®šä¹‰ chart"></a>5.5 æ‰“åŒ…è‡ªå®šä¹‰ chart</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm package app</span><br></pre></td></tr></table></figure><h3 id="5-6-å®‰è£…-chart"><a href="#5-6-å®‰è£…-chart" class="headerlink" title="5.6 å®‰è£… chart"></a>5.6 å®‰è£… chart</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm install app myapp-1.tgz</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">k8s</summary>
    
    
    
    <category term="Linux" scheme="https://www.naste.top:1024/categories/Linux/"/>
    
    
    <category term="Linux" scheme="https://www.naste.top:1024/tags/Linux/"/>
    
    <category term="k8s" scheme="https://www.naste.top:1024/tags/k8s/"/>
    
  </entry>
  
  <entry>
    <title>IDEAæ·»åŠ k8sæ’ä»¶å¿«é€Ÿç”Ÿæˆk8sé…ç½®æ–‡ä»¶</title>
    <link href="https://www.naste.top:1024/posts/2266788211.html"/>
    <id>https://www.naste.top:1024/posts/2266788211.html</id>
    <published>2023-03-16T13:36:34.000Z</published>
    <updated>2023-03-21T08:03:19.358Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h1><p>[TOC]</p><h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><p><a href="https://juejin.cn/post/7122400716110430245">https://juejin.cn/post/7122400716110430245</a></p><h1 id="ä¸‹è½½æ’ä»¶"><a href="#ä¸‹è½½æ’ä»¶" class="headerlink" title="ä¸‹è½½æ’ä»¶"></a>ä¸‹è½½æ’ä»¶</h1><p>æœç´¢<code>kubernetes</code>æ’ä»¶</p><p><img src="https://www.naste.top:9000/images/image-20230316213848511.png" alt="image-20230316213848511"></p><h1 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h1><p><img src="https://www.naste.top:9000/images/image-20230316214010682.png" alt="image-20230316214010682"></p><p><img src="https://www.naste.top:9000/images/image-20230316214207902.png" alt="image-20230316214207902"><br><img src="https://www.naste.top:9000/images/image-20230316214451822.png" alt="image-20230316214451822"></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="comment"># ç”¨æ¥ç»™å½“å‰podåŠ å…¥æ ‡ç­¾ï¼Œk8sä¸­nameæ˜¯å”¯ä¸€çš„ï¼Œlabelsä¸æ˜¯å”¯ä¸€çš„ï¼Œå¯ä»¥æ ¹æ®labelsæ¥è¿‡æ»¤pods</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">nginx:1.22.1</span></span><br><span class="line">      <span class="comment"># å®¹å™¨æ‹‰å–ç­–ç•¥ï¼Œä¸å­˜åœ¨æ‰æ‹‰å–</span></span><br><span class="line">      <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">  <span class="comment"># é‡å¯ç­–ç•¥ï¼Œæ€»æ˜¯é‡å¯</span></span><br><span class="line">  <span class="attr">restartPolicy:</span> <span class="string">Always</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">IDEAæ·»åŠ k8sæ’ä»¶å¿«é€Ÿç”Ÿæˆk8sé…ç½®æ–‡ä»¶</summary>
    
    
    
    <category term="Linux" scheme="https://www.naste.top:1024/categories/Linux/"/>
    
    
    <category term="Linux" scheme="https://www.naste.top:1024/tags/Linux/"/>
    
    <category term="Docker" scheme="https://www.naste.top:1024/tags/Docker/"/>
    
    <category term="k8s" scheme="https://www.naste.top:1024/tags/k8s/"/>
    
  </entry>
  
  <entry>
    <title>ä»£ç ç”Ÿæˆå™¨é¡¹ç›®è§£è¯»</title>
    <link href="https://www.naste.top:1024/posts/1154747761.html"/>
    <id>https://www.naste.top:1024/posts/1154747761.html</id>
    <published>2023-03-16T01:58:33.000Z</published>
    <updated>2023-03-21T07:52:37.501Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h1><p>[TOC]</p><h1 id="é¡¹ç›®åœ°å€"><a href="#é¡¹ç›®åœ°å€" class="headerlink" title="é¡¹ç›®åœ°å€"></a>é¡¹ç›®åœ°å€</h1><p><a href="https://github.com/liyupi/sql-father-backend-public">åç«¯ï¼šhttps://github.com/liyupi/sql-father-backend-public</a></p><p><a href="https://github.com/liyupi/sql-father-frontend-public">å‰ç«¯ï¼šhttps://github.com/liyupi/sql-father-frontend-public</a></p><h1 id="synchronizedåŠ é”"><a href="#synchronizedåŠ é”" class="headerlink" title="synchronizedåŠ é”"></a>synchronizedåŠ é”</h1><h2 id="String"><a href="#String" class="headerlink" title="String"></a>String</h2><blockquote><p><strong>ä½¿ç”¨Stringä¸­çš„internï¼Œå°†æŒ‡å®šå­—ç¬¦ä¸²ä½œä¸ºé”ï¼Œå°†ç”¨æˆ·çš„è´¦å·é”ä½ï¼Œé¿å…ç”¨æˆ·è´¦å·é‡å¤æ³¨å†Œ</strong></p><p><strong>String.intern()æ˜¯ä¸€ä¸ªNativeæ–¹æ³•ï¼Œå®ƒçš„ä½œç”¨æ˜¯ï¼šå¦‚æœå­—ç¬¦å¸¸é‡æ± ä¸­å·²ç»åŒ…å«ä¸€ä¸ªç­‰äºæ­¤Stringå¯¹è±¡çš„å­—ç¬¦ä¸²ï¼Œåˆ™è¿”å›å¸¸é‡æ± ä¸­å­—ç¬¦ä¸²çš„å¼•ç”¨ï¼Œå¦åˆ™ï¼Œå°†æ–°çš„å­—ç¬¦ä¸²æ”¾å…¥å¸¸é‡æ± ï¼Œå¹¶è¿”å›æ–°å­—ç¬¦ä¸²çš„å¼•ç”¨</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">long</span> <span class="title function_">userRegister</span><span class="params">(String userAccount)</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//ç»™ç”¨æˆ·è´¦å·åŠ é”ï¼ŒæŸ¥è¯¢ç”¨æˆ·æ˜¯å¦é‡å¤</span></span><br><span class="line">    <span class="keyword">synchronized</span> (userAccount.intern()) &#123;</span><br><span class="line">        <span class="comment">// è´¦æˆ·ä¸èƒ½é‡å¤</span></span><br><span class="line">        QueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(<span class="string">&quot;userAccount&quot;</span>, userAccount);</span><br><span class="line">        <span class="type">long</span> <span class="variable">count</span> <span class="operator">=</span> userMapper.selectCount(queryWrapper);</span><br><span class="line">        <span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(ErrorCode.PARAMS_ERROR, <span class="string">&quot;è´¦å·é‡å¤&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 3. æ’å…¥æ•°æ®</span></span><br><span class="line">        ....</span><br><span class="line">        <span class="keyword">return</span> user.getId();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="AOPä½¿ç”¨"><a href="#AOPä½¿ç”¨" class="headerlink" title="AOPä½¿ç”¨"></a>AOPä½¿ç”¨</h1><h2 id="è‡ªå®šä¹‰æ³¨è§£è®¤è¯"><a href="#è‡ªå®šä¹‰æ³¨è§£è®¤è¯" class="headerlink" title="è‡ªå®šä¹‰æ³¨è§£è®¤è¯"></a>è‡ªå®šä¹‰æ³¨è§£è®¤è¯</h2><blockquote><p><strong>ä½¿ç”¨AOP+è‡ªå®šä¹‰æ³¨è§£åšæ ¡éªŒ</strong></p></blockquote><div class="tabs" id="aopä½¿ç”¨"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#aopä½¿ç”¨-1">è‡ªå®šä¹‰æ³¨è§£</button></li><li class="tab"><button type="button" data-href="#aopä½¿ç”¨-2">AOPä»£ç </button></li><li class="tab"><button type="button" data-href="#aopä½¿ç”¨-3">ä½¿ç”¨</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="aopä½¿ç”¨-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æƒé™æ ¡éªŒ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Target(ElementType.METHOD)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> AuthCheck &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æœ‰ä»»ä½•ä¸€ä¸ªè§’è‰²</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String[] anyRole() <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¿…é¡»æœ‰æŸä¸ªè§’è‰²</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String <span class="title function_">mustRole</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="aopä½¿ç”¨-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yupi.sqlfather.aop;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.toolkit.CollectionUtils;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.annotation.AuthCheck;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.common.ErrorCode;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.exception.BusinessException;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.model.entity.User;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.service.UserService;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Around;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.request.RequestAttributes;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.request.RequestContextHolder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.request.ServletRequestAttributes;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æƒé™æ ¡éªŒ AOP</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰§è¡Œæ‹¦æˆª</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Around(&quot;@annotation(authCheck)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">doInterceptor</span><span class="params">(ProceedingJoinPoint joinPoint, AuthCheck authCheck)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        List&lt;String&gt; anyRole = Arrays.stream(authCheck.anyRole()).filter(StringUtils::isNotBlank).collect(Collectors.toList());</span><br><span class="line">        <span class="type">String</span> <span class="variable">mustRole</span> <span class="operator">=</span> authCheck.mustRole();</span><br><span class="line">        <span class="type">RequestAttributes</span> <span class="variable">requestAttributes</span> <span class="operator">=</span> RequestContextHolder.currentRequestAttributes();</span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> ((ServletRequestAttributes) requestAttributes).getRequest();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//ä¸‹é¢æ˜¯å…·ä½“çš„åšæ ¡éªŒçš„å†…å®¹ï¼Œå¯ä»¥æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œä¿®æ”¹---start</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å½“å‰ç™»å½•ç”¨æˆ·</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.getLoginUser(request);</span><br><span class="line">        <span class="comment">// æ‹¥æœ‰ä»»æ„æƒé™å³é€šè¿‡</span></span><br><span class="line">        <span class="keyword">if</span> (CollectionUtils.isNotEmpty(anyRole)) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">userRole</span> <span class="operator">=</span> user.getUserRole();</span><br><span class="line">            <span class="keyword">if</span> (!anyRole.contains(userRole)) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(ErrorCode.NO_AUTH_ERROR);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å¿…é¡»æœ‰æ‰€æœ‰æƒé™æ‰é€šè¿‡</span></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isNotBlank(mustRole)) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">userRole</span> <span class="operator">=</span> user.getUserRole();</span><br><span class="line">            <span class="keyword">if</span> (!mustRole.equals(userRole)) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(ErrorCode.NO_AUTH_ERROR);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//ä¸Šé¢æ˜¯å…·ä½“çš„åšæ ¡éªŒçš„å†…å®¹ï¼Œå¯ä»¥æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œä¿®æ”¹---end</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// é€šè¿‡æƒé™æ ¡éªŒï¼Œæ”¾è¡Œã€è¿™é‡Œæ”¾è¡Œå°±æ˜¯æ‰§è¡ŒåŸä»£ç ï¼Œä¸Šé¢çš„ä»£ç æ˜¯ç»™æŒ‡å®šçš„æ–¹æ³•åšåˆ‡é¢ã€‘</span></span><br><span class="line">        <span class="keyword">return</span> joinPoint.proceed();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="aopä½¿ç”¨-3"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ›´æ–°ï¼ˆä»…ç®¡ç†å‘˜ï¼‰</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/update&quot;)</span></span><br><span class="line"><span class="meta">@AuthCheck(mustRole = &quot;admin&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">()</span> &#123;</span><br><span class="line">    ...... å…·ä½“ä¸šåŠ¡</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="æ—¥å¿—åˆ‡é¢"><a href="#æ—¥å¿—åˆ‡é¢" class="headerlink" title="æ—¥å¿—åˆ‡é¢"></a>æ—¥å¿—åˆ‡é¢</h2><div class="tabs" id="æ—¥å¿—åˆ‡é¢"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#æ—¥å¿—åˆ‡é¢-1">AOPä»£ç </button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="æ—¥å¿—åˆ‡é¢-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Around;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StopWatch;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.request.RequestAttributes;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.request.RequestContextHolder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.request.ServletRequestAttributes;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¯·æ±‚å“åº”æ—¥å¿— AOP</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰§è¡Œæ‹¦æˆª</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Around(&quot;execution(* com.xiaofei.controller.*.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">doInterceptor</span><span class="params">(ProceedingJoinPoint point)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="comment">// è®¡æ—¶</span></span><br><span class="line">        <span class="type">StopWatch</span> <span class="variable">stopWatch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StopWatch</span>();</span><br><span class="line">        stopWatch.start();</span><br><span class="line">        <span class="comment">// è·å–è¯·æ±‚è·¯å¾„</span></span><br><span class="line">        <span class="type">RequestAttributes</span> <span class="variable">requestAttributes</span> <span class="operator">=</span> RequestContextHolder.currentRequestAttributes();</span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">httpServletRequest</span> <span class="operator">=</span> ((ServletRequestAttributes) requestAttributes).getRequest();</span><br><span class="line">        <span class="comment">// ç”Ÿæˆè¯·æ±‚å”¯ä¸€ id</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">requestId</span> <span class="operator">=</span> UUID.randomUUID().toString();</span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> httpServletRequest.getRequestURI();</span><br><span class="line">        <span class="comment">// è·å–è¯·æ±‚å‚æ•°</span></span><br><span class="line">        Object[] args = point.getArgs();</span><br><span class="line">        <span class="type">String</span> <span class="variable">reqParam</span> <span class="operator">=</span> <span class="string">&quot;[&quot;</span> + StringUtils.join(args, <span class="string">&quot;, &quot;</span>) + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">        <span class="comment">// è¾“å‡ºè¯·æ±‚æ—¥å¿—</span></span><br><span class="line">        log.info(<span class="string">&quot;request startï¼Œid: &#123;&#125;, path: &#123;&#125;, ip: &#123;&#125;, params: &#123;&#125;&quot;</span>, requestId, url,</span><br><span class="line">                httpServletRequest.getRemoteHost(), reqParam);</span><br><span class="line">        <span class="comment">// æ‰§è¡ŒåŸæ–¹æ³•</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> point.proceed();</span><br><span class="line">        <span class="comment">// è¾“å‡ºå“åº”æ—¥å¿—</span></span><br><span class="line">        stopWatch.stop();</span><br><span class="line">        <span class="type">long</span> <span class="variable">totalTimeMillis</span> <span class="operator">=</span> stopWatch.getTotalTimeMillis();</span><br><span class="line">        log.info(<span class="string">&quot;request end, id: &#123;&#125;, cost: &#123;&#125;ms&quot;</span>, requestId, totalTimeMillis);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h1 id="è·¨åŸŸé…ç½®"><a href="#è·¨åŸŸé…ç½®" class="headerlink" title="è·¨åŸŸé…ç½®"></a>è·¨åŸŸé…ç½®</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.CorsRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å…¨å±€è·¨åŸŸé…ç½®</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CorsConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addCorsMappings</span><span class="params">(CorsRegistry registry)</span> &#123;</span><br><span class="line">        <span class="comment">// è¦†ç›–æ‰€æœ‰è¯·æ±‚</span></span><br><span class="line">        registry.addMapping(<span class="string">&quot;/**&quot;</span>)</span><br><span class="line">                <span class="comment">// å…è®¸å‘é€ Cookie</span></span><br><span class="line">                .allowCredentials(<span class="literal">true</span>)</span><br><span class="line">                <span class="comment">// æ”¾è¡Œå“ªäº›åŸŸåï¼ˆå¿…é¡»ç”¨ patternsï¼Œå¦åˆ™ * ä¼šå’Œ allowCredentials å†²çªï¼‰</span></span><br><span class="line">                .allowedOriginPatterns(<span class="string">&quot;*&quot;</span>)</span><br><span class="line">                .allowedMethods(<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>, <span class="string">&quot;PUT&quot;</span>, <span class="string">&quot;DELETE&quot;</span>, <span class="string">&quot;OPTIONS&quot;</span>)</span><br><span class="line">                .allowedHeaders(<span class="string">&quot;*&quot;</span>)</span><br><span class="line">                .exposedHeaders(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="è®¾è®¡æ¨¡å¼"><a href="#è®¾è®¡æ¨¡å¼" class="headerlink" title="è®¾è®¡æ¨¡å¼"></a>è®¾è®¡æ¨¡å¼</h1><h2 id="å·¥å‚-å•ä¾‹æ¨¡å¼"><a href="#å·¥å‚-å•ä¾‹æ¨¡å¼" class="headerlink" title="å·¥å‚ + å•ä¾‹æ¨¡å¼"></a>å·¥å‚ + å•ä¾‹æ¨¡å¼</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ConcurrentHashMap;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æŒ‡å®šæ–¹æ³•å·¥å‚</span></span><br><span class="line"><span class="comment"> * å·¥å‚ + å•ä¾‹æ¨¡å¼ï¼Œé™ä½å¼€é”€</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> https://github.com/liyupi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SQLDialectFactory</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * className =&gt; æ–¹è¨€å®ä¾‹æ˜ å°„</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;String, SQLDialect&gt; DIALECT_POOL = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ„é€ å™¨ç§æœ‰åŒ–ï¼Œå•ä¾‹æ¨¡å¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">SQLDialectFactory</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–æŒ‡å®šç±»çš„é€”å¾„ï¼Œéšè—æ„é€ è¿‡ç¨‹ï¼Œç›´æ¥è®©ä½¿ç”¨è€…è·å–åˆ°åˆ›å»ºæµ©çš„å¯¹è±¡ï¼Œå·¥å‚æ¨¡å¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> SQLDialect <span class="title function_">getDialect</span><span class="params">(String className)</span> &#123;</span><br><span class="line">        <span class="comment">//å…·ä½“è·å–æ–¹æ³• ......</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="ç­–ç•¥æ¨¡å¼"><a href="#ç­–ç•¥æ¨¡å¼" class="headerlink" title="ç­–ç•¥æ¨¡å¼"></a>ç­–ç•¥æ¨¡å¼</h2><blockquote><p><strong>å…·ä½“ä½¿ç”¨å¯ä»¥çœ‹ï¼ˆè®¾è®¡æ¨¡å¼æ¡ˆä¾‹ï¼‰ï¼š<a href="http://naste.top/posts/3353504920.html">http://naste.top/posts/3353504920.html</a></strong></p></blockquote><ul><li>å°†æ¯ç§ç”Ÿæˆç±»å‹å®šä¹‰ä¸ºä¸€ä¸ª Builderï¼ˆcore/builder ç›®å½•ï¼‰</li><li>å…¶ä¸­ï¼Œå¯¹äº SQL ä»£ç ç”Ÿæˆå™¨ï¼ˆ SqlBuilderï¼‰ï¼Œä½¿ç”¨æ–¹è¨€æ¥æ”¯æŒä¸åŒçš„æ•°æ®åº“ç±»å‹ï¼ˆç­–ç•¥æ¨¡å¼ï¼‰ï¼Œå¹¶ä½¿ç”¨å•ä¾‹æ¨¡å¼ + å·¥å‚æ¨¡å¼åˆ›å»ºæ–¹è¨€å®ä¾‹</li><li>å¯¹äº Javaã€å‰ç«¯ä»£ç ç”Ÿæˆå™¨ï¼ˆJavaCodeBuilderã€FrontendCodeBuilderï¼‰ï¼Œä½¿ç”¨ FreeMarker æ¨¡æ¿å¼•æ“æ¥ç”Ÿæˆ</li></ul><h2 id="é—¨é¢æ¨¡å¼"><a href="#é—¨é¢æ¨¡å¼" class="headerlink" title="é—¨é¢æ¨¡å¼"></a>é—¨é¢æ¨¡å¼</h2><blockquote><p><strong>é—¨é¢æ¨¡å¼å°±æ˜¯è®©å®¢æˆ·ç«¯å°†åªè¯·æ±‚ä¸€æ¬¡å³å¯è·å–æ‰€æœ‰ä¿¡æ¯ï¼Œæ¯”å¦‚ä»£ç ç”Ÿæˆå¯èƒ½éœ€è¦ç”ŸæˆJavaã€vueã€JavaScriptç­‰ä»£ç ï¼Œå¦‚æœä¸é€‚ç”¨é—¨é¢æ¨¡å¼ï¼Œå°±éœ€è¦å®¢æˆ·ç«¯åˆ†åˆ«è°ƒç”¨ç”ŸæˆJavaã€vueã€JavaScriptçš„æ¥å£æ¥è·å–ç›¸åº”çš„ä¿¡æ¯ï¼Œä½†æ˜¯ä½¿ç”¨é—¨é¢æ¨¡å¼åï¼Œåªéœ€è¦è°ƒç”¨ä¸€æ¬¡æ–¹æ³•ï¼Œç„¶åæ”¹æ–¹æ³•å»æ“ä½œå„ä¸ªç”Ÿæˆæ–¹æ³•ï¼Œå†ç»Ÿä¸€å°è£…è¿”å›ï¼Œ<code>å°±æ˜¯åœ¨æœåŠ¡å™¨ç«¯ï¼Œæä¾›ä¸€ä¸ªå¯¹å¤–çš„æ–¹æ³•ï¼Œæ”¹æ–¹æ³•å»ç»Ÿä¸€è°ƒç”¨ç”Ÿæˆçš„æ–¹æ³•ï¼Œå°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œä¸éœ€è¦å®¢æˆ·ç«¯ä¸€ä¸€è°ƒç”¨ï¼Œå®¢æˆ·ç«¯åªéœ€è¦è°ƒç”¨ä¸€æ¬¡</code></strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.toolkit.CollectionUtils;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.core.builder.FrontendCodeBuilder;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.core.schema.SchemaException;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.core.schema.TableSchema;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.core.schema.TableSchema.Field;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.core.builder.DataBuilder;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.core.builder.JavaCodeBuilder;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.core.builder.JsonBuilder;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.core.builder.SqlBuilder;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.core.model.vo.GenerateVO;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Optional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é›†ä¸­æ•°æ®ç”Ÿæˆå™¨ï¼Œå°†å¤šç§ç”Ÿæˆæ–¹æ³•å…¨éƒ¨é›†æˆåœ¨è¯¥æ–¹æ³•ä¸­ï¼Œè¿›è¡Œç»Ÿä¸€è°ƒç”¨ï¼Œç»Ÿä¸€è¿”å›</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * é—¨é¢æ¨¡å¼ï¼Œç»Ÿä¸€ç”Ÿæˆ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GeneratorFacade</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”Ÿæˆæ‰€æœ‰å†…å®¹</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> tableSchema</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> GenerateVO <span class="title function_">generateAll</span><span class="params">(TableSchema tableSchema)</span> &#123;</span><br><span class="line">        <span class="comment">// æ ¡éªŒ</span></span><br><span class="line">        validSchema(tableSchema);</span><br><span class="line">        <span class="type">SqlBuilder</span> <span class="variable">sqlBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlBuilder</span>();</span><br><span class="line">        <span class="comment">// æ„é€ å»ºè¡¨ SQL</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">createSql</span> <span class="operator">=</span> sqlBuilder.buildCreateTableSql(tableSchema);</span><br><span class="line">        <span class="type">int</span> <span class="variable">mockNum</span> <span class="operator">=</span> tableSchema.getMockNum();</span><br><span class="line">        <span class="comment">// ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®</span></span><br><span class="line">        List&lt;Map&lt;String, Object&gt;&gt; dataList = DataBuilder.generateData(tableSchema, mockNum);</span><br><span class="line">        <span class="comment">// ç”Ÿæˆæ’å…¥ SQL</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">insertSql</span> <span class="operator">=</span> sqlBuilder.buildInsertSql(tableSchema, dataList);</span><br><span class="line">        <span class="comment">// ç”Ÿæˆæ•°æ® json</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">dataJson</span> <span class="operator">=</span> JsonBuilder.buildJson(dataList);</span><br><span class="line">        <span class="comment">// ç”Ÿæˆ java å®ä½“ä»£ç </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">javaEntityCode</span> <span class="operator">=</span> JavaCodeBuilder.buildJavaEntityCode(tableSchema);</span><br><span class="line">        <span class="comment">// ç”Ÿæˆ java å¯¹è±¡ä»£ç </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">javaObjectCode</span> <span class="operator">=</span> JavaCodeBuilder.buildJavaObjectCode(tableSchema, dataList);</span><br><span class="line">        <span class="comment">// ç”Ÿæˆ typescript ç±»å‹ä»£ç </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">typescriptTypeCode</span> <span class="operator">=</span> FrontendCodeBuilder.buildTypeScriptTypeCode(tableSchema);</span><br><span class="line">        <span class="comment">// å°è£…è¿”å›</span></span><br><span class="line">        <span class="type">GenerateVO</span> <span class="variable">generateVO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GenerateVO</span>();</span><br><span class="line">        generateVO.setTableSchema(tableSchema);</span><br><span class="line">        generateVO.setCreateSql(createSql);</span><br><span class="line">        generateVO.setDataList(dataList);</span><br><span class="line">        generateVO.setInsertSql(insertSql);</span><br><span class="line">        generateVO.setDataJson(dataJson);</span><br><span class="line">        generateVO.setJavaEntityCode(javaEntityCode);</span><br><span class="line">        generateVO.setJavaObjectCode(javaObjectCode);</span><br><span class="line">        generateVO.setTypescriptTypeCode(typescriptTypeCode);</span><br><span class="line">        <span class="keyword">return</span> generateVO;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * éªŒè¯ schema</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> tableSchema è¡¨æ¦‚è¦</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">validSchema</span><span class="params">(TableSchema tableSchema)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (tableSchema == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SchemaException</span>(<span class="string">&quot;æ•°æ®ä¸ºç©º&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">String</span> <span class="variable">tableName</span> <span class="operator">=</span> tableSchema.getTableName();</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isBlank(tableName)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SchemaException</span>(<span class="string">&quot;è¡¨åä¸èƒ½ä¸ºç©º&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">mockNum</span> <span class="operator">=</span> tableSchema.getMockNum();</span><br><span class="line">        <span class="comment">// é»˜è®¤ç”Ÿæˆ 20 æ¡</span></span><br><span class="line">        <span class="keyword">if</span> (tableSchema.getMockNum() == <span class="literal">null</span>) &#123;</span><br><span class="line">            tableSchema.setMockNum(<span class="number">20</span>);</span><br><span class="line">            mockNum = <span class="number">20</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (mockNum &gt; <span class="number">100</span> || mockNum &lt; <span class="number">10</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SchemaException</span>(<span class="string">&quot;ç”Ÿæˆæ¡æ•°è®¾ç½®é”™è¯¯&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;Field&gt; fieldList = tableSchema.getFieldList();</span><br><span class="line">        <span class="keyword">if</span> (CollectionUtils.isEmpty(fieldList)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SchemaException</span>(<span class="string">&quot;å­—æ®µåˆ—è¡¨ä¸èƒ½ä¸ºç©º&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (Field field : fieldList) &#123;</span><br><span class="line">            validField(field);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¡éªŒå­—æ®µ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">validField</span><span class="params">(Field field)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">fieldName</span> <span class="operator">=</span> field.getFieldName();</span><br><span class="line">        <span class="type">String</span> <span class="variable">fieldType</span> <span class="operator">=</span> field.getFieldType();</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isBlank(fieldName)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SchemaException</span>(<span class="string">&quot;å­—æ®µåä¸èƒ½ä¸ºç©º&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isBlank(fieldType)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SchemaException</span>(<span class="string">&quot;å­—æ®µç±»å‹ä¸èƒ½ä¸ºç©º&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">ä»£ç ç”Ÿæˆå™¨é¡¹ç›®è§£è¯»</summary>
    
    
    
    <category term="Java" scheme="https://www.naste.top:1024/categories/Java/"/>
    
    
    <category term="Java" scheme="https://www.naste.top:1024/tags/Java/"/>
    
    <category term="SpringBoot" scheme="https://www.naste.top:1024/tags/SpringBoot/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨autoCommitå¼€æºé¡¹ç›®å®ç°ä»»æ„æ—¶é—´èŒƒå›´è‡ªåŠ¨æäº¤commitè®©GitHubè´¡çŒ®å›¾å…¨ç»¿</title>
    <link href="https://www.naste.top:1024/posts/3711495662.html"/>
    <id>https://www.naste.top:1024/posts/3711495662.html</id>
    <published>2023-03-15T09:09:59.000Z</published>
    <updated>2023-04-26T01:20:36.888Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h1><p>[TOC]</p><h1 id="ä¸‹è½½æ’ä»¶"><a href="#ä¸‹è½½æ’ä»¶" class="headerlink" title="ä¸‹è½½æ’ä»¶"></a>ä¸‹è½½æ’ä»¶</h1><blockquote><p><strong>ä¸‹è½½VSCodeï¼Œä¸‹è½½<code>Auto Commit</code>æ’ä»¶</strong></p></blockquote><p><strong><a href="https://github.com/OBKoro1/autoCommit">å®˜æ–¹æ–‡æ¡£ï¼šhttps://github.com/OBKoro1/autoCommit</a></strong></p><p><img src="https://www.naste.top:9000/images/image-20230315172021038.png" alt="image-20230315172021038"></p><p><img src="https://www.naste.top:9000/images/image-20230315172034007.png" alt="image-20230315172034007"></p><p><img src="https://www.naste.top:9000/images/image-20230315172110456.png" alt="image-20230315172110456"></p><p><img src="https://www.naste.top:9000/images/image-20230315172227523.png" alt="image-20230315172227523"></p>]]></content>
    
    
    <summary type="html">ä½¿ç”¨autoCommitå¼€æºé¡¹ç›®å®ç°ä»»æ„æ—¶é—´èŒƒå›´è‡ªåŠ¨æäº¤commitè®©GitHubè´¡çŒ®å›¾å…¨ç»¿</summary>
    
    
    
    <category term="Git" scheme="https://www.naste.top:1024/categories/Git/"/>
    
    
    <category term="Git" scheme="https://www.naste.top:1024/tags/Git/"/>
    
  </entry>
  
</feed>
