<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>XiaoFeiğŸ¥</title>
  
  
  <link href="https://www.naste.top:1024/atom.xml" rel="self"/>
  
  <link href="https://www.naste.top:1024/"/>
  <updated>2023-10-12T15:20:41.010Z</updated>
  <id>https://www.naste.top:1024/</id>
  
  <author>
    <name>XiaoFeiğŸ¥</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>SpringBootä¸­æ•´åˆRedissonå®ç°åˆ†å¸ƒå¼é”</title>
    <link href="https://www.naste.top:1024/posts/1828688964.html"/>
    <id>https://www.naste.top:1024/posts/1828688964.html</id>
    <published>2023-10-12T08:30:21.000Z</published>
    <updated>2023-10-12T15:20:41.010Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h1><p>[TOC]</p><h1 id="å®˜æ–¹æ–‡æ¡£"><a href="#å®˜æ–¹æ–‡æ¡£" class="headerlink" title="å®˜æ–¹æ–‡æ¡£"></a>å®˜æ–¹æ–‡æ¡£</h1><p><a href="https://github.com/redisson/redisson">https://github.com/redisson/redisson</a></p><p><a href="https://github.com/redisson/redisson/wiki">https://github.com/redisson/redisson/wiki</a></p><p><img src="https://www.naste.top:9000/images/image-20231012164004815.png" alt="image-20231012164004815"></p><h1 id="Redissonå„é”"><a href="#Redissonå„é”" class="headerlink" title="Redissonå„é”"></a>Redissonå„é”</h1><p><a href="https://github.com/redisson/redisson/wiki/8.-%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E5%92%8C%E5%90%8C%E6%AD%A5%E5%99%A8">å®˜æ–¹æ–‡æ¡£ï¼šhttps://github.com/redisson/redisson/wiki/8.-%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E5%92%8C%E5%90%8C%E6%AD%A5%E5%99%A8</a></p><ul><li>å¯é‡å…¥é”ï¼ˆReentrant Lockï¼‰</li><li>å…¬å¹³é”ï¼ˆFair Lockï¼‰</li><li>è”é”ï¼ˆMultiLockï¼‰</li><li>çº¢é”ï¼ˆRedLockï¼‰</li><li><p>è¯»å†™é”ï¼ˆReadWriteLockï¼‰</p><ul><li>è¯»å†™é”ä¿è¯è¯»ä¸€å®šèƒ½è¯»åˆ°æœ€æ–°æ•°æ®ã€‚ä¿®æ”¹æœŸé—´ï¼Œå†™é”å¼ä¸€ä¸ªæ’ä»–é”ï¼ˆäº’æ–¥é”ï¼‰ã€‚è¯»é”æ˜¯ä¸€ä¸ªå…±äº«é”ã€‚<ul><li>è¯» + è¯»ï¼šç›¸å½“äºæ— é”ï¼Œå¹¶å‘è¯»</li><li>å†™ + è¯»ï¼šé˜»å¡æ–¹å¼</li><li>å†™ + å†™ï¼šæœ‰è¯»é”ï¼Œå†™ä¹Ÿéœ€è¦ç­‰å¾…</li><li>è¯» + å†™ï¼šæœ‰è¯»é”ï¼Œå†™ä¹Ÿéœ€è¦ç­‰å¾…</li></ul></li></ul></li><li><p>ä¿¡å·é‡ï¼ˆSemaphoreï¼‰</p></li><li>å¯è¿‡æœŸæ€§ä¿¡å·é‡ï¼ˆPermitExpirableSemaphoreï¼‰</li><li>é—­é”ï¼ˆCountDownLatchï¼‰<ul><li>ä¸€ä¸ªé”å†…ï¼Œå¿…é¡»ç­‰å¾…æ‰€æœ‰ä¸šåŠ¡éƒ½å®Œæˆï¼Œæ‰èƒ½é‡Šæ”¾é”</li></ul></li></ul><h1 id="Redissonä¼˜ç¼ºç‚¹"><a href="#Redissonä¼˜ç¼ºç‚¹" class="headerlink" title="Redissonä¼˜ç¼ºç‚¹"></a>Redissonä¼˜ç¼ºç‚¹</h1><ol><li><p>é˜»å¡å¼ç­‰å¾…ï¼Œé»˜è®¤é”çš„æ—¶é—´éƒ½æ˜¯30s</p></li><li><p>åŠ é”çš„ä¸šåŠ¡åªè¦è¿è¡Œå®Œæˆï¼Œå°±ä¸ä¼šç»™å½“å‰é”ç»­æœŸï¼Œå³ä½¿ä¸æ‰‹åŠ¨è§£é”ï¼Œé”é»˜è®¤åœ¨30sä»¥åè‡ªåŠ¨åˆ é™¤</p></li><li><p>é”çš„è‡ªåŠ¨ç»­æœŸï¼Œå¦‚æœä¸šåŠ¡æ—¶é—´è¶…é•¿ï¼Œå¦‚æœåœ¨æœŸé—´é”è¿‡æœŸäº†ï¼Œä¼šè‡ªåŠ¨ç»™é”ä¸Šæ–°çš„30sï¼Œä¸ç”¨æ‹…å¿ƒä¸šåŠ¡æ—¶é—´é•¿ï¼Œé”è‡ªåŠ¨è¿‡æœŸè¢«åˆ é™¤</p><ul><li><p>å¦‚æœè®¾ç½®äº†é”çš„è¿‡æœŸæ—¶é—´ï¼Œè¿‡æœŸåä¸ä¼šè‡ªåŠ¨ç»­æœŸï¼Œä¹Ÿä¸ä¼šè‡ªåŠ¨ç»­æœŸ</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1ã€è·å–åŒä¸€æŠŠé”ï¼Œåªè¦é”çš„åå­—ä¸€æ ·ï¼Œå°±æ˜¯åŒä¸€æŠŠé”ã€è¿™é‡Œä½¿ç”¨å¯é‡å…¥é”ä½œä¸ºç¤ºä¾‹ï¼Œå…¶ä»–é”åŒç†ã€‘</span></span><br><span class="line"><span class="type">RLock</span> <span class="variable">lock</span> <span class="operator">=</span> redissonClient.getLock(<span class="string">&quot;user-insert&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2ã€åŠ é”ï¼Œé˜»å¡å¼ç­‰å¾…</span></span><br><span class="line"><span class="comment">// å¦‚æœæŒ‡å®šäº†è¶…æ—¶æ—¶é—´ï¼Œé”è¿‡æœŸåä¸ä¼šè‡ªåŠ¨ç»­æœŸ</span></span><br><span class="line">lock.lock(<span class="number">5</span>, TimeUnit.SECONDS);</span><br></pre></td></tr></table></figure></li><li><p>å¦‚æœæ²¡æœ‰è®¾ç½®é”çš„è¿‡æœŸæ—¶é—´ï¼Œåªè¦å é”æˆåŠŸï¼Œå°±ä¼šå¯åŠ¨ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œæ¯éš”10séƒ½ä¼šè‡ªåŠ¨å†æ¬¡ç»­æœŸåˆ°30sã€30sæ—¶é—´å¼çœ‹é—¨ç‹—æ—¶é—´ã€‘</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1ã€è·å–åŒä¸€æŠŠé”ï¼Œåªè¦é”çš„åå­—ä¸€æ ·ï¼Œå°±æ˜¯åŒä¸€æŠŠé”ã€è¿™é‡Œä½¿ç”¨å¯é‡å…¥é”ä½œä¸ºç¤ºä¾‹ï¼Œå…¶ä»–é”åŒç†ã€‘</span></span><br><span class="line"><span class="type">RLock</span> <span class="variable">lock</span> <span class="operator">=</span> redissonClient.getLock(<span class="string">&quot;user-insert&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2ã€åŠ é”ï¼Œé˜»å¡å¼ç­‰å¾…</span></span><br><span class="line">lock.lock();</span><br></pre></td></tr></table></figure></li><li><p><strong>æ¨èä½¿ç”¨æŒ‡å®šè¿‡æœŸæ—¶é—´çš„æ–¹å¼åŠ é”</strong></p></li></ul></li></ol><h1 id="redisson"><a href="#redisson" class="headerlink" title="redisson"></a>redisson</h1><blockquote><p><strong>è¯¥éƒ¨åˆ†æ–‡æ¡£æ˜¯æœªä½¿ç”¨<code>redisson-spring-boot-starter</code>ï¼Œç›´æ¥è¯•ç”¨çš„<code>redisson</code>è¿›è¡Œæ“ä½œ</strong></p></blockquote><h2 id="ä¾èµ–"><a href="#ä¾èµ–" class="headerlink" title="ä¾èµ–"></a>ä¾èµ–</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.redisson<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>redisson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.23.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="é…ç½®ç±»"><a href="#é…ç½®ç±»" class="headerlink" title="é…ç½®ç±»"></a>é…ç½®ç±»</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.redisson.Redisson;</span><br><span class="line"><span class="keyword">import</span> org.redisson.api.RedissonClient;</span><br><span class="line"><span class="keyword">import</span> org.redisson.config.Config;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedissonConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰€æœ‰å¯¹redisçš„è¯•ç”¨éƒ½æ˜¯é€šè¿‡RedissonClientå¯¹è±¡</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean(destroyMethod = &quot;shutdown&quot;)</span></span><br><span class="line">    RedissonClient <span class="title function_">redisson</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">Config</span> <span class="variable">config</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Config</span>();</span><br><span class="line">        config.useSingleServer().setAddress(<span class="string">&quot;redis://127.0.0.1:6379&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> Redisson.create(config);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¯é‡å…¥é”ä½¿ç”¨"><a href="#å¯é‡å…¥é”ä½¿ç”¨" class="headerlink" title="å¯é‡å…¥é”ä½¿ç”¨"></a>å¯é‡å…¥é”ä½¿ç”¨</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;UserMapper, UserEntity&gt; <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">add</span><span class="params">(UserEntity userEntity)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">isSuccess</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1ã€è·å–åŒä¸€æŠŠé”ï¼Œåªè¦é”çš„åå­—ä¸€æ ·ï¼Œå°±æ˜¯åŒä¸€æŠŠé”</span></span><br><span class="line">        <span class="type">RLock</span> <span class="variable">lock</span> <span class="operator">=</span> redissonClient.getLock(<span class="string">&quot;user-insert&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2ã€åŠ é”ï¼Œé˜»å¡å¼ç­‰å¾…</span></span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">UserEntity</span> <span class="variable">result</span> <span class="operator">=</span> <span class="built_in">this</span>.baseMapper.selectOne(<span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;UserEntity&gt;().eq(userEntity.getNickname() != <span class="literal">null</span>, UserEntity::getNickname, userEntity.getNickname()));</span><br><span class="line">            Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">            <span class="keyword">if</span> (result != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(userEntity.getNickname() + <span class="string">&quot;å·²ç»æ’å…¥&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            isSuccess = <span class="built_in">this</span>.save(userEntity);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// 3ã€è§£é”</span></span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> isSuccess;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è¯»å†™é”ä½¿ç”¨"><a href="#è¯»å†™é”ä½¿ç”¨" class="headerlink" title="è¯»å†™é”ä½¿ç”¨"></a>è¯»å†™é”ä½¿ç”¨</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å†™é”</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">writLock</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="type">RReadWriteLock</span> <span class="variable">readWriteLock</span> <span class="operator">=</span> redissonClient.getReadWriteLock(<span class="string">&quot;anyRWLock&quot;</span>);</span><br><span class="line">    <span class="comment">// è·å–å†™é”</span></span><br><span class="line">    <span class="type">RLock</span> <span class="variable">rLock</span> <span class="operator">=</span> readWriteLock.writeLock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// æ·»åŠ å†™é”</span></span><br><span class="line">        rLock.lock();</span><br><span class="line">        </span><br><span class="line">        redisUtils.deleteObject(<span class="string">&quot;readWriteLock&quot;</span>);</span><br><span class="line">        redisUtils.setCacheObject(<span class="string">&quot;readWriteLock&quot;</span>, IdUtil.simpleUUID());</span><br><span class="line">        Thread.sleep(<span class="number">15000</span>);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        rLock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¯»é”</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">readLock</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="type">RReadWriteLock</span> <span class="variable">readWriteLock</span> <span class="operator">=</span> redissonClient.getReadWriteLock(<span class="string">&quot;anyRWLock&quot;</span>);</span><br><span class="line">    <span class="comment">// è·å–è¯»é”</span></span><br><span class="line">    <span class="type">RLock</span> <span class="variable">rLock</span> <span class="operator">=</span> readWriteLock.readLock();</span><br><span class="line">    <span class="comment">// æ·»åŠ è¯»é”</span></span><br><span class="line">    rLock.lock();</span><br><span class="line">    System.out.println(<span class="string">&quot;è¯»å†™é”è·å–å€¼ï¼š&quot;</span> + redisUtils.getCacheObject(<span class="string">&quot;readWriteLock&quot;</span>).toString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">writLock</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    userService.writLock();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">readLock</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    userService.readLock();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é—­é”ä½¿ç”¨"><a href="#é—­é”ä½¿ç”¨" class="headerlink" title="é—­é”ä½¿ç”¨"></a>é—­é”ä½¿ç”¨</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é—­é”æµ‹è¯•</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">countDownLatchTest</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="type">RCountDownLatch</span> <span class="variable">latch</span> <span class="operator">=</span> redissonClient.getCountDownLatch(<span class="string">&quot;anyCountDownLatch&quot;</span>);</span><br><span class="line">    <span class="comment">// è®¾ç½®å¤šå°‘ä¸ªä¸šåŠ¡å®Œæˆåï¼Œå°±å¯ä»¥è§£é”</span></span><br><span class="line">    latch.trySetCount(<span class="number">5</span>);</span><br><span class="line">    <span class="comment">// ç­‰å¾…</span></span><br><span class="line">    latch.await();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é—­é”å¤„ç†</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">countDownLatchDown</span><span class="params">(<span class="type">int</span> i)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="type">RCountDownLatch</span> <span class="variable">latch</span> <span class="operator">=</span> redissonClient.getCountDownLatch(<span class="string">&quot;anyCountDownLatch&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; i; j++) &#123;</span><br><span class="line">        System.out.println(j);</span><br><span class="line">        <span class="comment">// æ¯æ‰§è¡Œä¸€æ¬¡ç›¸å½“äºæ‰§è¡Œä¸€æ¬¡ä¸šåŠ¡ï¼Œé—­é”æ¬¡æ•°å°±ä¼šå‡å°‘ä¸€æ¬¡ï¼Œ ç­‰è¾¾åˆ°äº”æ¬¡æ—¶ï¼Œé—­é”å°±ä¼šè§£é”äº†ï¼Œç›¸å½“äºæ•´ä¸ªä¸šåŠ¡å®Œæˆ</span></span><br><span class="line">        latch.countDown();</span><br><span class="line">        </span><br><span class="line">        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    userService.countDownLatchTest();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">countDownLatchDown</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    userService.countDownLatchDown(<span class="number">5</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä¿¡å·é‡ä½¿ç”¨"><a href="#ä¿¡å·é‡ä½¿ç”¨" class="headerlink" title="ä¿¡å·é‡ä½¿ç”¨"></a>ä¿¡å·é‡ä½¿ç”¨</h2><ul><li>è½¦åº“åœè½¦ä½</li><li>åˆ†å¸ƒå¼é™æµ</li><li>â€¦â€¦</li></ul>]]></content>
    
    
    <summary type="html">SpringBootä¸­æ•´åˆRedissonå®ç°åˆ†å¸ƒå¼é”</summary>
    
    
    
    <category term="Java" scheme="https://www.naste.top:1024/categories/Java/"/>
    
    
    <category term="Java" scheme="https://www.naste.top:1024/tags/Java/"/>
    
    <category term="SpringBoot" scheme="https://www.naste.top:1024/tags/SpringBoot/"/>
    
    <category term="Redisson" scheme="https://www.naste.top:1024/tags/Redisson/"/>
    
  </entry>
  
  <entry>
    <title>SpringBooté›†æˆç¬¬ä¸‰æ–¹éªŒè¯ç åŠŸèƒ½</title>
    <link href="https://www.naste.top:1024/posts/2832085968.html"/>
    <id>https://www.naste.top:1024/posts/2832085968.html</id>
    <published>2023-09-26T14:05:29.000Z</published>
    <updated>2023-09-26T15:45:33.275Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h1><p>[TOC]</p><h1 id="kaptcha"><a href="#kaptcha" class="headerlink" title="kaptcha"></a>kaptcha</h1><h2 id="ä¾èµ–"><a href="#ä¾èµ–" class="headerlink" title="ä¾èµ–"></a>ä¾èµ–</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- éªŒè¯ç  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>pro.fessional<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>kaptcha<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="é…ç½®ç±»"><a href="#é…ç½®ç±»" class="headerlink" title="é…ç½®ç±»"></a>é…ç½®ç±»</h2><h3 id="è‡ªå®šä¹‰å±æ€§é…ç½®ç±»"><a href="#è‡ªå®šä¹‰å±æ€§é…ç½®ç±»" class="headerlink" title="è‡ªå®šä¹‰å±æ€§é…ç½®ç±»"></a>è‡ªå®šä¹‰å±æ€§é…ç½®ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç³»ç»Ÿè‡ªå®šä¹‰é…ç½®ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;customer&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomerProperties</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * éªŒè¯ç ç±»å‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String captchaType;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">customer:</span></span><br><span class="line">  <span class="comment"># éªŒè¯ç ç±»å‹ math æ•°å­—è®¡ç®— char å­—ç¬¦éªŒè¯</span></span><br><span class="line">  <span class="attr">captchaType:</span> <span class="string">math</span></span><br></pre></td></tr></table></figure><h3 id="éªŒè¯ç æ–‡æœ¬ç”Ÿæˆå™¨"><a href="#éªŒè¯ç æ–‡æœ¬ç”Ÿæˆå™¨" class="headerlink" title="éªŒè¯ç æ–‡æœ¬ç”Ÿæˆå™¨"></a>éªŒè¯ç æ–‡æœ¬ç”Ÿæˆå™¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.google.code.kaptcha.text.impl.DefaultTextCreator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * éªŒè¯ç æ–‡æœ¬ç”Ÿæˆå™¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">KaptchaTextCreator</span> <span class="keyword">extends</span> <span class="title class_">DefaultTextCreator</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String[] CNUMBERS = <span class="string">&quot;0,1,2,3,4,5,6,7,8,9,10&quot;</span>.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getText</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">Random</span> <span class="variable">random</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">        <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> random.nextInt(<span class="number">10</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">y</span> <span class="operator">=</span> random.nextInt(<span class="number">10</span>);</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">suChinese</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="type">int</span> <span class="variable">randomoperands</span> <span class="operator">=</span> random.nextInt(<span class="number">3</span>);</span><br><span class="line">        <span class="keyword">if</span> (randomoperands == <span class="number">0</span>) &#123;</span><br><span class="line">            result = x * y;</span><br><span class="line">            suChinese.append(CNUMBERS[x]);</span><br><span class="line">            suChinese.append(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">            suChinese.append(CNUMBERS[y]);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (randomoperands == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> ((x != <span class="number">0</span>) &amp;&amp; y % x == <span class="number">0</span>) &#123;</span><br><span class="line">                result = y / x;</span><br><span class="line">                suChinese.append(CNUMBERS[y]);</span><br><span class="line">                suChinese.append(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">                suChinese.append(CNUMBERS[x]);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                result = x + y;</span><br><span class="line">                suChinese.append(CNUMBERS[x]);</span><br><span class="line">                suChinese.append(<span class="string">&quot;+&quot;</span>);</span><br><span class="line">                suChinese.append(CNUMBERS[y]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (x &gt;= y) &#123;</span><br><span class="line">                result = x - y;</span><br><span class="line">                suChinese.append(CNUMBERS[x]);</span><br><span class="line">                suChinese.append(<span class="string">&quot;-&quot;</span>);</span><br><span class="line">                suChinese.append(CNUMBERS[y]);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                result = y - x;</span><br><span class="line">                suChinese.append(CNUMBERS[y]);</span><br><span class="line">                suChinese.append(<span class="string">&quot;-&quot;</span>);</span><br><span class="line">                suChinese.append(CNUMBERS[x]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        suChinese.append(<span class="string">&quot;=?@&quot;</span>).append(result);</span><br><span class="line">        <span class="keyword">return</span> suChinese.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="éªŒè¯ç é…ç½®ç±»"><a href="#éªŒè¯ç é…ç½®ç±»" class="headerlink" title="éªŒè¯ç é…ç½®ç±»"></a>éªŒè¯ç é…ç½®ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaofei.xiaofei.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.google.code.kaptcha.impl.DefaultKaptcha;</span><br><span class="line"><span class="keyword">import</span> com.google.code.kaptcha.util.Config;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> com.google.code.kaptcha.Constants.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * éªŒè¯ç é…ç½®ç±»</span></span><br><span class="line"><span class="comment"> * ClassName: CaptchaConfig</span></span><br><span class="line"><span class="comment"> * Package: com.xiaofei.xiaofei.config</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: XiaoFei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2023/9/26 21:50</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Email</span>: 1903078434@qq.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span>: 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CaptchaConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(name = &quot;captchaProducer&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DefaultKaptcha <span class="title function_">getKaptchaBean</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">DefaultKaptcha</span> <span class="variable">defaultKaptcha</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultKaptcha</span>();</span><br><span class="line">        <span class="type">Properties</span> <span class="variable">properties</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">        <span class="comment">// æ˜¯å¦æœ‰è¾¹æ¡† é»˜è®¤ä¸ºtrue æˆ‘ä»¬å¯ä»¥è‡ªå·±è®¾ç½®yesï¼Œno</span></span><br><span class="line">        properties.setProperty(KAPTCHA_BORDER, <span class="string">&quot;yes&quot;</span>);</span><br><span class="line">        <span class="comment">// éªŒè¯ç æ–‡æœ¬å­—ç¬¦é¢œè‰² é»˜è®¤ä¸ºColor.BLACK</span></span><br><span class="line">        properties.setProperty(KAPTCHA_TEXTPRODUCER_FONT_COLOR, <span class="string">&quot;black&quot;</span>);</span><br><span class="line">        <span class="comment">// éªŒè¯ç å›¾ç‰‡å®½åº¦ é»˜è®¤ä¸º200</span></span><br><span class="line">        properties.setProperty(KAPTCHA_IMAGE_WIDTH, <span class="string">&quot;160&quot;</span>);</span><br><span class="line">        <span class="comment">// éªŒè¯ç å›¾ç‰‡é«˜åº¦ é»˜è®¤ä¸º50</span></span><br><span class="line">        properties.setProperty(KAPTCHA_IMAGE_HEIGHT, <span class="string">&quot;60&quot;</span>);</span><br><span class="line">        <span class="comment">// éªŒè¯ç æ–‡æœ¬å­—ç¬¦å¤§å° é»˜è®¤ä¸º40</span></span><br><span class="line">        properties.setProperty(KAPTCHA_TEXTPRODUCER_FONT_SIZE, <span class="string">&quot;38&quot;</span>);</span><br><span class="line">        <span class="comment">// KAPTCHA_SESSION_KEY</span></span><br><span class="line">        properties.setProperty(KAPTCHA_SESSION_CONFIG_KEY, <span class="string">&quot;kaptchaCode&quot;</span>);</span><br><span class="line">        <span class="comment">// éªŒè¯ç æ–‡æœ¬å­—ç¬¦é•¿åº¦ é»˜è®¤ä¸º5</span></span><br><span class="line">        properties.setProperty(KAPTCHA_TEXTPRODUCER_CHAR_LENGTH, <span class="string">&quot;4&quot;</span>);</span><br><span class="line">        <span class="comment">// éªŒè¯ç æ–‡æœ¬å­—ä½“æ ·å¼ é»˜è®¤ä¸ºnew Font(&quot;Arial&quot;, 1, fontSize), new Font(&quot;Courier&quot;, 1, fontSize)</span></span><br><span class="line">        properties.setProperty(KAPTCHA_TEXTPRODUCER_FONT_NAMES, <span class="string">&quot;Arial,Courier&quot;</span>);</span><br><span class="line">        <span class="comment">// å›¾ç‰‡æ ·å¼ æ°´çº¹com.google.code.kaptcha.impl.WaterRipple é±¼çœ¼com.google.code.kaptcha.impl.FishEyeGimpy é˜´å½±com.google.code.kaptcha.impl.ShadowGimpy</span></span><br><span class="line">        properties.setProperty(KAPTCHA_OBSCURIFICATOR_IMPL, <span class="string">&quot;com.google.code.kaptcha.impl.ShadowGimpy&quot;</span>);</span><br><span class="line">        <span class="type">Config</span> <span class="variable">config</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Config</span>(properties);</span><br><span class="line">        defaultKaptcha.setConfig(config);</span><br><span class="line">        <span class="keyword">return</span> defaultKaptcha;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(name = &quot;captchaProducerMath&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DefaultKaptcha <span class="title function_">getKaptchaBeanMath</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">DefaultKaptcha</span> <span class="variable">defaultKaptcha</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultKaptcha</span>();</span><br><span class="line">        <span class="type">Properties</span> <span class="variable">properties</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">        <span class="comment">// æ˜¯å¦æœ‰è¾¹æ¡† é»˜è®¤ä¸ºtrue æˆ‘ä»¬å¯ä»¥è‡ªå·±è®¾ç½®yesï¼Œno</span></span><br><span class="line">        properties.setProperty(KAPTCHA_BORDER, <span class="string">&quot;yes&quot;</span>);</span><br><span class="line">        <span class="comment">// è¾¹æ¡†é¢œè‰² é»˜è®¤ä¸ºColor.BLACK</span></span><br><span class="line">        properties.setProperty(KAPTCHA_BORDER_COLOR, <span class="string">&quot;105,179,90&quot;</span>);</span><br><span class="line">        <span class="comment">// éªŒè¯ç æ–‡æœ¬å­—ç¬¦é¢œè‰² é»˜è®¤ä¸ºColor.BLACK</span></span><br><span class="line">        properties.setProperty(KAPTCHA_TEXTPRODUCER_FONT_COLOR, <span class="string">&quot;blue&quot;</span>);</span><br><span class="line">        <span class="comment">// éªŒè¯ç å›¾ç‰‡å®½åº¦ é»˜è®¤ä¸º200</span></span><br><span class="line">        properties.setProperty(KAPTCHA_IMAGE_WIDTH, <span class="string">&quot;160&quot;</span>);</span><br><span class="line">        <span class="comment">// éªŒè¯ç å›¾ç‰‡é«˜åº¦ é»˜è®¤ä¸º50</span></span><br><span class="line">        properties.setProperty(KAPTCHA_IMAGE_HEIGHT, <span class="string">&quot;60&quot;</span>);</span><br><span class="line">        <span class="comment">// éªŒè¯ç æ–‡æœ¬å­—ç¬¦å¤§å° é»˜è®¤ä¸º40</span></span><br><span class="line">        properties.setProperty(KAPTCHA_TEXTPRODUCER_FONT_SIZE, <span class="string">&quot;35&quot;</span>);</span><br><span class="line">        <span class="comment">// KAPTCHA_SESSION_KEY</span></span><br><span class="line">        properties.setProperty(KAPTCHA_SESSION_CONFIG_KEY, <span class="string">&quot;kaptchaCodeMath&quot;</span>);</span><br><span class="line">        <span class="comment">// éªŒè¯ç æ–‡æœ¬ç”Ÿæˆå™¨ã€é‡Œé¢é…ç½®çš„å€¼ä¸ºéªŒè¯ç æ–‡æœ¬ç”Ÿæˆå™¨çš„å…¨è·¯å¾„ï¼Œä¾‹å¦‚ï¼š&quot;com.xiaofei.config.KaptchaTextCreator&quot;ã€‘</span></span><br><span class="line">        properties.setProperty(KAPTCHA_TEXTPRODUCER_IMPL, é…ç½®çš„å€¼ï¼šéªŒè¯ç æ–‡æœ¬ç”Ÿæˆå™¨çš„å…¨è·¯å¾„);</span><br><span class="line">        <span class="comment">// éªŒè¯ç æ–‡æœ¬å­—ç¬¦é—´è· é»˜è®¤ä¸º2</span></span><br><span class="line">        properties.setProperty(KAPTCHA_TEXTPRODUCER_CHAR_SPACE, <span class="string">&quot;3&quot;</span>);</span><br><span class="line">        <span class="comment">// éªŒè¯ç æ–‡æœ¬å­—ç¬¦é•¿åº¦ é»˜è®¤ä¸º5</span></span><br><span class="line">        properties.setProperty(KAPTCHA_TEXTPRODUCER_CHAR_LENGTH, <span class="string">&quot;6&quot;</span>);</span><br><span class="line">        <span class="comment">// éªŒè¯ç æ–‡æœ¬å­—ä½“æ ·å¼ é»˜è®¤ä¸ºnew Font(&quot;Arial&quot;, 1, fontSize), new Font(&quot;Courier&quot;, 1, fontSize)</span></span><br><span class="line">        properties.setProperty(KAPTCHA_TEXTPRODUCER_FONT_NAMES, <span class="string">&quot;Arial,Courier&quot;</span>);</span><br><span class="line">        <span class="comment">// éªŒè¯ç å™ªç‚¹é¢œè‰² é»˜è®¤ä¸ºColor.BLACK</span></span><br><span class="line">        properties.setProperty(KAPTCHA_NOISE_COLOR, <span class="string">&quot;white&quot;</span>);</span><br><span class="line">        <span class="comment">// å¹²æ‰°å®ç°ç±»</span></span><br><span class="line">        properties.setProperty(KAPTCHA_NOISE_IMPL, <span class="string">&quot;com.google.code.kaptcha.impl.NoNoise&quot;</span>);</span><br><span class="line">        <span class="comment">// å›¾ç‰‡æ ·å¼ æ°´çº¹com.google.code.kaptcha.impl.WaterRipple é±¼çœ¼com.google.code.kaptcha.impl.FishEyeGimpy é˜´å½±com.google.code.kaptcha.impl.ShadowGimpy</span></span><br><span class="line">        properties.setProperty(KAPTCHA_OBSCURIFICATOR_IMPL, <span class="string">&quot;com.google.code.kaptcha.impl.ShadowGimpy&quot;</span>);</span><br><span class="line">        <span class="type">Config</span> <span class="variable">config</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Config</span>(properties);</span><br><span class="line">        defaultKaptcha.setConfig(config);</span><br><span class="line">        <span class="keyword">return</span> defaultKaptcha;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="rediså·¥å…·ç±»"><a href="#rediså·¥å…·ç±»" class="headerlink" title="rediså·¥å…·ç±»"></a>rediså·¥å…·ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.BoundSetOperations;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.HashOperations;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.ValueOperations;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * spring redis å·¥å…·ç±»</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@SuppressWarnings(value = &#123;&quot;unchecked&quot;, &quot;rawtypes&quot;&#125;)</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisUtils</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç¼“å­˜åŸºæœ¬çš„å¯¹è±¡ï¼ŒIntegerã€Stringã€å®ä½“ç±»ç­‰</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   ç¼“å­˜çš„é”®å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value ç¼“å­˜çš„å€¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="keyword">void</span> <span class="title function_">setCacheObject</span><span class="params">(<span class="keyword">final</span> String key, <span class="keyword">final</span> T value)</span> &#123;</span><br><span class="line">        redisTemplate.opsForValue().set(key, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç¼“å­˜åŸºæœ¬çš„å¯¹è±¡ï¼ŒIntegerã€Stringã€å®ä½“ç±»ç­‰</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key      ç¼“å­˜çš„é”®å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value    ç¼“å­˜çš„å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> timeout  æ—¶é—´</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> timeUnit æ—¶é—´é¢—ç²’åº¦</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="keyword">void</span> <span class="title function_">setCacheObject</span><span class="params">(<span class="keyword">final</span> String key, <span class="keyword">final</span> T value, <span class="keyword">final</span> Integer timeout, <span class="keyword">final</span> TimeUnit timeUnit)</span> &#123;</span><br><span class="line">        redisTemplate.opsForValue().set(key, value, timeout, timeUnit);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¾ç½®æœ‰æ•ˆæ—¶é—´</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key     Redisé”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> timeout è¶…æ—¶æ—¶é—´</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true=è®¾ç½®æˆåŠŸï¼›false=è®¾ç½®å¤±è´¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">expire</span><span class="params">(<span class="keyword">final</span> String key, <span class="keyword">final</span> <span class="type">long</span> timeout)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> expire(key, timeout, TimeUnit.SECONDS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¾ç½®æœ‰æ•ˆæ—¶é—´</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key     Redisé”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> timeout è¶…æ—¶æ—¶é—´</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> unit    æ—¶é—´å•ä½</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true=è®¾ç½®æˆåŠŸï¼›false=è®¾ç½®å¤±è´¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">expire</span><span class="params">(<span class="keyword">final</span> String key, <span class="keyword">final</span> <span class="type">long</span> timeout, <span class="keyword">final</span> TimeUnit unit)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.expire(key, timeout, unit);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–æœ‰æ•ˆæ—¶é—´</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key Redisé”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æœ‰æ•ˆæ—¶é—´</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getExpire</span><span class="params">(<span class="keyword">final</span> String key)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.getExpire(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ¤æ–­ keyæ˜¯å¦å­˜åœ¨</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true å­˜åœ¨ falseä¸å­˜åœ¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">hasKey</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.hasKey(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å¾—ç¼“å­˜çš„åŸºæœ¬å¯¹è±¡ã€‚</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key ç¼“å­˜é”®å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> ç¼“å­˜é”®å€¼å¯¹åº”çš„æ•°æ®</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; T <span class="title function_">getCacheObject</span><span class="params">(<span class="keyword">final</span> String key)</span> &#123;</span><br><span class="line">        ValueOperations&lt;String, T&gt; operation = redisTemplate.opsForValue();</span><br><span class="line">        <span class="keyword">return</span> operation.get(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ é™¤å•ä¸ªå¯¹è±¡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">deleteObject</span><span class="params">(<span class="keyword">final</span> String key)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.delete(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ é™¤é›†åˆå¯¹è±¡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">deleteObject</span><span class="params">(<span class="keyword">final</span> Collection collection)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.delete(collection) &gt; <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç¼“å­˜Listæ•°æ®</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key      ç¼“å­˜çš„é”®å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dataList å¾…ç¼“å­˜çš„Listæ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> ç¼“å­˜çš„å¯¹è±¡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="type">long</span> <span class="title function_">setCacheList</span><span class="params">(<span class="keyword">final</span> String key, <span class="keyword">final</span> List&lt;T&gt; dataList)</span> &#123;</span><br><span class="line">        <span class="type">Long</span> <span class="variable">count</span> <span class="operator">=</span> redisTemplate.opsForList().rightPushAll(key, dataList);</span><br><span class="line">        <span class="keyword">return</span> count == <span class="literal">null</span> ? <span class="number">0</span> : count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å¾—ç¼“å­˜çš„listå¯¹è±¡</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key ç¼“å­˜çš„é”®å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> ç¼“å­˜é”®å€¼å¯¹åº”çš„æ•°æ®</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; List&lt;T&gt; <span class="title function_">getCacheList</span><span class="params">(<span class="keyword">final</span> String key)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForList().range(key, <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç¼“å­˜Set</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key     ç¼“å­˜é”®å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dataSet ç¼“å­˜çš„æ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> ç¼“å­˜æ•°æ®çš„å¯¹è±¡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; BoundSetOperations&lt;String, T&gt; <span class="title function_">setCacheSet</span><span class="params">(<span class="keyword">final</span> String key, <span class="keyword">final</span> Set&lt;T&gt; dataSet)</span> &#123;</span><br><span class="line">        BoundSetOperations&lt;String, T&gt; setOperation = redisTemplate.boundSetOps(key);</span><br><span class="line">        Iterator&lt;T&gt; it = dataSet.iterator();</span><br><span class="line">        <span class="keyword">while</span> (it.hasNext()) &#123;</span><br><span class="line">            setOperation.add(it.next());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> setOperation;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å¾—ç¼“å­˜çš„set</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; Set&lt;T&gt; <span class="title function_">getCacheSet</span><span class="params">(<span class="keyword">final</span> String key)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForSet().members(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç¼“å­˜Map</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="keyword">void</span> <span class="title function_">setCacheMap</span><span class="params">(<span class="keyword">final</span> String key, <span class="keyword">final</span> Map&lt;String, T&gt; dataMap)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (dataMap != <span class="literal">null</span>) &#123;</span><br><span class="line">            redisTemplate.opsForHash().putAll(key, dataMap);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å¾—ç¼“å­˜çš„Map</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; Map&lt;String, T&gt; <span class="title function_">getCacheMap</span><span class="params">(<span class="keyword">final</span> String key)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHash().entries(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¾€Hashä¸­å­˜å…¥æ•°æ®</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   Redisé”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> hKey  Hashé”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value å€¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="keyword">void</span> <span class="title function_">setCacheMapValue</span><span class="params">(<span class="keyword">final</span> String key, <span class="keyword">final</span> String hKey, <span class="keyword">final</span> T value)</span> &#123;</span><br><span class="line">        redisTemplate.opsForHash().put(key, hKey, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–Hashä¸­çš„æ•°æ®</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key  Redisé”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> hKey Hashé”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Hashä¸­çš„å¯¹è±¡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; T <span class="title function_">getCacheMapValue</span><span class="params">(<span class="keyword">final</span> String key, <span class="keyword">final</span> String hKey)</span> &#123;</span><br><span class="line">        HashOperations&lt;String, String, T&gt; opsForHash = redisTemplate.opsForHash();</span><br><span class="line">        <span class="keyword">return</span> opsForHash.get(key, hKey);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–å¤šä¸ªHashä¸­çš„æ•°æ®</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   Redisé”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> hKeys Hashé”®é›†åˆ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Hashå¯¹è±¡é›†åˆ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; List&lt;T&gt; <span class="title function_">getMultiCacheMapValue</span><span class="params">(<span class="keyword">final</span> String key, <span class="keyword">final</span> Collection&lt;Object&gt; hKeys)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHash().multiGet(key, hKeys);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ é™¤Hashä¸­çš„æŸæ¡æ•°æ®</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key  Redisé”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> hKey Hashé”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æ˜¯å¦æˆåŠŸ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">deleteCacheMapValue</span><span class="params">(<span class="keyword">final</span> String key, <span class="keyword">final</span> String hKey)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHash().delete(key, hKey) &gt; <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å¾—ç¼“å­˜çš„åŸºæœ¬å¯¹è±¡åˆ—è¡¨</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pattern å­—ç¬¦ä¸²å‰ç¼€</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å¯¹è±¡åˆ—è¡¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Collection&lt;String&gt; <span class="title function_">keys</span><span class="params">(<span class="keyword">final</span> String pattern)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.keys(pattern);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å‚æ•°æ¥æ”¶å®ä½“ç±»"><a href="#å‚æ•°æ¥æ”¶å®ä½“ç±»" class="headerlink" title="å‚æ•°æ¥æ”¶å®ä½“ç±»"></a>å‚æ•°æ¥æ”¶å®ä½“ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.NotBlank;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”¨æˆ·ç™»å½•ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginInfoVO</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”¨æˆ·å</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;ç”¨æˆ·åä¸èƒ½ä¸ºç©º&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”¨æˆ·å¯†ç </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;å¯†ç ä¸èƒ½ä¸ºç©º&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * éªŒè¯ç </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;éªŒè¯ç ä¸èƒ½ä¸ºç©º&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String code;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å”¯ä¸€æ ‡è¯†</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;éªŒè¯ç ç”Ÿæˆæ—¶è¿”å›çš„å”¯ä¸€æ ‡è¯†ä¸èƒ½ä¸ºç©º&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String uuid;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¼‚å¸¸ç±»"><a href="#å¼‚å¸¸ç±»" class="headerlink" title="å¼‚å¸¸ç±»"></a>å¼‚å¸¸ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CaptchaException</span> <span class="keyword">extends</span> <span class="title class_">RuntimeException</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è‡ªå®šä¹‰å¼‚å¸¸çš„æ„é€ æ–¹æ³•</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CaptchaException</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserException</span> <span class="keyword">extends</span> <span class="title class_">RuntimeException</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è‡ªå®šä¹‰å¼‚å¸¸çš„æ„é€ æ–¹æ³•</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserException</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="éªŒè¯ç ç”Ÿæˆå…·ä½“å®ç°"><a href="#éªŒè¯ç ç”Ÿæˆå…·ä½“å®ç°" class="headerlink" title="éªŒè¯ç ç”Ÿæˆå…·ä½“å®ç°"></a>éªŒè¯ç ç”Ÿæˆå…·ä½“å®ç°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cn.hutool.core.codec.Base64;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.util.IdUtil;</span><br><span class="line"><span class="keyword">import</span> com.google.code.kaptcha.Producer;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.xiaofei.config.CustomerProperties;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.xiaofei.constant.RedisConstant;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.xiaofei.handler.CaptchaException;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.xiaofei.handler.UserException;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.xiaofei.utils.RedisUtils;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.xiaofei.utils.ResponseUtils;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.xiaofei.vo.LoginInfoVO;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.Api;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.FastByteArrayOutputStream;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> javax.imageio.ImageIO;</span><br><span class="line"><span class="keyword">import</span> javax.validation.Valid;</span><br><span class="line"><span class="keyword">import</span> java.awt.image.BufferedImage;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * éªŒè¯ç ç”Ÿæˆæ§åˆ¶å™¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Api(&quot;éªŒè¯ç æ ¡éªŒ&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CaptchaController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CustomerProperties customerProperties;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource(name = &quot;captchaProducer&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Producer captchaProducer;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource(name = &quot;captchaProducerMath&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Producer captchaProducerMath;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisUtils redisUtils;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”ŸæˆéªŒè¯ç </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/captchaImage&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseUtils <span class="title function_">getCode</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">ResponseUtils</span> <span class="variable">responseUtils</span> <span class="operator">=</span> ResponseUtils.success();</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">capStr</span> <span class="operator">=</span> <span class="literal">null</span>, code = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">BufferedImage</span> <span class="variable">image</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç”ŸæˆéªŒè¯ç </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">captchaType</span> <span class="operator">=</span> customerProperties.getCaptchaType();</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;math&quot;</span>.equals(captchaType)) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">capText</span> <span class="operator">=</span> captchaProducerMath.createText();</span><br><span class="line">            capStr = capText.substring(<span class="number">0</span>, capText.lastIndexOf(<span class="string">&quot;@&quot;</span>));</span><br><span class="line">            code = capText.substring(capText.lastIndexOf(<span class="string">&quot;@&quot;</span>) + <span class="number">1</span>);</span><br><span class="line">            image = captchaProducerMath.createImage(capStr);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;char&quot;</span>.equals(captchaType)) &#123;</span><br><span class="line">            capStr = code = captchaProducer.createText();</span><br><span class="line">            image = captchaProducer.createImage(capStr);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä¿å­˜éªŒè¯ç ä¿¡æ¯</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">uuid</span> <span class="operator">=</span> IdUtil.simpleUUID();</span><br><span class="line">        <span class="type">String</span> <span class="variable">verifyKey</span> <span class="operator">=</span> RedisConstant.CAPTCHA_CODE_KEY + uuid;</span><br><span class="line"></span><br><span class="line">        redisUtils.setCacheObject(verifyKey, code, RedisConstant.CAPTCHA_EXPIRATION, TimeUnit.MINUTES);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è½¬æ¢æµä¿¡æ¯å†™å‡º</span></span><br><span class="line">        <span class="type">FastByteArrayOutputStream</span> <span class="variable">os</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FastByteArrayOutputStream</span>();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ImageIO.write(image, <span class="string">&quot;jpg&quot;</span>, os);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            ResponseUtils.error(e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        responseUtils.put(<span class="string">&quot;uuid&quot;</span>, uuid);</span><br><span class="line">        responseUtils.put(<span class="string">&quot;img&quot;</span>, Base64.encode(os.toByteArray()));</span><br><span class="line">        <span class="keyword">return</span> responseUtils;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * éªŒè¯ç éªŒè¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/verify&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseUtils <span class="title function_">captchaVerify</span><span class="params">(<span class="meta">@Valid</span> <span class="meta">@RequestBody</span> LoginInfoVO loginInfoVO)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// éªŒè¯ç æ ¡éªŒ</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">captchaCacheKey</span> <span class="operator">=</span> RedisConstant.CAPTCHA_CODE_KEY + loginInfoVO.getUuid();</span><br><span class="line">        <span class="comment">// è·å–ç¼“å­˜ä¸­çš„éªŒè¯ç å€¼</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">captcha</span> <span class="operator">=</span> redisUtils.getCacheObject(captchaCacheKey);</span><br><span class="line">        <span class="comment">//redisUtils.deleteObject(verifyKey);</span></span><br><span class="line">        <span class="comment">// æ£€æŸ¥ç¼“å­˜æ˜¯å¦å¤±æ•ˆ</span></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isEmpty(captcha)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CaptchaException</span>(<span class="string">&quot;éªŒè¯ç å·²å¤±æ•ˆ&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æ£€æŸ¥è¾“å…¥çš„éªŒè¯ç å’Œç¼“å­˜çš„éªŒè¯ç æ˜¯å¦ä¸€è‡´</span></span><br><span class="line">        <span class="keyword">if</span> (!captcha.equalsIgnoreCase(loginInfoVO.getCode())) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CaptchaException</span>(<span class="string">&quot;éªŒè¯ç é”™è¯¯&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç”¨æˆ·åå¯†ç æ ¡éªŒ</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="string">&quot;admin&quot;</span>.equals(loginInfoVO.getUsername()) || !<span class="string">&quot;admin&quot;</span>.equals(loginInfoVO.getPassword())) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UserException</span>(<span class="string">&quot;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç”Ÿæˆtoken ï¼Œè¿™é‡Œå› ä¸ºæµ‹è¯•ï¼Œå°±ç®€å•ç”Ÿæˆä¸€ä¸ªå­—ç¬¦ä¸²ç»™å‰ç«¯è¿”å›ï¼Œæ¼”ç¤ºæµç¨‹</span></span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> IdUtil.fastUUID();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ResponseUtils.success().put(<span class="string">&quot;token&quot;</span>, token);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><p><img src="C:\Users\19030\AppData\Roaming\Typora\typora-user-images\image-20230926233950065.png" alt="image-20230926233950065"></p><p><img src="C:\Users\19030\AppData\Roaming\Typora\typora-user-images\image-20230926234018599.png" alt="image-20230926234018599"></p>]]></content>
    
    
    <summary type="html">SpringBooté›†æˆç¬¬ä¸‰æ–¹éªŒè¯ç åŠŸèƒ½</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>SpringBootä¸­åˆ¤æ–­æ–‡ä»¶å­—ç¬¦é›†</title>
    <link href="https://www.naste.top:1024/posts/2525108947.html"/>
    <id>https://www.naste.top:1024/posts/2525108947.html</id>
    <published>2023-09-24T13:36:39.000Z</published>
    <updated>2023-09-25T13:47:24.864Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h1><p>[TOC]</p><h1 id="ä¾èµ–"><a href="#ä¾èµ–" class="headerlink" title="ä¾èµ–"></a>ä¾èµ–</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.googlecode.juniversalchardet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>juniversalchardet<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="å·¥å…·ç±»"><a href="#å·¥å…·ç±»" class="headerlink" title="å·¥å…·ç±»"></a>å·¥å…·ç±»</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.mozilla.universalchardet.UniversalDetector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ–‡ä»¶ç¼–ç å·¥å…·ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileEncodingUtils</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ£€æµ‹æ–‡ä»¶ç¼–ç </span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æ–‡ä»¶ç¼–ç </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">detectFileEncoding</span><span class="params">(InputStream inputStream)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">UniversalDetector</span> <span class="variable">detector</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UniversalDetector</span>(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">byte</span>[] buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">        <span class="type">int</span> nread;</span><br><span class="line">        <span class="keyword">while</span> ((nread = inputStream.read(buffer)) &gt; <span class="number">0</span> &amp;&amp; !detector.isDone()) &#123;</span><br><span class="line">            detector.handleData(buffer, <span class="number">0</span>, nread);</span><br><span class="line">        &#125;</span><br><span class="line">        detector.dataEnd();</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">detectedCharset</span> <span class="operator">=</span> detector.getDetectedCharset();</span><br><span class="line">        <span class="keyword">if</span> (detectedCharset == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœæ£€æµ‹ä¸åˆ°ç¼–ç ï¼Œåˆ™ä½¿ç”¨é»˜è®¤ç¼–ç </span></span><br><span class="line">            detectedCharset = <span class="string">&quot;UTF-8&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        detector.reset();</span><br><span class="line">        <span class="keyword">return</span> detectedCharset;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">SpringBootä¸­åˆ¤æ–­æ–‡ä»¶å­—ç¬¦é›†</summary>
    
    
    
    <category term="Java" scheme="https://www.naste.top:1024/categories/Java/"/>
    
    
    <category term="Java" scheme="https://www.naste.top:1024/tags/Java/"/>
    
    <category term="SpringBoot" scheme="https://www.naste.top:1024/tags/SpringBoot/"/>
    
  </entry>
  
  <entry>
    <title>Javaä¸­ä½¿ç”¨WebSocket</title>
    <link href="https://www.naste.top:1024/posts/3435753282.html"/>
    <id>https://www.naste.top:1024/posts/3435753282.html</id>
    <published>2023-09-12T09:56:16.000Z</published>
    <updated>2023-10-12T04:30:47.444Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h1><p>[TOC]</p>]]></content>
    
    
    <summary type="html">Javaä¸­ä½¿ç”¨WebSocket</summary>
    
    
    
    <category term="Java" scheme="https://www.naste.top:1024/categories/Java/"/>
    
    
    <category term="Java" scheme="https://www.naste.top:1024/tags/Java/"/>
    
    <category term="SpringBoot" scheme="https://www.naste.top:1024/tags/SpringBoot/"/>
    
    <category term="WebSocket" scheme="https://www.naste.top:1024/tags/WebSocket/"/>
    
  </entry>
  
  <entry>
    <title>SpringBootå‰åç«¯åˆ†ç¦»é›†æˆSpringSecurity</title>
    <link href="https://www.naste.top:1024/posts/2824886599.html"/>
    <id>https://www.naste.top:1024/posts/2824886599.html</id>
    <published>2023-09-08T07:52:20.000Z</published>
    <updated>2023-09-08T10:46:51.680Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h1><p>[TOC]</p><p><img src="https://www.naste.top:9000/webp/20230908182843.webp" alt="20230908182843"></p><ul><li>è‡ªå®šä¹‰ç”¨æˆ·è®¤è¯é€»è¾‘ç±»ï¼Œå®ç°<code>implements UserDetailsService</code><ul><li>å½“ç”¨æˆ·ç™»å½•ï¼Œè¯·æ±‚æ”¾è¡Œçš„ç™»å½•åœ°å€ï¼Œå°†ä¼šè¢«è§¦å‘</li></ul></li><li>è®¤è¯å¤±è´¥å¤„ç†ç±»ï¼Œå®ç°<code>implements AuthenticationEntryPoint</code><ul><li>å½“è®¿é—®æ²¡æœ‰æƒé™ä¼šè§¦å‘</li></ul></li><li>ç™»å½•é€€å‡ºå¤„ç†ç±»ï¼Œå®ç°<code>implements LogoutSuccessHandler</code>ï¼š<ul><li>å½“ç”¨æˆ·è¯·æ±‚é…ç½®çš„ç™»å½•é€€å‡ºè¯·æ±‚æ—¶ï¼Œä¼šè§¦å‘</li></ul></li><li>tokenè®¤è¯è¿‡æ»¤å™¨ã€å¯é€‰ã€‘</li><li>è·¨åŸŸè¿‡æ»¤å™¨ã€å¯é€‰ã€‘</li><li>å…è®¸åŒ¿åè®¿é—®çš„åœ°å€ã€å¯é€‰ã€‘</li></ul><p>ThreadLocalï¼šé€šè¿‡æœ¬åœ°çº¿ç¨‹é”è·å–å½“å‰çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ä¿¡æ¯</p>]]></content>
    
    
    <summary type="html">SpringBootå‰åç«¯åˆ†ç¦»é›†æˆSpringSecurity</summary>
    
    
    
    <category term="Java" scheme="https://www.naste.top:1024/categories/Java/"/>
    
    
    <category term="Java" scheme="https://www.naste.top:1024/tags/Java/"/>
    
    <category term="SpringBoot" scheme="https://www.naste.top:1024/tags/SpringBoot/"/>
    
    <category term="SpringSecurity" scheme="https://www.naste.top:1024/tags/SpringSecurity/"/>
    
  </entry>
  
  <entry>
    <title>è™šæ‹Ÿæœºç½‘ç»œæ¨¡å¼</title>
    <link href="https://www.naste.top:1024/posts/644582412.html"/>
    <id>https://www.naste.top:1024/posts/644582412.html</id>
    <published>2023-08-20T11:42:18.000Z</published>
    <updated>2023-08-23T14:55:55.333Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h1><p>[TOC]</p><h1 id="ç½‘ç»œæ¨¡å¼"><a href="#ç½‘ç»œæ¨¡å¼" class="headerlink" title="ç½‘ç»œæ¨¡å¼"></a>ç½‘ç»œæ¨¡å¼</h1><ul><li>NAT</li><li>NATç½‘ç»œ</li><li>æ¡¥æ¥</li><li>å†…éƒ¨ç½‘ç»œ</li><li>ä»…ä¸»æœº</li></ul>]]></content>
    
    
    <summary type="html">è™šæ‹Ÿæœºç½‘ç»œæ¨¡å¼</summary>
    
    
    
    <category term="Linux" scheme="https://www.naste.top:1024/categories/Linux/"/>
    
    
    <category term="Linux" scheme="https://www.naste.top:1024/tags/Linux/"/>
    
    <category term="network" scheme="https://www.naste.top:1024/tags/network/"/>
    
  </entry>
  
  <entry>
    <title>Dockerç½‘ç»œæ¨¡å¼Linux</title>
    <link href="https://www.naste.top:1024/posts/411112023.html"/>
    <id>https://www.naste.top:1024/posts/411112023.html</id>
    <published>2023-08-20T10:44:43.000Z</published>
    <updated>2023-08-23T14:54:02.788Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h1><p>[TOC]</p><h1 id="Dockerç½‘ç»œ"><a href="#Dockerç½‘ç»œ" class="headerlink" title="Dockerç½‘ç»œ"></a>Dockerç½‘ç»œ</h1><ul><li>bridgeï¼šä¼šæœ‰å®¹å™¨IPç½‘æ®µ</li><li>hostï¼šå’Œå®¿ä¸»æœºå…±ç”¨IPï¼Œå³å®¿ä¸»æœºIPå°±æ˜¯å®¹å™¨IPï¼Œå¦‚æœå¤šä¸ªå®¹å™¨ä½¿ç”¨åŒä¸€ä¸ªç«¯å£ï¼Œä¼šå‡ºç°ç«¯å£å†²çª</li><li>noneï¼šæ²¡æœ‰IPï¼Œä¸èƒ½è”ç½‘ï¼Œå®¹å™¨å’Œå¤–éƒ¨éš”ç¦»</li><li>è‡ªå®šä¹‰ç½‘ç»œï¼šæ‹¥æœ‰é»˜è®¤bridgeçš„åŒæ—¶ï¼Œè‡ªå®šä¹‰bridgeç½‘ç»œï¼Œä¼šæ·»åŠ DNSåŠŸèƒ½ï¼Œä½¿ç”¨åŒä¸€ä¸ªè‡ªå®šä¹‰bridge</li></ul><div class="table-container"><table><thead><tr><th></th><th>é»˜è®¤bridge</th><th>è‡ªå®šä¹‰bridge</th><th>Host</th><th>None</th></tr></thead><tbody><tr><td>ä¼˜ç‚¹</td><td>é»˜è®¤ä½¿ç”¨ç½‘ç»œç±»å‹</td><td>è‡ªåŠ¨DNS</td><td>ç½‘ç»œæ€§èƒ½å¥½ï¼Œä¸éœ€è¦NAT</td><td>ç½‘ç»œéš”ç¦»</td></tr><tr><td>ç¼ºç‚¹</td><td>æ— è‡ªåŠ¨DNS</td><td>éœ€è¦NAT</td><td>å®‰å…¨é—®é¢˜ï¼Œä»…Linuxèƒ½ä½¿ç”¨</td><td>ä¸èƒ½è”ç½‘</td></tr><tr><td>åº”ç”¨åœºæ™¯</td><td>ä¸å»ºè®®ä½¿ç”¨</td><td>å•å®¿ä¸»å¤šå®¹å™¨</td><td>å•å®¹å™¨å¤šç«¯å£</td><td>å¤‡ä»½æ“ä½œ</td></tr></tbody></table></div>]]></content>
    
    
    <summary type="html">Dockerç½‘ç»œæ¨¡å¼Linux</summary>
    
    
    
    <category term="Linux" scheme="https://www.naste.top:1024/categories/Linux/"/>
    
    
    <category term="Linux" scheme="https://www.naste.top:1024/tags/Linux/"/>
    
    <category term="Docker" scheme="https://www.naste.top:1024/tags/Docker/"/>
    
    <category term="network" scheme="https://www.naste.top:1024/tags/network/"/>
    
  </entry>
  
  <entry>
    <title>ç»Ÿä¸€è®¤è¯æˆæƒä¸­å¿ƒ</title>
    <link href="https://www.naste.top:1024/posts/3180172769.html"/>
    <id>https://www.naste.top:1024/posts/3180172769.html</id>
    <published>2023-08-17T09:35:28.000Z</published>
    <updated>2023-08-23T14:54:48.157Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h1><p>[TOC]</p><h1 id="ç»Ÿä¸€è®¤è¯æˆæƒä¸­å¿ƒ"><a href="#ç»Ÿä¸€è®¤è¯æˆæƒä¸­å¿ƒ" class="headerlink" title="ç»Ÿä¸€è®¤è¯æˆæƒä¸­å¿ƒ"></a>ç»Ÿä¸€è®¤è¯æˆæƒä¸­å¿ƒ</h1><h2 id="1-èƒŒæ™¯"><a href="#1-èƒŒæ™¯" class="headerlink" title="1. èƒŒæ™¯"></a>1. èƒŒæ™¯</h2><p>ä¸€èˆ¬åœ¨ä¸€ä¸ªå…¬å¸å†…éƒ¨å¯èƒ½æœ‰å¤šä¸ªç³»ç»Ÿï¼Œæ¯”å¦‚OAï¼Œè´¢åŠ¡ç³»ç»Ÿï¼ŒCMSï¼ŒERPï¼Œè¥é”€ç³»ç»Ÿï¼Œå®¢æœä¸­å¿ƒï¼Œé¡¹ç›®ç®¡ç†ç³»ç»Ÿï¼Œä»£ç ç®¡ç†ç³»ç»Ÿç­‰ç­‰ã€‚</p><p>è¿™äº›ç³»ç»Ÿä¸€èˆ¬éƒ½æœ‰å„è‡ªçš„<code>ç”¨æˆ·ä½“ç³»</code>ï¼Œè¿™æ„å‘³ç€ä¸€äº›å¼Šç«¯ï¼š</p><ul><li>ä½¿ç”¨è€…å¿…é¡»ç»´æŠ¤å¤šä¸ªç³»ç»Ÿçš„è´¦å·å¯†ç ï¼Œå¹¶ä¸”æ¥å›åˆ‡æ¢ç™»å½•ï¼Œéå¸¸ä¸æ–¹ä¾¿</li><li>å¯¹ç®¡ç†è€…æ¥è¯´ï¼Œè´¦å·çš„ç®¡ç†ï¼Œæƒé™çš„åˆ†é…ç­‰éå¸¸å¤æ‚ï¼Œä¸”ä¸æ˜“ç»´æŠ¤</li></ul><p>è¿™å°±éœ€è¦<code>ç»Ÿä¸€è®¤è¯æˆæƒä¸­å¿ƒ</code>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç”¨æˆ·åªéœ€è¦ä¸€æ¬¡ç™»å½•ï¼Œå°±å¯ä»¥è®¿é—®å„ä¸ªç³»ç»Ÿï¼Œå®ç°äº’è”äº’é€šã€‚</p><h2 id="2-è®¤è¯æˆæƒæ¦‚å¿µ"><a href="#2-è®¤è¯æˆæƒæ¦‚å¿µ" class="headerlink" title="2. è®¤è¯æˆæƒæ¦‚å¿µ"></a>2. è®¤è¯æˆæƒæ¦‚å¿µ</h2><h3 id="2-1-è®¤è¯"><a href="#2-1-è®¤è¯" class="headerlink" title="2.1 è®¤è¯"></a>2.1 è®¤è¯</h3><p>è¯æ˜èº«ä»½çš„åˆæ³•æ€§ã€‚</p><p>æ¯”å¦‚ï¼š</p><ul><li>è´¦å·å¯†ç </li><li>æ‰‹æœºå·+çŸ­ä¿¡éªŒè¯ç </li><li>ç”µå­é‚®ç®±</li><li>èº«ä»½è¯</li><li>æŒ‡çº¹ï¼Œäººè„¸ç­‰ä¿¡æ¯</li></ul><p><strong>ä»¥ä¼ä¸šèƒŒæ™¯æ¥è¯´ï¼Œè®¤è¯å°±æ˜¯åˆ¤æ–­æ­¤è´¦å·æ˜¯å¦å±äºå…¬å¸çš„åˆæ³•è´¦å·</strong></p><h3 id="2-2-æˆæƒ"><a href="#2-2-æˆæƒ" class="headerlink" title="2.2 æˆæƒ"></a>2.2 æˆæƒ</h3><p>å½“ç”¨æˆ·èº«ä»½åˆæ³•åï¼Œä¸ä»£è¡¨æ­¤ç”¨æˆ·æ‹¥æœ‰æ“ä½œç³»ç»Ÿçš„æƒé™ã€‚</p><p>è¿™æ—¶å€™å°±éœ€è¦<code>æˆæƒ</code>ï¼Œæˆæƒå°±æ˜¯å°†æƒé™èµ‹äºˆç”¨æˆ·æ‰€æ‹¥æœ‰çš„è´¦å·/è§’è‰²ã€‚</p><p>æˆæƒè¿‡åï¼Œåœ¨ç”¨æˆ·ä½¿ç”¨è´¦å·è¿›è¡Œç™»å½•æ—¶ï¼Œéœ€è¦è¿›è¡Œ<code>é‰´æƒ</code>æ“ä½œï¼Œåˆ¤æ–­æ­¤ç”¨æˆ·æ˜¯å¦å…·æœ‰ç¬¦åˆè®¿é—®æŸä¸ªç³»ç»Ÿæˆ–è€…è®¿é—®æŸä¸ªåŠŸèƒ½çš„æƒé™ï¼Œæ¯”å¦‚ä¸€ä¸ªè¿è¥äººå‘˜æ˜¯ä¸å…è®¸è®¿é—®è´¢åŠ¡ç³»ç»Ÿçš„(<code>è¿è¥äººå‘˜çš„æˆæƒåˆ—è¡¨ä¸­å¹¶æ²¡æœ‰è´¢åŠ¡ç³»ç»Ÿçš„æˆæƒ</code>)ã€‚</p><h2 id="3-ä¸€äº›åè¯"><a href="#3-ä¸€äº›åè¯" class="headerlink" title="3. ä¸€äº›åè¯"></a>3. ä¸€äº›åè¯</h2><p><code>IAM(Identity and Access Management )</code> :  èº«ä»½è®¤è¯å’Œè®¿é—®ç®¡ç†ã€‚</p><p><code>IDM(Identity Management System)</code>: èº«ä»½ç®¡ç†ç³»ç»Ÿã€‚</p><p><code>SSO(SingleSignOn)</code>ï¼š å•ç‚¹ç™»å½•ï¼Œç”¨æˆ·åªéœ€è¦ç™»å½•ä¸€æ¬¡å°±å¯ä»¥è®¿é—®æ‰€æœ‰ç›¸äº’ä¿¡ä»»çš„åº”ç”¨ç³»ç»Ÿã€‚</p><p><code>RBAC(Role-Based Access Control)</code>: åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ã€‚æ˜¯ä¸€ç§æƒé™æ¨¡å‹ã€‚</p><h2 id="4-å¸¸è§çš„è®¤è¯æ–¹æ¡ˆ"><a href="#4-å¸¸è§çš„è®¤è¯æ–¹æ¡ˆ" class="headerlink" title="4. å¸¸è§çš„è®¤è¯æ–¹æ¡ˆ"></a>4. å¸¸è§çš„è®¤è¯æ–¹æ¡ˆ</h2><h3 id="4-1-JWT"><a href="#4-1-JWT" class="headerlink" title="4.1 JWT"></a>4.1 JWT</h3><p>HTTPåè®®æ˜¯æ— çŠ¶æ€çš„ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬æ— æ³•é€šè¿‡HTTPè®¿é—®æ¥ç¡®è®¤ç”¨æˆ·æ˜¯å¦ç™»å½•ï¼Œæœ‰ä¸¤ç§æ–¹æ¡ˆï¼š</p><ul><li>session</li><li>token</li></ul><p>å…¶ä¸­sessionæ–¹æ¡ˆï¼Œéœ€è¦å°†sessionå­˜å‚¨åœ¨æœåŠ¡ç«¯ï¼Œå¹¶ä¸”éœ€è¦cookieçš„é…åˆï¼Œæ— æ³•é€‚åº”åˆ†å¸ƒå¼åœºæ™¯ä»¥åŠå®¢æˆ·ç«¯æ˜¯æ‰‹æœºç«¯ç­‰è¿™äº›æ— cookieçš„åœºæ™¯ã€‚</p><p>tokenæ–¹æ¡ˆå°±æ˜¯ç™»å½•æˆåŠŸåï¼ŒæœåŠ¡ç«¯ä¼šä¸‹å‘ä¸€ä¸ªä»¤ç‰Œï¼ˆtokenï¼‰ï¼Œå®¢æˆ·ç«¯å°†tokenè¿›è¡Œå­˜å‚¨ï¼Œè¿™æ ·è®¿é—®èµ„æºæ—¶ï¼Œå°†ä»¤ç‰Œtokenæºå¸¦ï¼ŒæœåŠ¡ç«¯éªŒè¯tokenæœ‰æ•ˆæ€§å³å¯ã€‚</p><p><code>JWT</code>æ˜¯ä¸€ç§ç”¨äºtokenç”Ÿæˆçš„åŠ å¯†ç®—æ³•ï¼Œæ˜¯ç›®å‰ä¸šç•Œæ¯”è¾ƒæˆç†Ÿçš„ä¸€ç§æ–¹æ¡ˆã€‚</p><p>JWTå­—ç¬¦ä¸²çš„ç»„æˆï¼š</p><blockquote><p>A.B.Cï¼Œé€šè¿‡<code>.</code>è¿›è¡Œç›¸è¿ï¼Œå…¶ä¸­Aéƒ¨åˆ†ä¸ºHeaderï¼ŒBéƒ¨åˆ†ä¸ºPayloadï¼ŒCéƒ¨åˆ†ä¸ºSignature </p></blockquote><ul><li><p>Header: headeréƒ¨åˆ†ä¸€èˆ¬ä¼šåŒ…å«ä¸¤éƒ¨åˆ†ï¼š</p><ul><li>typï¼štokenç±»å‹ï¼Œè¿™é‡Œä¸€èˆ¬ä¸º<code>JWT</code></li><li>algï¼šç­¾åç®—æ³•ï¼Œä¸€èˆ¬å¡«å†™<code>HS256</code></li><li>ä»¥BASE64åŠ å¯†jsonå­—ç¬¦ä¸²ï¼Œå¯ä»¥è§£å¯†</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;alg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;HS256&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;typ&quot;</span><span class="punctuation">:</span> <span class="string">&quot;JWT&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li><li><p>Payloadï¼šå¯ä»¥æ·»åŠ éœ€è¦ä¼ é€’çš„æ•°æ®ï¼Œæ¯”å¦‚ç”¨æˆ·idï¼Œè¿˜æœ‰å‡ ä¸ªé»˜è®¤çš„å­—æ®µ</p><ul><li>iss (issuer)ï¼šç­¾å‘äºº/å‘è¡Œäºº</li><li>sub (subject)ï¼šä¸»é¢˜</li><li>aud (audience)ï¼šç”¨æˆ·</li><li>exp (expiration time)ï¼šè¿‡æœŸæ—¶é—´</li><li>nbf (Not Before)ï¼šç”Ÿæ•ˆæ—¶é—´ï¼Œåœ¨æ­¤ä¹‹å‰æ˜¯æ— æ•ˆçš„</li><li>iat (Issued At)ï¼šç­¾å‘æ—¶é—´</li><li>jti (JWT ID)ï¼šç”¨äºæ ‡è¯†è¯¥ JWT</li><li>è‡ªå®šä¹‰å­—æ®µ</li><li>ä»¥base64åŠ å¯†jsonå­—ç¬¦ä¸²ï¼Œå¯ä»¥è§£å¯†ï¼Œpayloadä¸­ä¸å»ºè®®å­˜æ”¾æ•æ„Ÿæ•°æ®</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="comment">//é»˜è®¤å­—æ®µ</span></span><br><span class="line">    <span class="attr">&quot;sub&quot;</span><span class="punctuation">:</span><span class="string">&quot;ä¸»é¢˜123&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="comment">//è‡ªå®šä¹‰å­—æ®µ</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;ç ç¥ä¹‹è·¯www.mszlu.com&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li><li><p>Signature: ç­¾åï¼ŒæŒ‡å®šä¸€ä¸ªsecret(ç§˜é’¥)ï¼Œè¯¥secretéœ€è¦ä¿å­˜èµ·æ¥ï¼Œä¸è®©å…¶ä»–äººçŸ¥é“ï¼Œé€šè¿‡headerä¸­æŒ‡æ˜çš„åŠ å¯†ç®—æ³•ï¼Œå°†ä¸Šè¿°headerå’Œpayloadè¿›è¡ŒåŠ å¯†ï¼Œä½¿ç”¨secretåŠ ç›ï¼Œè¿™å°±æ˜¯<code>ç­¾å</code></p><ul><li>éªŒè¯æ—¶ï¼Œæ”¶åˆ°ä¸€ä¸ª<code>Header.Playload.Signature</code>è¿™æ ·çš„å­—ç¬¦ä¸²ï¼Œç”¨secretåŠ å¯†<code>Header.Playload</code>ï¼Œå¦‚æœå¾—åˆ°çš„ç»“æœå’Œ<code>Signature</code>ä¸€æ ·ï¼Œåˆ™éªŒè¯é€šè¿‡</li><li>ç­¾ååŒæ ·æ˜¯base64åŠ å¯†</li></ul></li></ul><h3 id="4-2-OAuth2"><a href="#4-2-OAuth2" class="headerlink" title="4.2 OAuth2"></a>4.2 OAuth2</h3><p><code>OAuth2</code>ä¹Ÿæ˜¯ä¸€ç§tokenè®¤è¯æ–¹æ¡ˆï¼Œæµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="https://www.naste.top:9000/images/image-20230801231458409.png" alt="image-20230801231458409"></p><ul><li>å®¢æˆ·ç«¯ï¼ˆæ¯”å¦‚æµè§ˆå™¨ï¼Œæ‰‹æœºAPPç­‰ï¼‰</li><li>èµ„æºæ‹¥æœ‰è€…ï¼ˆç”¨æˆ·ï¼‰</li><li>è®¤è¯æœåŠ¡å™¨</li><li>èµ„æºæœåŠ¡å™¨</li></ul><p>è®¤è¯æµç¨‹ï¼š</p><ul><li>ï¼ˆAï¼‰ç”¨æˆ·æ‰“å¼€å®¢æˆ·ç«¯ä»¥åï¼Œå®¢æˆ·ç«¯è¦æ±‚ç”¨æˆ·ç»™äºˆæˆæƒã€‚</li><li>ï¼ˆBï¼‰ç”¨æˆ·åŒæ„ç»™äºˆå®¢æˆ·ç«¯æˆæƒã€‚</li><li>ï¼ˆCï¼‰å®¢æˆ·ç«¯ä½¿ç”¨ä¸Šä¸€æ­¥è·å¾—çš„æˆæƒï¼Œå‘è®¤è¯æœåŠ¡å™¨ç”³è¯·ä»¤ç‰Œã€‚</li><li>ï¼ˆDï¼‰æˆæƒè®¤è¯æœåŠ¡å™¨å¯¹å®¢æˆ·ç«¯è¿›è¡Œè®¤è¯ä»¥åï¼Œç¡®è®¤æ— è¯¯ï¼ŒåŒæ„å‘æ”¾ä»¤ç‰Œã€‚</li><li>ï¼ˆEï¼‰å®¢æˆ·ç«¯ä½¿ç”¨ä»¤ç‰Œï¼Œå‘èµ„æºæœåŠ¡å™¨ç”³è¯·è·å–èµ„æºã€‚</li><li>ï¼ˆFï¼‰èµ„æºæœåŠ¡å™¨ç¡®è®¤ä»¤ç‰Œæ— è¯¯ï¼ŒåŒæ„å‘å®¢æˆ·ç«¯å¼€æ”¾èµ„æºã€‚</li></ul><p><img src="https://www.naste.top:9000/images/image-20230801231955864.png" alt="image-20230801231955864"></p><p>OAuth 2.0å®šä¹‰äº†å››ç§æˆæƒè®¸å¯ç±»å‹ï¼š</p><ol><li><p>Authorization Codeï¼šæˆæƒç </p><p><img src="https://www.naste.top:9000/images/image-20230801232139146.png" alt="image-20230801232139146"></p></li><li><p>Implicitï¼šéšå¼è®¸å¯</p><p><img src="https://www.naste.top:9000/images/image-20230801232150239.png" alt="image-20230801232150239"></p></li><li><p>Resource Owner Password Credentialsï¼šå¯†ç å‡­è¯</p><p><img src="https://www.naste.top:9000/images/image-20230801232319057.png" alt="image-20230801232319057"></p></li><li><p>Client Credentials ï¼šå®¢æˆ·ç«¯å‡­è¯</p></li></ol><p>â€‹    <img src="https://www.naste.top:9000/images/image-20230801232337191.png" alt="image-20230801232337191"></p><h2 id="5-SSOåè®®"><a href="#5-SSOåè®®" class="headerlink" title="5. SSOåè®®"></a>5. SSOåè®®</h2><p>SSOå°±æ˜¯å•ç‚¹ç™»å½•ï¼Œä¸€æ¬¡ç™»å½•ï¼Œå¯ä»¥è®¿é—®æ‰€æœ‰å—ä¿¡åº”ç”¨ï¼Œ<code>JWT</code>å’Œ<code>OAuth</code>éƒ½å¯ä»¥å®ç°å•ç‚¹ç™»å½•ã€‚</p><h3 id="5-1-OpenID-Connect"><a href="#5-1-OpenID-Connect" class="headerlink" title="5.1 OpenID Connect"></a>5.1 OpenID Connect</h3><p>ç®€ç§°<code>OIDC</code>ï¼Œæ˜¯åŸºäºOAuth2æ‰©å±•å‡ºæ¥çš„ä¸€ä¸ªåè®®ã€‚ OIDC åœ¨ OAuth2.0 åè®®çš„åŸºç¡€ä¸Šï¼Œæä¾›äº†ç”¨æˆ·è®¤è¯ã€è·å–ç”¨æˆ·ä¿¡æ¯ç­‰çš„æ ‡å‡†å®ç°ã€‚<strong>OIDC æ˜¯å®Œå…¨å…¼å®¹ OAuth2.0 çš„</strong>ã€‚</p><ul><li><code>èµ„æºæŒæœ‰è€…ï¼ˆEnd Userï¼‰</code> ï¼š å¯¹åº” OAuthä¸­çš„<code>Resource Owner</code></li><li><code>å®¢æˆ·ç«¯ï¼ˆRelying Partyï¼‰</code>: å¯¹åº”OAuthä¸­çš„<code>Client</code></li><li><code>èµ„æºæœåŠ¡å™¨ï¼ˆResource Serverï¼‰</code> </li><li><code>è®¤è¯æœåŠ¡å™¨ï¼ˆOpenID Providerï¼‰</code>: å¯¹åº”OAuthä¸­çš„<code>Auhtorization Server</code></li></ul><p><img src="https://www.naste.top:9000/images/image-20230802003334390.png" alt="image-20230802003334390"></p><ol><li>RP(client)å‘é€ä¸€ä¸ªè®¤è¯è¯·æ±‚åˆ° OpenID Providerï¼ˆOPï¼‰ã€‚</li><li>OPå¯¹End Userè¿›è¡Œè®¤è¯å¹¶è·å¾—ç›¸åº”çš„æˆæƒã€‚</li><li>OPè¿”å›ä¸€ä¸ªID Tokenæˆ–è€…access Tokenç»™RPã€‚</li><li>RPä½¿ç”¨access tokenå‘UserInfo Endpointè¯·æ±‚ç”¨æˆ·ä¿¡æ¯ã€‚</li><li>UserInfo Endpointè¿”å›ç›¸åº”çš„ç”¨æˆ·ä¿¡æ¯ç»™RPã€‚</li></ol><p><code>ID Token</code>å°±åƒæ˜¯ä¸€ä¸ªç”¨æˆ·çš„èº«ä»½è¯ï¼Œå®ƒæ˜¯ä»¥JWTæ ¼å¼å­˜åœ¨çš„ï¼Œå¹¶ä¸”ç”±OPè¿›è¡Œç­¾åï¼Œä¿è¯å®ƒçš„å®‰å…¨æ€§ã€‚</p><blockquote><p>æˆæƒæ¨¡å¼ï¼š</p></blockquote><p><img src="https://www.naste.top:9000/images/v2-8735e5c0737994d9a7c1290cbefff789_1440w.webp" alt="img"></p><ul><li><p><strong>æˆæƒç æ¨¡å¼ï¼ˆAuthorization Codeï¼‰</strong></p><p><img src="https://www.naste.top:9000/images/v2-85de92eb3fdf3e55483bc00a72a48f44_1440w.webp" alt="img"></p></li><li><p><strong>æˆæƒç  + PKCE æ¨¡å¼ï¼ˆAuthorization Code With PKCEï¼‰</strong></p><p><img src="https://www.naste.top:9000/images/v2-a4be09b55d716895ff16a95ba0b8ed06_1440w.webp" alt="img"></p></li><li><p><strong>å®¢æˆ·ç«¯å‡­è¯æ¨¡å¼ï¼ˆClient Credentialsï¼‰</strong></p><p><img src="https://www.naste.top:9000/images/v2-7801b0e452b2d98de36c7c0b5fa7284d_1440w.webp" alt="img"></p></li><li><p><strong>éšå¼æ¨¡å¼ï¼ˆImplicitï¼‰</strong></p><p><img src="https://www.naste.top:9000/images/v2-b52c5743355754a237d415729f34d0bb_1440w.webp" alt="img"></p></li><li><p><strong>å¯†ç æ¨¡å¼ï¼ˆPasswordï¼‰</strong></p><p><img src="https://www.naste.top:9000/images/v2-d26c315aa259f67e5d03b35ee6d8e247_1440w.webp" alt="img"></p></li><li><p><strong>è®¾å¤‡ä»£ç æ¨¡å¼ï¼ˆDevice Codeï¼‰</strong></p><p><img src="https://www.naste.top:9000/images/v2-69a098d52e8bd9b190093697786b5fab_1440w-16909080543958.webp" alt="img"></p></li></ul><h3 id="5-2-SAML-2-0"><a href="#5-2-SAML-2-0" class="headerlink" title="5.2 SAML 2.0"></a>5.2 SAML 2.0</h3><p>SAMLåè®®å…¨ç§°ä¸º<code>Security Assertion Markup Language</code>ï¼Œå®ƒæ˜¯ä¸€ä¸ªåŸºäºXMLçš„æ ‡å‡†åè®®ã€‚SAMLæ ‡å‡†å®šä¹‰äº†èº«ä»½æä¾›è€…ï¼ˆIdentity Providerï¼‰å’ŒæœåŠ¡æä¾›è€…ï¼ˆService Providerï¼‰ä¹‹é—´ï¼Œå¦‚ä½•é€šè¿‡SAMLè§„èŒƒï¼Œé‡‡ç”¨åŠ å¯†å’Œç­¾åçš„æ–¹å¼æ¥å»ºç«‹äº’ä¿¡ï¼Œä»è€Œäº¤æ¢ç”¨æˆ·èº«ä»½ä¿¡æ¯ã€‚</p><p><strong>SAMLå¤æ‚æ€§æ¯”è¾ƒé«˜ï¼Œå¹¶ä¸æ¨èä½¿ç”¨ã€‚</strong></p><h3 id="5-3-CAS"><a href="#5-3-CAS" class="headerlink" title="5.3 CAS"></a>5.3 CAS</h3><p>CAS ï¼ˆ <code>Central Authentication Service</code> ï¼‰ æ˜¯ Yale å¤§å­¦å‘èµ·çš„ä¸€ä¸ªä¼ä¸šçº§çš„ã€å¼€æºçš„é¡¹ç›®ï¼Œæ—¨åœ¨ä¸º Web åº”ç”¨ç³»ç»Ÿæä¾›ä¸€ç§å¯é çš„å•ç‚¹ç™»å½•è§£å†³æ–¹æ³•ã€‚</p><p>CAS å¼€å§‹äº 2001 å¹´ï¼Œ å¹¶åœ¨ 2004 å¹´ 12 æœˆæ­£å¼æˆä¸º JA-SIG çš„ä¸€ä¸ªé¡¹ç›®ã€‚</p><p>è§’è‰²ä»‹ç»ï¼š</p><ul><li><p>CAS Client</p><p>è´Ÿè´£æä¾›èµ„æºï¼Œå½“èµ„æºå—ä¿æŠ¤æ—¶éœ€è¦ç”¨æˆ·è¿›è¡Œèº«ä»½è®¤è¯æ—¶ï¼Œé‡å®šå‘åˆ°CAS Serverè¿›è¡Œè®¤è¯ã€‚</p></li><li><p>CAS Server</p><p>è´Ÿè´£å¯¹ç”¨æˆ·çš„è®¤è¯ã€‚</p></li></ul><p>CASæœ‰ä¸åŒçš„ç‰ˆæœ¬ï¼Œæ¯”å¦‚1.0ï¼Œ2.0ï¼Œ3.0ï¼Œ4.0ç­‰ï¼Œè®¤è¯æµç¨‹åŸºæœ¬ä¸€è‡´ï¼Œåªæ˜¯ä¸åŒç‰ˆæœ¬ä¸­ï¼ŒServerå¯ä»¥å¼•å…¥ä¸åŒçš„è®¤è¯æœºåˆ¶ï¼ˆæ¯”å¦‚å¼•å…¥SAMLï¼ŒOAuth2ç­‰ï¼‰ã€‚</p><p>è®¤è¯æµç¨‹å¤§è‡´ä¸º: </p><p><img src="https://www.naste.top:9000/images/li4wdumqzo.png" alt="img"></p><ol><li>Client(ç»ˆç«¯ç”¨æˆ·)åœ¨æµè§ˆå™¨é‡Œè¯·æ±‚è®¿é—®Webåº”ç”¨exampleï¼›</li><li>æµè§ˆå™¨å‘èµ·ä¸€ä¸ªGETè¯·æ±‚è®¿é—®exampleåº”ç”¨çš„ä¸»é¡µ<code>https://www.example.com</code>ï¼›</li><li>åº”ç”¨exampleå‘ç°å½“å‰ç”¨æˆ·å¤„äºæœªç™»é™†çŠ¶æ€ï¼ŒRedirectç”¨æˆ·è‡³CASæœåŠ¡å™¨è¿›è¡Œè®¤è¯ï¼›</li><li>ç”¨æˆ·è¯·æ±‚CASæœåŠ¡å™¨ï¼›</li><li>CASå‘ç°å½“å‰ç”¨æˆ·åœ¨CASæœåŠ¡å™¨ä¸­å¤„äºæœªç™»é™†çŠ¶æ€, è¦æ±‚ç”¨æˆ·å¿…é¡»å¾—å…ˆç™»é™†ï¼›</li><li>CASæœåŠ¡å™¨è¿”å›ç™»é™†é¡µé¢è‡³æµè§ˆå™¨ï¼›</li><li>ç”¨æˆ·åœ¨ç™»é™†ç•Œé¢ä¸­è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼ˆæˆ–è€…å…¶ä»–è®¤è¯æ–¹å¼ï¼‰ï¼›</li><li>ç”¨æˆ·æŠŠç”¨æˆ·åå’Œå¯†ç é€šè¿‡POSTï¼Œæäº¤è‡³CASæœåŠ¡å™¨ï¼›</li><li>CASå¯¹ç”¨æˆ·èº«ä»½è¿›è¡Œè®¤è¯ï¼Œè‹¥ç”¨æˆ·åå’Œå¯†ç æ­£ç¡®ï¼Œåˆ™ç”ŸæˆSSOä¼šè¯,  ä¸”æŠŠä¼šè¯IDé€šè¿‡Cookieçš„æ–¹å¼è¿”å›è‡³ç”¨æˆ·çš„æµè§ˆå™¨ç«¯ï¼ˆæ­¤æ—¶ï¼Œç”¨æˆ·åœ¨CASæœåŠ¡ç«¯å¤„äºç™»é™†çŠ¶æ€ï¼‰ï¼›</li><li>CASæœåŠ¡å™¨åŒæ—¶ä¹Ÿä¼šæŠŠç”¨æˆ·é‡å®šå‘è‡³CAS Client, ä¸”åŒæ—¶å‘é€ä¸€ä¸ªService Ticketï¼›</li><li>CAS Clientçš„æœåŠ¡ç«¯æ”¶åˆ°è¿™ä¸ªService Ticketä»¥åï¼Œè¯·æ±‚CAS Serverå¯¹è¯¥ticketè¿›è¡Œæ ¡éªŒï¼›</li><li>CAS ServeræŠŠæ ¡éªŒç»“æœè¿”å›ç»™CAS Client, æ ¡éªŒç»“æœåŒ…æ‹¬è¯¥ticketæ˜¯å¦åˆæ³•ï¼Œä»¥åŠè¯¥ticketä¸­åŒ…å«å¯¹ç”¨æˆ·ä¿¡æ¯ï¼›</li><li>è‡³æ­¤ï¼ŒCAS Clientæ ¹æ®Service Ticketå¾—çŸ¥å½“å‰ç™»é™†ç”¨æˆ·çš„èº«ä»½ï¼ŒCAS Clientå¤„äºç™»é™†æ€ã€‚</li></ol><p><strong>CASåŒæ ·ä¸æ¨èä½¿ç”¨</strong></p><blockquote><p>è™½ç„¶SAMLå’ŒCASä¸æ¨èä½¿ç”¨ï¼Œä½†åšä¸ºç»Ÿä¸€è®¤è¯æˆæƒä¸­å¿ƒçš„å®ç°ï¼Œéœ€è¦è€ƒè™‘å¤šç§åœºæ™¯ï¼ŒåŒæ ·åº”è¯¥ç»™äºˆå®ç°ï¼ˆåªæ˜¯ä¼˜å…ˆçº§ä¸é«˜ï¼‰</p></blockquote><p><strong>ç›®å‰SSOåè®®ï¼Œæœ€ä¸ºæ¨èä½¿ç”¨çš„ä¸ºOIDCï¼Œä¹Ÿæ˜¯ç›®å‰äº‹å®ä¸Šçš„SSOé€šç”¨æ ‡å‡†</strong></p><h2 id="6-RBAC"><a href="#6-RBAC" class="headerlink" title="6. RBAC"></a>6. RBAC</h2><p>åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼ˆ<code>Role-based access control</code>ï¼‰ï¼ŒæŒ‡çš„æ˜¯é€šè¿‡ç”¨æˆ·çš„è§’è‰²ï¼ˆRoleï¼‰æˆæƒå…¶ç›¸å…³æƒé™ï¼Œè¿™å®ç°äº†æ›´çµæ´»çš„è®¿é—®æ§åˆ¶ï¼Œç›¸æ¯”ç›´æ¥æˆäºˆç”¨æˆ·æƒé™ï¼Œè¦æ›´åŠ ç®€å•ã€é«˜æ•ˆã€å¯æ‰©å±•ã€‚</p><p>å½“ä½¿ç”¨ RBAC æ—¶ï¼Œé€šè¿‡åˆ†æç³»ç»Ÿç”¨æˆ·çš„å®é™…æƒ…å†µï¼ŒåŸºäºå…±åŒçš„èŒè´£å’Œéœ€æ±‚ï¼Œæˆäºˆä»–ä»¬ä¸åŒè§’è‰²ã€‚ä½ å¯ä»¥æˆäºˆç»™ç”¨æˆ·ä¸€ä¸ªæˆ–å¤šä¸ªè§’è‰²ï¼Œæ¯ä¸ªè§’è‰²å…·æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªæƒé™ï¼Œè¿™ç§ <code>ç”¨æˆ·-è§’è‰²</code>ã€<code>è§’è‰²-æƒé™</code> é—´çš„å…³ç³»ï¼Œè®©æˆ‘ä»¬å¯ä»¥ä¸ç”¨å†å•ç‹¬ç®¡ç†å•ä¸ªç”¨æˆ·ï¼Œç”¨æˆ·ä»æˆäºˆçš„è§’è‰²é‡Œé¢ç»§æ‰¿æ‰€éœ€çš„æƒé™ã€‚</p><p>ä»¥ä¸€ä¸ªç®€å•çš„<code>åœºæ™¯</code>ï¼ˆGitlab çš„æƒé™ç³»ç»Ÿï¼‰ä¸ºä¾‹ï¼Œç”¨æˆ·ç³»ç»Ÿä¸­æœ‰ Adminã€Maintainerã€Operator ä¸‰ç§è§’è‰²ï¼Œè¿™ä¸‰ç§è§’è‰²åˆ†åˆ«å…·å¤‡ä¸åŒçš„æƒé™ï¼Œæ¯”å¦‚åªæœ‰ Admin å…·å¤‡åˆ›å»ºä»£ç ä»“åº“ã€åˆ é™¤ä»£ç ä»“åº“çš„æƒé™ï¼Œå…¶ä»–çš„è§’è‰²éƒ½ä¸å…·å¤‡ã€‚</p><p><img src="https://www.naste.top:9000/images/KX1PzJ94CsSRDwH.png" alt="img"></p>]]></content>
    
    
    <summary type="html">ç»Ÿä¸€è®¤è¯æˆæƒä¸­å¿ƒ</summary>
    
    
    
    <category term="Java" scheme="https://www.naste.top:1024/categories/Java/"/>
    
    
    <category term="Java" scheme="https://www.naste.top:1024/tags/Java/"/>
    
    <category term="SpringBoot" scheme="https://www.naste.top:1024/tags/SpringBoot/"/>
    
    <category term="SpringSecurity" scheme="https://www.naste.top:1024/tags/SpringSecurity/"/>
    
  </entry>
  
  <entry>
    <title>ShardingSphere</title>
    <link href="https://www.naste.top:1024/posts/2343814370.html"/>
    <id>https://www.naste.top:1024/posts/2343814370.html</id>
    <published>2023-08-17T09:35:01.000Z</published>
    <updated>2023-08-23T14:54:48.148Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h1><p>[TOC]</p><h1 id="ç¬¬01ç« -é«˜æ€§èƒ½æ¶æ„æ¨¡å¼"><a href="#ç¬¬01ç« -é«˜æ€§èƒ½æ¶æ„æ¨¡å¼" class="headerlink" title="ç¬¬01ç«  é«˜æ€§èƒ½æ¶æ„æ¨¡å¼"></a>ç¬¬01ç«  é«˜æ€§èƒ½æ¶æ„æ¨¡å¼</h1><p>äº’è”ç½‘ä¸šåŠ¡å…´èµ·ä¹‹åï¼Œæµ·é‡ç”¨æˆ·åŠ ä¸Šæµ·é‡æ•°æ®çš„ç‰¹ç‚¹ï¼Œå•ä¸ªæ•°æ®åº“æœåŠ¡å™¨å·²ç»éš¾ä»¥æ»¡è¶³ä¸šåŠ¡éœ€è¦ï¼Œå¿…é¡»è€ƒè™‘æ•°æ®åº“é›†ç¾¤çš„æ–¹å¼æ¥æå‡æ€§èƒ½ã€‚é«˜æ€§èƒ½æ•°æ®åº“é›†ç¾¤çš„<code>ç¬¬ä¸€ç§æ–¹å¼æ˜¯â€œè¯»å†™åˆ†ç¦»â€</code>ï¼Œ<code>ç¬¬äºŒç§æ–¹å¼æ˜¯â€œæ•°æ®åº“åˆ†ç‰‡â€</code>ã€‚</p><h2 id="1ã€è¯»å†™åˆ†ç¦»æ¶æ„"><a href="#1ã€è¯»å†™åˆ†ç¦»æ¶æ„" class="headerlink" title="1ã€è¯»å†™åˆ†ç¦»æ¶æ„"></a>1ã€è¯»å†™åˆ†ç¦»æ¶æ„</h2><p><strong>è¯»å†™åˆ†ç¦»åŸç†ï¼š</strong>è¯»å†™åˆ†ç¦»çš„åŸºæœ¬åŸç†æ˜¯å°†æ•°æ®åº“è¯»å†™æ“ä½œåˆ†æ•£åˆ°ä¸åŒçš„èŠ‚ç‚¹ä¸Šï¼Œä¸‹é¢æ˜¯å…¶åŸºæœ¬æ¶æ„å›¾ï¼š</p><p><img src="https://www.naste.top:9000/images/362d22168bf344687ec0c206aa115807.jpg" alt="img"></p><p><strong>è¯»å†™åˆ†ç¦»çš„åŸºæœ¬å®ç°ï¼š</strong></p><ul><li><code>ä¸»åº“è´Ÿè´£å¤„ç†äº‹åŠ¡æ€§çš„å¢åˆ æ”¹æ“ä½œï¼Œä»åº“è´Ÿè´£å¤„ç†æŸ¥è¯¢æ“ä½œ</code>ï¼Œèƒ½å¤Ÿæœ‰æ•ˆçš„é¿å…ç”±æ•°æ®æ›´æ–°å¯¼è‡´çš„è¡Œé”ï¼Œä½¿å¾—æ•´ä¸ªç³»ç»Ÿçš„æŸ¥è¯¢æ€§èƒ½å¾—åˆ°æå¤§çš„æ”¹å–„ã€‚</li><li>è¯»å†™åˆ†ç¦»æ˜¯<code>æ ¹æ® SQL è¯­ä¹‰çš„åˆ†æ</code>ï¼Œ<code>å°†è¯»æ“ä½œå’Œå†™æ“ä½œåˆ†åˆ«è·¯ç”±è‡³ä¸»åº“ä¸ä»åº“</code>ã€‚</li><li>é€šè¿‡<code>ä¸€ä¸»å¤šä»</code>çš„é…ç½®æ–¹å¼ï¼Œå¯ä»¥å°†æŸ¥è¯¢è¯·æ±‚å‡åŒ€çš„åˆ†æ•£åˆ°å¤šä¸ªæ•°æ®å‰¯æœ¬ï¼Œèƒ½å¤Ÿè¿›ä¸€æ­¥çš„æå‡ç³»ç»Ÿçš„å¤„ç†èƒ½åŠ›ã€‚ </li><li>ä½¿ç”¨<code>å¤šä¸»å¤šä»</code>çš„æ–¹å¼ï¼Œä¸ä½†èƒ½å¤Ÿæå‡ç³»ç»Ÿçš„ååé‡ï¼Œè¿˜èƒ½å¤Ÿæå‡ç³»ç»Ÿçš„å¯ç”¨æ€§ï¼Œå¯ä»¥è¾¾åˆ°åœ¨ä»»ä½•ä¸€ä¸ªæ•°æ®åº“å®•æœºï¼Œç”šè‡³ç£ç›˜ç‰©ç†æŸåçš„æƒ…å†µä¸‹ä»ç„¶ä¸å½±å“ç³»ç»Ÿçš„æ­£å¸¸è¿è¡Œã€‚</li></ul><p><strong>ä¸‹å›¾å±•ç¤ºäº†æ ¹æ®ä¸šåŠ¡éœ€è¦ï¼Œå°†ç”¨æˆ·è¡¨çš„å†™æ“ä½œå’Œè¯»æ“è·¯ç”±åˆ°ä¸åŒçš„æ•°æ®åº“çš„æ–¹æ¡ˆï¼š</strong></p><p><img src="https://www.naste.top:9000/images/image-20220804223138651.png" alt="image-20220804223138651"></p><p><strong>CAP ç†è®ºï¼š</strong></p><p>CAP å®šç†ï¼ˆCAP theoremï¼‰åˆè¢«ç§°ä½œå¸ƒé²å°”å®šç†ï¼ˆBrewerâ€™s theoremï¼‰ï¼Œæ˜¯åŠ å·å¤§å­¦ä¼¯å…‹åˆ©åˆ†æ ¡çš„è®¡ç®—æœºç§‘å­¦å®¶åŸƒé‡Œå…‹Â·å¸ƒé²å°”ï¼ˆEric Brewerï¼‰åœ¨ 2000 å¹´çš„ ACM PODC ä¸Šæå‡ºçš„ä¸€ä¸ªçŒœæƒ³ã€‚<code>å¯¹äºè®¾è®¡åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ¶æ„å¸ˆæ¥è¯´ï¼ŒCAP æ˜¯å¿…é¡»æŒæ¡çš„ç†è®ºã€‚</code></p><p>åœ¨ä¸€ä¸ª<code>åˆ†å¸ƒå¼ç³»ç»Ÿä¸­</code>ï¼Œå½“æ¶‰åŠè¯»å†™æ“ä½œæ—¶ï¼Œåªèƒ½ä¿è¯ä¸€è‡´æ€§ï¼ˆConsistenceï¼‰ã€å¯ç”¨æ€§ï¼ˆAvailabilityï¼‰ã€åˆ†åŒºå®¹é”™æ€§ï¼ˆPartition Toleranceï¼‰ä¸‰è€…ä¸­çš„ä¸¤ä¸ªï¼Œå¦å¤–ä¸€ä¸ªå¿…é¡»è¢«ç‰ºç‰²ã€‚</p><ul><li>C ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ï¼šå¯¹æŸä¸ªæŒ‡å®šçš„å®¢æˆ·ç«¯æ¥è¯´ï¼Œè¯»æ“ä½œä¿è¯èƒ½å¤Ÿè¿”å›æœ€æ–°çš„å†™æ“ä½œç»“æœ</li><li>A å¯ç”¨æ€§ï¼ˆAvailabilityï¼‰ï¼šéæ•…éšœçš„èŠ‚ç‚¹åœ¨åˆç†çš„æ—¶é—´å†…è¿”å›åˆç†çš„å“åº”<code>ï¼ˆä¸æ˜¯é”™è¯¯å’Œè¶…æ—¶çš„å“åº”ï¼‰</code></li><li>P åˆ†åŒºå®¹å¿æ€§ï¼ˆPartition Toleranceï¼‰ï¼šå½“å‡ºç°ç½‘ç»œåˆ†åŒºå<code>ï¼ˆå¯èƒ½æ˜¯ä¸¢åŒ…ï¼Œä¹Ÿå¯èƒ½æ˜¯è¿æ¥ä¸­æ–­ï¼Œè¿˜å¯èƒ½æ˜¯æ‹¥å¡ï¼‰</code>ï¼Œç³»ç»Ÿèƒ½å¤Ÿç»§ç»­â€œå±¥è¡ŒèŒè´£â€</li></ul><p><strong>CAPç‰¹ç‚¹ï¼š</strong></p><ul><li>åœ¨å®é™…è®¾è®¡è¿‡ç¨‹ä¸­ï¼Œæ¯ä¸ªç³»ç»Ÿä¸å¯èƒ½åªå¤„ç†ä¸€ç§æ•°æ®ï¼Œè€Œæ˜¯åŒ…å«å¤šç§ç±»å‹çš„æ•°æ®ï¼Œ<code>æœ‰çš„æ•°æ®å¿…é¡»é€‰æ‹© CPï¼Œæœ‰çš„æ•°æ®å¿…é¡»é€‰æ‹© APï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿç†è®ºä¸Šä¸å¯èƒ½é€‰æ‹© CA æ¶æ„ã€‚</code></li></ul><ul><li><p>CPï¼šå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œ<code>ä¸ºäº†ä¿è¯ä¸€è‡´æ€§</code>ï¼Œå½“å‘ç”Ÿåˆ†åŒºç°è±¡åï¼ŒN1 èŠ‚ç‚¹ä¸Šçš„æ•°æ®å·²ç»æ›´æ–°åˆ° yï¼Œä½†ç”±äº N1 å’Œ N2 ä¹‹é—´çš„å¤åˆ¶é€šé“ä¸­æ–­ï¼Œæ•°æ® y æ— æ³•åŒæ­¥åˆ° N2ï¼ŒN2 èŠ‚ç‚¹ä¸Šçš„æ•°æ®è¿˜æ˜¯ xã€‚<code>è¿™æ—¶å®¢æˆ·ç«¯ C è®¿é—® N2 æ—¶ï¼ŒN2 éœ€è¦è¿”å› Errorï¼Œæç¤ºå®¢æˆ·ç«¯ Câ€œç³»ç»Ÿç°åœ¨å‘ç”Ÿäº†é”™è¯¯â€ï¼Œ</code>è¿™ç§å¤„ç†æ–¹å¼<code>è¿èƒŒäº†å¯ç”¨æ€§</code>ï¼ˆAvailabilityï¼‰çš„è¦æ±‚ï¼Œå› æ­¤ CAP ä¸‰è€…åªèƒ½æ»¡è¶³ CPã€‚</p><p><img src="https://www.naste.top:9000/images/6e7d7bd54d7a4eb67918080863d354d7.png" alt="img"></p></li></ul><ul><li>APï¼šå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œ<code>ä¸ºäº†ä¿è¯å¯ç”¨æ€§</code>ï¼Œå½“å‘ç”Ÿåˆ†åŒºç°è±¡åï¼ŒN1 èŠ‚ç‚¹ä¸Šçš„æ•°æ®å·²ç»æ›´æ–°åˆ° yï¼Œä½†ç”±äº N1 å’Œ N2 ä¹‹é—´çš„å¤åˆ¶é€šé“ä¸­æ–­ï¼Œæ•°æ® y æ— æ³•åŒæ­¥åˆ° N2ï¼ŒN2 èŠ‚ç‚¹ä¸Šçš„æ•°æ®è¿˜æ˜¯ xã€‚<code>è¿™æ—¶å®¢æˆ·ç«¯ C è®¿é—® N2 æ—¶ï¼ŒN2 å°†å½“å‰è‡ªå·±æ‹¥æœ‰çš„æ•°æ® x è¿”å›ç»™å®¢æˆ·ç«¯ C äº†</code>ï¼Œè€Œå®é™…ä¸Šå½“å‰æœ€æ–°çš„æ•°æ®å·²ç»æ˜¯ y äº†ï¼Œè¿™å°±<code>ä¸æ»¡è¶³ä¸€è‡´æ€§</code>ï¼ˆConsistencyï¼‰çš„è¦æ±‚äº†ï¼Œå› æ­¤ CAP ä¸‰è€…åªèƒ½æ»¡è¶³ APã€‚æ³¨æ„ï¼šè¿™é‡Œ N2 èŠ‚ç‚¹è¿”å› xï¼Œè™½ç„¶ä¸æ˜¯ä¸€ä¸ªâ€œæ­£ç¡®â€çš„ç»“æœï¼Œä½†æ˜¯ä¸€ä¸ªâ€œåˆç†â€çš„ç»“æœï¼Œå› ä¸º x æ˜¯æ—§çš„æ•°æ®ï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ªé”™ä¹±çš„å€¼ï¼Œåªæ˜¯ä¸æ˜¯æœ€æ–°çš„æ•°æ®è€Œå·²ã€‚</li></ul><p><img src="https://www.naste.top:9000/images/2ccafe41de9bd7f8dec4658f004310d6.png" alt="img"></p><ul><li><p>CAP ç†è®ºä¸­çš„ <code>C åœ¨å®è·µä¸­æ˜¯ä¸å¯èƒ½å®Œç¾å®ç°çš„</code>ï¼Œåœ¨æ•°æ®å¤åˆ¶çš„è¿‡ç¨‹ä¸­ï¼ŒèŠ‚ç‚¹N1 å’ŒèŠ‚ç‚¹ N2 çš„æ•°æ®å¹¶ä¸ä¸€è‡´ï¼ˆå¼ºä¸€è‡´æ€§ï¼‰ã€‚å³ä½¿æ— æ³•åšåˆ°<code>å¼ºä¸€è‡´æ€§</code>ï¼Œä½†åº”ç”¨å¯ä»¥é‡‡ç”¨é€‚åˆçš„æ–¹å¼è¾¾åˆ°<code>æœ€ç»ˆä¸€è‡´æ€§</code>ã€‚å…·æœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š</p><ul><li>åŸºæœ¬å¯ç”¨ï¼ˆBasically Availableï¼‰ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿåœ¨å‡ºç°æ•…éšœæ—¶ï¼Œå…è®¸æŸå¤±éƒ¨åˆ†å¯ç”¨æ€§ï¼Œå³ä¿è¯æ ¸å¿ƒå¯ç”¨ã€‚</li><li>è½¯çŠ¶æ€ï¼ˆSoft Stateï¼‰ï¼šå…è®¸ç³»ç»Ÿå­˜åœ¨ä¸­é—´çŠ¶æ€ï¼Œè€Œè¯¥ä¸­é—´çŠ¶æ€ä¸ä¼šå½±å“ç³»ç»Ÿæ•´ä½“å¯ç”¨æ€§ã€‚è¿™é‡Œçš„ä¸­é—´çŠ¶æ€å°±æ˜¯ CAP ç†è®ºä¸­çš„æ•°æ®ä¸ä¸€è‡´ã€‚</li><li><code>æœ€ç»ˆä¸€è‡´æ€§ï¼ˆEventual Consistencyï¼‰ï¼šç³»ç»Ÿä¸­çš„æ‰€æœ‰æ•°æ®å‰¯æœ¬ç»è¿‡ä¸€å®šæ—¶é—´åï¼Œæœ€ç»ˆèƒ½å¤Ÿè¾¾åˆ°ä¸€è‡´çš„çŠ¶æ€ã€‚</code></li></ul></li></ul><h2 id="2ã€æ•°æ®åº“åˆ†ç‰‡æ¶æ„"><a href="#2ã€æ•°æ®åº“åˆ†ç‰‡æ¶æ„" class="headerlink" title="2ã€æ•°æ®åº“åˆ†ç‰‡æ¶æ„"></a>2ã€æ•°æ®åº“åˆ†ç‰‡æ¶æ„</h2><p><strong>è¯»å†™åˆ†ç¦»çš„é—®é¢˜ï¼š</strong></p><p>è¯»å†™åˆ†ç¦»åˆ†æ•£äº†æ•°æ®åº“è¯»å†™æ“ä½œçš„å‹åŠ›ï¼Œä½†æ²¡æœ‰åˆ†æ•£å­˜å‚¨å‹åŠ›ï¼Œä¸ºäº†æ»¡è¶³ä¸šåŠ¡æ•°æ®å­˜å‚¨çš„éœ€æ±‚ï¼Œå°±éœ€è¦<code>å°†å­˜å‚¨åˆ†æ•£åˆ°å¤šå°æ•°æ®åº“æœåŠ¡å™¨ä¸Š</code>ã€‚</p><p><strong>æ•°æ®åˆ†ç‰‡ï¼š</strong></p><p>å°†å­˜æ”¾åœ¨å•ä¸€æ•°æ®åº“ä¸­çš„æ•°æ®åˆ†æ•£åœ°å­˜æ”¾è‡³å¤šä¸ªæ•°æ®åº“æˆ–è¡¨ä¸­ï¼Œä»¥è¾¾åˆ°æå‡æ€§èƒ½ç“¶é¢ˆä»¥åŠå¯ç”¨æ€§çš„æ•ˆæœã€‚ æ•°æ®åˆ†ç‰‡çš„æœ‰æ•ˆæ‰‹æ®µæ˜¯å¯¹å…³ç³»å‹æ•°æ®åº“è¿›è¡Œ<code>åˆ†åº“å’Œåˆ†è¡¨</code>ã€‚æ•°æ®åˆ†ç‰‡çš„æ‹†åˆ†æ–¹å¼åˆåˆ†ä¸º<code>å‚ç›´åˆ†ç‰‡å’Œæ°´å¹³åˆ†ç‰‡</code>ã€‚</p><h3 id="2-1ã€å‚ç›´åˆ†ç‰‡"><a href="#2-1ã€å‚ç›´åˆ†ç‰‡" class="headerlink" title="2.1ã€å‚ç›´åˆ†ç‰‡"></a>2.1ã€å‚ç›´åˆ†ç‰‡</h3><p><strong>å‚ç›´åˆ†åº“ï¼š</strong></p><p><code>æŒ‰ç…§ä¸šåŠ¡æ‹†åˆ†çš„æ–¹å¼ç§°ä¸ºå‚ç›´åˆ†ç‰‡ï¼Œåˆç§°ä¸ºçºµå‘æ‹†åˆ†</code>ï¼Œå®ƒçš„æ ¸å¿ƒç†å¿µæ˜¯ä¸“åº“ä¸“ç”¨ã€‚ åœ¨æ‹†åˆ†ä¹‹å‰ï¼Œä¸€ä¸ªæ•°æ®åº“ç”±å¤šä¸ªæ•°æ®è¡¨æ„æˆï¼Œæ¯ä¸ªè¡¨å¯¹åº”ç€ä¸åŒçš„ä¸šåŠ¡ã€‚è€Œæ‹†åˆ†ä¹‹åï¼Œåˆ™æ˜¯æŒ‰ç…§ä¸šåŠ¡å°†è¡¨è¿›è¡Œå½’ç±»ï¼Œåˆ†å¸ƒåˆ°ä¸åŒçš„æ•°æ®åº“ä¸­ï¼Œä»è€Œå°†å‹åŠ›åˆ†æ•£è‡³ä¸åŒçš„æ•°æ®åº“ã€‚ </p><p><img src="https://www.naste.top:9000/images/71f41d46cc5c0405f4d4dc944b4350c9.jpg" alt="img"></p><p>ä¸‹å›¾å±•ç¤ºäº†æ ¹æ®ä¸šåŠ¡éœ€è¦ï¼Œå°†ç”¨æˆ·è¡¨å’Œè®¢å•è¡¨å‚ç›´åˆ†ç‰‡åˆ°ä¸åŒçš„æ•°æ®åº“çš„æ–¹æ¡ˆï¼š</p><p><img src="https://www.naste.top:9000/images/image-20220804221855449.png" alt="image-20220804221855449"></p><p>å‚ç›´æ‹†åˆ†å¯ä»¥ç¼“è§£æ•°æ®é‡å’Œè®¿é—®é‡å¸¦æ¥çš„é—®é¢˜ï¼Œä½†æ— æ³•æ ¹æ²»ã€‚<code>å¦‚æœå‚ç›´æ‹†åˆ†ä¹‹åï¼Œè¡¨ä¸­çš„æ•°æ®é‡ä¾ç„¶è¶…è¿‡å•èŠ‚ç‚¹æ‰€èƒ½æ‰¿è½½çš„é˜ˆå€¼ï¼Œåˆ™éœ€è¦æ°´å¹³åˆ†ç‰‡æ¥è¿›ä¸€æ­¥å¤„ç†ã€‚</code></p><p><strong>å‚ç›´åˆ†è¡¨ï¼š</strong></p><p><code>å‚ç›´åˆ†è¡¨é€‚åˆå°†è¡¨ä¸­æŸäº›ä¸å¸¸ç”¨çš„åˆ—ï¼Œæˆ–è€…æ˜¯å äº†å¤§é‡ç©ºé—´çš„åˆ—æ‹†åˆ†å‡ºå»ã€‚</code></p><p>å‡è®¾æˆ‘ä»¬æ˜¯ä¸€ä¸ªå©šæ‹ç½‘ç«™ï¼Œç”¨æˆ·åœ¨ç­›é€‰å…¶ä»–ç”¨æˆ·çš„æ—¶å€™ï¼Œä¸»è¦æ˜¯ç”¨ age å’Œ sex ä¸¤ä¸ªå­—æ®µè¿›è¡ŒæŸ¥è¯¢ï¼Œè€Œ nickname å’Œ description ä¸¤ä¸ªå­—æ®µä¸»è¦ç”¨äºå±•ç¤ºï¼Œä¸€èˆ¬ä¸ä¼šåœ¨ä¸šåŠ¡æŸ¥è¯¢ä¸­ç”¨åˆ°ã€‚description æœ¬èº«åˆæ¯”è¾ƒé•¿ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å°†è¿™ä¸¤ä¸ªå­—æ®µç‹¬ç«‹åˆ°å¦å¤–ä¸€å¼ è¡¨ä¸­ï¼Œè¿™æ ·åœ¨æŸ¥è¯¢ age å’Œ sex æ—¶ï¼Œå°±èƒ½å¸¦æ¥ä¸€å®šçš„æ€§èƒ½æå‡ã€‚</p><p>å‚ç›´åˆ†è¡¨å¼•å…¥çš„å¤æ‚æ€§ä¸»è¦ä½“ç°åœ¨è¡¨æ“ä½œçš„æ•°é‡è¦å¢åŠ ã€‚ä¾‹å¦‚ï¼ŒåŸæ¥åªè¦ä¸€æ¬¡æŸ¥è¯¢å°±å¯ä»¥è·å– nameã€ageã€sexã€nicknameã€descriptionï¼Œç°åœ¨éœ€è¦ä¸¤æ¬¡æŸ¥è¯¢ï¼Œä¸€æ¬¡æŸ¥è¯¢è·å– nameã€ageã€sexï¼Œå¦å¤–ä¸€æ¬¡æŸ¥è¯¢è·å– nicknameã€descriptionã€‚</p><p><img src="https://www.naste.top:9000/images/136bc2f01919edcb8271df6f7e71af40.jpg" alt="img"></p><p><code>æ°´å¹³åˆ†è¡¨é€‚åˆè¡¨è¡Œæ•°ç‰¹åˆ«å¤§çš„è¡¨ï¼Œæ°´å¹³åˆ†è¡¨å±äºæ°´å¹³åˆ†ç‰‡</code>ã€‚</p><h3 id="2-2ã€æ°´å¹³åˆ†ç‰‡"><a href="#2-2ã€æ°´å¹³åˆ†ç‰‡" class="headerlink" title="2.2ã€æ°´å¹³åˆ†ç‰‡"></a>2.2ã€æ°´å¹³åˆ†ç‰‡</h3><p><code>æ°´å¹³åˆ†ç‰‡åˆç§°ä¸ºæ¨ªå‘æ‹†åˆ†ã€‚</code> ç›¸å¯¹äºå‚ç›´åˆ†ç‰‡ï¼Œå®ƒä¸å†å°†æ•°æ®æ ¹æ®ä¸šåŠ¡é€»è¾‘åˆ†ç±»ï¼Œè€Œæ˜¯é€šè¿‡æŸä¸ªå­—æ®µï¼ˆæˆ–æŸå‡ ä¸ªå­—æ®µï¼‰ï¼Œæ ¹æ®æŸç§è§„åˆ™å°†æ•°æ®åˆ†æ•£è‡³å¤šä¸ªåº“æˆ–è¡¨ä¸­ï¼Œæ¯ä¸ªåˆ†ç‰‡ä»…åŒ…å«æ•°æ®çš„ä¸€éƒ¨åˆ†ã€‚ ä¾‹å¦‚ï¼šæ ¹æ®ä¸»é”®åˆ†ç‰‡ï¼Œå¶æ•°ä¸»é”®çš„è®°å½•æ”¾å…¥ 0 åº“ï¼ˆæˆ–è¡¨ï¼‰ï¼Œå¥‡æ•°ä¸»é”®çš„è®°å½•æ”¾å…¥ 1 åº“ï¼ˆæˆ–è¡¨ï¼‰ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src="https://www.naste.top:9000/images/image-20220804222212087.png" alt="image-20220804222212087"></p><p><code>å•è¡¨è¿›è¡Œåˆ‡åˆ†åï¼Œæ˜¯å¦å°†å¤šä¸ªè¡¨åˆ†æ•£åœ¨ä¸åŒçš„æ•°æ®åº“æœåŠ¡å™¨ä¸­ï¼Œå¯ä»¥æ ¹æ®å®é™…çš„åˆ‡åˆ†æ•ˆæœæ¥ç¡®å®šã€‚</code></p><ul><li><p><strong>æ°´å¹³åˆ†è¡¨ï¼š</strong>å•è¡¨åˆ‡åˆ†ä¸ºå¤šè¡¨åï¼Œæ–°çš„è¡¨å³ä½¿åœ¨åŒä¸€ä¸ªæ•°æ®åº“æœåŠ¡å™¨ä¸­ï¼Œä¹Ÿå¯èƒ½å¸¦æ¥å¯è§‚çš„æ€§èƒ½æå‡ï¼Œå¦‚æœæ€§èƒ½èƒ½å¤Ÿæ»¡è¶³ä¸šåŠ¡è¦æ±‚ï¼Œå¯ä»¥ä¸æ‹†åˆ†åˆ°å¤šå°æ•°æ®åº“æœåŠ¡å™¨ï¼Œæ¯•ç«Ÿä¸šåŠ¡åˆ†åº“ä¹Ÿä¼šå¼•å…¥å¾ˆå¤šå¤æ‚æ€§ï¼›</p></li><li><p><strong>æ°´å¹³åˆ†åº“ï¼š</strong>å¦‚æœå•è¡¨æ‹†åˆ†ä¸ºå¤šè¡¨åï¼Œå•å°æœåŠ¡å™¨ä¾ç„¶æ— æ³•æ»¡è¶³æ€§èƒ½è¦æ±‚ï¼Œé‚£å°±éœ€è¦å°†å¤šä¸ªè¡¨åˆ†æ•£åœ¨ä¸åŒçš„æ•°æ®åº“æœåŠ¡å™¨ä¸­ã€‚</p></li></ul><blockquote><p><strong>é˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œï¼š</strong></p><p>ã€æ¨èã€‘å•è¡¨è¡Œæ•°è¶…è¿‡ 500 ä¸‡è¡Œæˆ–è€…å•è¡¨å®¹é‡è¶…è¿‡ 2GBï¼Œæ‰æ¨èè¿›è¡Œåˆ†åº“åˆ†è¡¨ã€‚</p><p>è¯´æ˜ï¼šå¦‚æœé¢„è®¡ä¸‰å¹´åçš„æ•°æ®é‡æ ¹æœ¬è¾¾ä¸åˆ°è¿™ä¸ªçº§åˆ«ï¼Œ<code>è¯·ä¸è¦åœ¨åˆ›å»ºè¡¨æ—¶å°±åˆ†åº“åˆ†è¡¨</code>ã€‚</p></blockquote><h2 id="3ã€è¯»å†™åˆ†ç¦»å’Œæ•°æ®åˆ†ç‰‡æ¶æ„"><a href="#3ã€è¯»å†™åˆ†ç¦»å’Œæ•°æ®åˆ†ç‰‡æ¶æ„" class="headerlink" title="3ã€è¯»å†™åˆ†ç¦»å’Œæ•°æ®åˆ†ç‰‡æ¶æ„"></a>3ã€è¯»å†™åˆ†ç¦»å’Œæ•°æ®åˆ†ç‰‡æ¶æ„</h2><p> ä¸‹å›¾å±•ç°äº†å°†æ•°æ®åˆ†ç‰‡ä¸è¯»å†™åˆ†ç¦»ä¸€åŒä½¿ç”¨æ—¶ï¼Œåº”ç”¨ç¨‹åºä¸æ•°æ®åº“é›†ç¾¤ä¹‹é—´çš„å¤æ‚æ‹“æ‰‘å…³ç³»ã€‚</p><p><img src="https://www.naste.top:9000/images/image-20220804223321167.png" alt="image-20220804223321167"></p><h2 id="4ã€å®ç°æ–¹å¼"><a href="#4ã€å®ç°æ–¹å¼" class="headerlink" title="4ã€å®ç°æ–¹å¼"></a>4ã€å®ç°æ–¹å¼</h2><p>è¯»å†™åˆ†ç¦»å’Œæ•°æ®åˆ†ç‰‡å…·ä½“çš„å®ç°æ–¹å¼ä¸€èˆ¬æœ‰ä¸¤ç§ï¼š  <code>ç¨‹åºä»£ç å°è£…</code>å’Œ<code>ä¸­é—´ä»¶å°è£…</code>ã€‚</p><h3 id="4-1ã€ç¨‹åºä»£ç å°è£…"><a href="#4-1ã€ç¨‹åºä»£ç å°è£…" class="headerlink" title="4.1ã€ç¨‹åºä»£ç å°è£…"></a>4.1ã€ç¨‹åºä»£ç å°è£…</h3><p>ç¨‹åºä»£ç å°è£…æŒ‡åœ¨ä»£ç ä¸­æŠ½è±¡ä¸€ä¸ª<code>æ•°æ®è®¿é—®å±‚ï¼ˆæˆ–ä¸­é—´å±‚å°è£…ï¼‰</code>ï¼Œå®ç°è¯»å†™æ“ä½œåˆ†ç¦»å’Œæ•°æ®åº“æœåŠ¡å™¨è¿æ¥çš„ç®¡ç†ã€‚</p><p><strong>å…¶åŸºæœ¬æ¶æ„æ˜¯ï¼š</strong>ä»¥è¯»å†™åˆ†ç¦»ä¸ºä¾‹</p><p><img src="https://www.naste.top:9000/images/f8d538f9201e3ebee37dfdcd1922e9df.jpg" alt="img"></p><h3 id="4-2ã€ä¸­é—´ä»¶å°è£…"><a href="#4-2ã€ä¸­é—´ä»¶å°è£…" class="headerlink" title="4.2ã€ä¸­é—´ä»¶å°è£…"></a>4.2ã€ä¸­é—´ä»¶å°è£…</h3><p>ä¸­é—´ä»¶å°è£…æŒ‡çš„æ˜¯<code>ç‹¬ç«‹ä¸€å¥—ç³»ç»Ÿå‡ºæ¥</code>ï¼Œå®ç°è¯»å†™æ“ä½œåˆ†ç¦»å’Œæ•°æ®åº“æœåŠ¡å™¨è¿æ¥çš„ç®¡ç†ã€‚å¯¹äºä¸šåŠ¡æœåŠ¡å™¨æ¥è¯´ï¼Œè®¿é—®ä¸­é—´ä»¶å’Œè®¿é—®æ•°æ®åº“æ²¡æœ‰åŒºåˆ«ï¼Œåœ¨ä¸šåŠ¡æœåŠ¡å™¨çœ‹æ¥ï¼Œä¸­é—´ä»¶å°±æ˜¯ä¸€ä¸ªæ•°æ®åº“æœåŠ¡å™¨ã€‚</p><p><strong>åŸºæœ¬æ¶æ„æ˜¯ï¼š</strong>ä»¥è¯»å†™åˆ†ç¦»ä¸ºä¾‹</p><p><img src="https://www.naste.top:9000/images/2a2dba7f07581fd055d9cd5a3aa8388e.jpg" alt="img"></p><h3 id="4-3ã€å¸¸ç”¨è§£å†³æ–¹æ¡ˆ"><a href="#4-3ã€å¸¸ç”¨è§£å†³æ–¹æ¡ˆ" class="headerlink" title="4.3ã€å¸¸ç”¨è§£å†³æ–¹æ¡ˆ"></a>4.3ã€å¸¸ç”¨è§£å†³æ–¹æ¡ˆ</h3><p>Apache ShardingSphereï¼ˆç¨‹åºçº§åˆ«å’Œä¸­é—´ä»¶çº§åˆ«ï¼‰</p><p>MyCatï¼ˆæ•°æ®åº“ä¸­é—´ä»¶ï¼‰ </p><h1 id="ç¬¬02ç« -ShardingSphere"><a href="#ç¬¬02ç« -ShardingSphere" class="headerlink" title="ç¬¬02ç«  ShardingSphere"></a>ç¬¬02ç«  ShardingSphere</h1><h2 id="1ã€ç®€ä»‹"><a href="#1ã€ç®€ä»‹" class="headerlink" title="1ã€ç®€ä»‹"></a>1ã€ç®€ä»‹</h2><p>å®˜ç½‘ï¼š<a href="https://shardingsphere.apache.org/index_zh.html">https://shardingsphere.apache.org/index_zh.html</a></p><p>æ–‡æ¡£ï¼š<a href="https://shardingsphere.apache.org/document/5.1.1/cn/overview/">https://shardingsphere.apache.org/document/5.1.1/cn/overview/</a></p><p>Apache ShardingSphere ç”± JDBCã€Proxy å’Œ Sidecarï¼ˆè§„åˆ’ä¸­ï¼‰è¿™ 3 æ¬¾æ—¢èƒ½å¤Ÿç‹¬ç«‹éƒ¨ç½²ï¼Œåˆæ”¯æŒæ··åˆéƒ¨ç½²é…åˆä½¿ç”¨çš„äº§å“ç»„æˆã€‚ </p><h2 id="2ã€ShardingSphere-JDBC"><a href="#2ã€ShardingSphere-JDBC" class="headerlink" title="2ã€ShardingSphere-JDBC"></a>2ã€ShardingSphere-JDBC</h2><p><strong>ç¨‹åºä»£ç å°è£…</strong></p><p>å®šä½ä¸ºè½»é‡çº§ Java æ¡†æ¶ï¼Œ<code>åœ¨ Java çš„ JDBC å±‚æä¾›çš„é¢å¤–æœåŠ¡</code>ã€‚ å®ƒä½¿ç”¨å®¢æˆ·ç«¯ç›´è¿æ•°æ®åº“ï¼Œ<code>ä»¥ jar åŒ…å½¢å¼æä¾›æœåŠ¡</code>ï¼Œæ— éœ€é¢å¤–éƒ¨ç½²å’Œä¾èµ–ï¼Œå¯ç†è§£ä¸ºå¢å¼ºç‰ˆçš„ JDBC é©±åŠ¨ï¼Œå®Œå…¨å…¼å®¹ JDBC å’Œå„ç§ ORM æ¡†æ¶ã€‚</p><p><img src="https://www.naste.top:9000/images/image-20220804195402870.png" alt="image-20220804195402870"></p><h2 id="3ã€ShardingSphere-Proxy"><a href="#3ã€ShardingSphere-Proxy" class="headerlink" title="3ã€ShardingSphere-Proxy"></a>3ã€ShardingSphere-Proxy</h2><p><strong>ä¸­é—´ä»¶å°è£…</strong></p><p>å®šä½ä¸ºé€æ˜åŒ–çš„<code>æ•°æ®åº“ä»£ç†ç«¯</code>ï¼Œæä¾›å°è£…äº†æ•°æ®åº“äºŒè¿›åˆ¶åè®®çš„æœåŠ¡ç«¯ç‰ˆæœ¬ï¼Œç”¨äºå®Œæˆå¯¹å¼‚æ„è¯­è¨€çš„æ”¯æŒã€‚ ç›®å‰æä¾› MySQL å’Œ PostgreSQLç‰ˆæœ¬ï¼Œå®ƒå¯ä»¥ä½¿ç”¨ä»»ä½•å…¼å®¹ MySQL/PostgreSQL åè®®çš„è®¿é—®å®¢æˆ·ç«¯ï¼ˆå¦‚ï¼šMySQL Command Client, MySQL Workbench, Navicat ç­‰ï¼‰æ“ä½œæ•°æ®ï¼Œå¯¹ DBA æ›´åŠ å‹å¥½ã€‚</p><p><img src="https://www.naste.top:9000/images/image-20220804195432673.png" alt="image-20220804195432673"></p><h1 id="ç¬¬03ç« -MySQLä¸»ä»åŒæ­¥"><a href="#ç¬¬03ç« -MySQLä¸»ä»åŒæ­¥" class="headerlink" title="ç¬¬03ç«  MySQLä¸»ä»åŒæ­¥"></a>ç¬¬03ç«  MySQLä¸»ä»åŒæ­¥</h1><h2 id="1ã€MySQLä¸»ä»åŒæ­¥åŸç†"><a href="#1ã€MySQLä¸»ä»åŒæ­¥åŸç†" class="headerlink" title="1ã€MySQLä¸»ä»åŒæ­¥åŸç†"></a>1ã€MySQLä¸»ä»åŒæ­¥åŸç†</h2><p><img src="https://www.naste.top:9000/images/image-20220714133617856.png" alt="img"></p><p><strong>åŸºæœ¬åŸç†ï¼š</strong></p><p>slaveä¼šä»masterè¯»å–binlogæ¥è¿›è¡Œæ•°æ®åŒæ­¥</p><p><strong>å…·ä½“æ­¥éª¤ï¼š</strong></p><ul><li><code>step1ï¼š</code>masterå°†æ•°æ®æ”¹å˜è®°å½•åˆ°<code>äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆbinary logï¼‰</code>ä¸­ã€‚</li><li><code>step2ï¼š</code> å½“slaveä¸Šæ‰§è¡Œ <code>start slave</code> å‘½ä»¤ä¹‹åï¼Œslaveä¼šåˆ›å»ºä¸€ä¸ª <code>IO çº¿ç¨‹</code>ç”¨æ¥è¿æ¥masterï¼Œè¯·æ±‚masterä¸­çš„binlogã€‚</li><li><code>step3ï¼š</code>å½“slaveè¿æ¥masteræ—¶ï¼Œmasterä¼šåˆ›å»ºä¸€ä¸ª <code>log dump çº¿ç¨‹</code>ï¼Œç”¨äºå‘é€ binlog çš„å†…å®¹ã€‚åœ¨è¯»å– binlog çš„å†…å®¹çš„æ“ä½œä¸­ï¼Œä¼šå¯¹ä¸»èŠ‚ç‚¹ä¸Šçš„ binlog åŠ é”ï¼Œå½“è¯»å–å®Œæˆå¹¶å‘é€ç»™ä»æœåŠ¡å™¨åè§£é”ã€‚</li><li><code>step4ï¼š</code>IO çº¿ç¨‹æ¥æ”¶ä¸»èŠ‚ç‚¹ binlog dump è¿›ç¨‹å‘æ¥çš„æ›´æ–°ä¹‹åï¼Œä¿å­˜åˆ° <code>ä¸­ç»§æ—¥å¿—ï¼ˆrelay logï¼‰</code> ä¸­ã€‚</li><li><code>step5ï¼š</code>slaveçš„<code>SQLçº¿ç¨‹</code>ï¼Œè¯»å–relay logæ—¥å¿—ï¼Œå¹¶è§£ææˆå…·ä½“æ“ä½œï¼Œä»è€Œå®ç°ä¸»ä»æ“ä½œä¸€è‡´ï¼Œæœ€ç»ˆæ•°æ®ä¸€è‡´ã€‚</li></ul><h2 id="2ã€ä¸€ä¸»å¤šä»é…ç½®"><a href="#2ã€ä¸€ä¸»å¤šä»é…ç½®" class="headerlink" title="2ã€ä¸€ä¸»å¤šä»é…ç½®"></a>2ã€ä¸€ä¸»å¤šä»é…ç½®</h2><p>æœåŠ¡å™¨è§„åˆ’ï¼šä½¿ç”¨<code>docker</code>æ–¹å¼åˆ›å»ºï¼Œ<code>ä¸»ä»æœåŠ¡å™¨IPä¸€è‡´ï¼Œç«¯å£å·ä¸ä¸€è‡´</code></p><p><img src="https://www.naste.top:9000/images/image-20220807183231101.png" alt="image-20220807183231101"></p><ul><li>ä¸»æœåŠ¡å™¨ï¼šå®¹å™¨å<code>xiaofei-mysql-master</code>ï¼Œç«¯å£<code>3306</code></li><li>ä»æœåŠ¡å™¨ï¼šå®¹å™¨å<code>xiaofei-mysql-slave1</code>ï¼Œç«¯å£<code>3307</code></li><li>ä»æœåŠ¡å™¨ï¼šå®¹å™¨å<code>xiaofei-mysql-slave2</code>ï¼Œç«¯å£<code>3308</code></li></ul><p><strong>æ³¨æ„ï¼š</strong>å¦‚æœæ­¤æ—¶é˜²ç«å¢™æ˜¯å¼€å¯çš„ï¼Œ<code>åˆ™å…ˆå…³é—­é˜²ç«å¢™ï¼Œå¹¶é‡å¯docker</code>ï¼Œå¦åˆ™åç»­å®‰è£…çš„MySQLæ— æ³•å¯åŠ¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å…³é—­docker</span></span><br><span class="line">systemctl stop docker</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å…³é—­é˜²ç«å¢™</span></span><br><span class="line">systemctl stop firewalld</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å¯åŠ¨docker</span></span><br><span class="line">systemctl start docker</span><br></pre></td></tr></table></figure><h3 id="2-1ã€å‡†å¤‡ä¸»æœåŠ¡å™¨"><a href="#2-1ã€å‡†å¤‡ä¸»æœåŠ¡å™¨" class="headerlink" title="2.1ã€å‡†å¤‡ä¸»æœåŠ¡å™¨"></a>2.1ã€å‡†å¤‡ä¸»æœåŠ¡å™¨</h3><ul><li><strong>step1ï¼šåœ¨dockerä¸­åˆ›å»ºå¹¶å¯åŠ¨MySQLä¸»æœåŠ¡å™¨ï¼š</strong><code>ç«¯å£3306</code></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">-p 3306:3306 \</span><br><span class="line">-v /xiaofei/mysql/master/conf:/etc/mysql/conf.d \</span><br><span class="line">-v /xiaofei/mysql/master/data:/var/lib/mysql \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=123456 \</span><br><span class="line">--name xiaofei-mysql-master \</span><br><span class="line">mysql:8.0.29</span><br></pre></td></tr></table></figure><ul><li><strong>step2ï¼šåˆ›å»ºMySQLä¸»æœåŠ¡å™¨é…ç½®æ–‡ä»¶ï¼š</strong> </li></ul><p>é»˜è®¤æƒ…å†µä¸‹MySQLçš„binlogæ—¥å¿—æ˜¯è‡ªåŠ¨å¼€å¯çš„ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹é…ç½®å®šä¹‰ä¸€äº›å¯é€‰é…ç½®</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /xiaofei/mysql/master/conf/my.cnf</span><br></pre></td></tr></table></figure><p>é…ç½®å¦‚ä¸‹å†…å®¹</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[mysqld]</span></span><br><span class="line"><span class="comment"># æœåŠ¡å™¨å”¯ä¸€idï¼Œé»˜è®¤å€¼1</span></span><br><span class="line"><span class="attr">server-id</span>=<span class="string">1</span></span><br><span class="line"><span class="comment"># è®¾ç½®æ—¥å¿—æ ¼å¼ï¼Œé»˜è®¤å€¼ROW</span></span><br><span class="line"><span class="attr">binlog_format</span>=<span class="string">STATEMENT</span></span><br><span class="line"><span class="comment"># äºŒè¿›åˆ¶æ—¥å¿—åï¼Œé»˜è®¤binlog</span></span><br><span class="line"><span class="comment"># log-bin=binlog</span></span><br><span class="line"><span class="comment"># è®¾ç½®éœ€è¦å¤åˆ¶çš„æ•°æ®åº“ï¼Œé»˜è®¤å¤åˆ¶å…¨éƒ¨æ•°æ®åº“</span></span><br><span class="line"><span class="comment">#binlog-do-db=mytestdb</span></span><br><span class="line"><span class="comment"># è®¾ç½®ä¸éœ€è¦å¤åˆ¶çš„æ•°æ®åº“</span></span><br><span class="line"><span class="comment">#binlog-ignore-db=mysql</span></span><br><span class="line"><span class="comment">#binlog-ignore-db=infomation_schema</span></span><br></pre></td></tr></table></figure><p>é‡å¯MySQLå®¹å™¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker restart xiaofei-mysql-master</span><br></pre></td></tr></table></figure><p><code>binlogæ ¼å¼è¯´æ˜ï¼š</code></p><ul><li>binlog_format=STATEMENTï¼šæ—¥å¿—è®°å½•çš„æ˜¯ä¸»æœºæ•°æ®åº“çš„<code>å†™æŒ‡ä»¤</code>ï¼Œæ€§èƒ½é«˜ï¼Œä½†æ˜¯now()ä¹‹ç±»çš„å‡½æ•°ä»¥åŠè·å–ç³»ç»Ÿå‚æ•°çš„æ“ä½œä¼šå‡ºç°ä¸»ä»æ•°æ®ä¸åŒæ­¥çš„é—®é¢˜ã€‚</li><li>binlog_format=ROWï¼ˆé»˜è®¤ï¼‰ï¼šæ—¥å¿—è®°å½•çš„æ˜¯ä¸»æœºæ•°æ®åº“çš„<code>å†™åçš„æ•°æ®</code>ï¼Œæ‰¹é‡æ“ä½œæ—¶æ€§èƒ½è¾ƒå·®ï¼Œè§£å†³now()æˆ–è€…  user()æˆ–è€…  @@hostname ç­‰æ“ä½œåœ¨ä¸»ä»æœºå™¨ä¸Šä¸ä¸€è‡´çš„é—®é¢˜ã€‚</li><li>binlog_format=MIXEDï¼šæ˜¯ä»¥ä¸Šä¸¤ç§levelçš„æ··åˆä½¿ç”¨ï¼Œæœ‰å‡½æ•°ç”¨ROWï¼Œæ²¡å‡½æ•°ç”¨STATEMENTï¼Œä½†æ˜¯æ— æ³•è¯†åˆ«ç³»ç»Ÿå˜é‡</li></ul><p><code>binlog-ignore-dbå’Œbinlog-do-dbçš„ä¼˜å…ˆçº§é—®é¢˜ï¼š</code></p><p><img src="https://www.naste.top:9000/images/0.08703112216569037.png" alt="img"></p><ul><li><strong>step3ï¼šä½¿ç”¨å‘½ä»¤è¡Œç™»å½•MySQLä¸»æœåŠ¡å™¨ï¼š</strong></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">è¿›å…¥å®¹å™¨ï¼š<span class="built_in">env</span> LANG=C.UTF-8 é¿å…å®¹å™¨ä¸­æ˜¾ç¤ºä¸­æ–‡ä¹±ç </span></span><br><span class="line">docker exec -it xiaofei-mysql-master env LANG=C.UTF-8 /bin/bash</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">è¿›å…¥å®¹å™¨å†…çš„mysqlå‘½ä»¤è¡Œ</span></span><br><span class="line">mysql -uroot -p</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">ä¿®æ”¹é»˜è®¤å¯†ç æ ¡éªŒæ–¹å¼</span></span><br><span class="line">ALTER USER &#x27;root&#x27;@&#x27;%&#x27; IDENTIFIED WITH mysql_native_password BY &#x27;123456&#x27;;</span><br></pre></td></tr></table></figure><ul><li><strong>step4ï¼šä¸»æœºä¸­åˆ›å»ºslaveç”¨æˆ·ï¼š</strong></li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- åˆ›å»ºslaveç”¨æˆ·</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;xiaofei_slave&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"><span class="comment">-- è®¾ç½®å¯†ç </span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> <span class="string">&#x27;xiaofei_slave&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">WITH</span> mysql_native_password <span class="keyword">BY</span> <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line"><span class="comment">-- æˆäºˆå¤åˆ¶æƒé™</span></span><br><span class="line"><span class="keyword">GRANT</span> REPLICATION SLAVE <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;xiaofei_slave&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"><span class="comment">-- åˆ·æ–°æƒé™</span></span><br><span class="line">FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure><ul><li><strong>step5ï¼šä¸»æœºä¸­æŸ¥è¯¢masterçŠ¶æ€ï¼š</strong></li></ul><p>æ‰§è¡Œå®Œæ­¤æ­¥éª¤å<code>ä¸è¦å†æ“ä½œä¸»æœåŠ¡å™¨MYSQL</code>ï¼Œé˜²æ­¢ä¸»æœåŠ¡å™¨çŠ¶æ€å€¼å˜åŒ–</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> MASTER STATUS;</span><br></pre></td></tr></table></figure><p>è®°ä¸‹<code>File</code>å’Œ<code>Position</code>çš„å€¼ã€‚æ‰§è¡Œå®Œæ­¤æ­¥éª¤åä¸è¦å†æ“ä½œä¸»æœåŠ¡å™¨MYSQLï¼Œé˜²æ­¢ä¸»æœåŠ¡å™¨çŠ¶æ€å€¼å˜åŒ–ã€‚</p><p><img src="https://www.naste.top:9000/images/image-20220804191852164.png" alt="image-20220804191852164"></p><h3 id="2-2ã€å‡†å¤‡ä»æœåŠ¡å™¨"><a href="#2-2ã€å‡†å¤‡ä»æœåŠ¡å™¨" class="headerlink" title="2.2ã€å‡†å¤‡ä»æœåŠ¡å™¨"></a>2.2ã€å‡†å¤‡ä»æœåŠ¡å™¨</h3><p>å¯ä»¥é…ç½®å¤šå°ä»æœºslave1ã€slave2â€¦ï¼Œè¿™é‡Œä»¥é…ç½®slave1ä¸ºä¾‹</p><ul><li><strong>step1ï¼šåœ¨dockerä¸­åˆ›å»ºå¹¶å¯åŠ¨MySQLä»æœåŠ¡å™¨ï¼š</strong><code>ç«¯å£3307</code></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">-p 3307:3306 \</span><br><span class="line">-v /xiaofei/mysql/slave1/conf:/etc/mysql/conf.d \</span><br><span class="line">-v /xiaofei/mysql/slave1/data:/var/lib/mysql \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=123456 \</span><br><span class="line">--name xiaofei-mysql-slave1 \</span><br><span class="line">mysql:8.0.29</span><br></pre></td></tr></table></figure><ul><li><strong>step2ï¼šåˆ›å»ºMySQLä»æœåŠ¡å™¨é…ç½®æ–‡ä»¶ï¼š</strong> </li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /xiaofei/mysql/slave1/conf/my.cnf</span><br></pre></td></tr></table></figure><p>é…ç½®å¦‚ä¸‹å†…å®¹ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[mysqld]</span></span><br><span class="line"><span class="comment"># æœåŠ¡å™¨å”¯ä¸€idï¼Œæ¯å°æœåŠ¡å™¨çš„idå¿…é¡»ä¸åŒï¼Œå¦‚æœé…ç½®å…¶ä»–ä»æœºï¼Œæ³¨æ„ä¿®æ”¹id</span></span><br><span class="line"><span class="attr">server-id</span>=<span class="string">2</span></span><br><span class="line"><span class="comment"># ä¸­ç»§æ—¥å¿—åï¼Œé»˜è®¤xxxxxxxxxxxx-relay-bin</span></span><br><span class="line"><span class="comment">#relay-log=relay-bin</span></span><br></pre></td></tr></table></figure><p>é‡å¯MySQLå®¹å™¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker restart xiaofei-mysql-slave1</span><br></pre></td></tr></table></figure><ul><li><strong>step3ï¼šä½¿ç”¨å‘½ä»¤è¡Œç™»å½•MySQLä»æœåŠ¡å™¨ï¼š</strong></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">è¿›å…¥å®¹å™¨ï¼š</span></span><br><span class="line">docker exec -it xiaofei-mysql-slave1 env LANG=C.UTF-8 /bin/bash</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">è¿›å…¥å®¹å™¨å†…çš„mysqlå‘½ä»¤è¡Œ</span></span><br><span class="line">mysql -uroot -p</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">ä¿®æ”¹é»˜è®¤å¯†ç æ ¡éªŒæ–¹å¼</span></span><br><span class="line">ALTER USER &#x27;root&#x27;@&#x27;%&#x27; IDENTIFIED WITH mysql_native_password BY &#x27;123456&#x27;;</span><br></pre></td></tr></table></figure><ul><li><strong>step4ï¼šåœ¨ä»æœºä¸Šé…ç½®ä¸»ä»å…³ç³»ï¼š</strong></li></ul><p>åœ¨<strong>ä»æœº</strong>ä¸Šæ‰§è¡Œä»¥ä¸‹SQLæ“ä½œ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CHANGE MASTER <span class="keyword">TO</span> MASTER_HOST<span class="operator">=</span><span class="string">&#x27;192.168.100.201&#x27;</span>, </span><br><span class="line">MASTER_USER<span class="operator">=</span><span class="string">&#x27;xiaofei_slave&#x27;</span>,MASTER_PASSWORD<span class="operator">=</span><span class="string">&#x27;123456&#x27;</span>, MASTER_PORT<span class="operator">=</span><span class="number">3306</span>,</span><br><span class="line">MASTER_LOG_FILE<span class="operator">=</span><span class="string">&#x27;binlog.000003&#x27;</span>,MASTER_LOG_POS<span class="operator">=</span><span class="number">1357</span>; </span><br></pre></td></tr></table></figure><h3 id="2-3ã€å¯åŠ¨ä¸»ä»åŒæ­¥"><a href="#2-3ã€å¯åŠ¨ä¸»ä»åŒæ­¥" class="headerlink" title="2.3ã€å¯åŠ¨ä¸»ä»åŒæ­¥"></a>2.3ã€å¯åŠ¨ä¸»ä»åŒæ­¥</h3><p>å¯åŠ¨ä»æœºçš„å¤åˆ¶åŠŸèƒ½ï¼Œæ‰§è¡ŒSQLï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">START</span> SLAVE;</span><br><span class="line"><span class="comment">-- æŸ¥çœ‹çŠ¶æ€ï¼ˆä¸éœ€è¦åˆ†å·ï¼‰</span></span><br><span class="line"><span class="keyword">SHOW</span> SLAVE STATUS\G</span><br></pre></td></tr></table></figure><p><strong>ä¸¤ä¸ªå…³é”®è¿›ç¨‹ï¼š</strong>ä¸‹é¢ä¸¤ä¸ªå‚æ•°éƒ½æ˜¯Yesï¼Œåˆ™è¯´æ˜ä¸»ä»é…ç½®æˆåŠŸï¼</p><p><img src="https://www.naste.top:9000/images/image-20220715000533951.png" alt="img"></p><h3 id="2-4ã€å®ç°ä¸»ä»åŒæ­¥"><a href="#2-4ã€å®ç°ä¸»ä»åŒæ­¥" class="headerlink" title="2.4ã€å®ç°ä¸»ä»åŒæ­¥"></a>2.4ã€å®ç°ä¸»ä»åŒæ­¥</h3><p>åœ¨ä¸»æœºä¸­æ‰§è¡Œä»¥ä¸‹SQLï¼Œåœ¨ä»æœºä¸­æŸ¥çœ‹æ•°æ®åº“ã€è¡¨å’Œæ•°æ®æ˜¯å¦å·²ç»è¢«åŒæ­¥</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE db_user;</span><br><span class="line">USE db_user;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_user (</span><br><span class="line"> id <span class="type">BIGINT</span> AUTO_INCREMENT,</span><br><span class="line"> uname <span class="type">VARCHAR</span>(<span class="number">30</span>),</span><br><span class="line"> <span class="keyword">PRIMARY</span> KEY (id)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_user(uname) <span class="keyword">VALUES</span>(<span class="string">&#x27;zhang3&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_user(uname) <span class="keyword">VALUES</span>(@<span class="variable">@hostname</span>);</span><br></pre></td></tr></table></figure><h3 id="2-5ã€åœæ­¢å’Œé‡ç½®"><a href="#2-5ã€åœæ­¢å’Œé‡ç½®" class="headerlink" title="2.5ã€åœæ­¢å’Œé‡ç½®"></a>2.5ã€åœæ­¢å’Œé‡ç½®</h3><p>éœ€è¦çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹SQLè¯­å¥</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- åœ¨ä»æœºä¸Šæ‰§è¡Œã€‚åŠŸèƒ½è¯´æ˜ï¼šåœæ­¢I/O çº¿ç¨‹å’ŒSQLçº¿ç¨‹çš„æ“ä½œã€‚</span></span><br><span class="line">stop slave; </span><br><span class="line"></span><br><span class="line"><span class="comment">-- åœ¨ä»æœºä¸Šæ‰§è¡Œã€‚åŠŸèƒ½è¯´æ˜ï¼šç”¨äºåˆ é™¤SLAVEæ•°æ®åº“çš„relaylogæ—¥å¿—æ–‡ä»¶ï¼Œå¹¶é‡æ–°å¯ç”¨æ–°çš„relaylogæ–‡ä»¶ã€‚</span></span><br><span class="line">reset slave;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- åœ¨ä¸»æœºä¸Šæ‰§è¡Œã€‚åŠŸèƒ½è¯´æ˜ï¼šåˆ é™¤æ‰€æœ‰çš„binglogæ—¥å¿—æ–‡ä»¶ï¼Œå¹¶å°†æ—¥å¿—ç´¢å¼•æ–‡ä»¶æ¸…ç©ºï¼Œé‡æ–°å¼€å§‹æ‰€æœ‰æ–°çš„æ—¥å¿—æ–‡ä»¶ã€‚</span></span><br><span class="line"><span class="comment">-- ç”¨äºç¬¬ä¸€æ¬¡è¿›è¡Œæ­å»ºä¸»ä»åº“æ—¶ï¼Œè¿›è¡Œä¸»åº“binlogåˆå§‹åŒ–å·¥ä½œï¼›</span></span><br><span class="line">reset master;</span><br></pre></td></tr></table></figure><h3 id="2-6ã€å¸¸è§é—®é¢˜"><a href="#2-6ã€å¸¸è§é—®é¢˜" class="headerlink" title="2.6ã€å¸¸è§é—®é¢˜"></a><strong>2.6ã€å¸¸è§é—®é¢˜</strong></h3><h4 id="é—®é¢˜1"><a href="#é—®é¢˜1" class="headerlink" title="é—®é¢˜1"></a>é—®é¢˜1</h4><p>å¯åŠ¨ä¸»ä»åŒæ­¥åï¼Œå¸¸è§é”™è¯¯æ˜¯<code>Slave_IO_Runningï¼š No æˆ–è€… Connecting</code> çš„æƒ…å†µï¼Œæ­¤æ—¶æŸ¥çœ‹ä¸‹æ–¹çš„ <code>Last_IO_ERROR</code>é”™è¯¯æ—¥å¿—ï¼Œæ ¹æ®æ—¥å¿—ä¸­æ˜¾ç¤ºçš„é”™è¯¯ä¿¡æ¯åœ¨ç½‘ä¸Šæœç´¢è§£å†³æ–¹æ¡ˆå³å¯</p><p><img src="https://www.naste.top:9000/images/image-20220714235426120.png" alt="img"></p><p><strong>å…¸å‹çš„é”™è¯¯ä¾‹å¦‚ï¼š</strong><code>Last_IO_Error: Got fatal error 1236 from master when reading data from binary log: &#39;Client requested master to start replication from position &gt; file size&#39;</code></p><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- åœ¨ä»æœºåœæ­¢slave</span></span><br><span class="line">SLAVE STOP;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- åœ¨ä¸»æœºæŸ¥çœ‹materçŠ¶æ€</span></span><br><span class="line"><span class="keyword">SHOW</span> MASTER STATUS;</span><br><span class="line"><span class="comment">-- åœ¨ä¸»æœºåˆ·æ–°æ—¥å¿—</span></span><br><span class="line">FLUSH LOGS;</span><br><span class="line"><span class="comment">-- å†æ¬¡åœ¨ä¸»æœºæŸ¥çœ‹materçŠ¶æ€ï¼ˆä¼šå‘ç°Fileå’ŒPositionå‘ç”Ÿäº†å˜åŒ–ï¼‰</span></span><br><span class="line"><span class="keyword">SHOW</span> MASTER STATUS;</span><br><span class="line"><span class="comment">-- ä¿®æ”¹ä»æœºè¿æ¥ä¸»æœºçš„SQLï¼Œå¹¶é‡æ–°è¿æ¥å³å¯</span></span><br></pre></td></tr></table></figure><h4 id="é—®é¢˜2"><a href="#é—®é¢˜2" class="headerlink" title="é—®é¢˜2"></a>é—®é¢˜2</h4><p>å¯åŠ¨dockerå®¹å™¨åæç¤º <code>WARNING: IPv4 forwarding is disabled. Networking will not work.</code></p><p><img src="https://www.naste.top:9000/images/image-20220715004850504.png" alt="img"></p><p>æ­¤é”™è¯¯ï¼Œè™½ç„¶ä¸å½±å“ä¸»ä»åŒæ­¥çš„æ­å»ºï¼Œä½†æ˜¯å¦‚æœæƒ³ä»è¿œç¨‹å®¢æˆ·ç«¯é€šè¿‡ä»¥ä¸‹æ–¹å¼è¿æ¥dockerä¸­çš„MySQLåˆ™æ²¡æ³•è¿æ¥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\administrator&gt;mysql -h 192.168.100.201 -P 3306 -u root -p</span><br></pre></td></tr></table></figure><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š</span></span><br><span class="line">vim /usr/lib/sysctl.d/00-system.conf</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">è¿½åŠ </span></span><br><span class="line">net.ipv4.ip_forward=1</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">æ¥ç€é‡å¯ç½‘ç»œ</span></span><br><span class="line">systemctl restart network</span><br></pre></td></tr></table></figure><h1 id="ç¬¬04ç« -ShardingSphere-JDBCè¯»å†™åˆ†ç¦»"><a href="#ç¬¬04ç« -ShardingSphere-JDBCè¯»å†™åˆ†ç¦»" class="headerlink" title="ç¬¬04ç«  ShardingSphere-JDBCè¯»å†™åˆ†ç¦»"></a>ç¬¬04ç«  ShardingSphere-JDBCè¯»å†™åˆ†ç¦»</h1><h2 id="1ã€åˆ›å»ºSpringBootç¨‹åº"><a href="#1ã€åˆ›å»ºSpringBootç¨‹åº" class="headerlink" title="1ã€åˆ›å»ºSpringBootç¨‹åº"></a>1ã€åˆ›å»ºSpringBootç¨‹åº</h2><h3 id="1-1ã€åˆ›å»ºé¡¹ç›®"><a href="#1-1ã€åˆ›å»ºé¡¹ç›®" class="headerlink" title="1.1ã€åˆ›å»ºé¡¹ç›®"></a>1.1ã€åˆ›å»ºé¡¹ç›®</h3><p>é¡¹ç›®ç±»å‹ï¼šSpring Initializr</p><p>SpringBootè„šæ‰‹æ¶ï¼š<a href="http://start.aliyun.com">http://start.aliyun.com</a></p><p>é¡¹ç›®åï¼šsharding-jdbc-demo</p><p>SpringBootç‰ˆæœ¬ï¼š2.3.7.RELEASE</p><h3 id="1-2ã€æ·»åŠ ä¾èµ–"><a href="#1-2ã€æ·»åŠ ä¾èµ–" class="headerlink" title="1.2ã€æ·»åŠ ä¾èµ–"></a>1.2ã€æ·»åŠ ä¾èµ–</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shardingsphere<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shardingsphere-jdbc-core-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.vintage<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-vintage-engine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="1-3ã€åˆ›å»ºå®ä½“ç±»"><a href="#1-3ã€åˆ›å»ºå®ä½“ç±»" class="headerlink" title="1.3ã€åˆ›å»ºå®ä½“ç±»"></a>1.3ã€åˆ›å»ºå®ä½“ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaofei.shardingjdbcdemo.entity;</span><br><span class="line"></span><br><span class="line"><span class="meta">@TableName(&quot;t_user&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="meta">@TableId(type = IdType.AUTO)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String uname;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-4ã€åˆ›å»ºMapper"><a href="#1-4ã€åˆ›å»ºMapper" class="headerlink" title="1.4ã€åˆ›å»ºMapper"></a>1.4ã€åˆ›å»ºMapper</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaofei.shardingjdbcdemo.mapper;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;User&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-5ã€é…ç½®è¯»å†™åˆ†ç¦»"><a href="#1-5ã€é…ç½®è¯»å†™åˆ†ç¦»" class="headerlink" title="1.5ã€é…ç½®è¯»å†™åˆ†ç¦»"></a>1.5ã€é…ç½®è¯»å†™åˆ†ç¦»</h3><p>application.propertiesï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åº”ç”¨åç§°</span></span><br><span class="line"><span class="attr">spring.application.name</span>=<span class="string">sharging-jdbc-demo</span></span><br><span class="line"><span class="comment"># å¼€å‘ç¯å¢ƒè®¾ç½®</span></span><br><span class="line"><span class="attr">spring.profiles.active</span>=<span class="string">dev</span></span><br><span class="line"><span class="comment"># å†…å­˜æ¨¡å¼</span></span><br><span class="line"><span class="attr">spring.shardingsphere.mode.type</span>=<span class="string">Memory</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># é…ç½®çœŸå®æ•°æ®æº</span></span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.names</span>=<span class="string">master,slave1,slave2</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># é…ç½®ç¬¬ 1 ä¸ªæ•°æ®æº</span></span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.master.type</span>=<span class="string">com.zaxxer.hikari.HikariDataSource</span></span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.master.driver-class-name</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.master.jdbc-url</span>=<span class="string">jdbc:mysql://192.168.100.201:3306/db_user</span></span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.master.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.master.password</span>=<span class="string">123456</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># é…ç½®ç¬¬ 2 ä¸ªæ•°æ®æº</span></span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.slave1.type</span>=<span class="string">com.zaxxer.hikari.HikariDataSource</span></span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.slave1.driver-class-name</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.slave1.jdbc-url</span>=<span class="string">jdbc:mysql://192.168.100.201:3307/db_user</span></span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.slave1.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.slave1.password</span>=<span class="string">123456</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># é…ç½®ç¬¬ 3 ä¸ªæ•°æ®æº</span></span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.slave2.type</span>=<span class="string">com.zaxxer.hikari.HikariDataSource</span></span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.slave2.driver-class-name</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.slave2.jdbc-url</span>=<span class="string">jdbc:mysql://192.168.100.201:3308/db_user</span></span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.slave2.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.slave2.password</span>=<span class="string">123456</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># è¯»å†™åˆ†ç¦»ç±»å‹ï¼Œå¦‚: Staticï¼ŒDynamic</span></span><br><span class="line"><span class="attr">spring.shardingsphere.rules.readwrite-splitting.data-sources.myds.type</span>=<span class="string">Static</span></span><br><span class="line"><span class="comment"># å†™æ•°æ®æºåç§°</span></span><br><span class="line"><span class="attr">spring.shardingsphere.rules.readwrite-splitting.data-sources.myds.props.write-data-source-name</span>=<span class="string">master</span></span><br><span class="line"><span class="comment"># è¯»æ•°æ®æºåç§°ï¼Œå¤šä¸ªä»æ•°æ®æºç”¨é€—å·åˆ†éš”</span></span><br><span class="line"><span class="attr">spring.shardingsphere.rules.readwrite-splitting.data-sources.myds.props.read-data-source-names</span>=<span class="string">slave1,slave2</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># è´Ÿè½½å‡è¡¡ç®—æ³•åç§°</span></span><br><span class="line"><span class="attr">spring.shardingsphere.rules.readwrite-splitting.data-sources.myds.load-balancer-name</span>=<span class="string">alg_round</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># è´Ÿè½½å‡è¡¡ç®—æ³•é…ç½®</span></span><br><span class="line"><span class="comment"># è´Ÿè½½å‡è¡¡ç®—æ³•ç±»å‹</span></span><br><span class="line"><span class="attr">spring.shardingsphere.rules.readwrite-splitting.load-balancers.alg_round.type</span>=<span class="string">ROUND_ROBIN</span></span><br><span class="line"><span class="attr">spring.shardingsphere.rules.readwrite-splitting.load-balancers.alg_random.type</span>=<span class="string">RANDOM</span></span><br><span class="line"><span class="attr">spring.shardingsphere.rules.readwrite-splitting.load-balancers.alg_weight.type</span>=<span class="string">WEIGHT</span></span><br><span class="line"><span class="attr">spring.shardingsphere.rules.readwrite-splitting.load-balancers.alg_weight.props.slave1</span>=<span class="string">1</span></span><br><span class="line"><span class="attr">spring.shardingsphere.rules.readwrite-splitting.load-balancers.alg_weight.props.slave2</span>=<span class="string">2</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># æ‰“å°SQl</span></span><br><span class="line"><span class="attr">spring.shardingsphere.props.sql-show</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure><h2 id="2ã€æµ‹è¯•"><a href="#2ã€æµ‹è¯•" class="headerlink" title="2ã€æµ‹è¯•"></a>2ã€æµ‹è¯•</h2><h3 id="2-1ã€è¯»å†™åˆ†ç¦»æµ‹è¯•"><a href="#2-1ã€è¯»å†™åˆ†ç¦»æµ‹è¯•" class="headerlink" title="2.1ã€è¯»å†™åˆ†ç¦»æµ‹è¯•"></a>2.1ã€è¯»å†™åˆ†ç¦»æµ‹è¯•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaofei.shardingjdbcdemo;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ReadwriteTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å†™å…¥æ•°æ®çš„æµ‹è¯•</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testInsert</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setUname(<span class="string">&quot;å¼ ä¸‰ä¸°&quot;</span>);</span><br><span class="line">        userMapper.insert(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-2ã€äº‹åŠ¡æµ‹è¯•"><a href="#2-2ã€äº‹åŠ¡æµ‹è¯•" class="headerlink" title="2.2ã€äº‹åŠ¡æµ‹è¯•"></a>2.2ã€äº‹åŠ¡æµ‹è¯•</h3><p>ä¸ºäº†ä¿è¯ä¸»ä»åº“é—´çš„äº‹åŠ¡ä¸€è‡´æ€§ï¼Œé¿å…è·¨æœåŠ¡çš„åˆ†å¸ƒå¼äº‹åŠ¡ï¼ŒShardingSphere-JDBCçš„<code>ä¸»ä»æ¨¡å‹ä¸­ï¼Œäº‹åŠ¡ä¸­çš„æ•°æ®è¯»å†™å‡ç”¨ä¸»åº“</code>ã€‚</p><ul><li>ä¸æ·»åŠ @Transactionalï¼šinsertå¯¹ä¸»åº“æ“ä½œï¼Œselectå¯¹ä»åº“æ“ä½œ</li><li>æ·»åŠ @Transactionalï¼šåˆ™insertå’Œselectå‡å¯¹ä¸»åº“æ“ä½œ</li><li><strong>æ³¨æ„ï¼š</strong>åœ¨JUnitç¯å¢ƒä¸‹çš„@Transactionalæ³¨è§£ï¼Œé»˜è®¤æƒ…å†µä¸‹å°±ä¼šå¯¹äº‹åŠ¡è¿›è¡Œå›æ»šï¼ˆå³ä½¿åœ¨æ²¡åŠ æ³¨è§£@Rollbackï¼Œä¹Ÿä¼šå¯¹äº‹åŠ¡å›æ»šï¼‰</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * äº‹åŠ¡æµ‹è¯•</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@Transactional</span><span class="comment">//å¼€å¯äº‹åŠ¡</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testTrans</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    user.setUname(<span class="string">&quot;é“é”¤&quot;</span>);</span><br><span class="line">    userMapper.insert(user);</span><br><span class="line"></span><br><span class="line">    List&lt;User&gt; users = userMapper.selectList(<span class="literal">null</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-3ã€è´Ÿè½½å‡è¡¡æµ‹è¯•"><a href="#2-3ã€è´Ÿè½½å‡è¡¡æµ‹è¯•" class="headerlink" title="2.3ã€è´Ÿè½½å‡è¡¡æµ‹è¯•"></a>2.3ã€è´Ÿè½½å‡è¡¡æµ‹è¯•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¯»æ•°æ®æµ‹è¯•</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectAll</span><span class="params">()</span>&#123;</span><br><span class="line">    List&lt;User&gt; users = userMapper.selectList(<span class="literal">null</span>);</span><br><span class="line">    List&lt;User&gt; users = userMapper.selectList(<span class="literal">null</span>);<span class="comment">//æ‰§è¡Œç¬¬äºŒæ¬¡æµ‹è¯•è´Ÿè½½å‡è¡¡</span></span><br><span class="line">    users.forEach(System.out::println);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥åœ¨webè¯·æ±‚ä¸­æµ‹è¯•è´Ÿè½½å‡è¡¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaofei.shardingjdbcdemo.controller;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/userController&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æµ‹è¯•è´Ÿè½½å‡è¡¡ç­–ç•¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;selectAll&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">selectAll</span><span class="params">()</span>&#123;</span><br><span class="line">        List&lt;User&gt; users = userMapper.selectList(<span class="literal">null</span>);</span><br><span class="line">        users.forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ç¬¬05ç« -ShardingSphere-JDBCå‚ç›´åˆ†ç‰‡"><a href="#ç¬¬05ç« -ShardingSphere-JDBCå‚ç›´åˆ†ç‰‡" class="headerlink" title="ç¬¬05ç«  ShardingSphere-JDBCå‚ç›´åˆ†ç‰‡"></a>ç¬¬05ç«  ShardingSphere-JDBCå‚ç›´åˆ†ç‰‡</h1><h2 id="1ã€å‡†å¤‡æœåŠ¡å™¨"><a href="#1ã€å‡†å¤‡æœåŠ¡å™¨" class="headerlink" title="1ã€å‡†å¤‡æœåŠ¡å™¨"></a>1ã€å‡†å¤‡æœåŠ¡å™¨</h2><p>æœåŠ¡å™¨è§„åˆ’ï¼šä½¿ç”¨<code>docker</code>æ–¹å¼åˆ›å»ºå¦‚ä¸‹å®¹å™¨</p><p><img src="https://www.naste.top:9000/images/image-20220807232456342.png" alt="image-20220807232456342"></p><ul><li><p>æœåŠ¡å™¨ï¼šå®¹å™¨å<code>server-user</code>ï¼Œç«¯å£<code>3301</code></p></li><li><p>æœåŠ¡å™¨ï¼šå®¹å™¨å<code>server-order</code>ï¼Œç«¯å£<code>3302</code></p></li></ul><h3 id="1-1ã€åˆ›å»ºserver-userå®¹å™¨"><a href="#1-1ã€åˆ›å»ºserver-userå®¹å™¨" class="headerlink" title="1.1ã€åˆ›å»ºserver-userå®¹å™¨"></a>1.1ã€åˆ›å»ºserver-userå®¹å™¨</h3><ul><li><strong>step1ï¼šåˆ›å»ºå®¹å™¨ï¼š</strong></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">-p 3301:3306 \</span><br><span class="line">-v /xiaofei/server/user/conf:/etc/mysql/conf.d \</span><br><span class="line">-v /xiaofei/server/user/data:/var/lib/mysql \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=123456 \</span><br><span class="line">--name server-user \</span><br><span class="line">mysql:8.0.29</span><br></pre></td></tr></table></figure><ul><li><strong>step2ï¼šç™»å½•MySQLæœåŠ¡å™¨ï¼š</strong></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">è¿›å…¥å®¹å™¨ï¼š</span></span><br><span class="line">docker exec -it server-user env LANG=C.UTF-8 /bin/bash</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">è¿›å…¥å®¹å™¨å†…çš„mysqlå‘½ä»¤è¡Œ</span></span><br><span class="line">mysql -uroot -p</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">ä¿®æ”¹é»˜è®¤å¯†ç æ’ä»¶</span></span><br><span class="line">ALTER USER &#x27;root&#x27;@&#x27;%&#x27; IDENTIFIED WITH mysql_native_password BY &#x27;123456&#x27;;</span><br></pre></td></tr></table></figure><ul><li><strong>step3ï¼šåˆ›å»ºæ•°æ®åº“ï¼š</strong></li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE db_user;</span><br><span class="line">USE db_user;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_user (</span><br><span class="line"> id <span class="type">BIGINT</span> AUTO_INCREMENT,</span><br><span class="line"> uname <span class="type">VARCHAR</span>(<span class="number">30</span>),</span><br><span class="line"> <span class="keyword">PRIMARY</span> KEY (id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h3 id="1-2ã€åˆ›å»ºserver-orderå®¹å™¨"><a href="#1-2ã€åˆ›å»ºserver-orderå®¹å™¨" class="headerlink" title="1.2ã€åˆ›å»ºserver-orderå®¹å™¨"></a>1.2ã€åˆ›å»ºserver-orderå®¹å™¨</h3><ul><li><strong>step1ï¼šåˆ›å»ºå®¹å™¨ï¼š</strong></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">-p 3302:3306 \</span><br><span class="line">-v /xiaofei/server/order/conf:/etc/mysql/conf.d \</span><br><span class="line">-v /xiaofei/server/order/data:/var/lib/mysql \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=123456 \</span><br><span class="line">--name server-order \</span><br><span class="line">mysql:8.0.29</span><br></pre></td></tr></table></figure><ul><li><strong>step2ï¼šç™»å½•MySQLæœåŠ¡å™¨ï¼š</strong></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">è¿›å…¥å®¹å™¨ï¼š</span></span><br><span class="line">docker exec -it server-order env LANG=C.UTF-8 /bin/bash</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">è¿›å…¥å®¹å™¨å†…çš„mysqlå‘½ä»¤è¡Œ</span></span><br><span class="line">mysql -uroot -p</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">ä¿®æ”¹é»˜è®¤å¯†ç æ’ä»¶</span></span><br><span class="line">ALTER USER &#x27;root&#x27;@&#x27;%&#x27; IDENTIFIED WITH mysql_native_password BY &#x27;123456&#x27;;</span><br></pre></td></tr></table></figure><ul><li><strong>step3ï¼šåˆ›å»ºæ•°æ®åº“ï¼š</strong></li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE db_order;</span><br><span class="line">USE db_order;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_order (</span><br><span class="line">  id <span class="type">BIGINT</span> AUTO_INCREMENT,</span><br><span class="line">  order_no <span class="type">VARCHAR</span>(<span class="number">30</span>),</span><br><span class="line">  user_id <span class="type">BIGINT</span>,</span><br><span class="line">  amount <span class="type">DECIMAL</span>(<span class="number">10</span>,<span class="number">2</span>),</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY(id) </span><br><span class="line">);</span><br></pre></td></tr></table></figure><h2 id="2ã€ç¨‹åºå®ç°"><a href="#2ã€ç¨‹åºå®ç°" class="headerlink" title="2ã€ç¨‹åºå®ç°"></a>2ã€ç¨‹åºå®ç°</h2><h3 id="2-1ã€åˆ›å»ºå®ä½“ç±»"><a href="#2-1ã€åˆ›å»ºå®ä½“ç±»" class="headerlink" title="2.1ã€åˆ›å»ºå®ä½“ç±»"></a>2.1ã€åˆ›å»ºå®ä½“ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaofei.shardingjdbcdemo.entity;</span><br><span class="line"></span><br><span class="line"><span class="meta">@TableName(&quot;t_order&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Order</span> &#123;</span><br><span class="line">    <span class="meta">@TableId(type = IdType.AUTO)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String orderNo;</span><br><span class="line">    <span class="keyword">private</span> Long userId;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal amount;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-2ã€åˆ›å»ºMapper"><a href="#2-2ã€åˆ›å»ºMapper" class="headerlink" title="2.2ã€åˆ›å»ºMapper"></a>2.2ã€åˆ›å»ºMapper</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaofei.shardingjdbcdemo.mapper;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;Order&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-3ã€é…ç½®å‚ç›´åˆ†ç‰‡"><a href="#2-3ã€é…ç½®å‚ç›´åˆ†ç‰‡" class="headerlink" title="2.3ã€é…ç½®å‚ç›´åˆ†ç‰‡"></a>2.3ã€é…ç½®å‚ç›´åˆ†ç‰‡</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åº”ç”¨åç§°</span></span><br><span class="line"><span class="attr">spring.application.name</span>=<span class="string">sharding-jdbc-demo</span></span><br><span class="line"><span class="comment"># ç¯å¢ƒè®¾ç½®</span></span><br><span class="line"><span class="attr">spring.profiles.active</span>=<span class="string">dev</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># é…ç½®çœŸå®æ•°æ®æº</span></span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.names</span>=<span class="string">server-user,server-order</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># é…ç½®ç¬¬ 1 ä¸ªæ•°æ®æº</span></span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.server-user.type</span>=<span class="string">com.zaxxer.hikari.HikariDataSource</span></span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.server-user.driver-class-name</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.server-user.jdbc-url</span>=<span class="string">jdbc:mysql://192.168.100.201:3301/db_user</span></span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.server-user.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.server-user.password</span>=<span class="string">123456</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># é…ç½®ç¬¬ 2 ä¸ªæ•°æ®æº</span></span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.server-order.type</span>=<span class="string">com.zaxxer.hikari.HikariDataSource</span></span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.server-order.driver-class-name</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.server-order.jdbc-url</span>=<span class="string">jdbc:mysql://192.168.100.201:3302/db_order</span></span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.server-order.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.server-order.password</span>=<span class="string">123456</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># æ ‡å‡†åˆ†ç‰‡è¡¨é…ç½®ï¼ˆæ•°æ®èŠ‚ç‚¹ï¼‰</span></span><br><span class="line"><span class="comment"># spring.shardingsphere.rules.sharding.tables.&lt;table-name&gt;.actual-data-nodes=å€¼</span></span><br><span class="line"><span class="comment"># å€¼ç”±æ•°æ®æºå + è¡¨åç»„æˆï¼Œä»¥å°æ•°ç‚¹åˆ†éš”ã€‚</span></span><br><span class="line"><span class="comment"># &lt;table-name&gt;ï¼šé€»è¾‘è¡¨å</span></span><br><span class="line"><span class="attr">spring.shardingsphere.rules.sharding.tables.t_user.actual-data-nodes</span>=<span class="string">server-user.t_user</span></span><br><span class="line"><span class="attr">spring.shardingsphere.rules.sharding.tables.t_order.actual-data-nodes</span>=<span class="string">server-order.t_order</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># æ‰“å°SQL</span></span><br><span class="line"><span class="attr">spring.shardingsphere.props.sql-show</span>=<span class="string">true</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="3ã€æµ‹è¯•å‚ç›´åˆ†ç‰‡"><a href="#3ã€æµ‹è¯•å‚ç›´åˆ†ç‰‡" class="headerlink" title="3ã€æµ‹è¯•å‚ç›´åˆ†ç‰‡"></a>3ã€æµ‹è¯•å‚ç›´åˆ†ç‰‡</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaofei.shardingjdbcdemo;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShardingTest</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderMapper orderMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‚ç›´åˆ†ç‰‡ï¼šæ’å…¥æ•°æ®æµ‹è¯•</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testInsertOrderAndUser</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setUname(<span class="string">&quot;å¼ºå“¥&quot;</span>);</span><br><span class="line">        userMapper.insert(user);</span><br><span class="line"></span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Order</span>();</span><br><span class="line">        order.setOrderNo(<span class="string">&quot;xiaofei001&quot;</span>);</span><br><span class="line">        order.setUserId(user.getId());</span><br><span class="line">        order.setAmount(<span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="number">100</span>));</span><br><span class="line">        orderMapper.insert(order);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‚ç›´åˆ†ç‰‡ï¼šæŸ¥è¯¢æ•°æ®æµ‹è¯•</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectFromOrderAndUser</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.selectById(<span class="number">1L</span>);</span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> orderMapper.selectById(<span class="number">1L</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¸¸è§é”™è¯¯"><a href="#å¸¸è§é”™è¯¯" class="headerlink" title="å¸¸è§é”™è¯¯"></a>å¸¸è§é”™è¯¯</h3><p><img src="https://www.naste.top:9000/images/image-20220810163534068.png" alt="image-20220810163534068"></p><p>ShardingSphere-JDBCè¿œç¨‹è¿æ¥çš„æ–¹å¼é»˜è®¤çš„å¯†ç åŠ å¯†è§„åˆ™æ˜¯ï¼šmysql_native_password</p><p>å› æ­¤éœ€è¦åœ¨æœåŠ¡å™¨ç«¯ä¿®æ”¹æœåŠ¡å™¨çš„å¯†ç åŠ å¯†è§„åˆ™ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">WITH</span> mysql_native_password <span class="keyword">BY</span> <span class="string">&#x27;123456&#x27;</span>;</span><br></pre></td></tr></table></figure><h1 id="ç¬¬06ç« -ShardingSphere-JDBCæ°´å¹³åˆ†ç‰‡"><a href="#ç¬¬06ç« -ShardingSphere-JDBCæ°´å¹³åˆ†ç‰‡" class="headerlink" title="ç¬¬06ç«  ShardingSphere-JDBCæ°´å¹³åˆ†ç‰‡"></a>ç¬¬06ç«  ShardingSphere-JDBCæ°´å¹³åˆ†ç‰‡</h1><h2 id="1ã€å‡†å¤‡æœåŠ¡å™¨-1"><a href="#1ã€å‡†å¤‡æœåŠ¡å™¨-1" class="headerlink" title="1ã€å‡†å¤‡æœåŠ¡å™¨"></a>1ã€å‡†å¤‡æœåŠ¡å™¨</h2><p>æœåŠ¡å™¨è§„åˆ’ï¼šä½¿ç”¨<code>docker</code>æ–¹å¼åˆ›å»ºå¦‚ä¸‹å®¹å™¨</p><p><img src="https://www.naste.top:9000/images/image-20220808033239206.png" alt="image-20220808033239206"></p><ul><li><p>æœåŠ¡å™¨ï¼šå®¹å™¨å<code>server-order0</code>ï¼Œç«¯å£<code>3310</code></p></li><li><p>æœåŠ¡å™¨ï¼šå®¹å™¨å<code>server-order1</code>ï¼Œç«¯å£<code>3311</code></p></li></ul><h3 id="1-1ã€åˆ›å»ºserver-order0å®¹å™¨"><a href="#1-1ã€åˆ›å»ºserver-order0å®¹å™¨" class="headerlink" title="1.1ã€åˆ›å»ºserver-order0å®¹å™¨"></a>1.1ã€åˆ›å»ºserver-order0å®¹å™¨</h3><ul><li><strong>step1ï¼šåˆ›å»ºå®¹å™¨ï¼š</strong></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">-p 3310:3306 \</span><br><span class="line">-v /xiaofei/server/order0/conf:/etc/mysql/conf.d \</span><br><span class="line">-v /xiaofei/server/order0/data:/var/lib/mysql \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=123456 \</span><br><span class="line">--name server-order0 \</span><br><span class="line">mysql:8.0.29</span><br></pre></td></tr></table></figure><ul><li><strong>step2ï¼šç™»å½•MySQLæœåŠ¡å™¨ï¼š</strong></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">è¿›å…¥å®¹å™¨ï¼š</span></span><br><span class="line">docker exec -it server-order0 env LANG=C.UTF-8 /bin/bash</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">è¿›å…¥å®¹å™¨å†…çš„mysqlå‘½ä»¤è¡Œ</span></span><br><span class="line">mysql -uroot -p</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">ä¿®æ”¹é»˜è®¤å¯†ç æ’ä»¶</span></span><br><span class="line">ALTER USER &#x27;root&#x27;@&#x27;%&#x27; IDENTIFIED WITH mysql_native_password BY &#x27;123456&#x27;;</span><br></pre></td></tr></table></figure><ul><li><strong>step3ï¼šåˆ›å»ºæ•°æ®åº“ï¼š</strong></li></ul><p><code>æ³¨æ„ï¼š</code>æ°´å¹³åˆ†ç‰‡çš„idéœ€è¦åœ¨ä¸šåŠ¡å±‚å®ç°ï¼Œ<code>ä¸èƒ½ä¾èµ–æ•°æ®åº“çš„ä¸»é”®è‡ªå¢</code></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE db_order;</span><br><span class="line">USE db_order;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_order0 (</span><br><span class="line">  id <span class="type">BIGINT</span>,</span><br><span class="line">  order_no <span class="type">VARCHAR</span>(<span class="number">30</span>),</span><br><span class="line">  user_id <span class="type">BIGINT</span>,</span><br><span class="line">  amount <span class="type">DECIMAL</span>(<span class="number">10</span>,<span class="number">2</span>),</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY(id) </span><br><span class="line">);</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_order1 (</span><br><span class="line">  id <span class="type">BIGINT</span>,</span><br><span class="line">  order_no <span class="type">VARCHAR</span>(<span class="number">30</span>),</span><br><span class="line">  user_id <span class="type">BIGINT</span>,</span><br><span class="line">  amount <span class="type">DECIMAL</span>(<span class="number">10</span>,<span class="number">2</span>),</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY(id) </span><br><span class="line">);</span><br></pre></td></tr></table></figure><h3 id="1-2ã€åˆ›å»ºserver-order1å®¹å™¨"><a href="#1-2ã€åˆ›å»ºserver-order1å®¹å™¨" class="headerlink" title="1.2ã€åˆ›å»ºserver-order1å®¹å™¨"></a>1.2ã€åˆ›å»ºserver-order1å®¹å™¨</h3><ul><li><strong>step1ï¼šåˆ›å»ºå®¹å™¨ï¼š</strong></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">-p 3311:3306 \</span><br><span class="line">-v /xiaofei/server/order1/conf:/etc/mysql/conf.d \</span><br><span class="line">-v /xiaofei/server/order1/data:/var/lib/mysql \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=123456 \</span><br><span class="line">--name server-order1 \</span><br><span class="line">mysql:8.0.29</span><br></pre></td></tr></table></figure><ul><li><strong>step2ï¼šç™»å½•MySQLæœåŠ¡å™¨ï¼š</strong></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">è¿›å…¥å®¹å™¨ï¼š</span></span><br><span class="line">docker exec -it server-order1 env LANG=C.UTF-8 /bin/bash</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">è¿›å…¥å®¹å™¨å†…çš„mysqlå‘½ä»¤è¡Œ</span></span><br><span class="line">mysql -uroot -p</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">ä¿®æ”¹é»˜è®¤å¯†ç æ’ä»¶</span></span><br><span class="line">ALTER USER &#x27;root&#x27;@&#x27;%&#x27; IDENTIFIED WITH mysql_native_password BY &#x27;123456&#x27;;</span><br></pre></td></tr></table></figure><ul><li><strong>step3ï¼šåˆ›å»ºæ•°æ®åº“ï¼š</strong>å’Œserver-order0ç›¸åŒ</li></ul><p><code>æ³¨æ„ï¼š</code>æ°´å¹³åˆ†ç‰‡çš„idéœ€è¦åœ¨ä¸šåŠ¡å±‚å®ç°ï¼Œä¸èƒ½ä¾èµ–æ•°æ®åº“çš„ä¸»é”®è‡ªå¢</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE db_order;</span><br><span class="line">USE db_order;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_order0 (</span><br><span class="line">  id <span class="type">BIGINT</span>,</span><br><span class="line">  order_no <span class="type">VARCHAR</span>(<span class="number">30</span>),</span><br><span class="line">  user_id <span class="type">BIGINT</span>,</span><br><span class="line">  amount <span class="type">DECIMAL</span>(<span class="number">10</span>,<span class="number">2</span>),</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY(id) </span><br><span class="line">);</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_order1 (</span><br><span class="line">  id <span class="type">BIGINT</span>,</span><br><span class="line">  order_no <span class="type">VARCHAR</span>(<span class="number">30</span>),</span><br><span class="line">  user_id <span class="type">BIGINT</span>,</span><br><span class="line">  amount <span class="type">DECIMAL</span>(<span class="number">10</span>,<span class="number">2</span>),</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY(id) </span><br><span class="line">);</span><br></pre></td></tr></table></figure><h2 id="2ã€åŸºæœ¬æ°´å¹³åˆ†ç‰‡"><a href="#2ã€åŸºæœ¬æ°´å¹³åˆ†ç‰‡" class="headerlink" title="2ã€åŸºæœ¬æ°´å¹³åˆ†ç‰‡"></a>2ã€åŸºæœ¬æ°´å¹³åˆ†ç‰‡</h2><h3 id="2-1ã€åŸºæœ¬é…ç½®"><a href="#2-1ã€åŸºæœ¬é…ç½®" class="headerlink" title="2.1ã€åŸºæœ¬é…ç½®"></a>2.1ã€åŸºæœ¬é…ç½®</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#========================åŸºæœ¬é…ç½®</span></span><br><span class="line"><span class="comment"># åº”ç”¨åç§°</span></span><br><span class="line"><span class="attr">spring.application.name</span>=<span class="string">sharging-jdbc-demo</span></span><br><span class="line"><span class="comment"># å¼€å‘ç¯å¢ƒè®¾ç½®</span></span><br><span class="line"><span class="attr">spring.profiles.active</span>=<span class="string">dev</span></span><br><span class="line"><span class="comment"># å†…å­˜æ¨¡å¼</span></span><br><span class="line"><span class="attr">spring.shardingsphere.mode.type</span>=<span class="string">Memory</span></span><br><span class="line"><span class="comment"># æ‰“å°SQl</span></span><br><span class="line"><span class="attr">spring.shardingsphere.props.sql-show</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure><h3 id="2-2ã€æ•°æ®æºé…ç½®"><a href="#2-2ã€æ•°æ®æºé…ç½®" class="headerlink" title="2.2ã€æ•°æ®æºé…ç½®"></a>2.2ã€æ•°æ®æºé…ç½®</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#========================æ•°æ®æºé…ç½®</span></span><br><span class="line"><span class="comment"># é…ç½®çœŸå®æ•°æ®æº</span></span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.names</span>=<span class="string">server-user,server-order0,server-order1</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># é…ç½®ç¬¬ 1 ä¸ªæ•°æ®æº</span></span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.server-user.type</span>=<span class="string">com.zaxxer.hikari.HikariDataSource</span></span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.server-user.driver-class-name</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.server-user.jdbc-url</span>=<span class="string">jdbc:mysql://192.168.100.201:3301/db_user</span></span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.server-user.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.server-user.password</span>=<span class="string">123456</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># é…ç½®ç¬¬ 2 ä¸ªæ•°æ®æº</span></span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.server-order.type</span>=<span class="string">com.zaxxer.hikari.HikariDataSource</span></span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.server-order.driver-class-name</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.server-order.jdbc-url</span>=<span class="string">jdbc:mysql://192.168.100.201:3310/db_order</span></span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.server-order.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.server-order.password</span>=<span class="string">123456</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># é…ç½®ç¬¬ 3 ä¸ªæ•°æ®æº</span></span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.server-order.type</span>=<span class="string">com.zaxxer.hikari.HikariDataSource</span></span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.server-order.driver-class-name</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.server-order.jdbc-url</span>=<span class="string">jdbc:mysql://192.168.100.201:3311/db_order</span></span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.server-order.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.server-order.password</span>=<span class="string">123456</span></span><br></pre></td></tr></table></figure><h3 id="2-3ã€æ ‡æ¤åˆ†ç‰‡è¡¨é…ç½®"><a href="#2-3ã€æ ‡æ¤åˆ†ç‰‡è¡¨é…ç½®" class="headerlink" title="2.3ã€æ ‡æ¤åˆ†ç‰‡è¡¨é…ç½®"></a>2.3ã€æ ‡æ¤åˆ†ç‰‡è¡¨é…ç½®</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#========================æ ‡å‡†åˆ†ç‰‡è¡¨é…ç½®ï¼ˆæ•°æ®èŠ‚ç‚¹é…ç½®ï¼‰</span></span><br><span class="line"><span class="comment"># spring.shardingsphere.rules.sharding.tables.&lt;table-name&gt;.actual-data-nodes=å€¼</span></span><br><span class="line"><span class="comment"># å€¼ç”±æ•°æ®æºå + è¡¨åç»„æˆï¼Œä»¥å°æ•°ç‚¹åˆ†éš”ã€‚å¤šä¸ªè¡¨ä»¥é€—å·åˆ†éš”ï¼Œæ”¯æŒ inline è¡¨è¾¾å¼ã€‚</span></span><br><span class="line"><span class="comment"># &lt;table-name&gt;ï¼šé€»è¾‘è¡¨å</span></span><br><span class="line"><span class="attr">spring.shardingsphere.rules.sharding.tables.t_user.actual-data-nodes</span>=<span class="string">server-user.t_user</span></span><br><span class="line"><span class="attr">spring.shardingsphere.rules.sharding.tables.t_order.actual-data-nodes</span>=<span class="string">server-order0.t_order0,server-order0.t_order1,server-order1.t_order0,server-order1.t_order1</span></span><br></pre></td></tr></table></figure><p>ä¿®æ”¹Orderå®ä½“ç±»çš„ä¸»é”®ç­–ç•¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//@TableId(type = IdType.AUTO)//ä¾èµ–æ•°æ®åº“çš„ä¸»é”®è‡ªå¢ç­–ç•¥</span></span><br><span class="line"><span class="meta">@TableId(type = IdType.ASSIGN_ID)</span><span class="comment">//åˆ†å¸ƒå¼id</span></span><br></pre></td></tr></table></figure><p>æµ‹è¯•ï¼šä¿ç•™ä¸Šé¢é…ç½®ä¸­çš„ä¸€ä¸ªåˆ†ç‰‡è¡¨èŠ‚ç‚¹åˆ†åˆ«è¿›è¡Œæµ‹è¯•ï¼Œæ£€æŸ¥æ¯ä¸ªåˆ†ç‰‡èŠ‚ç‚¹æ˜¯å¦å¯ç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ°´å¹³åˆ†ç‰‡ï¼šæ’å…¥æ•°æ®æµ‹è¯•</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testInsertOrder</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Order</span>();</span><br><span class="line">    order.setOrderNo(<span class="string">&quot;xiaofei001&quot;</span>);</span><br><span class="line">    order.setUserId(<span class="number">1L</span>);</span><br><span class="line">    order.setAmount(<span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="number">100</span>));</span><br><span class="line">    orderMapper.insert(order);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-4ã€è¡Œè¡¨è¾¾å¼"><a href="#2-4ã€è¡Œè¡¨è¾¾å¼" class="headerlink" title="2.4ã€è¡Œè¡¨è¾¾å¼"></a>2.4ã€è¡Œè¡¨è¾¾å¼</h3><p>ä¼˜åŒ–ä¸Šä¸€æ­¥çš„åˆ†ç‰‡è¡¨é…ç½®</p><p><a href="https://shardingsphere.apache.org/document/5.1.1/cn/features/sharding/concept/inline-expression/">https://shardingsphere.apache.org/document/5.1.1/cn/features/sharding/concept/inline-expression/</a></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#========================æ ‡å‡†åˆ†ç‰‡è¡¨é…ç½®ï¼ˆæ•°æ®èŠ‚ç‚¹é…ç½®ï¼‰</span></span><br><span class="line"><span class="comment"># spring.shardingsphere.rules.sharding.tables.&lt;table-name&gt;.actual-data-nodes=å€¼</span></span><br><span class="line"><span class="comment"># å€¼ç”±æ•°æ®æºå + è¡¨åç»„æˆï¼Œä»¥å°æ•°ç‚¹åˆ†éš”ã€‚å¤šä¸ªè¡¨ä»¥é€—å·åˆ†éš”ï¼Œæ”¯æŒ inline è¡¨è¾¾å¼ã€‚</span></span><br><span class="line"><span class="comment"># &lt;table-name&gt;ï¼šé€»è¾‘è¡¨å</span></span><br><span class="line"><span class="attr">spring.shardingsphere.rules.sharding.tables.t_user.actual-data-nodes</span>=<span class="string">server-user.t_user</span></span><br><span class="line"><span class="attr">spring.shardingsphere.rules.sharding.tables.t_order.actual-data-nodes</span>=<span class="string">server-order$-&gt;&#123;0..1&#125;.t_order$-&gt;&#123;0..1&#125;</span></span><br></pre></td></tr></table></figure><h3 id="2-5ã€åˆ†ç‰‡ç®—æ³•é…ç½®"><a href="#2-5ã€åˆ†ç‰‡ç®—æ³•é…ç½®" class="headerlink" title="2.5ã€åˆ†ç‰‡ç®—æ³•é…ç½®"></a>2.5ã€åˆ†ç‰‡ç®—æ³•é…ç½®</h3><p><strong>æ°´å¹³åˆ†åº“ï¼š</strong></p><p>åˆ†ç‰‡è§„åˆ™ï¼šorderè¡¨ä¸­<code>user_id</code>ä¸ºå¶æ•°æ—¶ï¼Œæ•°æ®æ’å…¥<code>server-order0æœåŠ¡å™¨</code>ï¼Œ<code>user_id</code>ä¸ºå¥‡æ•°æ—¶ï¼Œæ•°æ®æ’å…¥<code>server-order1æœåŠ¡å™¨</code>ã€‚è¿™æ ·åˆ†ç‰‡çš„å¥½å¤„æ˜¯ï¼ŒåŒä¸€ä¸ªç”¨æˆ·çš„è®¢å•æ•°æ®ï¼Œä¸€å®šä¼šè¢«æ’å…¥åˆ°åŒä¸€å°æœåŠ¡å™¨ä¸Šï¼ŒæŸ¥è¯¢ä¸€ä¸ªç”¨æˆ·çš„è®¢å•æ—¶æ•ˆç‡è¾ƒé«˜ã€‚</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#------------------------åˆ†åº“ç­–ç•¥</span></span><br><span class="line"><span class="comment"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class="line"><span class="attr">spring.shardingsphere.rules.sharding.tables.t_order.database-strategy.standard.sharding-column</span>=<span class="string">user_id</span></span><br><span class="line"><span class="comment"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class="line"><span class="attr">spring.shardingsphere.rules.sharding.tables.t_order.database-strategy.standard.sharding-algorithm-name</span>=<span class="string">alg_inline_userid</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#------------------------åˆ†ç‰‡ç®—æ³•é…ç½®</span></span><br><span class="line"><span class="comment"># è¡Œè¡¨è¾¾å¼åˆ†ç‰‡ç®—æ³•</span></span><br><span class="line"><span class="comment"># åˆ†ç‰‡ç®—æ³•ç±»å‹</span></span><br><span class="line"><span class="attr">spring.shardingsphere.rules.sharding.sharding-algorithms.alg_inline_userid.type</span>=<span class="string">INLINE</span></span><br><span class="line"><span class="comment"># åˆ†ç‰‡ç®—æ³•å±æ€§é…ç½®</span></span><br><span class="line"><span class="attr">spring.shardingsphere.rules.sharding.sharding-algorithms.alg_inline_userid.props.algorithm-expression</span>=<span class="string">server-order$-&gt;&#123;user_id % 2&#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># å–æ¨¡åˆ†ç‰‡ç®—æ³•</span></span><br><span class="line"><span class="comment"># åˆ†ç‰‡ç®—æ³•ç±»å‹</span></span><br><span class="line"><span class="attr">spring.shardingsphere.rules.sharding.sharding-algorithms.alg_mod.type</span>=<span class="string">MOD</span></span><br><span class="line"><span class="comment"># åˆ†ç‰‡ç®—æ³•å±æ€§é…ç½®</span></span><br><span class="line"><span class="attr">spring.shardingsphere.rules.sharding.sharding-algorithms.alg_mod.props.sharding-count</span>=<span class="string">2</span></span><br></pre></td></tr></table></figure><p>ä¸ºäº†æ–¹ä¾¿æµ‹è¯•ï¼Œå…ˆè®¾ç½®åªåœ¨ <code>t_order0</code>è¡¨ä¸Šè¿›è¡Œæµ‹è¯•</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">xxx.actual-data-nodes</span>=<span class="string">server-order$-&gt;&#123;0..1&#125;.t_order0</span></span><br></pre></td></tr></table></figure><p>æµ‹è¯•ï¼šå¯ä»¥åˆ†åˆ«æµ‹è¯•è¡Œè¡¨è¾¾å¼åˆ†ç‰‡ç®—æ³•å’Œå–æ¨¡åˆ†ç‰‡ç®—æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ°´å¹³åˆ†ç‰‡ï¼šåˆ†åº“æ’å…¥æ•°æ®æµ‹è¯•</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testInsertOrderDatabaseStrategy</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">long</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Order</span>();</span><br><span class="line">        order.setOrderNo(<span class="string">&quot;xiaofei001&quot;</span>);</span><br><span class="line">        order.setUserId(i + <span class="number">1</span>);</span><br><span class="line">        order.setAmount(<span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="number">100</span>));</span><br><span class="line">        orderMapper.insert(order);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ°´å¹³åˆ†è¡¨ï¼š</strong></p><p>åˆ†ç‰‡è§„åˆ™ï¼šorderè¡¨ä¸­<code>order_noçš„å“ˆå¸Œå€¼ä¸ºå¶æ•°æ—¶</code>ï¼Œæ•°æ®æ’å…¥å¯¹åº”æœåŠ¡å™¨çš„<code>t_order0è¡¨</code>ï¼Œ<code>order_noçš„å“ˆå¸Œå€¼ä¸ºå¥‡æ•°æ—¶</code>ï¼Œæ•°æ®æ’å…¥å¯¹åº”æœåŠ¡å™¨çš„<code>t_order1è¡¨</code>ã€‚å› ä¸ºorder_noæ˜¯å­—ç¬¦ä¸²å½¢å¼ï¼Œå› æ­¤ä¸èƒ½ç›´æ¥å–æ¨¡ã€‚</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#------------------------åˆ†è¡¨ç­–ç•¥</span></span><br><span class="line"><span class="comment"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class="line"><span class="attr">spring.shardingsphere.rules.sharding.tables.t_order.table-strategy.standard.sharding-column</span>=<span class="string">order_no</span></span><br><span class="line"><span class="comment"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class="line"><span class="attr">spring.shardingsphere.rules.sharding.tables.t_order.table-strategy.standard.sharding-algorithm-name</span>=<span class="string">alg_hash_mod</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#------------------------åˆ†ç‰‡ç®—æ³•é…ç½®</span></span><br><span class="line"><span class="comment"># å“ˆå¸Œå–æ¨¡åˆ†ç‰‡ç®—æ³•</span></span><br><span class="line"><span class="comment"># åˆ†ç‰‡ç®—æ³•ç±»å‹</span></span><br><span class="line"><span class="attr">spring.shardingsphere.rules.sharding.sharding-algorithms.alg_hash_mod.type</span>=<span class="string">HASH_MOD</span></span><br><span class="line"><span class="comment"># åˆ†ç‰‡ç®—æ³•å±æ€§é…ç½®</span></span><br><span class="line"><span class="attr">spring.shardingsphere.rules.sharding.sharding-algorithms.alg_hash_mod.props.sharding-count</span>=<span class="string">2</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æµ‹è¯•å‰ä¸è¦å¿˜è®°å°†å¦‚ä¸‹èŠ‚ç‚¹æ”¹å›åŸæ¥çš„çŠ¶æ€</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">xxx.actual-data-nodes</span>=<span class="string">server-order$-&gt;&#123;0..1&#125;.t_order$-&gt;&#123;0..1&#125;</span></span><br></pre></td></tr></table></figure><p>æµ‹è¯•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ°´å¹³åˆ†ç‰‡ï¼šåˆ†è¡¨æ’å…¥æ•°æ®æµ‹è¯•</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testInsertOrderTableStrategy</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">long</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Order</span>();</span><br><span class="line">        order.setOrderNo(<span class="string">&quot;xiaofei&quot;</span> + i);</span><br><span class="line">        order.setUserId(<span class="number">1L</span>);</span><br><span class="line">        order.setAmount(<span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="number">100</span>));</span><br><span class="line">        orderMapper.insert(order);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">long</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">5</span>; i &lt; <span class="number">9</span>; i++) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Order</span>();</span><br><span class="line">        order.setOrderNo(<span class="string">&quot;xiaofei&quot;</span> + i);</span><br><span class="line">        order.setUserId(<span class="number">2L</span>);</span><br><span class="line">        order.setAmount(<span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="number">100</span>));</span><br><span class="line">        orderMapper.insert(order);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æµ‹è¯•å“ˆå¸Œå–æ¨¡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testHash</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ³¨æ„hashå–æ¨¡çš„ç»“æœæ˜¯æ•´ä¸ªå­—ç¬¦ä¸²hashåå†å–æ¨¡ï¼Œå’Œæ•°å€¼åç¼€æ˜¯å¥‡æ•°è¿˜æ˜¯å¶æ•°æ— å…³</span></span><br><span class="line">    System.out.println(<span class="string">&quot;xiaofei001&quot;</span>.hashCode() % <span class="number">2</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;xiaofei0011&quot;</span>.hashCode() % <span class="number">2</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æŸ¥è¯¢æµ‹è¯•ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ°´å¹³åˆ†ç‰‡ï¼šæŸ¥è¯¢æ‰€æœ‰è®°å½•</span></span><br><span class="line"><span class="comment">     * æŸ¥è¯¢äº†ä¸¤ä¸ªæ•°æ®æºï¼Œæ¯ä¸ªæ•°æ®æºä¸­ä½¿ç”¨UNION ALLè¿æ¥ä¸¤ä¸ªè¡¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testShardingSelectAll</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">    List&lt;Order&gt; orders = orderMapper.selectList(<span class="literal">null</span>);</span><br><span class="line">    orders.forEach(System.out::println);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ°´å¹³åˆ†ç‰‡ï¼šæ ¹æ®user_idæŸ¥è¯¢è®°å½•</span></span><br><span class="line"><span class="comment">     * æŸ¥è¯¢äº†ä¸€ä¸ªæ•°æ®æºï¼Œæ¯ä¸ªæ•°æ®æºä¸­ä½¿ç”¨UNION ALLè¿æ¥ä¸¤ä¸ªè¡¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testShardingSelectByUserId</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">    QueryWrapper&lt;Order&gt; orderQueryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    orderQueryWrapper.eq(<span class="string">&quot;user_id&quot;</span>, <span class="number">1L</span>);</span><br><span class="line">    List&lt;Order&gt; orders = orderMapper.selectList(orderQueryWrapper);</span><br><span class="line">    orders.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-6ã€åˆ†å¸ƒå¼åºåˆ—ç®—æ³•"><a href="#2-6ã€åˆ†å¸ƒå¼åºåˆ—ç®—æ³•" class="headerlink" title="2.6ã€åˆ†å¸ƒå¼åºåˆ—ç®—æ³•"></a>2.6ã€åˆ†å¸ƒå¼åºåˆ—ç®—æ³•</h3><p><strong>é›ªèŠ±ç®—æ³•ï¼š</strong></p><p><a href="https://shardingsphere.apache.org/document/5.1.1/cn/features/sharding/concept/key-generator/">https://shardingsphere.apache.org/document/5.1.1/cn/features/sharding/concept/key-generator/</a></p><p>æ°´å¹³åˆ†ç‰‡éœ€è¦å…³æ³¨å…¨å±€åºåˆ—ï¼Œå› ä¸ºä¸èƒ½ç®€å•çš„ä½¿ç”¨åŸºäºæ•°æ®åº“çš„ä¸»é”®è‡ªå¢ã€‚</p><p>è¿™é‡Œæœ‰ä¸¤ç§æ–¹æ¡ˆï¼šä¸€ç§æ˜¯åŸºäºMyBatisPlusçš„idç­–ç•¥ï¼›ä¸€ç§æ˜¯ShardingSphere-JDBCçš„å…¨å±€åºåˆ—é…ç½®ã€‚</p><p><code>åŸºäºMyBatisPlusçš„idç­–ç•¥ï¼š</code>å°†Orderç±»çš„idè®¾ç½®æˆå¦‚ä¸‹å½¢å¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@TableId(type = IdType.ASSIGN_ID)</span></span><br><span class="line"><span class="keyword">private</span> Long id;</span><br></pre></td></tr></table></figure><p><code>åŸºäºShardingSphere-JDBCçš„å…¨å±€åºåˆ—é…ç½®</code>ï¼šå’Œå‰é¢çš„MyBatisPlusçš„ç­–ç•¥äºŒé€‰ä¸€</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#------------------------åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥é…ç½®</span></span><br><span class="line"><span class="comment"># åˆ†å¸ƒå¼åºåˆ—åˆ—åç§°</span></span><br><span class="line"><span class="attr">spring.shardingsphere.rules.sharding.tables.t_order.key-generate-strategy.column</span>=<span class="string">id</span></span><br><span class="line"><span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class="line"><span class="attr">spring.shardingsphere.rules.sharding.tables.t_order.key-generate-strategy.key-generator-name</span>=<span class="string">alg_snowflake</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•é…ç½®</span></span><br><span class="line"><span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•ç±»å‹</span></span><br><span class="line"><span class="attr">spring.shardingsphere.rules.sharding.key-generators.alg_snowflake.type</span>=<span class="string">SNOWFLAKE</span></span><br><span class="line"><span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•å±æ€§é…ç½®</span></span><br><span class="line"><span class="comment">#spring.shardingsphere.rules.sharding.key-generators.alg_snowflake.props.xxx=</span></span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ï¼Œéœ€è¦å°†å®ä½“ç±»ä¸­çš„idç­–ç•¥ä¿®æ”¹æˆä»¥ä¸‹å½¢å¼ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å½“é…ç½®äº†shardingsphere-jdbcçš„åˆ†å¸ƒå¼åºåˆ—æ—¶ï¼Œè‡ªåŠ¨ä½¿ç”¨shardingsphere-jdbcçš„åˆ†å¸ƒå¼åºåˆ—</span></span><br><span class="line"><span class="comment">//å½“æ²¡æœ‰é…ç½®shardingsphere-jdbcçš„åˆ†å¸ƒå¼åºåˆ—æ—¶ï¼Œè‡ªåŠ¨ä¾èµ–æ•°æ®åº“çš„ä¸»é”®è‡ªå¢ç­–ç•¥</span></span><br><span class="line"><span class="meta">@TableId(type = IdType.AUTO)</span></span><br></pre></td></tr></table></figure><h2 id="3ã€å¤šè¡¨å…³è”"><a href="#3ã€å¤šè¡¨å…³è”" class="headerlink" title="3ã€å¤šè¡¨å…³è”"></a>3ã€å¤šè¡¨å…³è”</h2><h3 id="3-1ã€åˆ›å»ºå…³è”è¡¨"><a href="#3-1ã€åˆ›å»ºå…³è”è¡¨" class="headerlink" title="3.1ã€åˆ›å»ºå…³è”è¡¨"></a>3.1ã€åˆ›å»ºå…³è”è¡¨</h3><p>åœ¨<code>server-order0ã€server-order1</code>æœåŠ¡å™¨ä¸­åˆ†åˆ«åˆ›å»ºä¸¤å¼ è®¢å•è¯¦æƒ…è¡¨<code>t_order_item0ã€t_order_item1</code></p><p>æˆ‘ä»¬å¸Œæœ›<code>åŒä¸€ä¸ªç”¨æˆ·çš„è®¢å•è¡¨å’Œè®¢å•è¯¦æƒ…è¡¨ä¸­çš„æ•°æ®éƒ½åœ¨åŒä¸€ä¸ªæ•°æ®æºä¸­ï¼Œé¿å…è·¨åº“å…³è”</code>ï¼Œå› æ­¤è¿™ä¸¤å¼ è¡¨æˆ‘ä»¬ä½¿ç”¨ç›¸åŒçš„åˆ†ç‰‡ç­–ç•¥ã€‚</p><p>é‚£ä¹ˆåœ¨<code>t_order_item</code>ä¸­æˆ‘ä»¬ä¹Ÿéœ€è¦åˆ›å»º<code>order_no</code>å’Œ<code>user_id</code>è¿™ä¸¤ä¸ªåˆ†ç‰‡é”®</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_order_item0(</span><br><span class="line">    id <span class="type">BIGINT</span>,</span><br><span class="line">    order_no <span class="type">VARCHAR</span>(<span class="number">30</span>),</span><br><span class="line">    user_id <span class="type">BIGINT</span>,</span><br><span class="line">    price <span class="type">DECIMAL</span>(<span class="number">10</span>,<span class="number">2</span>),</span><br><span class="line">    `count` <span class="type">INT</span>,</span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY(id)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_order_item1(</span><br><span class="line">    id <span class="type">BIGINT</span>,</span><br><span class="line">    order_no <span class="type">VARCHAR</span>(<span class="number">30</span>),</span><br><span class="line">    user_id <span class="type">BIGINT</span>,</span><br><span class="line">    price <span class="type">DECIMAL</span>(<span class="number">10</span>,<span class="number">2</span>),</span><br><span class="line">    `count` <span class="type">INT</span>,</span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY(id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h3 id="3-2ã€åˆ›å»ºå®ä½“ç±»"><a href="#3-2ã€åˆ›å»ºå®ä½“ç±»" class="headerlink" title="3.2ã€åˆ›å»ºå®ä½“ç±»"></a>3.2ã€åˆ›å»ºå®ä½“ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaofei.shardingjdbcdemo.entity;</span><br><span class="line"></span><br><span class="line"><span class="meta">@TableName(&quot;t_order_item&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderItem</span> &#123;</span><br><span class="line">    <span class="comment">//å½“é…ç½®äº†shardingsphere-jdbcçš„åˆ†å¸ƒå¼åºåˆ—æ—¶ï¼Œè‡ªåŠ¨ä½¿ç”¨shardingsphere-jdbcçš„åˆ†å¸ƒå¼åºåˆ—</span></span><br><span class="line">    <span class="meta">@TableId(type = IdType.AUTO)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String orderNo;</span><br><span class="line">    <span class="keyword">private</span> Long userId;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal price;</span><br><span class="line">    <span class="keyword">private</span> Integer count;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-3ã€åˆ›å»ºMapper"><a href="#3-3ã€åˆ›å»ºMapper" class="headerlink" title="3.3ã€åˆ›å»ºMapper"></a>3.3ã€åˆ›å»ºMapper</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaofei.shargingjdbcdemo.mapper;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderItemMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;OrderItem&gt; &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-4ã€é…ç½®å…³è”è¡¨"><a href="#3-4ã€é…ç½®å…³è”è¡¨" class="headerlink" title="3.4ã€é…ç½®å…³è”è¡¨"></a>3.4ã€é…ç½®å…³è”è¡¨</h3><p>t_order_itemçš„åˆ†ç‰‡è¡¨ã€åˆ†ç‰‡ç­–ç•¥ã€åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥å’Œt_orderä¸€è‡´</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#------------------------æ ‡å‡†åˆ†ç‰‡è¡¨é…ç½®ï¼ˆæ•°æ®èŠ‚ç‚¹é…ç½®ï¼‰</span></span><br><span class="line"><span class="attr">spring.shardingsphere.rules.sharding.tables.t_order_item.actual-data-nodes</span>=<span class="string">server-order$-&gt;&#123;0..1&#125;.t_order_item$-&gt;&#123;0..1&#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#------------------------åˆ†åº“ç­–ç•¥</span></span><br><span class="line"><span class="comment"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class="line"><span class="attr">spring.shardingsphere.rules.sharding.tables.t_order_item.database-strategy.standard.sharding-column</span>=<span class="string">user_id</span></span><br><span class="line"><span class="comment"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class="line"><span class="attr">spring.shardingsphere.rules.sharding.tables.t_order_item.database-strategy.standard.sharding-algorithm-name</span>=<span class="string">alg_mod</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#------------------------åˆ†è¡¨ç­–ç•¥</span></span><br><span class="line"><span class="comment"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class="line"><span class="attr">spring.shardingsphere.rules.sharding.tables.t_order_item.table-strategy.standard.sharding-column</span>=<span class="string">order_no</span></span><br><span class="line"><span class="comment"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class="line"><span class="attr">spring.shardingsphere.rules.sharding.tables.t_order_item.table-strategy.standard.sharding-algorithm-name</span>=<span class="string">alg_hash_mod</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#------------------------åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥é…ç½®</span></span><br><span class="line"><span class="comment"># åˆ†å¸ƒå¼åºåˆ—åˆ—åç§°</span></span><br><span class="line"><span class="attr">spring.shardingsphere.rules.sharding.tables.t_order_item.key-generate-strategy.column</span>=<span class="string">id</span></span><br><span class="line"><span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class="line"><span class="attr">spring.shardingsphere.rules.sharding.tables.t_order_item.key-generate-strategy.key-generator-name</span>=<span class="string">alg_snowflake</span></span><br></pre></td></tr></table></figure><h3 id="3-5ã€æµ‹è¯•æ’å…¥æ•°æ®"><a href="#3-5ã€æµ‹è¯•æ’å…¥æ•°æ®" class="headerlink" title="3.5ã€æµ‹è¯•æ’å…¥æ•°æ®"></a>3.5ã€æµ‹è¯•æ’å…¥æ•°æ®</h3><p>åŒä¸€ä¸ªç”¨æˆ·çš„è®¢å•è¡¨å’Œè®¢å•è¯¦æƒ…è¡¨ä¸­çš„æ•°æ®éƒ½åœ¨åŒä¸€ä¸ªæ•°æ®æºä¸­ï¼Œé¿å…è·¨åº“å…³è”</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æµ‹è¯•å…³è”è¡¨æ’å…¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testInsertOrderAndOrderItem</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">long</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Order</span>();</span><br><span class="line">        order.setOrderNo(<span class="string">&quot;xiaofei&quot;</span> + i);</span><br><span class="line">        order.setUserId(<span class="number">1L</span>);</span><br><span class="line">        orderMapper.insert(order);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">long</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt; <span class="number">3</span>; j++) &#123;</span><br><span class="line">            <span class="type">OrderItem</span> <span class="variable">orderItem</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrderItem</span>();</span><br><span class="line">            orderItem.setOrderNo(<span class="string">&quot;xiaofei&quot;</span> + i);</span><br><span class="line">            orderItem.setUserId(<span class="number">1L</span>);</span><br><span class="line">            orderItem.setPrice(<span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="number">10</span>));</span><br><span class="line">            orderItem.setCount(<span class="number">2</span>);</span><br><span class="line">            orderItemMapper.insert(orderItem);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">long</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">5</span>; i &lt; <span class="number">7</span>; i++) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Order</span>();</span><br><span class="line">        order.setOrderNo(<span class="string">&quot;xiaofei&quot;</span> + i);</span><br><span class="line">        order.setUserId(<span class="number">2L</span>);</span><br><span class="line">        orderMapper.insert(order);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">long</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt; <span class="number">3</span>; j++) &#123;</span><br><span class="line">            <span class="type">OrderItem</span> <span class="variable">orderItem</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrderItem</span>();</span><br><span class="line">            orderItem.setOrderNo(<span class="string">&quot;xiaofei&quot;</span> + i);</span><br><span class="line">            orderItem.setUserId(<span class="number">2L</span>);</span><br><span class="line">            orderItem.setPrice(<span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="number">1</span>));</span><br><span class="line">            orderItem.setCount(<span class="number">3</span>);</span><br><span class="line">            orderItemMapper.insert(orderItem);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4ã€ç»‘å®šè¡¨"><a href="#4ã€ç»‘å®šè¡¨" class="headerlink" title="4ã€ç»‘å®šè¡¨"></a>4ã€ç»‘å®šè¡¨</h2><p><strong>éœ€æ±‚ï¼š</strong>æŸ¥è¯¢æ¯ä¸ªè®¢å•çš„è®¢å•å·å’Œæ€»è®¢å•é‡‘é¢</p><h3 id="4-1ã€åˆ›å»ºVOå¯¹è±¡"><a href="#4-1ã€åˆ›å»ºVOå¯¹è±¡" class="headerlink" title="4.1ã€åˆ›å»ºVOå¯¹è±¡"></a>4.1ã€åˆ›å»ºVOå¯¹è±¡</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaofei.shardingjdbcdemo.entity;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderVo</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String orderNo;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal amount;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-2ã€æ·»åŠ Mapperæ–¹æ³•"><a href="#4-2ã€æ·»åŠ Mapperæ–¹æ³•" class="headerlink" title="4.2ã€æ·»åŠ Mapperæ–¹æ³•"></a>4.2ã€æ·»åŠ Mapperæ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaofei.shardingjdbcdemo.mapper;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;Order&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Select(&#123;&quot;SELECT o.order_no, SUM(i.price * i.count) AS amount&quot;,</span></span><br><span class="line"><span class="meta">            &quot;FROM t_order o JOIN t_order_item i ON o.order_no = i.order_no&quot;,</span></span><br><span class="line"><span class="meta">            &quot;GROUP BY o.order_no&quot;&#125;)</span></span><br><span class="line">    List&lt;OrderVo&gt; <span class="title function_">getOrderAmount</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-3ã€æµ‹è¯•å…³è”æŸ¥è¯¢"><a href="#4-3ã€æµ‹è¯•å…³è”æŸ¥è¯¢" class="headerlink" title="4.3ã€æµ‹è¯•å…³è”æŸ¥è¯¢"></a>4.3ã€æµ‹è¯•å…³è”æŸ¥è¯¢</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æµ‹è¯•å…³è”è¡¨æŸ¥è¯¢</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetOrderAmount</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">    List&lt;OrderVo&gt; orderAmountList = orderMapper.getOrderAmount();</span><br><span class="line">    orderAmountList.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-4ã€é…ç½®ç»‘å®šè¡¨"><a href="#4-4ã€é…ç½®ç»‘å®šè¡¨" class="headerlink" title="4.4ã€é…ç½®ç»‘å®šè¡¨"></a>4.4ã€é…ç½®ç»‘å®šè¡¨</h3><p>åœ¨åŸæ¥æ°´å¹³åˆ†ç‰‡é…ç½®çš„åŸºç¡€ä¸Šæ·»åŠ å¦‚ä¸‹é…ç½®ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#------------------------ç»‘å®šè¡¨</span></span><br><span class="line"><span class="attr">spring.shardingsphere.rules.sharding.binding-tables[0]</span>=<span class="string">t_order,t_order_item</span></span><br></pre></td></tr></table></figure><p>é…ç½®å®Œç»‘å®šè¡¨åå†æ¬¡è¿›è¡Œå…³è”æŸ¥è¯¢çš„æµ‹è¯•ï¼š</p><ul><li><p><strong>å¦‚æœä¸é…ç½®ç»‘å®šè¡¨ï¼šæµ‹è¯•çš„ç»“æœä¸º8ä¸ªSQLã€‚</strong>å¤šè¡¨å…³è”æŸ¥è¯¢ä¼šå‡ºç°ç¬›å¡å°”ç§¯å…³è”ã€‚</p></li><li><p><strong>å¦‚æœé…ç½®ç»‘å®šè¡¨ï¼šæµ‹è¯•çš„ç»“æœä¸º4ä¸ªSQLã€‚</strong> å¤šè¡¨å…³è”æŸ¥è¯¢ä¸ä¼šå‡ºç°ç¬›å¡å°”ç§¯å…³è”ï¼Œå…³è”æŸ¥è¯¢æ•ˆç‡å°†å¤§å¤§æå‡ã€‚</p></li></ul><p><code>ç»‘å®šè¡¨ï¼š</code>æŒ‡åˆ†ç‰‡è§„åˆ™ä¸€è‡´çš„ä¸€ç»„åˆ†ç‰‡è¡¨ã€‚ ä½¿ç”¨ç»‘å®šè¡¨è¿›è¡Œå¤šè¡¨å…³è”æŸ¥è¯¢æ—¶ï¼Œå¿…é¡»ä½¿ç”¨åˆ†ç‰‡é”®è¿›è¡Œå…³è”ï¼Œå¦åˆ™ä¼šå‡ºç°ç¬›å¡å°”ç§¯å…³è”æˆ–è·¨åº“å…³è”ï¼Œä»è€Œå½±å“æŸ¥è¯¢æ•ˆç‡ã€‚</p><h2 id="5ã€å¹¿æ’­è¡¨"><a href="#5ã€å¹¿æ’­è¡¨" class="headerlink" title="5ã€å¹¿æ’­è¡¨"></a>5ã€å¹¿æ’­è¡¨</h2><h3 id="4-1ã€ä»€ä¹ˆæ˜¯å¹¿æ’­è¡¨"><a href="#4-1ã€ä»€ä¹ˆæ˜¯å¹¿æ’­è¡¨" class="headerlink" title="4.1ã€ä»€ä¹ˆæ˜¯å¹¿æ’­è¡¨"></a>4.1ã€ä»€ä¹ˆæ˜¯å¹¿æ’­è¡¨</h3><p>æŒ‡æ‰€æœ‰çš„åˆ†ç‰‡æ•°æ®æºä¸­éƒ½å­˜åœ¨çš„è¡¨ï¼Œè¡¨ç»“æ„åŠå…¶æ•°æ®åœ¨æ¯ä¸ªæ•°æ®åº“ä¸­å‡å®Œå…¨ä¸€è‡´ã€‚ é€‚ç”¨äºæ•°æ®é‡ä¸å¤§ä¸”éœ€è¦ä¸æµ·é‡æ•°æ®çš„è¡¨è¿›è¡Œå…³è”æŸ¥è¯¢çš„åœºæ™¯ï¼Œä¾‹å¦‚ï¼šå­—å…¸è¡¨ã€‚</p><p>å¹¿æ’­å…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š</p><p>ï¼ˆ1ï¼‰æ’å…¥ã€æ›´æ–°æ“ä½œä¼šå®æ—¶åœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šæ‰§è¡Œï¼Œä¿æŒå„ä¸ªåˆ†ç‰‡çš„æ•°æ®ä¸€è‡´æ€§</p><p>ï¼ˆ2ï¼‰æŸ¥è¯¢æ“ä½œï¼Œåªä»ä¸€ä¸ªèŠ‚ç‚¹è·å–</p><p>ï¼ˆ3ï¼‰å¯ä»¥è·Ÿä»»ä½•ä¸€ä¸ªè¡¨è¿›è¡Œ JOIN æ“ä½œ</p><h3 id="4-2ã€åˆ›å»ºå¹¿æ’­è¡¨"><a href="#4-2ã€åˆ›å»ºå¹¿æ’­è¡¨" class="headerlink" title="4.2ã€åˆ›å»ºå¹¿æ’­è¡¨"></a>4.2ã€åˆ›å»ºå¹¿æ’­è¡¨</h3><p>åœ¨server-order0ã€server-order1å’Œserver-useræœåŠ¡å™¨ä¸­åˆ†åˆ«åˆ›å»ºt_dictè¡¨</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_dict(</span><br><span class="line">    id <span class="type">BIGINT</span>,</span><br><span class="line">    dict_type <span class="type">VARCHAR</span>(<span class="number">200</span>),</span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY(id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h3 id="4-3ã€ç¨‹åºå®ç°"><a href="#4-3ã€ç¨‹åºå®ç°" class="headerlink" title="4.3ã€ç¨‹åºå®ç°"></a>4.3ã€ç¨‹åºå®ç°</h3><h4 id="4-3-1ã€åˆ›å»ºå®ä½“ç±»"><a href="#4-3-1ã€åˆ›å»ºå®ä½“ç±»" class="headerlink" title="4.3.1ã€åˆ›å»ºå®ä½“ç±»"></a>4.3.1ã€åˆ›å»ºå®ä½“ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaofei.shardingjdbcdemo.entity;</span><br><span class="line"></span><br><span class="line"><span class="meta">@TableName(&quot;t_dict&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dict</span> &#123;</span><br><span class="line">    <span class="comment">//å¯ä»¥ä½¿ç”¨MyBatisPlusçš„é›ªèŠ±ç®—æ³•</span></span><br><span class="line">    <span class="meta">@TableId(type = IdType.ASSIGN_ID)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String dictType;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="4-3-2ã€åˆ›å»ºMapper"><a href="#4-3-2ã€åˆ›å»ºMapper" class="headerlink" title="4.3.2ã€åˆ›å»ºMapper"></a>4.3.2ã€åˆ›å»ºMapper</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaofei.shardingjdbcdemo.mapper;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DictMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;Dict&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="4-3-3ã€é…ç½®å¹¿æ’­è¡¨"><a href="#4-3-3ã€é…ç½®å¹¿æ’­è¡¨" class="headerlink" title="4.3.3ã€é…ç½®å¹¿æ’­è¡¨"></a>4.3.3ã€é…ç½®å¹¿æ’­è¡¨</h4><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æ•°æ®èŠ‚ç‚¹å¯ä¸é…ç½®ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå‘æ‰€æœ‰æ•°æ®æºå¹¿æ’­</span></span><br><span class="line"><span class="attr">spring.shardingsphere.rules.sharding.tables.t_dict.actual-data-nodes</span>=<span class="string">server-user.t_dict,server-order$-&gt;&#123;0..1&#125;.t_dict</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># å¹¿æ’­è¡¨</span></span><br><span class="line"><span class="attr">spring.shardingsphere.rules.sharding.broadcast-tables[0]</span>=<span class="string">t_dict</span></span><br></pre></td></tr></table></figure><h3 id="4-4ã€æµ‹è¯•å¹¿æ’­è¡¨"><a href="#4-4ã€æµ‹è¯•å¹¿æ’­è¡¨" class="headerlink" title="4.4ã€æµ‹è¯•å¹¿æ’­è¡¨"></a>4.4ã€æµ‹è¯•å¹¿æ’­è¡¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> DictMapper dictMapper;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¹¿æ’­è¡¨ï¼šæ¯ä¸ªæœåŠ¡å™¨ä¸­çš„t_dictåŒæ—¶æ·»åŠ äº†æ–°æ•°æ®</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testBroadcast</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">Dict</span> <span class="variable">dict</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Dict</span>();</span><br><span class="line">    dict.setDictType(<span class="string">&quot;type1&quot;</span>);</span><br><span class="line">    dictMapper.insert(dict);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥è¯¢æ“ä½œï¼Œåªä»ä¸€ä¸ªèŠ‚ç‚¹è·å–æ•°æ®</span></span><br><span class="line"><span class="comment">     * éšæœºè´Ÿè½½å‡è¡¡è§„åˆ™</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectBroadcast</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">    List&lt;Dict&gt; dicts = dictMapper.selectList(<span class="literal">null</span>);</span><br><span class="line">    dicts.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ç¬¬07ç« -å¯åŠ¨ShardingSphere-Proxy"><a href="#ç¬¬07ç« -å¯åŠ¨ShardingSphere-Proxy" class="headerlink" title="ç¬¬07ç«  å¯åŠ¨ShardingSphere-Proxy"></a>ç¬¬07ç«  å¯åŠ¨ShardingSphere-Proxy</h1><h2 id="1ã€è·å–"><a href="#1ã€è·å–" class="headerlink" title="1ã€è·å–"></a>1ã€è·å–</h2><p>ç›®å‰ ShardingSphere-Proxy æä¾›äº† 3 ç§è·å–æ–¹å¼ï¼š</p><ul><li><a href="https://shardingsphere.apache.org/document/5.1.1/cn/user-manual/shardingsphere-proxy/startup/bin/">äºŒè¿›åˆ¶å‘å¸ƒåŒ…</a></li><li><a href="https://shardingsphere.apache.org/document/5.1.1/cn/user-manual/shardingsphere-proxy/startup/docker/">Docker</a></li><li><a href="https://shardingsphere.apache.org/document/5.1.1/cn/user-manual/shardingsphere-proxy/startup/helm/">Helm</a></li></ul><h2 id="2ã€ä½¿ç”¨äºŒè¿›åˆ¶å‘å¸ƒåŒ…å®‰è£…"><a href="#2ã€ä½¿ç”¨äºŒè¿›åˆ¶å‘å¸ƒåŒ…å®‰è£…" class="headerlink" title="2ã€ä½¿ç”¨äºŒè¿›åˆ¶å‘å¸ƒåŒ…å®‰è£…"></a>2ã€ä½¿ç”¨äºŒè¿›åˆ¶å‘å¸ƒåŒ…å®‰è£…</h2><p>äºŒè¿›åˆ¶åŒ…æ—¢å¯ä»¥Linuxç³»ç»Ÿè¿è¡Œï¼Œåˆå¯ä»¥åœ¨windowsç³»ç»Ÿè¿è¡Œ</p><p><strong>step1ï¼šè§£å‹äºŒè¿›åˆ¶åŒ…</strong></p><p><code>apache-shardingsphere-5.1.1-shardingsphere-proxy-bin.tar.gz</code></p><p>windowsï¼šä½¿ç”¨è§£å‹è½¯ä»¶è§£å‹æ–‡ä»¶</p><p>Linuxï¼šå°†æ–‡ä»¶ä¸Šä¼ è‡³/optç›®å½•ï¼Œå¹¶è§£å‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf apache-shardingsphere-5.1.1-shardingsphere-proxy-bin.tar.gz</span><br></pre></td></tr></table></figure><p><strong>step2ï¼šMySQLé©±åŠ¨</strong></p><p><code>mysql-connector-java-8.0.22.jar</code></p><p>å°†MySQlé©±åŠ¨æ”¾è‡³è§£å‹ç›®å½•ä¸­çš„<code>ext-lib</code>ç›®å½•</p><p><strong>spte3ï¼šä¿®æ”¹é…ç½®conf/server.yaml</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="type">!AUTHORITY</span></span><br><span class="line">    <span class="attr">users:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">root@%:root</span></span><br><span class="line">    <span class="attr">provider:</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">ALL_PRIVILEGES_PERMITTED</span></span><br><span class="line"></span><br><span class="line"><span class="attr">props:</span></span><br><span class="line">  <span class="attr">sql-show:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><p><strong>spte4ï¼šå¯åŠ¨ShardingSphere-Proxy</strong></p><p>Linux æ“ä½œç³»ç»Ÿè¯·è¿è¡Œ <code>bin/start.sh</code></p><p>Windows æ“ä½œç³»ç»Ÿè¯·è¿è¡Œ <code>bin/start.bat</code> </p><p>æŒ‡å®šç«¯å£å·å’Œé…ç½®æ–‡ä»¶ç›®å½•ï¼š<code>bin/start.bat $&#123;proxy_port&#125; $&#123;proxy_conf_directory&#125;</code> </p><p><strong>step5ï¼šè¿œç¨‹è¿æ¥ShardingSphere-Proxy</strong></p><p>è¿œç¨‹è®¿é—®</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -h192.168.100.1 -P3307 -uroot -p</span><br></pre></td></tr></table></figure><p><strong>step6ï¼šè®¿é—®æµ‹è¯•</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> databases;</span><br></pre></td></tr></table></figure><p><img src="https://www.naste.top:9000/images/image-20220819152009158.png" alt="image-20220819152009158"></p><h2 id="3ã€ä½¿ç”¨Dockerå®‰è£…"><a href="#3ã€ä½¿ç”¨Dockerå®‰è£…" class="headerlink" title="3ã€ä½¿ç”¨Dockerå®‰è£…"></a>3ã€ä½¿ç”¨Dockerå®‰è£…</h2><p><strong>step1ï¼šå¯åŠ¨Dockerå®¹å™¨</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">-v /xiaofei/server/proxy-a/conf:/opt/shardingsphere-proxy/conf \</span><br><span class="line">-v /xiaofei/server/proxy-a/ext-lib:/opt/shardingsphere-proxy/ext-lib \</span><br><span class="line">-e ES_JAVA_OPTS=&quot;-Xmx256m -Xms256m -Xmn128m&quot; \</span><br><span class="line">-p 3321:3307 \</span><br><span class="line">--name server-proxy-a \</span><br><span class="line">apache/shardingsphere-proxy:5.1.1</span><br></pre></td></tr></table></figure><p><strong>step2ï¼šä¸Šä¼ MySQLé©±åŠ¨</strong></p><p>å°†MySQlé©±åŠ¨ä¸Šä¼ è‡³<code>/xiaofei/server/proxy-a/ext-lib</code>ç›®å½•</p><p><strong>spte3ï¼šä¿®æ”¹é…ç½®server.yaml</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="type">!AUTHORITY</span></span><br><span class="line">    <span class="attr">users:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">root@%:root</span></span><br><span class="line">    <span class="attr">provider:</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">ALL_PRIVILEGES_PERMITTED</span></span><br><span class="line"></span><br><span class="line"><span class="attr">props:</span></span><br><span class="line">  <span class="attr">sql-show:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><p>å°†é…ç½®æ–‡ä»¶ä¸Šä¼ è‡³<code>/xiaofei/server/proxy-a/conf</code>ç›®å½•</p><p><strong>spte4ï¼šé‡å¯å®¹å™¨</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker restart server-proxy-a</span><br></pre></td></tr></table></figure><p><strong>step5ï¼šè¿œç¨‹è¿æ¥ShardingSphere-Proxy</strong></p><p>ShardingSphere-Proxyå®¹å™¨ä¸­é»˜è®¤æƒ…å†µä¸‹æ²¡æœ‰mysqlå‘½ä»¤è¡Œå®¢æˆ·ç«¯çš„å®‰è£…ï¼Œå› æ­¤éœ€è¦è¿œç¨‹è®¿é—®</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -h192.168.100.201 -P3321 -uroot -p</span><br></pre></td></tr></table></figure><p><strong>step6ï¼šè®¿é—®æµ‹è¯•</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> databases;</span><br></pre></td></tr></table></figure><p><img src="https://www.naste.top:9000/images/image-20220819152009158.png" alt="image-20220819152009158"></p><p><strong>å¸¸è§é—®é¢˜ï¼šdockerå®¹å™¨æ— æ³•è¿œç¨‹è¿æ¥</strong></p><p>å®¹å™¨å¯ä»¥æˆåŠŸçš„åˆ›å»ºå¹¶å¯åŠ¨ï¼Œä½†æ˜¯æ— æ³•è¿œç¨‹è¿æ¥ã€‚æ’é™¤é˜²ç«å¢™å’Œç½‘ç»œç­‰é—®é¢˜åï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯å› ä¸ºå®¹å™¨å†…å­˜ä¸è¶³å¯¼è‡´ã€‚</p><p><code>åŸå› ï¼š</code>å®¹å™¨å¯åˆ†é…å†…å­˜ä¸è¶³</p><p><code>æŸ¥çœ‹åŠæ³•ï¼š</code>è¿›å…¥å®¹å™¨åæŸ¥çœ‹ShardingSphere-Proxyçš„æ—¥å¿—ï¼Œå¦‚æœ‰æœ‰<code>cannot allocate memory</code>ï¼Œåˆ™è¯´æ˜å®¹å™¨å†…å­˜ä¸è¶³</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it server-proxy-a env LANG=C.UTF-8 /bin/bash</span><br><span class="line">cd /opt/shardingsphere-proxy/logs</span><br><span class="line">tail stdout.log </span><br></pre></td></tr></table></figure><p><img src="https://www.naste.top:9000/images/image-20220819151154763.png" alt="image-20220819151154763"></p><p><code>è§£å†³æ–¹æ¡ˆï¼š</code>åˆ›å»ºå®¹å™¨çš„æ—¶å€™ä½¿ç”¨JVMå‚æ•°</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-e ES_JAVA_OPTS=&quot;-Xmx256m -Xms256m -Xmn128m&quot;</span><br></pre></td></tr></table></figure><h1 id="ç¬¬08ç« -ShardingSphere-Proxyè¯»å†™åˆ†ç¦»"><a href="#ç¬¬08ç« -ShardingSphere-Proxyè¯»å†™åˆ†ç¦»" class="headerlink" title="ç¬¬08ç«  ShardingSphere-Proxyè¯»å†™åˆ†ç¦»"></a>ç¬¬08ç«  ShardingSphere-Proxyè¯»å†™åˆ†ç¦»</h1><h2 id="1ã€ä¿®æ”¹é…ç½®æ–‡ä»¶"><a href="#1ã€ä¿®æ”¹é…ç½®æ–‡ä»¶" class="headerlink" title="1ã€ä¿®æ”¹é…ç½®æ–‡ä»¶"></a>1ã€ä¿®æ”¹é…ç½®æ–‡ä»¶</h2><p><strong>ä¿®æ”¹é…ç½®config-readwrite-splitting.yaml</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">schemaName:</span> <span class="string">readwrite_splitting_db</span></span><br><span class="line"></span><br><span class="line"><span class="attr">dataSources:</span></span><br><span class="line">  <span class="attr">write_ds:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.100.201:3306/db_user?serverTimezone=UTC&amp;useSSL=false</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">connectionTimeoutMilliseconds:</span> <span class="number">30000</span></span><br><span class="line">    <span class="attr">idleTimeoutMilliseconds:</span> <span class="number">60000</span></span><br><span class="line">    <span class="attr">maxLifetimeMilliseconds:</span> <span class="number">1800000</span></span><br><span class="line">    <span class="attr">maxPoolSize:</span> <span class="number">50</span></span><br><span class="line">    <span class="attr">minPoolSize:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">read_ds_0:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.100.201:3307/db_user?serverTimezone=UTC&amp;useSSL=false</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">connectionTimeoutMilliseconds:</span> <span class="number">30000</span></span><br><span class="line">    <span class="attr">idleTimeoutMilliseconds:</span> <span class="number">60000</span></span><br><span class="line">    <span class="attr">maxLifetimeMilliseconds:</span> <span class="number">1800000</span></span><br><span class="line">    <span class="attr">maxPoolSize:</span> <span class="number">50</span></span><br><span class="line">    <span class="attr">minPoolSize:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">read_ds_1:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.100.201:3308/db_user?serverTimezone=UTC&amp;useSSL=false</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">connectionTimeoutMilliseconds:</span> <span class="number">30000</span></span><br><span class="line">    <span class="attr">idleTimeoutMilliseconds:</span> <span class="number">60000</span></span><br><span class="line">    <span class="attr">maxLifetimeMilliseconds:</span> <span class="number">1800000</span></span><br><span class="line">    <span class="attr">maxPoolSize:</span> <span class="number">50</span></span><br><span class="line">    <span class="attr">minPoolSize:</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line"><span class="bullet">-</span> <span class="type">!READWRITE_SPLITTING</span></span><br><span class="line">  <span class="attr">dataSources:</span></span><br><span class="line">    <span class="attr">readwrite_ds:</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">Static</span></span><br><span class="line">      <span class="attr">props:</span></span><br><span class="line">        <span class="attr">write-data-source-name:</span> <span class="string">write_ds</span></span><br><span class="line">        <span class="attr">read-data-source-names:</span> <span class="string">read_ds_0,read_ds_1</span></span><br></pre></td></tr></table></figure><p>å°†é…ç½®æ–‡ä»¶ä¸Šä¼ è‡³<code>/xiaofei/server/proxy-a/conf</code>ç›®å½•</p><p><strong>é‡å¯å®¹å™¨</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker restart server-proxy-a</span><br></pre></td></tr></table></figure><h2 id="2ã€å®æ—¶æŸ¥çœ‹æ—¥å¿—"><a href="#2ã€å®æ—¶æŸ¥çœ‹æ—¥å¿—" class="headerlink" title="2ã€å®æ—¶æŸ¥çœ‹æ—¥å¿—"></a>2ã€å®æ—¶æŸ¥çœ‹æ—¥å¿—</h2><p>å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼æŸ¥çœ‹æœåŠ¡å™¨ä¸­è¾“å‡ºçš„SQLè¯­å¥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it server-proxy-a env LANG=C.UTF-8 /bin/bash</span><br><span class="line">tail -f /opt/shardingsphere-proxy/logs/stdout.log </span><br></pre></td></tr></table></figure><h2 id="3ã€è¿œç¨‹è®¿é—®æµ‹è¯•"><a href="#3ã€è¿œç¨‹è®¿é—®æµ‹è¯•" class="headerlink" title="3ã€è¿œç¨‹è®¿é—®æµ‹è¯•"></a>3ã€è¿œç¨‹è®¿é—®æµ‹è¯•</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> databases;</span><br><span class="line">mysql<span class="operator">&gt;</span> use readwrite_splitting_db;</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> tables;</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_user;</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_user;</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">insert</span> <span class="keyword">into</span> t_user(uname) <span class="keyword">values</span>(<span class="string">&#x27;wang5&#x27;</span>);</span><br></pre></td></tr></table></figure><h2 id="4ã€åº”ç”¨ç¨‹åºè®¿é—®Proxy"><a href="#4ã€åº”ç”¨ç¨‹åºè®¿é—®Proxy" class="headerlink" title="4ã€åº”ç”¨ç¨‹åºè®¿é—®Proxy"></a>4ã€åº”ç”¨ç¨‹åºè®¿é—®Proxy</h2><h3 id="4-1ã€åˆ›å»ºé¡¹ç›®"><a href="#4-1ã€åˆ›å»ºé¡¹ç›®" class="headerlink" title="4.1ã€åˆ›å»ºé¡¹ç›®"></a>4.1ã€åˆ›å»ºé¡¹ç›®</h3><p>é¡¹ç›®ç±»å‹ï¼šSpring Initializr</p><p>SpringBootè„šæ‰‹æ¶ï¼š<a href="http://start.aliyun.com">http://start.aliyun.com</a></p><p>é¡¹ç›®åï¼šsharding-proxy-demo</p><p>SpringBootç‰ˆæœ¬ï¼š2.3.7.RELEASE</p><h3 id="4-2ã€æ·»åŠ ä¾èµ–"><a href="#4-2ã€æ·»åŠ ä¾èµ–" class="headerlink" title="4.2ã€æ·»åŠ ä¾èµ–"></a>4.2ã€æ·»åŠ ä¾èµ–</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.vintage<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-vintage-engine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="4-3ã€åˆ›å»ºå®ä½“ç±»"><a href="#4-3ã€åˆ›å»ºå®ä½“ç±»" class="headerlink" title="4.3ã€åˆ›å»ºå®ä½“ç±»"></a>4.3ã€åˆ›å»ºå®ä½“ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaofei.shardingproxydemo.entity;</span><br><span class="line"></span><br><span class="line"><span class="meta">@TableName(&quot;t_user&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="meta">@TableId(type = IdType.AUTO)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String uname;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="4-4ã€åˆ›å»ºMapper"><a href="#4-4ã€åˆ›å»ºMapper" class="headerlink" title="4.4ã€åˆ›å»ºMapper"></a>4.4ã€åˆ›å»ºMapper</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaofei.shardingproxydemo.mapper;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;User&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-5ã€é…ç½®æ•°æ®æº"><a href="#4-5ã€é…ç½®æ•°æ®æº" class="headerlink" title="4.5ã€é…ç½®æ•°æ®æº"></a>4.5ã€é…ç½®æ•°æ®æº</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åº”ç”¨åç§°</span></span><br><span class="line"><span class="attr">spring.application.name</span>=<span class="string">sharding-proxy-demo</span></span><br><span class="line"><span class="comment"># å¼€å‘ç¯å¢ƒè®¾ç½®</span></span><br><span class="line"><span class="attr">spring.profiles.active</span>=<span class="string">dev</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#mysqlæ•°æ®åº“è¿æ¥ï¼ˆproxyï¼‰</span></span><br><span class="line"><span class="attr">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">spring.datasource.url</span>=<span class="string">jdbc:mysql://192.168.100.201:3321/readwrite_splitting_db?serverTimezone=GMT%2B8&amp;useSSL=false</span></span><br><span class="line"><span class="attr">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">spring.datasource.password</span>=<span class="string">root</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#mybatisæ—¥å¿—</span></span><br><span class="line"><span class="attr">mybatis-plus.configuration.log-impl</span>=<span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br></pre></td></tr></table></figure><h3 id="4-6ã€æµ‹è¯•"><a href="#4-6ã€æµ‹è¯•" class="headerlink" title="4.6ã€æµ‹è¯•"></a>4.6ã€æµ‹è¯•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaofei.shardingproxydemo;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ShardingProxyDemoApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¯»æ•°æ®æµ‹è¯•</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectAll</span><span class="params">()</span>&#123;</span><br><span class="line">        List&lt;User&gt; users = userMapper.selectList(<span class="literal">null</span>);</span><br><span class="line">        users.forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ç¬¬09ç« -ShardingSphere-Proxyå‚ç›´åˆ†ç‰‡"><a href="#ç¬¬09ç« -ShardingSphere-Proxyå‚ç›´åˆ†ç‰‡" class="headerlink" title="ç¬¬09ç«  ShardingSphere-Proxyå‚ç›´åˆ†ç‰‡"></a>ç¬¬09ç«  ShardingSphere-Proxyå‚ç›´åˆ†ç‰‡</h1><h2 id="1ã€ä¿®æ”¹é…ç½®æ–‡ä»¶-1"><a href="#1ã€ä¿®æ”¹é…ç½®æ–‡ä»¶-1" class="headerlink" title="1ã€ä¿®æ”¹é…ç½®æ–‡ä»¶"></a>1ã€ä¿®æ”¹é…ç½®æ–‡ä»¶</h2><p><strong>ä¿®æ”¹é…ç½®config-sharding.yaml</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">schemaName:</span> <span class="string">sharding_db</span></span><br><span class="line"></span><br><span class="line"><span class="attr">dataSources:</span></span><br><span class="line">  <span class="attr">ds_0:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.100.201:3301/db_user?serverTimezone=UTC&amp;useSSL=false</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">connectionTimeoutMilliseconds:</span> <span class="number">30000</span></span><br><span class="line">    <span class="attr">idleTimeoutMilliseconds:</span> <span class="number">60000</span></span><br><span class="line">    <span class="attr">maxLifetimeMilliseconds:</span> <span class="number">1800000</span></span><br><span class="line">    <span class="attr">maxPoolSize:</span> <span class="number">50</span></span><br><span class="line">    <span class="attr">minPoolSize:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">ds_1:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.100.201:3302/db_order?serverTimezone=UTC&amp;useSSL=false</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">connectionTimeoutMilliseconds:</span> <span class="number">30000</span></span><br><span class="line">    <span class="attr">idleTimeoutMilliseconds:</span> <span class="number">60000</span></span><br><span class="line">    <span class="attr">maxLifetimeMilliseconds:</span> <span class="number">1800000</span></span><br><span class="line">    <span class="attr">maxPoolSize:</span> <span class="number">50</span></span><br><span class="line">    <span class="attr">minPoolSize:</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line"><span class="bullet">-</span> <span class="type">!SHARDING</span></span><br><span class="line">  <span class="attr">tables:</span></span><br><span class="line">    <span class="attr">t_user:</span></span><br><span class="line">      <span class="attr">actualDataNodes:</span> <span class="string">ds_0.t_user</span></span><br><span class="line">    <span class="attr">t_order:</span></span><br><span class="line">      <span class="attr">actualDataNodes:</span> <span class="string">ds_1.t_order</span></span><br></pre></td></tr></table></figure><h2 id="2ã€å®æ—¶æŸ¥çœ‹æ—¥å¿—-1"><a href="#2ã€å®æ—¶æŸ¥çœ‹æ—¥å¿—-1" class="headerlink" title="2ã€å®æ—¶æŸ¥çœ‹æ—¥å¿—"></a>2ã€å®æ—¶æŸ¥çœ‹æ—¥å¿—</h2><p>å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼æŸ¥çœ‹æœåŠ¡å™¨ä¸­è¾“å‡ºçš„SQLè¯­å¥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it server-proxy-a env LANG=C.UTF-8 /bin/bash</span><br><span class="line">tail -f /opt/shardingsphere-proxy/logs/stdout.log </span><br></pre></td></tr></table></figure><h2 id="3ã€è¿œç¨‹è®¿é—®æµ‹è¯•-1"><a href="#3ã€è¿œç¨‹è®¿é—®æµ‹è¯•-1" class="headerlink" title="3ã€è¿œç¨‹è®¿é—®æµ‹è¯•"></a>3ã€è¿œç¨‹è®¿é—®æµ‹è¯•</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> databases;</span><br><span class="line">mysql<span class="operator">&gt;</span> use sharding_db;</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> tables;</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_order;</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_user;</span><br></pre></td></tr></table></figure><h1 id="ç¬¬10ç« -ShardingSphere-Proxyæ°´å¹³åˆ†ç‰‡"><a href="#ç¬¬10ç« -ShardingSphere-Proxyæ°´å¹³åˆ†ç‰‡" class="headerlink" title="ç¬¬10ç«  ShardingSphere-Proxyæ°´å¹³åˆ†ç‰‡"></a>ç¬¬10ç«  ShardingSphere-Proxyæ°´å¹³åˆ†ç‰‡</h1><h2 id="1ã€ä¿®æ”¹é…ç½®æ–‡ä»¶-2"><a href="#1ã€ä¿®æ”¹é…ç½®æ–‡ä»¶-2" class="headerlink" title="1ã€ä¿®æ”¹é…ç½®æ–‡ä»¶"></a>1ã€ä¿®æ”¹é…ç½®æ–‡ä»¶</h2><p><strong>ä¿®æ”¹é…ç½®config-sharding.yaml</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">schemaName:</span> <span class="string">sharding_db</span></span><br><span class="line"></span><br><span class="line"><span class="attr">dataSources:</span></span><br><span class="line">  <span class="attr">ds_user:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.100.201:3301/db_user?serverTimezone=UTC&amp;useSSL=false</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">connectionTimeoutMilliseconds:</span> <span class="number">30000</span></span><br><span class="line">    <span class="attr">idleTimeoutMilliseconds:</span> <span class="number">60000</span></span><br><span class="line">    <span class="attr">maxLifetimeMilliseconds:</span> <span class="number">1800000</span></span><br><span class="line">    <span class="attr">maxPoolSize:</span> <span class="number">50</span></span><br><span class="line">    <span class="attr">minPoolSize:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">ds_order0:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.100.201:3310/db_order?serverTimezone=UTC&amp;useSSL=false</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">connectionTimeoutMilliseconds:</span> <span class="number">30000</span></span><br><span class="line">    <span class="attr">idleTimeoutMilliseconds:</span> <span class="number">60000</span></span><br><span class="line">    <span class="attr">maxLifetimeMilliseconds:</span> <span class="number">1800000</span></span><br><span class="line">    <span class="attr">maxPoolSize:</span> <span class="number">50</span></span><br><span class="line">    <span class="attr">minPoolSize:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">ds_order1:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.100.201:3311/db_order?serverTimezone=UTC&amp;useSSL=false</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">connectionTimeoutMilliseconds:</span> <span class="number">30000</span></span><br><span class="line">    <span class="attr">idleTimeoutMilliseconds:</span> <span class="number">60000</span></span><br><span class="line">    <span class="attr">maxLifetimeMilliseconds:</span> <span class="number">1800000</span></span><br><span class="line">    <span class="attr">maxPoolSize:</span> <span class="number">50</span></span><br><span class="line">    <span class="attr">minPoolSize:</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line"><span class="bullet">-</span> <span class="type">!SHARDING</span></span><br><span class="line">  <span class="attr">tables:</span></span><br><span class="line">    <span class="attr">t_user:</span></span><br><span class="line">      <span class="attr">actualDataNodes:</span> <span class="string">ds_user.t_user</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">t_order:</span></span><br><span class="line">      <span class="attr">actualDataNodes:</span> <span class="string">ds_order$&#123;0..1&#125;.t_order$&#123;0..1&#125;</span></span><br><span class="line">      <span class="attr">databaseStrategy:</span></span><br><span class="line">        <span class="attr">standard:</span></span><br><span class="line">          <span class="attr">shardingColumn:</span> <span class="string">user_id</span></span><br><span class="line">          <span class="attr">shardingAlgorithmName:</span> <span class="string">alg_mod</span></span><br><span class="line">      <span class="attr">tableStrategy:</span></span><br><span class="line">        <span class="attr">standard:</span></span><br><span class="line">          <span class="attr">shardingColumn:</span> <span class="string">order_no</span></span><br><span class="line">          <span class="attr">shardingAlgorithmName:</span> <span class="string">alg_hash_mod</span></span><br><span class="line">      <span class="attr">keyGenerateStrategy:</span></span><br><span class="line">        <span class="attr">column:</span> <span class="string">id</span></span><br><span class="line">        <span class="attr">keyGeneratorName:</span> <span class="string">snowflake</span></span><br><span class="line">    <span class="attr">t_order_item:</span></span><br><span class="line">      <span class="attr">actualDataNodes:</span> <span class="string">ds_order$&#123;0..1&#125;.t_order_item$&#123;0..1&#125;</span></span><br><span class="line">      <span class="attr">databaseStrategy:</span></span><br><span class="line">        <span class="attr">standard:</span></span><br><span class="line">          <span class="attr">shardingColumn:</span> <span class="string">user_id</span></span><br><span class="line">          <span class="attr">shardingAlgorithmName:</span> <span class="string">alg_mod</span></span><br><span class="line">      <span class="attr">tableStrategy:</span></span><br><span class="line">        <span class="attr">standard:</span></span><br><span class="line">          <span class="attr">shardingColumn:</span> <span class="string">order_no</span></span><br><span class="line">          <span class="attr">shardingAlgorithmName:</span> <span class="string">alg_hash_mod</span></span><br><span class="line">      <span class="attr">keyGenerateStrategy:</span></span><br><span class="line">        <span class="attr">column:</span> <span class="string">id</span></span><br><span class="line">        <span class="attr">keyGeneratorName:</span> <span class="string">snowflake</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">bindingTables:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">t_order,t_order_item</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="attr">broadcastTables:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">t_dict</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">shardingAlgorithms:</span></span><br><span class="line">    <span class="attr">alg_inline_userid:</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">INLINE</span></span><br><span class="line">      <span class="attr">props:</span></span><br><span class="line">        <span class="attr">algorithm-expression:</span> <span class="string">server-order$-&gt;&#123;user_id</span> <span class="string">%</span> <span class="number">2</span><span class="string">&#125;</span></span><br><span class="line">    <span class="attr">alg_mod:</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">MOD</span></span><br><span class="line">      <span class="attr">props:</span></span><br><span class="line">        <span class="attr">sharding-count:</span> <span class="number">2</span></span><br><span class="line">    <span class="attr">alg_hash_mod:</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">HASH_MOD</span></span><br><span class="line">      <span class="attr">props:</span></span><br><span class="line">        <span class="attr">sharding-count:</span> <span class="number">2</span></span><br><span class="line">  </span><br><span class="line">  <span class="attr">keyGenerators:</span></span><br><span class="line">    <span class="attr">snowflake:</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">SNOWFLAKE</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="2ã€å®æ—¶æŸ¥çœ‹æ—¥å¿—-2"><a href="#2ã€å®æ—¶æŸ¥çœ‹æ—¥å¿—-2" class="headerlink" title="2ã€å®æ—¶æŸ¥çœ‹æ—¥å¿—"></a>2ã€å®æ—¶æŸ¥çœ‹æ—¥å¿—</h2><p>å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼æŸ¥çœ‹æœåŠ¡å™¨ä¸­è¾“å‡ºçš„SQLè¯­å¥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it server-proxy-a env LANG=C.UTF-8 /bin/bash</span><br><span class="line">tail -f /opt/shardingsphere-proxy/logs/stdout.log </span><br></pre></td></tr></table></figure><h2 id="3ã€è¿œç¨‹è®¿é—®æµ‹è¯•-2"><a href="#3ã€è¿œç¨‹è®¿é—®æµ‹è¯•-2" class="headerlink" title="3ã€è¿œç¨‹è®¿é—®æµ‹è¯•"></a>3ã€è¿œç¨‹è®¿é—®æµ‹è¯•</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> databases;</span><br><span class="line">mysql<span class="operator">&gt;</span> use sharding_db;</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> tables;</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_order; <span class="comment">--æµ‹è¯•æ°´å¹³åˆ†ç‰‡</span></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_dict; <span class="comment">--æµ‹è¯•å¹¿æ’­è¡¨</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">ShardingSphere</summary>
    
    
    
    <category term="Java" scheme="https://www.naste.top:1024/categories/Java/"/>
    
    
    <category term="Java" scheme="https://www.naste.top:1024/tags/Java/"/>
    
    <category term="MySQL" scheme="https://www.naste.top:1024/tags/MySQL/"/>
    
    <category term="SpringBoot" scheme="https://www.naste.top:1024/tags/SpringBoot/"/>
    
    <category term="ShardingSphere" scheme="https://www.naste.top:1024/tags/ShardingSphere/"/>
    
  </entry>
  
  <entry>
    <title>Hutoolå®ç°æ•°æ®è„±æ•</title>
    <link href="https://www.naste.top:1024/posts/3224676358.html"/>
    <id>https://www.naste.top:1024/posts/3224676358.html</id>
    <published>2023-08-15T11:06:11.000Z</published>
    <updated>2023-08-23T14:54:48.152Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h1><p>[TOC]</p><h1 id="å¼•å…¥ä¾èµ–"><a href="#å¼•å…¥ä¾èµ–" class="headerlink" title="å¼•å…¥ä¾èµ–"></a>å¼•å…¥ä¾èµ–</h1><blockquote><p><strong>Hutool 5.xæ”¯æŒJDK8+ï¼Œ å¦‚æœä½ çš„é¡¹ç›®ä½¿ç”¨JDK7ï¼Œè¯·ä½¿ç”¨Hutool 4.xç‰ˆæœ¬ã€‚æœ¬æ–‡ä½¿ç”¨çš„æ•°æ®è„±æ•å·¥å…·ç±»åªæœ‰åœ¨5.6+ç‰ˆæœ¬ä»¥ä¸Šæ‰æä¾›ã€‚</strong></p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--hutoolå·¥å…·ç±»--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.hutool<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hutool-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.8.16<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="Hutoolæ”¯æŒçš„è„±æ•æ•°æ®ç±»å‹"><a href="#Hutoolæ”¯æŒçš„è„±æ•æ•°æ®ç±»å‹" class="headerlink" title="Hutoolæ”¯æŒçš„è„±æ•æ•°æ®ç±»å‹"></a>Hutoolæ”¯æŒçš„è„±æ•æ•°æ®ç±»å‹</h1><ul><li><p>ç”¨æˆ·id</p></li><li><p>ä¸­æ–‡å</p></li><li><p>èº«ä»½è¯å·</p></li><li><p>åº§æœºå·</p></li><li><p>æ‰‹æœºå·</p></li><li><p>åœ°å€</p></li><li><p>ç”µå­é‚®ä»¶</p></li><li><p>å¯†ç </p></li><li><p>ä¸­å›½å¤§é™†è½¦ç‰Œï¼ŒåŒ…å«æ™®é€šè½¦è¾†ã€æ–°èƒ½æºè½¦è¾†</p></li><li><p>é“¶è¡Œå¡</p></li><li><p>IPv4åœ°å€</p></li><li><p>IPv6åœ°å€</p></li><li><p>å®šä¹‰äº†ä¸€ä¸ªfirst_maskçš„è§„åˆ™ï¼Œåªæ˜¾ç¤ºç¬¬ä¸€ä¸ªå­—ç¬¦ã€‚</p></li></ul><h1 id="Hutoolæ•°æ®è„±æ•å®æ“"><a href="#Hutoolæ•°æ®è„±æ•å®æ“" class="headerlink" title="Hutoolæ•°æ®è„±æ•å®æ“"></a>Hutoolæ•°æ®è„±æ•å®æ“</h1><h2 id="åˆ›å»ºæ³¨è§£ç±»"><a href="#åˆ›å»ºæ³¨è§£ç±»" class="headerlink" title="åˆ›å»ºæ³¨è§£ç±»"></a>åˆ›å»ºæ³¨è§£ç±»</h2><blockquote><p><strong>åœ¨å®ä½“ç±»éœ€è¦è„±æ•çš„å­—æ®µä¸Šï¼Œä½¿ç”¨è¯¥æ³¨è§£æ ‡æ³¨å’ŒæŒ‡å®šè„±æ•çš„ç±»å‹ï¼Œæ•°æ®åˆ™ä¼šåœ¨åºåˆ—åŒ–çš„æ—¶å€™è¿›è¡Œè„±æ•å¤„ç†</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cn.hutool.core.util.DesensitizedUtil;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JacksonAnnotationsInside;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.annotation.JsonSerialize;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.encryption.config.DesensitizationSerialize;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ•°æ®è„±æ•ä½¿ç”¨æ³¨è§£ï¼Œåœ¨éœ€è¦è„±æ•çš„å­—æ®µä¸Šæ·»åŠ è¯¥æ³¨è§£ï¼Œç„¶åé…åˆè‡ªå®šä¹‰åºåˆ—åŒ–ï¼Œå°†æ•°æ®è¿›è¡Œè„±æ•</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Target(ElementType.FIELD)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@JacksonAnnotationsInside</span></span><br><span class="line"><span class="meta">@JsonSerialize(using = DesensitizationSerialize.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Desensitization &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è„±æ•æ•°æ®ç±»å‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    DesensitizedUtil.DesensitizedType <span class="title function_">type</span><span class="params">()</span> <span class="keyword">default</span> DesensitizedUtil.DesensitizedType.FIRST_MASK;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åˆ›å»ºåºåˆ—åŒ–é…ç½®ç±»"><a href="#åˆ›å»ºåºåˆ—åŒ–é…ç½®ç±»" class="headerlink" title="åˆ›å»ºåºåˆ—åŒ–é…ç½®ç±»"></a>åˆ›å»ºåºåˆ—åŒ–é…ç½®ç±»</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cn.hutool.core.util.DesensitizedUtil;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.JsonGenerator;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.BeanProperty;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.JsonMappingException;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.JsonSerializer;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.SerializerProvider;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ser.ContextualSerializer;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.encryption.annotation.Desensitization;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Objects;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ•°æ®è„±æ•è‡ªå®šä¹‰åºåˆ—åŒ–ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DesensitizationSerialize</span> <span class="keyword">extends</span> <span class="title class_">JsonSerializer</span>&lt;String&gt; <span class="keyword">implements</span> <span class="title class_">ContextualSerializer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> DesensitizedUtil.DesensitizedType type;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(String str, JsonGenerator jsonGenerator, SerializerProvider serializerProvider)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.isEmpty(str)) &#123;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// åŒ¹é…ä¸åŒè„±æ•ç±»å‹ï¼Œå¯¹æ•°æ®åšä¸åŒçš„è„±æ•æ“ä½œ</span></span><br><span class="line">            <span class="keyword">switch</span> (type) &#123;</span><br><span class="line">                <span class="keyword">case</span> USER_ID:</span><br><span class="line">                    str = String.valueOf(DesensitizedUtil.userId());</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> CHINESE_NAME:</span><br><span class="line">                    str = DesensitizedUtil.chineseName(str);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> ID_CARD:</span><br><span class="line">                    str = DesensitizedUtil.idCardNum(str, <span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> FIXED_PHONE:</span><br><span class="line">                    str = DesensitizedUtil.fixedPhone(str);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> MOBILE_PHONE:</span><br><span class="line">                    str = DesensitizedUtil.mobilePhone(str);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> ADDRESS:</span><br><span class="line">                    str = DesensitizedUtil.address(str, <span class="number">8</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> EMAIL:</span><br><span class="line">                    str = DesensitizedUtil.email(str);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> PASSWORD:</span><br><span class="line">                    str = DesensitizedUtil.password(str);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> CAR_LICENSE:</span><br><span class="line">                    str = DesensitizedUtil.carLicense(str);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> BANK_CARD:</span><br><span class="line">                    str = DesensitizedUtil.bankCard(str);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> IPV4:</span><br><span class="line">                    str = DesensitizedUtil.ipv4(str);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> IPV6:</span><br><span class="line">                    str = DesensitizedUtil.ipv6(str);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> FIRST_MASK:</span><br><span class="line">                    str = DesensitizedUtil.firstMask(str);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">            &#125;</span><br><span class="line">            jsonGenerator.writeString(str);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> JsonSerializer&lt;?&gt; createContextual(SerializerProvider serializerProvider, BeanProperty beanProperty) <span class="keyword">throws</span> JsonMappingException &#123;</span><br><span class="line">        <span class="keyword">if</span> (beanProperty != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// åˆ¤æ–­æ•°æ®ç±»å‹æ˜¯å¦ä¸ºStringç±»å‹</span></span><br><span class="line">            <span class="keyword">if</span> (Objects.equals(beanProperty.getType().getRawClass(), String.class)) &#123;</span><br><span class="line">                <span class="comment">// è·å–å®šä¹‰çš„æ³¨è§£</span></span><br><span class="line">                <span class="type">Desensitization</span> <span class="variable">desensitization</span> <span class="operator">=</span> beanProperty.getAnnotation(Desensitization.class);</span><br><span class="line">                <span class="comment">// ä¸ºnull</span></span><br><span class="line">                <span class="keyword">if</span> (desensitization == <span class="literal">null</span>) &#123;</span><br><span class="line">                    desensitization = beanProperty.getContextAnnotation(Desensitization.class);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// ä¸ä¸ºnull</span></span><br><span class="line">                <span class="keyword">if</span> (desensitization != <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="comment">// åˆ›å»ºå®šä¹‰çš„åºåˆ—åŒ–ç±»çš„å®ä¾‹å¹¶ä¸”è¿”å›ï¼Œå…¥å‚ä¸ºæ³¨è§£å®šä¹‰çš„type,å¼€å§‹ä½ç½®ï¼Œç»“æŸä½ç½®ã€‚</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DesensitizationSerialize</span>(desensitization.type());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> serializerProvider.findValueSerializer(beanProperty.getType(), beanProperty);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> serializerProvider.findNullValueSerializer(<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å®ä½“ç±»"><a href="#å®ä½“ç±»" class="headerlink" title="å®ä½“ç±»"></a>å®ä½“ç±»</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cn.hutool.core.util.DesensitizedUtil;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.excel.annotation.ExcelProperty;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableField;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableName;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.encryption.annotation.Desensitization;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiModel;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiModelProperty;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.EqualsAndHashCode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”¨æˆ·</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode(callSuper = true)</span></span><br><span class="line"><span class="meta">@ApiModel(&quot;ç”¨æˆ·è¡¨&quot;)</span></span><br><span class="line"><span class="meta">@TableName(value = &quot;user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserEntity</span> <span class="keyword">extends</span> <span class="title class_">BaseEntity</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;å¯†ç ï¼ŒåŠ å¯†å­˜å‚¨&quot;)</span></span><br><span class="line">    <span class="meta">@Desensitization(type = DesensitizedUtil.DesensitizedType.PASSWORD)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;æ‰‹æœºå·&quot;)</span></span><br><span class="line">    <span class="meta">@Desensitization(type = DesensitizedUtil.DesensitizedType.MOBILE_PHONE)</span></span><br><span class="line">    <span class="keyword">private</span> String phone;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç»“æœ"><a href="#ç»“æœ" class="headerlink" title="ç»“æœ"></a>ç»“æœ</h2><blockquote><p><strong>é€šè¿‡å›¾ç‰‡å¯ä»¥æŸ¥çœ‹åˆ°ï¼Œè¿”å›çš„æ•°æ®å·²ç»è¿›è¡Œè„±æ•å¤„ç†äº†ï¼Œåç»­åªéœ€è¦åœ¨å®ä½“ç±»ä¸Šä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£<code>Desensitization</code>ï¼Œç„¶åå†æŒ‡å®šéœ€è¦è„±æ•çš„ç±»å‹ï¼Œå³å¯å¯¹æ•°æ®é’ˆå¯¹æ€§çš„è„±æ•</strong></p></blockquote><p><img src="https://www.naste.top:9000/images/image-20230815224500111.png" alt="image-20230815224500111"></p>]]></content>
    
    
    <summary type="html">Hutoolå®ç°æ•°æ®è„±æ•</summary>
    
    
    
    <category term="Java" scheme="https://www.naste.top:1024/categories/Java/"/>
    
    
    <category term="Java" scheme="https://www.naste.top:1024/tags/Java/"/>
    
    <category term="SpringBoot" scheme="https://www.naste.top:1024/tags/SpringBoot/"/>
    
    <category term="Hutool" scheme="https://www.naste.top:1024/tags/Hutool/"/>
    
  </entry>
  
  <entry>
    <title>EasyExcelä½¿ç”¨</title>
    <link href="https://www.naste.top:1024/posts/869019539.html"/>
    <id>https://www.naste.top:1024/posts/869019539.html</id>
    <published>2023-08-12T13:56:11.000Z</published>
    <updated>2023-08-23T14:54:48.160Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h1><p>[TOC]</p><h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><p><a href="https://www.bilibili.com/video/BV1mG4y1f7jr/">https://www.bilibili.com/video/BV1mG4y1f7jr/</a></p><h1 id="EasyExcelæ³¨è§£"><a href="#EasyExcelæ³¨è§£" class="headerlink" title="EasyExcelæ³¨è§£"></a>EasyExcelæ³¨è§£</h1><div class="table-container"><table><thead><tr><th></th><th></th><th></th></tr></thead><tbody><tr><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td></tr><tr><td></td><td></td></tr></tbody></table></div><h1 id="å¯¼å…¥ä¾èµ–"><a href="#å¯¼å…¥ä¾èµ–" class="headerlink" title="å¯¼å…¥ä¾èµ–"></a>å¯¼å…¥ä¾èµ–</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--EasyExcel--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>easyexcel<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `<span class="keyword">user</span>`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `<span class="keyword">user</span>` (</span><br><span class="line">  `id` <span class="type">bigint</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;è‡ªå¢id&#x27;</span>,</span><br><span class="line">  `nickname` <span class="type">varchar</span>(<span class="number">32</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_0900_ai_ci <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;ç”¨æˆ·æ˜µç§°&#x27;</span>,</span><br><span class="line">  `avatar` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_0900_ai_ci <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;ç”¨æˆ·å¤´åƒé“¾æ¥&#x27;</span>,</span><br><span class="line">  `username` <span class="type">varchar</span>(<span class="number">32</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_0900_ai_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;ç”¨æˆ·å&#x27;</span>,</span><br><span class="line">  `password` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_0900_ai_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;å¯†ç ï¼ŒåŠ å¯†å­˜å‚¨&#x27;</span>,</span><br><span class="line">  `salt` <span class="type">varchar</span>(<span class="number">32</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_0900_ai_ci <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;å¯†ç ç›å€¼&#x27;</span>,</span><br><span class="line">  `gender` tinyint(<span class="number">1</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;æ€§åˆ«ï¼Œ0è¡¨ç¤ºæœªçŸ¥ï¼Œ1è¡¨ç¤ºç”·æ€§ï¼Œ2è¡¨ç¤ºå¥³æ€§&#x27;</span>,</span><br><span class="line">  `birthday` <span class="type">date</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;ç”Ÿæ—¥&#x27;</span>,</span><br><span class="line">  `email` <span class="type">varchar</span>(<span class="number">64</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_0900_ai_ci <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;é‚®ç®±&#x27;</span>,</span><br><span class="line">  `phone` <span class="type">varchar</span>(<span class="number">11</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_0900_ai_ci <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;æ‰‹æœºå·&#x27;</span>,</span><br><span class="line">  `qq` <span class="type">varchar</span>(<span class="number">16</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_0900_ai_ci <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;QQå·ç &#x27;</span>,</span><br><span class="line">  `wechat` <span class="type">varchar</span>(<span class="number">32</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_0900_ai_ci <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;å¾®ä¿¡å·&#x27;</span>,</span><br><span class="line">  `weibo` <span class="type">varchar</span>(<span class="number">64</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_0900_ai_ci <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;å¾®åšè´¦å·&#x27;</span>,</span><br><span class="line">  `github` <span class="type">varchar</span>(<span class="number">64</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_0900_ai_ci <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;GitHubè´¦å·&#x27;</span>,</span><br><span class="line">  `linkedin` <span class="type">varchar</span>(<span class="number">64</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_0900_ai_ci <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;LinkedInè´¦å·&#x27;</span>,</span><br><span class="line">  `country_code` <span class="type">varchar</span>(<span class="number">5</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_0900_ai_ci <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;å›½å®¶ä»£ç &#x27;</span>,</span><br><span class="line">  `province` <span class="type">varchar</span>(<span class="number">16</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_0900_ai_ci <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;çœä»½&#x27;</span>,</span><br><span class="line">  `city` <span class="type">varchar</span>(<span class="number">16</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_0900_ai_ci <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;åŸå¸‚&#x27;</span>,</span><br><span class="line">  `address` <span class="type">varchar</span>(<span class="number">128</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_0900_ai_ci <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;åœ°å€&#x27;</span>,</span><br><span class="line">  `post_code` <span class="type">varchar</span>(<span class="number">6</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_0900_ai_ci <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;é‚®ç¼–&#x27;</span>,</span><br><span class="line">  `last_login_time` datetime <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;æœ€è¿‘ä¸€æ¬¡ç™»å½•æ—¶é—´&#x27;</span>,</span><br><span class="line">  `last_login_ip` <span class="type">varchar</span>(<span class="number">15</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_0900_ai_ci <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;æœ€è¿‘ä¸€æ¬¡ç™»å½•IPåœ°å€&#x27;</span>,</span><br><span class="line">  `status` tinyint(<span class="number">1</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;1&#x27;</span> COMMENT <span class="string">&#x27;ç”¨æˆ·çŠ¶æ€ï¼Œ0è¡¨ç¤ºç¦ç”¨ï¼Œ1è¡¨ç¤ºå¯ç”¨&#x27;</span>,</span><br><span class="line">  `create_time` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,</span><br><span class="line">  `update_time` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;ä¿®æ”¹æ—¶é—´&#x27;</span>,</span><br><span class="line">  `remark1` <span class="type">varchar</span>(<span class="number">64</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_0900_ai_ci <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;è‡ªå®šä¹‰å­—æ®µ1&#x27;</span>,</span><br><span class="line">  `remark2` <span class="type">varchar</span>(<span class="number">64</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_0900_ai_ci <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;è‡ªå®šä¹‰å­—æ®µ2&#x27;</span>,</span><br><span class="line">  `remark3` <span class="type">varchar</span>(<span class="number">64</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_0900_ai_ci <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;è‡ªå®šä¹‰å­—æ®µ3&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`) <span class="keyword">USING</span> BTREE,</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `idx_username` (`username`) <span class="keyword">USING</span> BTREE COMMENT <span class="string">&#x27;å”¯ä¸€ç´¢å¼•ï¼Œä¿è¯ç”¨æˆ·åå”¯ä¸€&#x27;</span></span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">1</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8mb4_0900_ai_ci ROW_FORMAT<span class="operator">=</span><span class="keyword">DYNAMIC</span> COMMENT<span class="operator">=</span><span class="string">&#x27;ç”¨æˆ·è¡¨&#x27;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.excel.annotation.ExcelProperty;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”¨æˆ·ä¿¡æ¯excelæ˜ å°„ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserExcelEntity</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty(value = &quot;ç¼–å·&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty(value = &quot;æ˜µç§°&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String nickname;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty(value = &quot;ç”¨æˆ·å&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty(value = &quot;å¯†ç &quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ–‡ä»¶å¯¼å…¥"><a href="#æ–‡ä»¶å¯¼å…¥" class="headerlink" title="æ–‡ä»¶å¯¼å…¥"></a>æ–‡ä»¶å¯¼å…¥</h1><h2 id="åŸºæœ¬æ–¹å¼å¯¼å…¥"><a href="#åŸºæœ¬æ–¹å¼å¯¼å…¥" class="headerlink" title="åŸºæœ¬æ–¹å¼å¯¼å…¥"></a>åŸºæœ¬æ–¹å¼å¯¼å…¥</h2><blockquote><p><strong>åŸºæœ¬æ–¹å¼å¯¼å…¥ï¼Œç¨‹åºä¸­è·å–åˆ°çš„æ•°æ®ä¸º<code>Map</code>ç±»å‹</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.excel.EasyExcel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 1ã€åŸºæœ¬æ–¹å¼å¯¼å…¥</span></span><br><span class="line"><span class="comment"> * Date: 2023/8/12</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> XiaoFei</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BaseImport</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;C:\\Users\\19030\\Desktop\\tmp\\user.xlsx&quot;</span>);</span><br><span class="line"></span><br><span class="line">        List&lt;Object&gt; list = EasyExcel.read(file).sheet(<span class="number">0</span>).doReadSync();</span><br><span class="line"></span><br><span class="line">        list.forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://www.naste.top:9000/images/image-20230812232426105.png" alt="image-20230812232426105"></p><h2 id="æ¨¡å‹æ˜ å°„å¯¼å…¥"><a href="#æ¨¡å‹æ˜ å°„å¯¼å…¥" class="headerlink" title="æ¨¡å‹æ˜ å°„å¯¼å…¥"></a>æ¨¡å‹æ˜ å°„å¯¼å…¥</h2><h3 id="åŸºæœ¬è¯­æ³•"><a href="#åŸºæœ¬è¯­æ³•" class="headerlink" title="åŸºæœ¬è¯­æ³•"></a>åŸºæœ¬è¯­æ³•</h3><ul><li><p>å…³è”æ˜ å°„</p><ul><li><p>@ExcelProperty(index = 0)</p></li><li><p>@ExcelProperty(value = â€œåˆ—åâ€)</p></li><li><p>@ExcelProperty(value = {â€œä¸»æ ‡é¢˜â€, â€œå‰¯æ ‡é¢˜â€})</p></li></ul></li><li><p>æ ¼å¼è½¬æ¢ï¼Œæ³¨è§£éƒ½æ˜¯å±äº<code>com.alibaba.excel.annotation</code>ä¸‹çš„</p><ul><li>@DateTimeFormat(value = â€œyyyyå¹´MMæœˆddæ—¥ HHæ—¶mmåˆ†ssç§’â€)</li><li>@NumberFormat(value = â€œ#.##%â€)</li><li>@ExcelProperty(converter = è‡ªå®šä¹‰æ ¼å¼è½¬æ¢.class)</li></ul></li><li>ç›¸å…³æ–¹æ³•<ul><li>EasyExcel.read(inputStream).head(æ˜ å°„æ¨¡å‹.class).xxx</li></ul></li></ul><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.excel.EasyExcel;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.excel.entity.excel.UserExcelEntity;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 1ã€æ–‡ä»¶å¯¼å…¥</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileImport</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¨¡å‹æ˜ å¯¼å…¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">modelMapImport</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;C:\\Users\\19030\\Desktop\\tmp\\user.xlsx&quot;</span>);</span><br><span class="line"></span><br><span class="line">        List&lt;UserExcelEntity&gt; list = EasyExcel.read(file).head(UserExcelEntity.class).sheet(<span class="number">0</span>).doReadSync();</span><br><span class="line"></span><br><span class="line">        list.forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://www.naste.top:9000/images/image-20230813100133627.png" alt="image-20230813100133627"></p><h2 id="å¯¼å…¥çš„ç›‘æ˜•å™¨"><a href="#å¯¼å…¥çš„ç›‘æ˜•å™¨" class="headerlink" title="å¯¼å…¥çš„ç›‘æ˜•å™¨"></a>å¯¼å…¥çš„ç›‘æ˜•å™¨</h2><h3 id="ä½¿ç”¨EasyExcelè‡ªå¸¦ç›‘å¬å™¨"><a href="#ä½¿ç”¨EasyExcelè‡ªå¸¦ç›‘å¬å™¨" class="headerlink" title="ä½¿ç”¨EasyExcelè‡ªå¸¦ç›‘å¬å™¨"></a>ä½¿ç”¨EasyExcelè‡ªå¸¦ç›‘å¬å™¨</h3><p><img src="https://www.naste.top:9000/images/image-20230813110435387.png" alt="image-20230813110435387"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.excel.EasyExcel;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.excel.read.listener.PageReadListener;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.excel.entity.excel.UserExcelEntity;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 1ã€æ–‡ä»¶å¯¼å…¥</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileImport</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¯¼å…¥ç›‘å¬å™¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">listenerImport</span><span class="params">()</span> <span class="keyword">throws</span> FileNotFoundException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;C:\\Users\\19030\\Desktop\\tmp\\user.xlsx&quot;</span>);</span><br><span class="line"></span><br><span class="line">        EasyExcel.read(inputStream, UserExcelEntity.class, <span class="keyword">new</span> <span class="title class_">PageReadListener</span>&lt;&gt;(<span class="built_in">this</span>::consumerMethod)).sheet(<span class="number">0</span>).doRead();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¶ˆè´¹å‡½æ•°ï¼Œç›‘å¬å™¨ä¼šè‡ªåŠ¨è°ƒç”¨è¯¥å‡½æ•°ï¼Œå¯¹æ•°æ®è¿›è¡Œæ¶ˆè´¹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">consumerMethod</span><span class="params">(List&lt;UserExcelEntity&gt; list)</span> &#123;</span><br><span class="line">        list.forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨è‡ªå®šä¹‰ç›‘å¬å™¨"><a href="#ä½¿ç”¨è‡ªå®šä¹‰ç›‘å¬å™¨" class="headerlink" title="ä½¿ç”¨è‡ªå®šä¹‰ç›‘å¬å™¨"></a>ä½¿ç”¨è‡ªå®šä¹‰ç›‘å¬å™¨</h3><blockquote><p><strong>åˆ›å»ºä¸€ä¸ªç±»ï¼Œå®ç°<code>ReadListener</code>æ¥å£</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.excel.context.AnalysisContext;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.excel.read.listener.ReadListener;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.excel.entity.excel.UserExcelEntity;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”¨æˆ·ä¿¡æ¯excelå¯¼å…¥ç›‘å¬å™¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserListener</span> <span class="keyword">implements</span> <span class="title class_">ReadListener</span>&lt;UserExcelEntity&gt; &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–æ¯ä¸€è¡Œæ•°æ®å’Œ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">invoke</span><span class="params">(UserExcelEntity userExcelEntity, AnalysisContext analysisContext)</span> &#123;</span><br><span class="line">        System.out.println(userExcelEntity);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doAfterAllAnalysed</span><span class="params">(AnalysisContext analysisContext)</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.excel.EasyExcel;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.excel.entity.excel.UserExcelEntity;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.excel.listener.UserListener;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 1ã€æ–‡ä»¶å¯¼å…¥</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileImport</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç›‘å¬å™¨å¯¼å…¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">listenerImport</span><span class="params">()</span> <span class="keyword">throws</span> FileNotFoundException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;C:\\Users\\19030\\Desktop\\tmp\\user.xlsx&quot;</span>);</span><br><span class="line"></span><br><span class="line">        EasyExcel.read(inputStream, UserExcelEntity.class, <span class="keyword">new</span> <span class="title class_">UserListener</span>()).sheet(<span class="number">0</span>).doRead();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="æŒ‡å®šè¡¨å¤´å¯¼å…¥"><a href="#æŒ‡å®šè¡¨å¤´å¯¼å…¥" class="headerlink" title="æŒ‡å®šè¡¨å¤´å¯¼å…¥"></a>æŒ‡å®šè¡¨å¤´å¯¼å…¥</h2><p><img src="https://www.naste.top:9000/images/image-20230813111609120.png" alt="image-20230813111609120"></p><blockquote><p><strong>å¦‚å›¾æ‰€ç¤ºï¼Œç”±äºè¡¨å¤´æ‰€åœ¨è¡Œæ•°ä¸æ˜¯ç¬¬ä¸€è¡Œï¼ŒEasyExcelé»˜è®¤æ˜¯æŒ‡å®šç¬¬ä¸€è¡Œä¸ºè¡¨å¤´ï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦<code>EasyExcel.read().headRowNumber(è¡¨å¤´æ‰€åœ¨è¡Œæ•°)</code>æŒ‡å®šè¡¨å¤´æ‰€åœ¨è¡Œ</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.excel.EasyExcel;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.excel.read.listener.PageReadListener;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.excel.entity.excel.UserExcelEntity;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 1ã€æ–‡ä»¶å¯¼å…¥</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileImport</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¯¼å…¥ç›‘å¬å™¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">listenerImport</span><span class="params">()</span> <span class="keyword">throws</span> FileNotFoundException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;C:\\Users\\19030\\Desktop\\tmp\\user.xlsx&quot;</span>);</span><br><span class="line"></span><br><span class="line">        EasyExcel.read(inputStream, UserExcelEntity.class, <span class="keyword">new</span> <span class="title class_">PageReadListener</span>&lt;&gt;(<span class="built_in">this</span>::consumerMethod))</span><br><span class="line">                .headRowNumber(<span class="number">3</span>)</span><br><span class="line">                .sheet(<span class="number">0</span>).doRead();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¶ˆè´¹å‡½æ•°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">consumerMethod</span><span class="params">(List&lt;UserExcelEntity&gt; list)</span> &#123;</span><br><span class="line">        list.forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¯¼å…¥å¼‚å¸¸å¤„ç†"><a href="#å¯¼å…¥å¼‚å¸¸å¤„ç†" class="headerlink" title="å¯¼å…¥å¼‚å¸¸å¤„ç†"></a>å¯¼å…¥å¼‚å¸¸å¤„ç†</h2><blockquote><p><strong><code>ReadListener</code>æ¥å£ä¸­çš„<code>onException</code>ä¸ºå‡ºç°å¼‚å¸¸æ—¶ä¼šæ‰§è¡Œçš„æ–¹æ³•</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.excel.context.AnalysisContext;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.excel.read.listener.ReadListener;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.excel.entity.excel.UserExcelEntity;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”¨æˆ·ä¿¡æ¯excelå¯¼å…¥ç›‘å¬å™¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserListener</span> <span class="keyword">implements</span> <span class="title class_">ReadListener</span>&lt;UserExcelEntity&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">invoke</span><span class="params">(UserExcelEntity userExcelEntity, AnalysisContext analysisContext)</span> &#123;</span><br><span class="line">        System.out.println(userExcelEntity);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doAfterAllAnalysed</span><span class="params">(AnalysisContext analysisContext)</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å½“å‡ºç°å¼‚å¸¸æ—¶ï¼Œè¯¥æ–¹æ³•ä¼šæ‰§è¡Œ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onException</span><span class="params">(Exception exception, AnalysisContext context)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        log.error(<span class="string">&quot;Excelå¯¼å…¥æŠ¥é”™&quot;</span>);</span><br><span class="line">        ReadListener.<span class="built_in">super</span>.onException(exception, context);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="æ–‡ä»¶ä¸Šä¼ å¯¼å…¥"><a href="#æ–‡ä»¶ä¸Šä¼ å¯¼å…¥" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ å¯¼å…¥"></a>æ–‡ä»¶ä¸Šä¼ å¯¼å…¥</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ–‡ä»¶ä¸Šä¼ </span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> file ä¸Šä¼ çš„æ–‡ä»¶</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> trueï¼šä¸Šä¼ æˆåŠŸã€‚falseï¼šä¸Šä¼ å¤±è´¥</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ApiOperation(value = &quot;æ–‡ä»¶ä¸Šä¼ &quot;, httpMethod = &quot;POST&quot;, response = ResponseUtils.class, produces = &quot;application/json&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/upload&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseUtils&lt;Boolean&gt; <span class="title function_">uploadFile</span><span class="params">(<span class="meta">@RequestParam(&quot;file&quot;)</span> MultipartFile file)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">Boolean</span> <span class="variable">isSuccess</span> <span class="operator">=</span> userService.uploadFile(file);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseUtils</span>&lt;Boolean&gt;().success(isSuccess ? <span class="string">&quot;ä¸Šä¼ æˆåŠŸ&quot;</span> : <span class="string">&quot;ä¸Šä¼ å¤±è´¥&quot;</span>, isSuccess);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ–‡ä»¶ä¸Šä¼ </span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> file ä¸Šä¼ çš„æ–‡ä»¶</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> trueï¼šä¸Šä¼ æˆåŠŸã€‚falseï¼šä¸Šä¼ å¤±è´¥</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Boolean <span class="title function_">uploadFile</span><span class="params">(MultipartFile file)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (file == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;ä¸Šä¼ çš„æ–‡ä»¶ä¸èƒ½ä¸ºç©º&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è·å–fileçš„æ–‡ä»¶æµ</span></span><br><span class="line">    <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> file.getInputStream();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//EasyExcelè¯»å–inputStreamé‡Œé¢çš„æ•°æ®ï¼Œæ‰¹é‡æ’å…¥æ•°æ®åº“ä¸­</span></span><br><span class="line">    EasyExcel.read(inputStream, UserEntity.class, <span class="keyword">new</span> <span class="title class_">PageReadListener</span>&lt;&gt;(<span class="built_in">this</span>::addBatch)).headRowNumber(<span class="number">3</span>).sheet().doRead();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è¿”å›å¤„ç†ç»“æœ</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ‰¹é‡æ·»åŠ æ•°æ®</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> userEntityList æ•°æ®é›†åˆ</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> trueï¼šæ·»åŠ æˆåŠŸã€‚falseï¼šæ·»åŠ å¤±è´¥</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@CacheEvict(cacheNames = RedisConstant.BASE_CACHE_KEY + &quot;user&quot;, allEntries = true)</span></span><br><span class="line"><span class="keyword">public</span> Boolean <span class="title function_">addBatch</span><span class="params">(List&lt;UserEntity&gt; userEntityList)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.saveBatch(userEntityList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ–‡ä»¶å¯¼å‡º"><a href="#æ–‡ä»¶å¯¼å‡º" class="headerlink" title="æ–‡ä»¶å¯¼å‡º"></a>æ–‡ä»¶å¯¼å‡º</h1><h2 id="åŸºæœ¬æ–¹å¼å¯¼å‡º"><a href="#åŸºæœ¬æ–¹å¼å¯¼å‡º" class="headerlink" title="åŸºæœ¬æ–¹å¼å¯¼å‡º"></a>åŸºæœ¬æ–¹å¼å¯¼å‡º</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">baseImport</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">filePath</span> <span class="operator">=</span> <span class="string">&quot;C:\\Users\\19030\\Desktop\\tmp\\userExport.xlsx&quot;</span>;</span><br><span class="line">    List&lt;UserEntity&gt; userEntities = userService.selectList();</span><br><span class="line"></span><br><span class="line">    EasyExcel.write(filePath).sheet(<span class="string">&quot;å¯¼å‡ºæ•°æ®&quot;</span>).head(UserEntity.class).doWrite(userEntities);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ¨¡å‹æ˜ å°„å¯¼å‡º"><a href="#æ¨¡å‹æ˜ å°„å¯¼å‡º" class="headerlink" title="æ¨¡å‹æ˜ å°„å¯¼å‡º"></a>æ¨¡å‹æ˜ å°„å¯¼å‡º</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.excel.EasyExcel;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.excel.entity.UserEntity;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.excel.service.UserService;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EasyExcelApplicationTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åŸºç¡€å¯¼å…¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">baseImport</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä»æ•°æ®åº“ä¸­æŸ¥è¯¢æ•°æ®</span></span><br><span class="line">        List&lt;UserEntity&gt; userEntities = userService.selectList();</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * å°†æŸ¥è¯¢å‡ºæ¥çš„æ•°æ®å¯¼å…¥Excelè¡¨æ ¼ä¸­</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">filePath</span> <span class="operator">=</span> <span class="string">&quot;C:\\Users\\19030\\Desktop\\tmp\\userExport.xlsx&quot;</span>;</span><br><span class="line">        EasyExcel.write(filePath).sheet(<span class="string">&quot;å¯¼å‡ºæ•°æ®&quot;</span>).head(UserEntity.class).doWrite(userEntities);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¯¼å‡ºè¡Œé«˜åˆ—å®½"><a href="#å¯¼å‡ºè¡Œé«˜åˆ—å®½" class="headerlink" title="å¯¼å‡ºè¡Œé«˜åˆ—å®½"></a>å¯¼å‡ºè¡Œé«˜åˆ—å®½</h2><blockquote><p><strong>åœ¨å®ä½“ç±»çš„å­—æ®µæˆ–ç±»ä¸Šï¼Œæ·»åŠ å¯¹åº”çš„æ³¨è§£</strong></p></blockquote><p><img src="https://www.naste.top:9000/images/image-20230813162000907.png" alt="image-20230813162000907"></p><blockquote><p><strong>EasyExcel.write(filePath).sheet(â€œå¯¼å‡ºæ•°æ®â€).registerWriteHandlerå¯¹åº”çš„ç­–ç•¥ï¼Œä¹Ÿå¯ä»¥å†™ä¸€ä¸ªç±»ç»§æ‰¿<code>AbstractColumnWidthStyleStrategy</code></strong></p></blockquote><p><img src="https://www.naste.top:9000/images/image-20230813162104164.png" alt="image-20230813162104164"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.excel.EasyExcel;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.excel.write.style.column.SimpleColumnWidthStyleStrategy;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.excel.entity.UserEntity;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.excel.service.UserService;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EasyExcelApplicationTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åŸºç¡€å¯¼å…¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">baseImport</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä»æ•°æ®åº“ä¸­æŸ¥è¯¢æ•°æ®</span></span><br><span class="line">        List&lt;UserEntity&gt; userEntities = userService.selectList();</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * å°†æŸ¥è¯¢å‡ºæ¥çš„æ•°æ®å¯¼å…¥Excelè¡¨æ ¼ä¸­</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">filePath</span> <span class="operator">=</span> <span class="string">&quot;C:\\Users\\19030\\Desktop\\tmp\\userExport.xlsx&quot;</span>;</span><br><span class="line">        EasyExcel</span><br><span class="line">                .write(filePath)</span><br><span class="line">                .sheet(<span class="string">&quot;å¯¼å‡ºæ•°æ®&quot;</span>).head(UserEntity.class)</span><br><span class="line">                .registerWriteHandler(<span class="keyword">new</span> <span class="title class_">SimpleColumnWidthStyleStrategy</span>(<span class="number">30</span>))</span><br><span class="line">                .doWrite(userEntities);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><strong>ä¹Ÿå¯ä»¥å†™ä¸€ä¸ªç±»ï¼Œç»§æ‰¿<code>AbstractCellStyleStrategy</code>å¹¶ä¸”å®ç°<code>CellWriteHandler</code>ï¼Œç¼–å†™ä¸€ä¸ªEasyExcelçš„è‡ªå®šä¹‰æ‹¦æˆªå™¨</strong></p></blockquote><h2 id="åˆå¹¶å•å…ƒæ ¼å¯¼å‡º"><a href="#åˆå¹¶å•å…ƒæ ¼å¯¼å‡º" class="headerlink" title="åˆå¹¶å•å…ƒæ ¼å¯¼å‡º"></a>åˆå¹¶å•å…ƒæ ¼å¯¼å‡º</h2><h2 id="å¯¼å‡ºåŠ¨æ€è¡¨å¤´"><a href="#å¯¼å‡ºåŠ¨æ€è¡¨å¤´" class="headerlink" title="å¯¼å‡ºåŠ¨æ€è¡¨å¤´"></a>å¯¼å‡ºåŠ¨æ€è¡¨å¤´</h2><h2 id="å¯¼å‡ºé“¾æ¥æ‰¹æ³¨å…¬å¼"><a href="#å¯¼å‡ºé“¾æ¥æ‰¹æ³¨å…¬å¼" class="headerlink" title="å¯¼å‡ºé“¾æ¥æ‰¹æ³¨å…¬å¼"></a>å¯¼å‡ºé“¾æ¥æ‰¹æ³¨å…¬å¼</h2><h2 id="å¯¼å‡ºå›¾ç‰‡å†…å®¹"><a href="#å¯¼å‡ºå›¾ç‰‡å†…å®¹" class="headerlink" title="å¯¼å‡ºå›¾ç‰‡å†…å®¹"></a>å¯¼å‡ºå›¾ç‰‡å†…å®¹</h2><h1 id="å¡«å……æ¨¡æ¿"><a href="#å¡«å……æ¨¡æ¿" class="headerlink" title="å¡«å……æ¨¡æ¿"></a>å¡«å……æ¨¡æ¿</h1><h2 id="æ¨¡æ¿å¡«å……å¯¹è±¡"><a href="#æ¨¡æ¿å¡«å……å¯¹è±¡" class="headerlink" title="æ¨¡æ¿å¡«å……å¯¹è±¡"></a>æ¨¡æ¿å¡«å……å¯¹è±¡</h2><h2 id="æ¨¡æ¿å¡«å……åˆ—è¡¨"><a href="#æ¨¡æ¿å¡«å……åˆ—è¡¨" class="headerlink" title="æ¨¡æ¿å¡«å……åˆ—è¡¨"></a>æ¨¡æ¿å¡«å……åˆ—è¡¨</h2><h2 id="æ¨¡æ¿ç»„åˆå¡«å……"><a href="#æ¨¡æ¿ç»„åˆå¡«å……" class="headerlink" title="æ¨¡æ¿ç»„åˆå¡«å……"></a>æ¨¡æ¿ç»„åˆå¡«å……</h2><h2 id="å¯¼å‡ºæ–‡ä»¶ä¸‹è½½"><a href="#å¯¼å‡ºæ–‡ä»¶ä¸‹è½½" class="headerlink" title="å¯¼å‡ºæ–‡ä»¶ä¸‹è½½"></a>å¯¼å‡ºæ–‡ä»¶ä¸‹è½½</h2><h1 id="å·¥å…·ç±»"><a href="#å·¥å…·ç±»" class="headerlink" title="å·¥å…·ç±»"></a>å·¥å…·ç±»</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.excel.enums.CellDataTypeEnum;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.excel.metadata.Head;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.excel.metadata.data.WriteCellData;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.excel.util.MapUtils;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.excel.write.metadata.holder.WriteSheetHolder;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.excel.write.style.column.AbstractColumnWidthStyleStrategy;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.CollectionUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.ss.usermodel.Cell;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Excelå¯¼å‡ºè‡ªå®šä¹‰åˆ—å®½ç­–ç•¥è®¾ç½®</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ColumnWidthStyleStrategy</span> <span class="keyword">extends</span> <span class="title class_">AbstractColumnWidthStyleStrategy</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MAX_COLUMN_WIDTH</span> <span class="operator">=</span> <span class="number">255</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;Integer, Map&lt;Integer, Integer&gt;&gt; cache = MapUtils.newHashMapWithExpectedSize(<span class="number">8</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¾ç½®åˆ—å®½åº¦</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">setColumnWidth</span><span class="params">(WriteSheetHolder writeSheetHolder, List&lt;WriteCellData&lt;?&gt;&gt; cellDataList, Cell cell, Head head, Integer relativeRowIndex, Boolean isHead)</span> &#123;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">needSetWidth</span> <span class="operator">=</span> isHead || !CollectionUtils.isEmpty(cellDataList);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ˜¯å¦éœ€è¦è®¾ç½®å®½åº¦</span></span><br><span class="line">        <span class="keyword">if</span> (needSetWidth) &#123;</span><br><span class="line">            Map&lt;Integer, Integer&gt; maxColumnWidthMap = <span class="built_in">this</span>.cache.computeIfAbsent(writeSheetHolder.getSheetNo(), (key) -&gt; <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(<span class="number">16</span>));</span><br><span class="line">            <span class="type">Integer</span> <span class="variable">columnWidth</span> <span class="operator">=</span> <span class="built_in">this</span>.dataLength(cellDataList, cell, isHead);</span><br><span class="line">            <span class="comment">// åˆ—å®½åˆ¤æ–­</span></span><br><span class="line">            <span class="keyword">if</span> (columnWidth &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (columnWidth &gt; MAX_COLUMN_WIDTH) &#123;</span><br><span class="line">                    columnWidth = MAX_COLUMN_WIDTH;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">Integer</span> <span class="variable">maxColumnWidth</span> <span class="operator">=</span> maxColumnWidthMap.get(cell.getColumnIndex());</span><br><span class="line">                <span class="keyword">if</span> (maxColumnWidth == <span class="literal">null</span> || columnWidth &gt; maxColumnWidth) &#123;</span><br><span class="line">                    maxColumnWidthMap.put(cell.getColumnIndex(), columnWidth);</span><br><span class="line">                    writeSheetHolder.getSheet().setColumnWidth(cell.getColumnIndex(), (columnWidth + <span class="number">15</span>) * MAX_COLUMN_WIDTH);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ•°æ®é•¿åº¦è·å–</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer <span class="title function_">dataLength</span><span class="params">(List&lt;WriteCellData&lt;?&gt;&gt; cellDataList, Cell cell, Boolean isHead)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isHead) &#123;</span><br><span class="line">            <span class="keyword">return</span> cell.getStringCellValue().getBytes().length;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            WriteCellData&lt;?&gt; cellData = cellDataList.get(<span class="number">0</span>);</span><br><span class="line">            <span class="type">CellDataTypeEnum</span> <span class="variable">type</span> <span class="operator">=</span> cellData.getType();</span><br><span class="line">            <span class="keyword">if</span> (type == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">switch</span> (type) &#123;</span><br><span class="line">                    <span class="keyword">case</span> STRING:</span><br><span class="line">                        <span class="keyword">return</span> cellData.getStringValue().getBytes().length;</span><br><span class="line">                    <span class="keyword">case</span> BOOLEAN:</span><br><span class="line">                        <span class="keyword">return</span> cellData.getBooleanValue().toString().getBytes().length;</span><br><span class="line">                    <span class="keyword">case</span> NUMBER:</span><br><span class="line">                        <span class="keyword">return</span> cellData.getNumberValue().toString().getBytes().length;</span><br><span class="line">                    <span class="keyword">default</span>:</span><br><span class="line">                        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.excel.EasyExcel;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.excel.enums.BooleanEnum;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.excel.event.SyncReadListener;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.excel.read.listener.PageReadListener;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.excel.support.ExcelTypeEnum;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.excel.write.metadata.style.WriteCellStyle;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.excel.write.metadata.style.WriteFont;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.excel.write.style.HorizontalCellStyleStrategy;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.excel.write.style.row.SimpleRowHeightStyleStrategy;</span><br><span class="line"><span class="keyword">import</span> com.xiaofei.excel.strategy.ColumnWidthStyleStrategy;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.ss.usermodel.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.URLEncoder;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.function.Consumer;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * EasyExcelå·¥å…·ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EasyExcelUtils</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¯»å–æŒ‡å®šçš„æ–‡ä»¶ä¸­çš„æŒ‡å®šçš„sheetå¹¶ä¸”æŒ‡å®šConsumerå¯¹æ•°æ®è¿›è¡Œæ¶ˆè´¹</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> inputStream æ–‡ä»¶æµ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> head        è¯»å–çš„æ•°æ®è¦è½¬æ¢æˆå“ªä¸ªç±»å‹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> consumer    ç”¨äºæ¶ˆè´¹æ•°æ®æ–¹æ³•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sheetName   sheetNameåç§°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="keyword">void</span> <span class="title function_">readFile</span><span class="params">(InputStream inputStream, Class&lt;T&gt; head, Consumer&lt;List&lt;T&gt;&gt; consumer, String sheetName, Integer headRowNumber)</span> &#123;</span><br><span class="line">        EasyExcel.read(inputStream, head, <span class="keyword">new</span> <span class="title class_">PageReadListener</span>&lt;&gt;(consumer))</span><br><span class="line">                .autoCloseStream(<span class="literal">false</span>) <span class="comment">// ä¸è¦è‡ªåŠ¨å…³é—­ï¼Œäº¤ç»™ Servlet è‡ªå·±å¤„ç†</span></span><br><span class="line">                .headRowNumber(headRowNumber == <span class="literal">null</span> ? <span class="number">1</span> : headRowNumber)</span><br><span class="line">                .sheet(sheetName)</span><br><span class="line">                .doReadSync();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¯»å–æŒ‡å®šçš„æ–‡ä»¶ä¸­çš„æŒ‡å®šçš„sheetå¹¶ä¸”æŒ‡å®šConsumerå¯¹æ•°æ®è¿›è¡Œæ¶ˆè´¹</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> inputStream æ–‡ä»¶æµ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> head        è¯»å–çš„æ•°æ®è¦è½¬æ¢æˆå“ªä¸ªç±»å‹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> consumer    ç”¨äºæ¶ˆè´¹æ•°æ®æ–¹æ³•</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="keyword">void</span> <span class="title function_">readFile</span><span class="params">(InputStream inputStream, Class&lt;T&gt; head, Consumer&lt;List&lt;T&gt;&gt; consumer, Integer headRowNumber)</span> &#123;</span><br><span class="line">        EasyExcel.read(inputStream, head, <span class="keyword">new</span> <span class="title class_">PageReadListener</span>&lt;T&gt;(consumer))</span><br><span class="line">                .autoCloseStream(<span class="literal">false</span>) <span class="comment">// ä¸è¦è‡ªåŠ¨å…³é—­ï¼Œäº¤ç»™ Servlet è‡ªå·±å¤„ç†</span></span><br><span class="line">                .headRowNumber(headRowNumber == <span class="literal">null</span> ? <span class="number">1</span> : headRowNumber)</span><br><span class="line">                .doReadAllSync();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¯»å–æŒ‡å®šçš„æ–‡ä»¶ä¸­çš„æŒ‡å®šçš„sheetå¹¶ä¸”æŒ‡å®šConsumerå¯¹æ•°æ®è¿›è¡Œæ¶ˆè´¹</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> inputStream   æ–‡ä»¶æµ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> head          è¯»å–çš„æ•°æ®è¦è½¬æ¢æˆå“ªä¸ªç±»å‹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sheetName     sheetNameåç§°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> headRowNumber è¡¨å¤´åœ¨å“ªä¸€è¡Œ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; List&lt;T&gt; <span class="title function_">readFile</span><span class="params">(InputStream inputStream, Class&lt;T&gt; head, String sheetName, Integer headRowNumber)</span> &#123;</span><br><span class="line">        <span class="type">SyncReadListener</span> <span class="variable">syncReadListener</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SyncReadListener</span>();</span><br><span class="line">        EasyExcel.read(inputStream, head, syncReadListener)</span><br><span class="line">                .autoCloseStream(<span class="literal">false</span>) <span class="comment">// ä¸è¦è‡ªåŠ¨å…³é—­ï¼Œäº¤ç»™ Servlet è‡ªå·±å¤„ç†</span></span><br><span class="line">                .headRowNumber(headRowNumber == <span class="literal">null</span> ? <span class="number">1</span> : headRowNumber)</span><br><span class="line">                .sheet(sheetName)</span><br><span class="line">                .doReadSync();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ¤æ–­è·å–åˆ°çš„æ•°æ®æ˜¯å¦ä¸ºç©º</span></span><br><span class="line">        <span class="keyword">if</span> (syncReadListener.getList() != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> (List&lt;T&gt;) syncReadListener.getList();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¯»å–æŒ‡å®šçš„æ–‡ä»¶ä¸­çš„æŒ‡å®šçš„sheetå¹¶ä¸”æŒ‡å®šConsumerå¯¹æ•°æ®è¿›è¡Œæ¶ˆè´¹</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> inputStream æ–‡ä»¶æµ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> head        è¯»å–çš„æ•°æ®è¦è½¬æ¢æˆå“ªä¸ªç±»å‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; List&lt;T&gt; <span class="title function_">readFile</span><span class="params">(InputStream inputStream, Class&lt;T&gt; head, Integer headRowNumber)</span> &#123;</span><br><span class="line">        <span class="type">SyncReadListener</span> <span class="variable">syncReadListener</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SyncReadListener</span>();</span><br><span class="line"></span><br><span class="line">        EasyExcel.read(inputStream, head, syncReadListener)</span><br><span class="line">                .autoCloseStream(<span class="literal">false</span>) <span class="comment">// ä¸è¦è‡ªåŠ¨å…³é—­ï¼Œäº¤ç»™ Servlet è‡ªå·±å¤„ç†</span></span><br><span class="line">                .headRowNumber(headRowNumber == <span class="literal">null</span> ? <span class="number">1</span> : headRowNumber)</span><br><span class="line">                .doReadAllSync();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ¤æ–­è·å–åˆ°çš„æ•°æ®æ˜¯å¦ä¸ºç©º</span></span><br><span class="line">        <span class="keyword">if</span> (syncReadListener.getList() != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> (List&lt;T&gt;) syncReadListener.getList();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†æ•°æ®å†™å…¥Excelä¸­</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="keyword">void</span> <span class="title function_">writeFile</span><span class="params">(HttpServletResponse response, String filename, String sheetName, Class&lt;T&gt; head, List&lt;T&gt; data)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è®¾ç½® header å’Œ contentTypeã€‚å†™åœ¨æœ€åçš„åŸå› æ˜¯ï¼Œé¿å…æŠ¥é”™æ—¶ï¼Œå“åº” contentType å·²ç»è¢«ä¿®æ”¹äº†</span></span><br><span class="line">        response.setContentType(<span class="string">&quot;application/vnd.ms-excel&quot;</span>);</span><br><span class="line">        response.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">        <span class="comment">// è¿™é‡ŒURLEncoder.encodeå¯ä»¥é˜²æ­¢ä¸­æ–‡ä¹±ç </span></span><br><span class="line">        filename = URLEncoder.encode(filename, <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        response.setHeader(<span class="string">&quot;Content-disposition&quot;</span>, <span class="string">&quot;attachment;filename=&quot;</span> + filename + <span class="string">&quot;_&quot;</span> + System.currentTimeMillis() + ExcelTypeEnum.XLSX.getValue());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¤´æ ·å¼ç­–ç•¥</span></span><br><span class="line">        <span class="type">HorizontalCellStyleStrategy</span> <span class="variable">horizontalCellStyleStrategy</span> <span class="operator">=</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">HorizontalCellStyleStrategy</span>(headWriteCellStyle(), contentWriteCellStyle());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å†…å®¹æ ·å¼ç­–ç•¥</span></span><br><span class="line">        EasyExcel</span><br><span class="line">                .write(response.getOutputStream(), head)</span><br><span class="line">                .autoCloseStream(<span class="literal">false</span>) <span class="comment">// ä¸è¦è‡ªåŠ¨å…³é—­ï¼Œäº¤ç»™ Servlet è‡ªå·±å¤„ç†</span></span><br><span class="line">                .registerWriteHandler(<span class="keyword">new</span> <span class="title class_">ColumnWidthStyleStrategy</span>()) <span class="comment">// è‡ªåŠ¨é€‚é…å®½åº¦ç­–ç•¥</span></span><br><span class="line">                .registerWriteHandler(<span class="keyword">new</span> <span class="title class_">SimpleRowHeightStyleStrategy</span>((<span class="type">short</span>) <span class="number">30</span>, (<span class="type">short</span>) <span class="number">25</span>))<span class="comment">//è®¾ç½®è¡¨å¤´è¡Œé«˜å’Œå†…å®¹è¡Œé«˜</span></span><br><span class="line">                .registerWriteHandler(horizontalCellStyleStrategy) <span class="comment">// è®¾ç½®è‡ªå®šä¹‰æ ·å¼</span></span><br><span class="line">                .sheet(sheetName)</span><br><span class="line">                .doWrite(data);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Excelè¡¨å¤´æ ·å¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> WriteCellStyle <span class="title function_">headWriteCellStyle</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// å¤´çš„ç­–ç•¥</span></span><br><span class="line">        <span class="type">WriteCellStyle</span> <span class="variable">headWriteCellStyle</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WriteCellStyle</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å­—ä½“</span></span><br><span class="line">        <span class="type">WriteFont</span> <span class="variable">headWriteFont</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WriteFont</span>();</span><br><span class="line">        headWriteFont.setFontName(<span class="string">&quot;ä»¿å®‹&quot;</span>);<span class="comment">//è®¾ç½®å­—ä½“åå­—</span></span><br><span class="line">        headWriteFont.setFontHeightInPoints((<span class="type">short</span>) <span class="number">16</span>);<span class="comment">//è®¾ç½®å­—ä½“å¤§å°</span></span><br><span class="line">        headWriteFont.setBold(BooleanEnum.TRUE.getBooleanValue());<span class="comment">//å­—ä½“æ˜¯å¦åŠ ç²—</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ ·å¼</span></span><br><span class="line">        headWriteCellStyle.setWriteFont(headWriteFont); <span class="comment">//åœ¨æ ·å¼ç”¨åº”ç”¨è®¾ç½®çš„å­—ä½“æ ·å¼;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// èƒŒæ™¯</span></span><br><span class="line">        headWriteCellStyle.setFillForegroundColor(IndexedColors.PALE_BLUE.index);<span class="comment">//èƒŒæ™¯é¢œè‰²</span></span><br><span class="line">        headWriteCellStyle.setFillPatternType(FillPatternType.SOLID_FOREGROUND);<span class="comment">//èƒŒæ™¯é¢œè‰²å¡«å……ç±»å‹</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//è¾¹æ¡†</span></span><br><span class="line">        headWriteCellStyle.setBorderBottom(BorderStyle.THIN);<span class="comment">//è®¾ç½®åº•è¾¹æ¡†;</span></span><br><span class="line">        headWriteCellStyle.setBottomBorderColor((IndexedColors.BLACK1.index));<span class="comment">//è®¾ç½®åº•è¾¹æ¡†é¢œè‰²;</span></span><br><span class="line">        headWriteCellStyle.setBorderLeft(BorderStyle.THIN);  <span class="comment">//è®¾ç½®å·¦è¾¹æ¡†;</span></span><br><span class="line">        headWriteCellStyle.setLeftBorderColor(IndexedColors.BLACK1.index);<span class="comment">//è®¾ç½®å·¦è¾¹æ¡†é¢œè‰²;</span></span><br><span class="line">        headWriteCellStyle.setBorderRight(BorderStyle.THIN);<span class="comment">//è®¾ç½®å³è¾¹æ¡†;</span></span><br><span class="line">        headWriteCellStyle.setRightBorderColor(IndexedColors.BLACK1.index);<span class="comment">//è®¾ç½®å³è¾¹æ¡†é¢œè‰²;</span></span><br><span class="line">        headWriteCellStyle.setBorderTop(BorderStyle.THIN);<span class="comment">//è®¾ç½®é¡¶è¾¹æ¡†;</span></span><br><span class="line">        headWriteCellStyle.setTopBorderColor(IndexedColors.BLACK1.index); <span class="comment">//è®¾ç½®é¡¶è¾¹æ¡†é¢œè‰²;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// å…¶ä»–</span></span><br><span class="line">        headWriteCellStyle.setWrapped(BooleanEnum.FALSE.getBooleanValue());  <span class="comment">//è®¾ç½®è‡ªåŠ¨æ¢è¡Œ;</span></span><br><span class="line">        headWriteCellStyle.setHorizontalAlignment(HorizontalAlignment.CENTER);<span class="comment">//è®¾ç½®æ°´å¹³å¯¹é½çš„æ ·å¼ä¸ºå±…ä¸­å¯¹é½;</span></span><br><span class="line">        headWriteCellStyle.setVerticalAlignment(VerticalAlignment.CENTER);  <span class="comment">//è®¾ç½®å‚ç›´å¯¹é½çš„æ ·å¼ä¸ºå±…ä¸­å¯¹é½;</span></span><br><span class="line">        headWriteCellStyle.setShrinkToFit(BooleanEnum.FALSE.getBooleanValue());<span class="comment">//è®¾ç½®æ–‡æœ¬æ”¶ç¼©è‡³åˆé€‚</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> headWriteCellStyle;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Excelå†…å®¹æ ·å¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> WriteCellStyle <span class="title function_">contentWriteCellStyle</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// å¤´çš„ç­–ç•¥</span></span><br><span class="line">        <span class="type">WriteCellStyle</span> <span class="variable">headWriteCellStyle</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WriteCellStyle</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å­—ä½“</span></span><br><span class="line">        <span class="type">WriteFont</span> <span class="variable">headWriteFont</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WriteFont</span>();</span><br><span class="line">        headWriteFont.setFontName(<span class="string">&quot;ä»¿å®‹&quot;</span>);<span class="comment">//è®¾ç½®å­—ä½“åå­—</span></span><br><span class="line">        headWriteFont.setFontHeightInPoints((<span class="type">short</span>) <span class="number">14</span>);<span class="comment">//è®¾ç½®å­—ä½“å¤§å°</span></span><br><span class="line">        headWriteFont.setBold(BooleanEnum.FALSE.getBooleanValue());<span class="comment">//å­—ä½“æ˜¯å¦åŠ ç²—</span></span><br><span class="line">        headWriteFont.setColor(IndexedColors.BLACK.index);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ ·å¼</span></span><br><span class="line">        headWriteCellStyle.setWriteFont(headWriteFont); <span class="comment">//åœ¨æ ·å¼ç”¨åº”ç”¨è®¾ç½®çš„å­—ä½“æ ·å¼;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// èƒŒæ™¯</span></span><br><span class="line">        headWriteCellStyle.setFillForegroundColor(IndexedColors.WHITE.index);<span class="comment">//èƒŒæ™¯é¢œè‰²</span></span><br><span class="line">        headWriteCellStyle.setFillPatternType(FillPatternType.SOLID_FOREGROUND);<span class="comment">//èƒŒæ™¯é¢œè‰²å¡«å……ç±»å‹</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//è¾¹æ¡†</span></span><br><span class="line">        headWriteCellStyle.setBorderBottom(BorderStyle.THIN);<span class="comment">//è®¾ç½®åº•è¾¹æ¡†;</span></span><br><span class="line">        headWriteCellStyle.setBottomBorderColor((IndexedColors.BLACK1.index));<span class="comment">//è®¾ç½®åº•è¾¹æ¡†é¢œè‰²;</span></span><br><span class="line">        headWriteCellStyle.setBorderLeft(BorderStyle.THIN);  <span class="comment">//è®¾ç½®å·¦è¾¹æ¡†;</span></span><br><span class="line">        headWriteCellStyle.setLeftBorderColor(IndexedColors.BLACK1.index);<span class="comment">//è®¾ç½®å·¦è¾¹æ¡†é¢œè‰²;</span></span><br><span class="line">        headWriteCellStyle.setBorderRight(BorderStyle.THIN);<span class="comment">//è®¾ç½®å³è¾¹æ¡†;</span></span><br><span class="line">        headWriteCellStyle.setRightBorderColor(IndexedColors.BLACK1.index);<span class="comment">//è®¾ç½®å³è¾¹æ¡†é¢œè‰²;</span></span><br><span class="line">        headWriteCellStyle.setBorderTop(BorderStyle.THIN);<span class="comment">//è®¾ç½®é¡¶è¾¹æ¡†;</span></span><br><span class="line">        headWriteCellStyle.setTopBorderColor(IndexedColors.BLACK1.index); <span class="comment">//è®¾ç½®é¡¶è¾¹æ¡†é¢œè‰²;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// å…¶ä»–</span></span><br><span class="line">        headWriteCellStyle.setWrapped(BooleanEnum.FALSE.getBooleanValue());  <span class="comment">//è®¾ç½®è‡ªåŠ¨æ¢è¡Œ;</span></span><br><span class="line">        headWriteCellStyle.setShrinkToFit(BooleanEnum.FALSE.getBooleanValue());<span class="comment">//è®¾ç½®æ–‡æœ¬æ”¶ç¼©è‡³åˆé€‚</span></span><br><span class="line">        headWriteCellStyle.setHorizontalAlignment(HorizontalAlignment.CENTER);<span class="comment">//è®¾ç½®æ°´å¹³å¯¹é½çš„æ ·å¼ä¸ºå±…ä¸­å¯¹é½;</span></span><br><span class="line">        headWriteCellStyle.setVerticalAlignment(VerticalAlignment.CENTER);  <span class="comment">//è®¾ç½®å‚ç›´å¯¹é½çš„æ ·å¼ä¸ºå±…ä¸­å¯¹é½;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> headWriteCellStyle;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">EasyExcelä½¿ç”¨</summary>
    
    
    
    <category term="Java" scheme="https://www.naste.top:1024/categories/Java/"/>
    
    
    <category term="Java" scheme="https://www.naste.top:1024/tags/Java/"/>
    
    <category term="SpringBoot" scheme="https://www.naste.top:1024/tags/SpringBoot/"/>
    
    <category term="EasyExcel" scheme="https://www.naste.top:1024/tags/EasyExcel/"/>
    
  </entry>
  
  <entry>
    <title>è®¾è®¡æ¨¡å¼-å¤–è§‚æ¨¡å¼</title>
    <link href="https://www.naste.top:1024/posts/1868115705.html"/>
    <id>https://www.naste.top:1024/posts/1868115705.html</id>
    <published>2023-06-17T09:48:16.000Z</published>
    <updated>2023-06-27T09:51:15.049Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h1><p>[TOC]</p><h1 id="ä»€ä¹ˆæ˜¯å¤–è§‚æ¨¡å¼"><a href="#ä»€ä¹ˆæ˜¯å¤–è§‚æ¨¡å¼" class="headerlink" title="ä»€ä¹ˆæ˜¯å¤–è§‚æ¨¡å¼"></a>ä»€ä¹ˆæ˜¯å¤–è§‚æ¨¡å¼</h1><p>å¤–è§‚æ¨¡å¼åˆå«é—¨é¢æ¨¡å¼</p><p>å¤–è§‚æ¨¡å¼ä¹Ÿå«é—¨é¢æ¨¡å¼ï¼Œåœ¨åˆ›å»ºå‹æ¨¡å¼ã€ç»“æ„å‹æ¨¡å¼å’Œè¡Œä¸ºå‹æ¨¡å¼åˆ†ç±»ä¸­ï¼Œå¤–è§‚æ¨¡å¼å½’å±äºç»“æ„å‹æ¨¡å¼</p><p>åœ¨æˆ‘ä»¬å®é™…çš„å·¥ä½œä¸­ï¼Œå¤–è§‚æ¨¡å¼æ˜¯æœ€å¸¸ç”¨çš„ä¸€ç§è®¾è®¡æ¨¡å¼ä¹‹ä¸€</p><p>æ¯”å¦‚ï¼Œæˆ‘ä»¬æŠŠå‡ ä¸ªæ–¹æ³•ä¸­å…±ç”¨çš„é€»è¾‘æŠ½è±¡æˆä¸€ä¸ªç‹¬ç«‹çš„æ–¹æ³•ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–¹æ³•å°±å¯ä»¥ç†è§£æˆå¤–è§‚æ¨¡å¼</p><p>å¤–è§‚æ¨¡å¼æ˜¯é€šè¿‡å¼•å…¥ä¸€ä¸ªå¤–è§‚è§’è‰²æ¥ç®€åŒ–è°ƒç”¨è€…ä¸å„ä¸ªå­ç³»ç»Ÿä¹‹é—´çš„äº¤äº’ï¼Œä¸ºå¤æ‚çš„å­ç³»ç»Ÿè°ƒç”¨æä¾›ä¸€ä¸ªç»Ÿä¸€çš„å…¥å£ï¼Œé™ä½å­ç³»ç»Ÿä¸è°ƒç”¨è€…çš„è€¦åˆåº¦ï¼Œä½¿å¾—æ‰©å±•æ›´åŠ æ–¹ä¾¿</p><p><img src="https://www.naste.top:9000/images/v2-70762a5b963aba1dc35447fb3ec87407_1440w.webp" alt="img"></p><p>å¤–è§‚æ¨¡å¼å®ç°æ­¥éª¤ï¼š</p><ol><li>æŠ½è±¡å„ä¸ªå­ç³»ç»Ÿçš„ä¸šåŠ¡é€»è¾‘</li><li>å°†æŠ½è±¡è¿‡çš„ä¸šåŠ¡é€»è¾‘å°è£…åˆ°é—¨é¢ç±»ä¸­</li><li>è°ƒç”¨è€…ä½¿ç”¨é—¨é¢ç±»ä¸­çš„æ–¹æ³•å®Œæˆè‡ªå·±çš„é€»è¾‘</li></ol><h1 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h1><ol><li>éœ€è¦ä¸ºä¸€ä¸ªå¤æ‚çš„å­ç³»ç»Ÿæä¾›ä¸€ç³»åˆ—é€»è¾‘æ”¯æŒçš„æ—¶å€™ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨å¤–è§‚æ¨¡å¼ï¼Œæ¯”å¦‚ï¼Œä¸Šæ–‡ä¸­æåˆ°çš„æ¡ˆä¾‹ã€‚ä¸­å°ç³»ç»Ÿéœ€è¦ç»™ä¸šåŠ¡ç³»ç»Ÿæä¾›å¤šä¸ªæ–¹æ³•æ”¯æŒï¼Œå¯ä»¥ç”¨å¤–è§‚æ¨¡å¼</li><li>å½“è°ƒç”¨è€…éœ€è¦è°ƒç”¨å¤šä¸ªå­ç³»ç»Ÿæ¥å®Œæˆè‡ªå·±çš„é€»è¾‘æ—¶ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨å¤–è§‚æ¨¡å¼ï¼Œæ¯”å¦‚æ—¥å¿—å¤„ç†æ¡†æ¶ <code>SLF4J</code>ï¼Œå®ƒå¯¹è°ƒç”¨è€…æä¾›æ¥å£ã€‚<code>logback</code>ã€<code>log4j</code>ç­‰å„ç§æ—¥å¿—æ¡†æ¶ä½œä¸ºå­ç³»ç»Ÿå»å®ç°è¿™äº›æ¥å£ï¼Œä¸šåŠ¡ç³»ç»Ÿéœ€è¦è®°å½•æ—¥å¿—æ—¶ï¼Œè°ƒç”¨<code>SLF4J</code>é—¨é¢ç±»å³å¯ï¼Œè€Œä¸å¿…å…³å¿ƒå…·ä½“ä½¿ç”¨çš„æ˜¯å“ªä¸€ä¸ªæ¡†æ¶</li></ol><h1 id="å›¾æ–‡è§£é‡Š"><a href="#å›¾æ–‡è§£é‡Š" class="headerlink" title="å›¾æ–‡è§£é‡Š"></a>å›¾æ–‡è§£é‡Š</h1><p>å‡å¦‚æˆ‘ä»¬æœ‰ä¸€ä¸ªä¸­å°ç³»ç»Ÿï¼Œç³»ç»Ÿä¸­æœ‰5ä¸ªæ¥å£ä¾›ä¸šåŠ¡ç³»ç»Ÿè°ƒç”¨</p><p><img src="https://www.naste.top:9000/images/image-20230627164824991.png" alt="image-20230627164824991"></p><p>ä¸šåŠ¡ç³»ç»ŸAéœ€è¦è°ƒç”¨ä¸­å°ç³»ç»Ÿçš„å‰ä¸‰ä¸ªæ¥å£å®Œæˆè‡ªå·±çš„ä¸šåŠ¡é€»è¾‘</p><p>ä¸šåŠ¡ç³»ç»ŸBéœ€è¦è°ƒç”¨ä¸­å°ç³»ç»Ÿçš„åä¸¤ä¸ªæ¥å£æ¥å®Œæˆä¸šåŠ¡ç³»ç»ŸBè‡ªå·±çš„é€»è¾‘</p><p><img src="https://www.naste.top:9000/images/image-20230627164950400.png" alt="image-20230627164950400"></p><p>æ¥ç€æ˜¯ä¸šåŠ¡ç³»ç»ŸCã€Dã€Eã€Fç­‰ç­‰ï¼Œä»–ä»¬éƒ½å’Œä¸šåŠ¡ç³»ç»ŸAæˆ–Bçš„éœ€æ±‚ä¸€æ ·ï¼šå¸Œæœ›è°ƒç”¨ä¸­å°ç³»ç»Ÿçš„å‰ä¸‰ä¸ªæ¥å£æˆ–åä¸¤ä¸ªæ¥å£å»å®ç°è‡ªå·±ç³»ç»Ÿçš„ä¸šåŠ¡é€»è¾‘</p><p>æˆ‘ä»¬ä¼šå‘ç°ï¼Œè¿™äº›ä¸šåŠ¡ç³»ç»Ÿåœ¨è°ƒç”¨ä¸­å°ç³»ç»Ÿæ—¶å­˜åœ¨å‡ ä¸ªé—®é¢˜</p><ul><li>ä¸šåŠ¡ç³»ç»Ÿéœ€è¦è¶³å¤Ÿäº†è§£ä¸­å°ç³»ç»Ÿçš„æ¯ä¸ªæ¥å£é€»è¾‘ï¼Œæ‰èƒ½å†³å®šè‡ªå·±åˆ°åº•è¯¥è°ƒç”¨å“ªäº›æ¥å£</li><li>ä¸šåŠ¡ç³»ç»Ÿåœ¨è°ƒç”¨ä¸­å°ç³»ç»Ÿæ¥å£æ—¶ï¼Œéœ€è¦è°ƒç”¨å¤šä¸ªæ¥å£ï¼Œéå¸¸éº»çƒ¦</li><li>å¤šä¸ªä¸šåŠ¡ç³»ç»Ÿå­˜åœ¨ç›¸åŒçš„ä»£ç ï¼Œå¯¼è‡´æ•´ä½“å·¥ä½œé‡å¢åŠ </li></ul><p>æˆ‘ä»¬å¯ä»¥è¿™æ ·å¯¹ä¸­å°ç³»ç»Ÿè¿›è¡Œæ”¹é€ ï¼Œè®©ä¸šåŠ¡ç³»ç»Ÿè°ƒç”¨æ›´ç®€å•</p><p><img src="https://www.naste.top:9000/images/image-20230627165113360.png" alt="image-20230627165113360"></p><p>åœ¨ä¸­å°ç³»ç»Ÿä¸­å¢åŠ <strong>æ¥å£A</strong> ï¼Œåœ¨æ¥å£Aé‡Œé¢åˆ†åˆ«åˆ†åˆ«è°ƒç”¨æ¥å£1ã€2ã€3ã€‚ä¸šåŠ¡ç³»ç»ŸAå¯ä»¥ç›´æ¥è°ƒç”¨æ¥å£Aæ¥å®Œæˆè‡ªå·±çš„ä¸šåŠ¡</p><p>åŒæ ·çš„ï¼Œä¸­å°ç³»ç»Ÿä¸­å¢åŠ <strong>æ¥å£B</strong>ï¼Œåœ¨æ¥å£Bä¸­åˆ†åˆ«è°ƒç”¨æ¥å£4ã€5ã€‚ä¸šåŠ¡ç³»ç»ŸBå¯ä»¥ç›´æ¥è°ƒç”¨æ¥å£Bæ¥å®Œæˆè‡ªå·±çš„ä¸šåŠ¡</p><p>è¿™æ ·æˆ‘ä»¬å°±è§£å†³äº†åˆšæ‰æ‰€è¯´çš„3ä¸ªé—®é¢˜</p><ul><li>ä¸šåŠ¡ç³»ç»Ÿä¸éœ€è¦äº†è§£ä¸­å°ç³»ç»Ÿå…·ä½“çš„æ¥å£é€»è¾‘ï¼Œåªéœ€è¦è°ƒç”¨å¯¹åº”çš„æ¥å£å³å¯</li><li>ä¸šåŠ¡ç³»ç»Ÿè°ƒç”¨ä¸­å°ç³»ç»Ÿæ—¶ä¸å†æ˜¯å¤šä¸ªæ¥å£ï¼Œåªéœ€è¦è°ƒç”¨ä¸€ä¸ªæ¥å£</li><li>åŸæ¥çš„å¤šä¸ªä¸šåŠ¡ç³»ç»Ÿä¸­ç›¸åŒçš„ä»£ç è¢«å°è£…åœ¨äº†æ¥å£Aæˆ–æ¥å£Bä¸­ï¼Œä¸šåŠ¡ç³»ç»Ÿç›¸åº”çš„å·¥ä½œé‡ä¼šå‡å°‘</li></ul><p>è¿™ç§å®ç°æ–¹å¼å°±æ˜¯åœ¨ä¸­å°ç³»ç»Ÿä¸­ä½¿ç”¨äº†<strong>å¤–è§‚æ¨¡å¼</strong>ï¼Œæ¥å£Aå’Œæ¥å£Bå°±æ˜¯ä¸­å°ç³»ç»Ÿçš„é—¨é¢ï¼ˆå¤–è§‚æ¨¡å¼ä¹Ÿå«é—¨é¢æ¨¡å¼ï¼‰</p><h1 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h1><p>é¦–å…ˆæ˜¯ä¸­å°ç³»ç»Ÿçš„5ä¸ªæ¥å£ï¼Œè¿™é‡Œç”¨5ä¸ªæ–¹æ³•ä»£è¡¨æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Center</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method1</span><span class="params">()</span>&#123;&#125; <span class="comment">// æ¨¡æ‹Ÿæ¥å£1</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method2</span><span class="params">()</span>&#123;&#125; <span class="comment">// æ¨¡æ‹Ÿæ¥å£2</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method3</span><span class="params">()</span>&#123;&#125; <span class="comment">// æ¨¡æ‹Ÿæ¥å£3</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method4</span><span class="params">()</span>&#123;&#125; <span class="comment">// æ¨¡æ‹Ÿæ¥å£4</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method5</span><span class="params">()</span>&#123;&#125; <span class="comment">// æ¨¡æ‹Ÿæ¥å£5</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æ˜¯ä¸­å°ç³»ç»Ÿä¸­çš„å¤–è§‚ç±»ï¼Œé‡Œé¢åŒ…å«äº†æ¥å£Aå’Œæ¥å£Bã€‚åŒæ ·ç”¨ä¸¤ä¸ªæ–¹æ³•æ¥ä»£è¡¨æ¥å£</p><p>åœ¨æ¥å£Aä¸­è°ƒç”¨äº†ä¸­å°ç³»ç»Ÿçš„å‰3ä¸ªæ–¹æ³•ï¼›åœ¨æ¥å£Bä¸­è°ƒç”¨äº†ä¸­å°ç³»ç»Ÿä¸­çš„åä¸¤ä¸ªæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CenterFacade</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Center</span> <span class="variable">center</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Center</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¨¡æ‹Ÿæ¥å£A</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">centerA</span><span class="params">()</span> &#123;</span><br><span class="line">        center.method1();</span><br><span class="line">        center.method2();</span><br><span class="line">        center.method3();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¨¡æ‹Ÿæ¥å£B</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">centerB</span><span class="params">()</span> &#123;</span><br><span class="line">        center.method4();</span><br><span class="line">        center.method5();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸šåŠ¡ç³»ç»ŸAåœ¨è°ƒç”¨æ—¶ï¼Œä½¿ç”¨å¤–è§‚ç±»ä¸­çš„æ¥å£Aå³å¯å®ç°è‡ªå·±çš„ä¸šåŠ¡é€»è¾‘</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">CenterFacade</span> <span class="variable">centerFacade</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CenterFacade</span>();</span><br><span class="line">centerFacade.centerA();</span><br></pre></td></tr></table></figure><p>ä¸šåŠ¡ç³»ç»ŸBåœ¨è°ƒç”¨æ—¶ï¼Œä½¿ç”¨å¤–è§‚ç±»ä¸­çš„æ¥å£Bå³å¯å®ç°è‡ªå·±çš„ä¸šåŠ¡é€»è¾‘</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">CenterFacade</span> <span class="variable">centerFacade</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CenterFacade</span>();</span><br><span class="line">centerFacade.centerB();</span><br></pre></td></tr></table></figure><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><ul><li><p>ä¼˜ç‚¹</p><ul><li>å¤–è§‚æ¨¡å¼ç»™å„ä¸ªå­ç³»ç»Ÿæä¾›ç»Ÿä¸€çš„å…¥å£ï¼Œè°ƒç”¨è€…ä½¿ç”¨èµ·æ¥å¾ˆç®€å•</li><li>å¤–è§‚æ¨¡å¼æŠŠå„ä¸ªå­ç³»ç»Ÿå’Œè°ƒç”¨è€…è§£è€¦ï¼Œæ‰©å±•æ€§ä¼šæ›´å¥½ã€‚æ¯”å¦‚ï¼Œæƒ³è¦å¢åŠ ä¸€ä¸ªå­ç³»ç»Ÿæ—¶ï¼Œåªéœ€è¦æŒ‰ç…§å¤–è§‚æ¨¡å¼çš„è§„èŒƒè¿›è¡Œå¼€å‘ï¼Œè°ƒç”¨è€…å’Œå¤–è§‚ç±»éƒ½ä¸ç”¨ä¿®æ”¹</li></ul></li><li><p>ç¼ºç‚¹</p><ul><li>å¦‚æœè®¾è®¡ä¸åˆç†ï¼Œå¢åŠ æ–°çš„å­ç³»ç»Ÿæ—¶å¯èƒ½éœ€è¦ä¿®æ”¹å¤–è§‚ç±»æˆ–è°ƒç”¨è€…çš„æºä»£ç ï¼Œè¿èƒŒäº†â€œå¼€é—­åŸåˆ™â€</li></ul></li></ul>]]></content>
    
    
    <summary type="html">è®¾è®¡æ¨¡å¼-å¤–è§‚æ¨¡å¼</summary>
    
    
    
    <category term="Java" scheme="https://www.naste.top:1024/categories/Java/"/>
    
    
    <category term="Java" scheme="https://www.naste.top:1024/tags/Java/"/>
    
    <category term="è®¾è®¡æ¨¡å¼" scheme="https://www.naste.top:1024/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    <category term="å¤–è§‚æ¨¡å¼" scheme="https://www.naste.top:1024/tags/%E5%A4%96%E8%A7%82%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>è®¾è®¡æ¨¡å¼-è§‚å¯Ÿè€…æ¨¡å¼</title>
    <link href="https://www.naste.top:1024/posts/1324173671.html"/>
    <id>https://www.naste.top:1024/posts/1324173671.html</id>
    <published>2023-06-17T09:48:08.000Z</published>
    <updated>2023-06-23T12:24:03.830Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h1><p>[TOC]</p><h1 id="ä»€ä¹ˆæ˜¯è§‚å¯Ÿè€…æ¨¡å¼"><a href="#ä»€ä¹ˆæ˜¯è§‚å¯Ÿè€…æ¨¡å¼" class="headerlink" title="ä»€ä¹ˆæ˜¯è§‚å¯Ÿè€…æ¨¡å¼"></a>ä»€ä¹ˆæ˜¯è§‚å¯Ÿè€…æ¨¡å¼</h1><p>è§‚å¯Ÿè€…æ¨¡å¼ä¹Ÿå«å‘å¸ƒè®¢é˜…æ¨¡å¼</p><p>è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserver Patternï¼‰æ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œå®ƒå®šä¹‰äº†ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œå½“ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œå®ƒçš„æ‰€æœ‰ä¾èµ–è€…éƒ½ä¼šæ”¶åˆ°é€šçŸ¥å¹¶è‡ªåŠ¨æ›´æ–°</p><p>å½“å¤šä¸ªäººéƒ½å…³æ³¨äº†ä¸€ä¸ªå…¬ä¼—å·æ—¶ï¼Œè¿™ä¸ªå…¬ä¼—å·ä¸€å‘å¸ƒæ–°çš„æ–‡ç« ï¼Œæ‰€æœ‰å…³æ³¨çš„è´¦å·éƒ½ä¼šæ”¶åˆ°æ¶ˆæ¯</p><p>è§‚å¯Ÿè€…æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³æ˜¯å°†è§‚å¯Ÿè€…å¯¹è±¡æ³¨å†Œåˆ°ä¸»é¢˜å¯¹è±¡ä¸­ï¼Œå½“ä¸»é¢˜å¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œé€šçŸ¥æ‰€æœ‰çš„è§‚å¯Ÿè€…å¯¹è±¡è¿›è¡Œæ›´æ–°ã€‚è¿™ç§è®¾è®¡æ¨¡å¼å¯ä»¥å¸®åŠ©æˆ‘ä»¬å®ç°æ¾è€¦åˆçš„å¯¹è±¡é—´äº¤äº’ï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§</p><p>è§‚å¯Ÿè€…æ¨¡å¼åŒ…å«ä»¥ä¸‹å‡ ä¸ªè§’è‰²ï¼š</p><ol><li>æŠ½è±¡ä¸»é¢˜ï¼ˆSubjectï¼‰ï¼šå®šä¹‰äº†ä¸€ç§æŠ½è±¡æ¥å£ï¼Œç”¨äºæ·»åŠ ã€åˆ é™¤å’Œé€šçŸ¥è§‚å¯Ÿè€…å¯¹è±¡ã€‚</li><li>å…·ä½“ä¸»é¢˜ï¼ˆConcreteSubjectï¼‰ï¼šå®ç°äº†æŠ½è±¡ä¸»é¢˜æ¥å£ï¼Œç»´æŠ¤äº†ä¸€ç»„è§‚å¯Ÿè€…å¯¹è±¡ï¼Œå¹¶åœ¨çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶é€šçŸ¥å®ƒä»¬ã€‚</li><li>æŠ½è±¡è§‚å¯Ÿè€…ï¼ˆObserverï¼‰ï¼šå®šä¹‰äº†ä¸€ç§æŠ½è±¡æ¥å£ï¼Œç”¨äºæ¥æ”¶ä¸»é¢˜å¯¹è±¡çš„é€šçŸ¥ã€‚</li><li>å…·ä½“è§‚å¯Ÿè€…ï¼ˆConcreteObserverï¼‰ï¼šå®ç°äº†æŠ½è±¡è§‚å¯Ÿè€…æ¥å£ï¼Œå­˜å‚¨ä¸»é¢˜å¯¹è±¡çš„å¼•ç”¨ï¼Œå¹¶åœ¨æ”¶åˆ°é€šçŸ¥æ—¶æ›´æ–°è‡ªå·±çš„çŠ¶æ€ã€‚</li></ol><h1 id="UMLç±»å›¾"><a href="#UMLç±»å›¾" class="headerlink" title="UMLç±»å›¾"></a>UMLç±»å›¾</h1><p><img src="https://www.naste.top:9000/images/f6dae790229e48a0ac4bd507dab3f455.png" alt="img"><img src="https://www.naste.top:9000/images/228ff4ace242424ab67c3453870e549b.png" alt="img"></p><h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><p><img src="https://www.naste.top:9000/images/observer.jpg" alt="img"></p><h1 id="ä»£ç -1"><a href="#ä»£ç -1" class="headerlink" title="ä»£ç "></a>ä»£ç </h1><h2 id="è¢«è§‚å¯Ÿè€…ï¼Œæˆ–è€…å«è®¢é˜…ä¸»é¢˜"><a href="#è¢«è§‚å¯Ÿè€…ï¼Œæˆ–è€…å«è®¢é˜…ä¸»é¢˜" class="headerlink" title="è¢«è§‚å¯Ÿè€…ï¼Œæˆ–è€…å«è®¢é˜…ä¸»é¢˜"></a>è¢«è§‚å¯Ÿè€…ï¼Œæˆ–è€…å«è®¢é˜…ä¸»é¢˜</h2><p>é¦–å…ˆæ˜¯ä¸Šå®˜æ— é›ªè¿™ä¸ªç»¿èŒ¶å©Šçš„ç±»</p><p>å…ˆå®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œå¾ˆç®€å•ï¼ŒåŒ…å«ä¸€ä¸ªç”¨æ¥è®¢é˜…çš„æ–¹æ³•<code>add</code>å’Œå–æ¶ˆè®¢é˜…çš„æ–¹æ³•<code>remove</code>ã€‚è¿˜æœ‰ä¸€ä¸ªå½“çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œç”¨æ¥é€šçŸ¥å…¶è§‚å¯Ÿè€…çš„æ–¹æ³•<code>notifyState</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">GreenTeaBitchSubject</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(TianDogObserver observer)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(TianDogObserver observer)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">notifyState</span><span class="params">(String state)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æ˜¯å…¶å®ç°ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShangGuanSubject</span> <span class="keyword">implements</span> <span class="title class_">GreenTeaBitchSubject</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;TianDogObserver&gt; tianDogs = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(TianDogObserver observer)</span> &#123;</span><br><span class="line">        tianDogs.add(observer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(TianDogObserver observer)</span> &#123;</span><br><span class="line">        tianDogs.remove(observer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">notifyState</span><span class="params">(String state)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (TianDogObserver tianDog : tianDogs) &#123;</span><br><span class="line">            tianDog.update(state);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹Ÿéå¸¸ç®€å•ï¼Œå…¶æŒæœ‰ä¸€ä¸ªå¯¹å…¶æ„Ÿå…´è¶£çš„è§‚å¯Ÿè€…é›†åˆï¼Œå½“çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶å°±å¾ªç¯é€šçŸ¥æ¯ä¸ªè§‚å¯Ÿè€…ã€‚</p><h2 id="è§‚å¯Ÿè€…ï¼Œæˆ–è€…å«è®¢é˜…è€…"><a href="#è§‚å¯Ÿè€…ï¼Œæˆ–è€…å«è®¢é˜…è€…" class="headerlink" title="è§‚å¯Ÿè€…ï¼Œæˆ–è€…å«è®¢é˜…è€…"></a>è§‚å¯Ÿè€…ï¼Œæˆ–è€…å«è®¢é˜…è€…</h2><p>å…ˆå®šä¹‰ä¸€ä¸ªè§‚å¯Ÿè€…æ¥å£ï¼Œé‡Œé¢åªæœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œè§‚å¯Ÿè€…å°±æ˜¯åœ¨è¿™ä¸ªæ–¹æ³•é‡Œé¢æ¥æ”¶è¢«è§‚å¯Ÿè€…å‘é€çš„çŠ¶æ€æ”¹å˜é€šçŸ¥ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">TianDogObserver</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(String message)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬å®ç°ä¸€ä¸ªèˆ”ç‹—ç‹äºŒç‹—ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dog2WangObserver</span> <span class="keyword">implements</span> <span class="title class_">TianDogObserver</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&quot;è‚šå­å¥½é¥¿&quot;</span>.equals(message))&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;äºŒç‹—ï¼šåŠå¤œèµ·æ¥ï¼Œç¿»å¢™å‡ºå»æ­¥è¡Œ2å…¬é‡Œä¹°å¥³ç¥æœ€çˆ±åƒçš„å°ç¬¼åŒ…... ä¸Šå®˜ï¼šäºŒç‹—ï¼Œä½ çœŸæ˜¯ä¸ªå¥½äºº&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;å¿ƒæƒ…ä¸å¥½&quot;</span>.equals(message))&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;äºŒç‹—ï¼šå®˜å“­ç€è¿°è¯´æ¸£ç”·æ€ä¹ˆæ¬ºè´Ÿçš„å¥¹...æ•´æ•´3ä¸ªå°æ—¶ï¼Œå…¨ç¨‹å®‰æ…°... ä¸Šå®˜ï¼šäºŒç‹—ï¼Œä½ çœŸæ˜¯ä¸ªå¥½äºº&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;éšå«éšåˆ°...&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨updateæ–¹æ³•ä¸­ï¼Œæ¥æ”¶åˆ°å¥³ç¥çš„é€šçŸ¥åï¼Œæ ¹æ®ä¸åŒçš„çŠ¶æ€åšå‡ºäº†ç›¸åº”çš„åŠ¨ä½œã€‚</p><p>è¥¿é—¨æ·«è¡ç±»å·®ä¸å¤šï¼Œå°±çœç•¥äº†ï¼Œå¯ä»¥ä»æ–‡ç« æœ€åçš„æºç æŸ¥çœ‹â€¦</p><h2 id="å®¢æˆ·ç«¯ä½¿ç”¨"><a href="#å®¢æˆ·ç«¯ä½¿ç”¨" class="headerlink" title="å®¢æˆ·ç«¯ä½¿ç”¨"></a>å®¢æˆ·ç«¯ä½¿ç”¨</h2><p>å®¢æˆ·ç«¯è°ƒç”¨æ—¶ï¼Œå…ˆç»™è¢«è§‚å¯Ÿè€…é€šè¿‡<code>add</code>æ·»åŠ è§‚å¯Ÿè€…ï¼Œä¹Ÿå°±æ˜¯è®©äºŒç‹—å’Œè¥¿é—¨è®¢é˜…ä¸Šå®˜çš„çŠ¶æ€ï¼Œä»¥ä¾¿äºä¸Šå®˜çŠ¶æ€æ”¹å˜æ—¶å¯ä»¥å¾—åˆ°é€šçŸ¥ã€‚æœ€åä½¿ç”¨<code>notifyState</code>æ¥é€šçŸ¥è§‚å¯Ÿè€…çŠ¶æ€æ”¹å˜äº†ã€‚å¦‚æœæŸä¸ªè§‚å¯Ÿè€…ä¸å†å¯¹è¢«è§‚å¯Ÿè€…æ„Ÿå…´è¶£ï¼Œç›´æ¥ä½¿ç”¨<code>remove</code>æ–¹æ³•å–æ¶ˆè®¢é˜…å³å¯ã€‚æœ€åç‹äºŒç‹—è¢«ç»¿èŒ¶å©Šä¸Šå®˜ä¼¤é€äº†å¿ƒï¼Œå’Œç‰›ç¿ åèµ°åˆ°äº†ä¸€èµ·ï¼Œä»æ­¤äºŒç‹—å°±ä¸å†å…³å¿ƒä¸Šå®˜çš„çŠ¶æ€äº†ï¼Œç›´æ¥ä½¿ç”¨<code>remove</code>æ–¹æ³•å–æ¶ˆè®¢é˜…ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ObserverClient</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendThink</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">GreenTeaBitchSubject</span> <span class="variable">subject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ShangGuanSubject</span>();</span><br><span class="line">        <span class="type">Dog2WangObserver</span> <span class="variable">dog2WangObserver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Dog2WangObserver</span>();</span><br><span class="line">        subject.add(dog2WangObserver);</span><br><span class="line">        subject.add(<span class="keyword">new</span> <span class="title class_">YinDangObserver</span>());</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;------åˆå¤œ12ç‚¹ï¼Œè‚šå­å¥½é¥¿ï¼Œæ‰¾ä¸ªäººæ¥ä¹°ä¸œè¥¿åƒ------&quot;</span>);</span><br><span class="line">        subject.notifyState(<span class="string">&quot;è‚šå­å¥½é¥¿&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;------åˆè¢«æ¸£ç”·ç”©äº†ï¼Œæœ‰ç‚¹å°éš¾è¿‡ï¼Œæ‰¾ä¸ªäººæ¥å®‰æ…°ä¸€ä¸‹------&quot;</span>);</span><br><span class="line">        subject.notifyState(<span class="string">&quot;å¿ƒæƒ…ä¸å¥½&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;------äºŒç‹—ç»ˆäºçœ‹é€äº†ä¸Šå®˜è¿™ä¸ªç»¿èŒ¶å©Šï¼Œå’Œç‰›ç¿ èŠ±èµ°åˆ°äº†ä¸€èµ·------&quot;</span>);</span><br><span class="line">        subject.remove(dog2WangObserver);</span><br><span class="line">        System.out.println(<span class="string">&quot;------ä¸Šå®˜åˆè¢«æ¸£ç”·ç”©äº†ï¼Œæƒ³æ‰¾ä¸ªäººæ¥å®‰æ…°ä¸€ä¸‹ï¼Œå´ä¸è§äº†é‚£ä¸ªå¥½äººçš„èº«å½±------&quot;</span>);</span><br><span class="line">        subject.notifyState(<span class="string">&quot;å¿ƒæƒ…ä¸å¥½&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">------åˆå¤œ<span class="number">12</span>ç‚¹ï¼Œè‚šå­å¥½é¥¿ï¼Œæ‰¾ä¸ªäººæ¥ä¹°ä¸œè¥¿åƒ------</span><br><span class="line">äºŒç‹—ï¼šåŠå¤œèµ·æ¥ï¼Œç¿»å¢™å‡ºå»æ­¥è¡Œ<span class="number">2</span>å…¬é‡Œä¹°å¥³ç¥æœ€çˆ±åƒçš„å°ç¬¼åŒ…... ä¸Šå®˜ï¼šäºŒç‹—ï¼Œä½ çœŸæ˜¯ä¸ªå¥½äºº</span><br><span class="line">è¥¿é—¨ï¼šæ˜¯å—ï¼Ÿé‚£æˆ‘ä¸‹é¢ç»™ä½ åƒå•Šï¼Ÿä¸Šå®˜ï¼šè®¨åŒæ‹‰...</span><br><span class="line">------åˆè¢«æ¸£ç”·ç”©äº†ï¼Œæœ‰ç‚¹å°éš¾è¿‡ï¼Œæ‰¾ä¸ªäººæ¥å®‰æ…°ä¸€ä¸‹------</span><br><span class="line">äºŒç‹—ï¼šå®˜å“­ç€è¿°è¯´æ¸£ç”·æ€ä¹ˆæ¬ºè´Ÿçš„å¥¹...æ•´æ•´<span class="number">3</span>ä¸ªå°æ—¶ï¼Œå…¨ç¨‹å®‰æ…°... ä¸Šå®˜ï¼šäºŒç‹—ï¼Œä½ çœŸæ˜¯ä¸ªå¥½äºº</span><br><span class="line">è¥¿é—¨ï¼šå—é—¨é‚£è¾¹æ–°å¼€äº†ä¸€å®¶é…’å§ï¼Œæ™šä¸Šå¸¦ä½ å»æ”¾æ¾ä¸€ä¸‹å§... ä¸Šå®˜ï¼šå¥½å—¨å†ï¼Œæ„Ÿè§‰äººç”Ÿè¾¾åˆ°äº†é«˜å³°..</span><br><span class="line">------äºŒç‹—ç»ˆäºçœ‹é€äº†ä¸Šå®˜è¿™ä¸ªç»¿èŒ¶å©Šï¼Œå’Œç‰›ç¿ èŠ±èµ°åˆ°äº†ä¸€èµ·------</span><br><span class="line">------ä¸Šå®˜åˆè¢«æ¸£ç”·ç”©äº†ï¼Œæƒ³æ‰¾ä¸ªäººæ¥å®‰æ…°ä¸€ä¸‹ï¼Œå´ä¸è§äº†é‚£ä¸ªå¥½äººçš„èº«å½±------</span><br><span class="line">è¥¿é—¨ï¼šå—é—¨é‚£è¾¹æ–°å¼€äº†ä¸€å®¶é…’å§ï¼Œæ™šä¸Šå¸¦ä½ å»æ”¾æ¾ä¸€ä¸‹å§... ä¸Šå®˜ï¼šå¥½å—¨å†ï¼Œæ„Ÿè§‰äººç”Ÿè¾¾åˆ°äº†é«˜å³°..</span><br></pre></td></tr></table></figure><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>è§‚å¯Ÿè€…æ¨¡å¼çš„åº”ç”¨éå¸¸å¹¿æ³›ï¼Œä¾‹å¦‚åœ¨å„ç§æ¶ˆæ¯ä¸­é—´ä»¶ä¸­ï¼Œå¦‚kafkaã€rabitmqç­‰ï¼Œä¾‹å¦‚RxJava ç­‰ç­‰ã€‚å…¶å®Javaä»1.0å°±å¯¹è§‚å¯Ÿè€…æ¨¡å¼è¿›è¡Œäº†æ”¯æŒï¼Œæä¾›äº†ä¸¤ä¸ªç±»å‹<code>java.util.Observable</code> å’Œ<code>java.util.Observer</code> ä½†å…¶åœ¨Java9æ—¶å€™è¢«æ ‡è®°ä¸ºåºŸå¼ƒçŠ¶æ€ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œä¹Ÿå°±ä¸æäº†ï¼Œæ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥å»çœ‹çœ‹</p><p>å½“å‰ç”±äºå„ç§æ¡†æ¶å’Œç¬¬ä¸‰æ–¹å¼€æºåº“çš„ä½¿ç”¨ï¼Œç¨‹åºè®¾è®¡çš„è¦æ±‚è¢«é™çš„å¾ˆä½ï¼Œå¤§éƒ¨åˆ†äººç»ˆæ—¥éƒ½åœ¨å†™èƒ¶æ°´ä»£ç å’Œä¸šåŠ¡ä»£ç ï¼Œä»€ä¹ˆè®¾è®¡æ¨¡å¼ï¼Œå‹æ ¹ä¸çŸ¥é“ï¼Œä¸çŸ¥é“ä¹Ÿç…§æ ·å†™ä»£ç â€¦ã€‚è¿™ä¸ªæ˜¯ITäº§ä¸šåŒ–ä¸å¯é€†è½¬çš„è¶‹åŠ¿ï¼Œä¸ç„¶ä¸ºä»€ä¹ˆITä»ä¸šäººå‘˜è¢«åˆ’å½’ä¸ºæ–°å‹æ°‘å·¥çš„è¡Œåˆ—äº†å‘¢ï¼Ÿå°±æ˜¯å› ä¸ºæˆ‘ä»¬æ­£åœ¨å˜æˆå·¥åœ°ä¸ŠæŒ‰ç…§è®¾è®¡å›¾çº¸ä¸€å—ä¸€å—å’ç –çš„å†œæ°‘å·¥çš„æ ·å­ã€‚ä¸è¿‡æˆ‘ä»¬ä¹Ÿä¸åº”è¯¥å¦„è‡ªè²è–„ï¼Œæ¬ç –æ˜¯ä¸ºäº†ç”Ÿæ´»ï¼Œä¸æ–­æ¢å¯»æ˜¯ä¸ºäº†æ¢¦æƒ³â€¦</p>]]></content>
    
    
    <summary type="html">è®¾è®¡æ¨¡å¼-è§‚å¯Ÿè€…æ¨¡å¼</summary>
    
    
    
    <category term="Java" scheme="https://www.naste.top:1024/categories/Java/"/>
    
    
    <category term="Java" scheme="https://www.naste.top:1024/tags/Java/"/>
    
    <category term="è®¾è®¡æ¨¡å¼" scheme="https://www.naste.top:1024/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    <category term="è§‚å¯Ÿè€…æ¨¡å¼" scheme="https://www.naste.top:1024/tags/%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>è®¾è®¡æ¨¡å¼-é€‚é…å™¨æ¨¡å¼</title>
    <link href="https://www.naste.top:1024/posts/554442395.html"/>
    <id>https://www.naste.top:1024/posts/554442395.html</id>
    <published>2023-06-17T09:47:59.000Z</published>
    <updated>2023-06-23T12:24:19.589Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h1><p>[TOC]</p><h1 id="ä»€ä¹ˆæ˜¯é€‚é…å™¨æ¨¡å¼"><a href="#ä»€ä¹ˆæ˜¯é€‚é…å™¨æ¨¡å¼" class="headerlink" title="ä»€ä¹ˆæ˜¯é€‚é…å™¨æ¨¡å¼"></a>ä»€ä¹ˆæ˜¯é€‚é…å™¨æ¨¡å¼</h1><p>é€‚é…å™¨æ¨¡å¼æ˜¯ä¸€ç§ç»“æ„å‹è®¾è®¡æ¨¡å¼ã€‚å®ƒçš„æ€æƒ³æ˜¯ï¼šæŠŠä¸€ä¸ªç±»çš„æ¥å£å˜æ¢æˆå®¢æˆ·ç«¯æ‰€æœŸå¾…çš„å¦ä¸€ç§æ¥å£ï¼Œä»è€Œä½¿åŸæœ¬å› æ¥å£ä¸åŒ¹é…è€Œæ— æ³•åœ¨ä¸€èµ·å·¥ä½œçš„ä¸¤ä¸ªç±»èƒ½å¤Ÿåœ¨ä¸€èµ·å·¥ä½œã€‚</p><p>åœ¨é€‚é…å™¨æ¨¡å¼ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡å¢åŠ ä¸€ä¸ªæ–°çš„é€‚é…å™¨ç±»æ¥è§£å†³æ¥å£å…¼å®¹é—®é¢˜ã€‚è¿™ä¸ªæ–°çš„é€‚é…å™¨ç±»ä¼šæŒæœ‰ä¸€ä¸ªæˆ–å¤šä¸ªç›®æ ‡å¯¹è±¡ï¼Œå¹¶ä¸”å°†è¿™äº›ç›®æ ‡å¯¹è±¡è½¬æ¢æˆå®¢æˆ·ç«¯æ‰€æœŸæœ›çš„å¦ä¸€ç§æ¥å£ã€‚</p><h1 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h1><ul><li>å½“éœ€è¦ä½¿ç”¨ä¸€ä¸ªç°å­˜çš„ç±»ï¼Œä½†å®ƒæä¾›çš„æ¥å£ä¸æˆ‘ä»¬ç³»ç»Ÿçš„æ¥å£ä¸å…¼å®¹ï¼Œè€Œæˆ‘ä»¬è¿˜ä¸èƒ½ä¿®æ”¹å®ƒæ—¶</li><li>å½“å¤šä¸ªå›¢é˜Ÿç‹¬ç«‹å¼€å‘ç³»ç»Ÿçš„å„åŠŸèƒ½æ¨¡å—ï¼Œç„¶åç»„åˆåœ¨ä¸€èµ·ï¼Œä½†ç”±äºæŸäº›åŸå› äº‹å…ˆä¸èƒ½ç¡®å®šæ¥å£æ—¶</li></ul><h1 id="UMLç±»å›¾"><a href="#UMLç±»å›¾" class="headerlink" title="UMLç±»å›¾"></a>UMLç±»å›¾</h1><p>é€‚é…å™¨æ¨¡å¼åªæœ‰3ä¸ªè§’è‰²</p><ul><li>Target</li></ul><p>æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®ƒæ˜¯æˆ‘ä»¬å®¢æˆ·ç«¯ä½¿ç”¨çš„ç›®æ ‡æ¥å£</p><ul><li>Adaptee</li></ul><p>æˆ‘ä»¬æƒ³è¦ä½¿ç”¨çš„æ¥å£ä¸<code>Target</code>ä¸å…¼å®¹çš„ç±»ï¼Œå®ƒå¯ä»¥æ˜¯ä¸€ä¸ªæ¥å£ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªç±»ã€‚</p><ul><li>Adapter</li></ul><p>é€‚é…å™¨ç±»ï¼Œæ­¤æ¨¡å¼çš„æ ¸å¿ƒã€‚å®ƒéœ€è¦å®ç°ç›®æ ‡æ¥å£<code>Target</code>ï¼Œè€Œä¸”å¿…é¡»è¦å¼•ç”¨<code>Adaptee</code>ï¼Œå› ä¸ºæˆ‘ä»¬è¦åœ¨æ­¤ç±»ä¸­åŒ…è£…<code>Adaptee</code>çš„åŠŸèƒ½</p><p><img src="https://www.naste.top:9000/images/image-20230623161718401.png" alt="image-20230623161718401"></p><h1 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h1><p><img src="https://www.naste.top:9000/images/adapter.png" alt="img"></p><h2 id="ç›®æ ‡æ¥å£"><a href="#ç›®æ ‡æ¥å£" class="headerlink" title="ç›®æ ‡æ¥å£"></a>ç›®æ ‡æ¥å£</h2><blockquote><p><strong>ç³»ç»ŸåŸæ¥çš„æ—¥å¿—æ¥å£å¦‚ä¸‹</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç³»ç»ŸåŸæ¥çš„æ—¥å¿—æ¥å£</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">LogFactory</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">debug</span><span class="params">(String tag,String message)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä¸‰æ–¹åº“æ¥å£åŠå®ç°"><a href="#ä¸‰æ–¹åº“æ¥å£åŠå®ç°" class="headerlink" title="ä¸‰æ–¹åº“æ¥å£åŠå®ç°"></a>ä¸‰æ–¹åº“æ¥å£åŠå®ç°</h2><p>ä¸‹é¢æ˜¯ç¬¬ä¸‰æ–¹åº“æä¾›çš„æ—¥å¿—åŠŸèƒ½ï¼Œä½†æ˜¯å…¶æ¥å£ä¸åŸç³»ç»Ÿç›®å‰ä½¿ç”¨çš„ä¸å…¼å®¹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ–°çš„æ—¥å¿—ç³»ç»Ÿæ¥å£</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">NewLogger</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">newDebug</span><span class="params">(<span class="type">int</span> priority, String message, Object... obj)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ–°çš„æ—¥å¿—ç³»ç»Ÿæ¥å£å®ç°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NewLoggerImp</span> <span class="keyword">implements</span> <span class="title class_">NewLogger</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">newDebug</span><span class="params">(<span class="type">int</span> priority, String message, Object... obj)</span> &#123;</span><br><span class="line">        System.out.println(String.format(<span class="string">&quot;æ–°çš„æ—¥å¿—ç³»ç»Ÿï¼šloggerè®°å½•:%s&quot;</span>, message));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ„å»ºé€‚é…å™¨ç±»"><a href="#æ„å»ºé€‚é…å™¨ç±»" class="headerlink" title="æ„å»ºé€‚é…å™¨ç±»"></a>æ„å»ºé€‚é…å™¨ç±»</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Objects;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é€‚é…å™¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogAdapter</span> <span class="keyword">implements</span> <span class="title class_">LogFactory</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> NewLogger nbLogger;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LogAdapter</span><span class="params">(NewLogger nbLogger)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.nbLogger = nbLogger;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å®ç°è€çš„æ—¥å¿—æ¥å£ï¼Œå®ç°è€æ—¥å¿—æ¥å£ä¸­çš„æ–¹æ³•ï¼Œåœ¨è¯¥æ–¹æ³•ä¸­ä½¿ç”¨æ–°çš„æ—¥å¿—ç³»ç»Ÿè¿›è¡Œæ—¥å¿—æ‰“å°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">debug</span><span class="params">(String tag, String message)</span> &#123;</span><br><span class="line">        Objects.requireNonNull(nbLogger);</span><br><span class="line">        nbLogger.newDebug(<span class="number">1</span>, message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdapterClient</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//ä½¿ç”¨è€çš„æ—¥å¿—æ¥å£ï¼Œä½†æ˜¯newæ˜¯é€‚é…å™¨ï¼Œå¹¶ä¸”å°†æ–°çš„é€‚é…å™¨ç±»ä¼ å…¥è¿›å»ï¼Œç„¶åè°ƒç”¨çš„æ—¥å¿—æ‰“å°çš„æ–¹æ³•å°±æ˜¯ä¿¡æ¯æ—¥å¿—ç³»ç»Ÿè¿›è¡Œæ‰“å°</span></span><br><span class="line">        <span class="type">LogFactory</span> <span class="variable">logFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LogAdapter</span>(<span class="keyword">new</span> <span class="title class_">NewLoggerImp</span>());</span><br><span class="line">        logFactory.debug(<span class="string">&quot;Test&quot;</span>, <span class="string">&quot;æˆ‘å°†ä½¿ç”¨ç‰›é€¼loggeræ‰“å°log&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://www.naste.top:9000/images/image-20230623163404690.png" alt="image-20230623163404690"></p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>ä¼˜ç‚¹ï¼š</p><ol><li>æé«˜ä»£ç å¤ç”¨æ€§ï¼šé€‚é…å™¨æ¨¡å¼é€šè¿‡å°†ä¸€ä¸ªç±»çš„æ¥å£è½¬æ¢æˆå®¢æˆ·ç«¯æ‰€æœŸæœ›çš„æ¥å£ï¼Œå¯ä»¥è®©åŸæœ¬ä¸å…¼å®¹çš„ç±»èƒ½å¤ŸååŒå·¥ä½œï¼Œä»è€Œæé«˜ä»£ç çš„å¤ç”¨æ€§ã€‚</li><li>æé«˜ç³»ç»Ÿçµæ´»æ€§ï¼šé€‚é…å™¨æ¨¡å¼å¯ä»¥å°†ä¸åŒçš„ç±»çš„æ¥å£ç»Ÿä¸€èµ·æ¥ï¼Œä»è€Œä½¿å¾—ç³»ç»Ÿæ›´åŠ çµæ´»ï¼Œèƒ½å¤Ÿé€‚åº”å„ç§å˜åŒ–ã€‚</li><li>ç¬¦åˆå¼€é—­åŸåˆ™ï¼šé€‚é…å™¨æ¨¡å¼å¯ä»¥åœ¨ä¸ä¿®æ”¹ç°æœ‰ä»£ç çš„æƒ…å†µä¸‹æ·»åŠ æ–°åŠŸèƒ½ï¼Œä»è€Œç¬¦åˆå¼€é—­åŸåˆ™ã€‚</li></ol><p>ç¼ºç‚¹ï¼š</p><ol><li>å¢åŠ ä»£ç å¤æ‚åº¦ï¼šé€‚é…å™¨æ¨¡å¼éœ€è¦å¢åŠ ä¸€ä¸ªé€‚é…å™¨ç±»æ¥å®ç°æ¥å£è½¬æ¢ï¼Œè¿™ä¼šå¢åŠ ä»£ç çš„å¤æ‚åº¦ã€‚</li><li>é™ä½ä»£ç å¯è¯»æ€§ï¼šé€‚é…å™¨æ¨¡å¼å¯èƒ½ä¼šè®©ä»£ç çš„é€»è¾‘å˜å¾—æ›´åŠ å¤æ‚ï¼Œé™ä½ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</li><li>å¯èƒ½ä¼šå½±å“ç³»ç»Ÿæ€§èƒ½ï¼šé€‚é…å™¨æ¨¡å¼éœ€è¦è¿›è¡Œé¢å¤–çš„ç±»å‹è½¬æ¢å’Œæ¥å£è½¬æ¢ï¼Œè¿™å¯èƒ½ä¼šå½±å“ç³»ç»Ÿçš„æ€§èƒ½ã€‚</li></ol><p>æ€»ä¹‹ï¼Œé€‚é…å™¨æ¨¡å¼æ˜¯ä¸€ç§éå¸¸æœ‰ç”¨çš„è®¾è®¡æ¨¡å¼ï¼Œå®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬å°†ç°æœ‰çš„ä»£ç ä¸å…¶ä»–ä»£ç æˆ–ç³»ç»Ÿé›†æˆèµ·æ¥ï¼Œä»è€Œæé«˜è½¯ä»¶ç³»ç»Ÿçš„çµæ´»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚ä½†æ˜¯ï¼Œåœ¨ä½¿ç”¨é€‚é…å™¨æ¨¡å¼æ—¶ï¼Œéœ€è¦æƒè¡¡å…¶ä¼˜ç¼ºç‚¹å¹¶è¿›è¡Œé€‚å½“çš„è®¾è®¡å’Œå®ç°ã€‚</p>]]></content>
    
    
    <summary type="html">è®¾è®¡æ¨¡å¼-é€‚é…å™¨æ¨¡å¼</summary>
    
    
    
    <category term="Java" scheme="https://www.naste.top:1024/categories/Java/"/>
    
    
    <category term="Java" scheme="https://www.naste.top:1024/tags/Java/"/>
    
    <category term="è®¾è®¡æ¨¡å¼" scheme="https://www.naste.top:1024/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    <category term="é€‚é…å™¨æ¨¡å¼" scheme="https://www.naste.top:1024/tags/%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>è®¾è®¡æ¨¡å¼-è´£ä»»é“¾æ¨¡å¼</title>
    <link href="https://www.naste.top:1024/posts/3066120463.html"/>
    <id>https://www.naste.top:1024/posts/3066120463.html</id>
    <published>2023-06-17T09:46:56.000Z</published>
    <updated>2023-06-18T07:27:36.615Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h1><p>[TOC]</p><h1 id="ä¸Šé¢æ˜¯è´£ä»»é“¾æ¨¡å¼ï¼ˆèŒè´£é“¾æ¨¡å¼ï¼‰"><a href="#ä¸Šé¢æ˜¯è´£ä»»é“¾æ¨¡å¼ï¼ˆèŒè´£é“¾æ¨¡å¼ï¼‰" class="headerlink" title="ä¸Šé¢æ˜¯è´£ä»»é“¾æ¨¡å¼ï¼ˆèŒè´£é“¾æ¨¡å¼ï¼‰"></a>ä¸Šé¢æ˜¯è´£ä»»é“¾æ¨¡å¼ï¼ˆèŒè´£é“¾æ¨¡å¼ï¼‰</h1><p>åœ¨ç°å®ç”Ÿæ´»ä¸­ï¼Œå¸¸å¸¸ä¼šå‡ºç°è¿™æ ·çš„äº‹ä¾‹ï¼šä¸€ä¸ªè¯·æ±‚æœ‰å¤šä¸ªå¯¹è±¡å¯ä»¥å¤„ç†ï¼Œä½†æ¯ä¸ªå¯¹è±¡çš„å¤„ç†æ¡ä»¶æˆ–æƒé™ä¸åŒã€‚ä¾‹å¦‚ï¼Œå…¬å¸å‘˜å·¥è¯·å‡ï¼Œå¯æ‰¹å‡çš„é¢†å¯¼æœ‰éƒ¨é—¨è´Ÿè´£äººã€å‰¯æ€»ç»ç†ã€æ€»ç»ç†ç­‰ï¼Œä½†æ¯ä¸ªé¢†å¯¼èƒ½æ‰¹å‡†çš„å¤©æ•°ä¸åŒï¼Œå‘˜å·¥å¿…é¡»æ ¹æ®è‡ªå·±è¦è¯·å‡çš„å¤©æ•°å»æ‰¾ä¸åŒçš„é¢†å¯¼ç­¾åï¼Œä¹Ÿå°±æ˜¯è¯´å‘˜å·¥å¿…é¡»è®°ä½æ¯ä¸ªé¢†å¯¼çš„å§“åã€ç”µè¯å’Œåœ°å€ç­‰ä¿¡æ¯ï¼Œè¿™å¢åŠ äº†éš¾åº¦ã€‚è¿™æ ·çš„ä¾‹å­è¿˜æœ‰å¾ˆå¤šï¼Œå¦‚æ‰¾é¢†å¯¼å‡ºå·®æŠ¥é”€ã€ç”Ÿæ´»ä¸­çš„â€œå‡»é¼“ä¼ èŠ±â€æ¸¸æˆç­‰ã€‚</p><p>åœ¨è®¡ç®—æœºè½¯ç¡¬ä»¶ä¸­ä¹Ÿæœ‰ç›¸å…³ä¾‹å­ï¼Œå¦‚æ€»çº¿ç½‘ä¸­æ•°æ®æŠ¥ä¼ é€ï¼Œæ¯å°è®¡ç®—æœºæ ¹æ®ç›®æ ‡åœ°å€æ˜¯å¦åŒè‡ªå·±çš„åœ°å€ç›¸åŒæ¥å†³å®šæ˜¯å¦æ¥æ”¶ï¼›è¿˜æœ‰å¼‚å¸¸å¤„ç†ä¸­ï¼Œå¤„ç†ç¨‹åºæ ¹æ®å¼‚å¸¸çš„ç±»å‹å†³å®šè‡ªå·±æ˜¯å¦å¤„ç†è¯¥å¼‚å¸¸ï¼›è¿˜æœ‰ Struts2çš„æ‹¦æˆªå™¨ã€JSPå’ŒServletçš„ Filter ç­‰ï¼Œæ‰€æœ‰è¿™äº›ï¼Œå¦‚æœç”¨è´£ä»»é“¾æ¨¡å¼éƒ½èƒ½å¾ˆå¥½è§£å†³ã€‚</p><p>è´£ä»»é“¾ï¼ˆChain of Responsibilityï¼‰æ¨¡å¼çš„å®šä¹‰ï¼šä¸ºäº†é¿å…è¯·æ±‚å‘é€è€…ä¸å¤šä¸ªè¯·æ±‚å¤„ç†è€…è€¦åˆåœ¨ä¸€èµ·ï¼Œå°†æ‰€æœ‰è¯·æ±‚çš„å¤„ç†è€…é€šè¿‡å‰ä¸€å¯¹è±¡è®°ä½å…¶ä¸‹ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨è€Œè¿æˆä¸€æ¡é“¾ï¼›å½“æœ‰è¯·æ±‚å‘ç”Ÿæ—¶ï¼Œå¯å°†è¯·æ±‚æ²¿ç€è¿™æ¡é“¾ä¼ é€’ï¼Œç›´åˆ°æœ‰å¯¹è±¡å¤„ç†å®ƒä¸ºæ­¢ã€‚</p><p>åœ¨è´£ä»»é“¾æ¨¡å¼ä¸­ï¼Œå®¢æˆ·åªéœ€è¦å°†è¯·æ±‚å‘é€åˆ°è´£ä»»é“¾ä¸Šå³å¯ï¼Œæ— é¡»å…³å¿ƒè¯·æ±‚çš„å¤„ç†ç»†èŠ‚å’Œè¯·æ±‚çš„ä¼ é€’è¿‡ç¨‹ï¼Œæ‰€ä»¥è´£ä»»é“¾å°†è¯·æ±‚çš„å‘é€è€…å’Œè¯·æ±‚çš„å¤„ç†è€…è§£è€¦äº†ã€‚</p><h1 id="è´£ä»»é“¾æ¨¡å¼ç»“æ„"><a href="#è´£ä»»é“¾æ¨¡å¼ç»“æ„" class="headerlink" title="è´£ä»»é“¾æ¨¡å¼ç»“æ„"></a>è´£ä»»é“¾æ¨¡å¼ç»“æ„</h1><p>èŒè´£é“¾æ¨¡å¼ä¸»è¦åŒ…å«ä»¥ä¸‹è§’è‰²ã€‚</p><ol><li>æŠ½è±¡å¤„ç†è€…ï¼ˆHandlerï¼‰è§’è‰²ï¼šå®šä¹‰ä¸€ä¸ªå¤„ç†è¯·æ±‚çš„æ¥å£ï¼ŒåŒ…å«æŠ½è±¡å¤„ç†æ–¹æ³•å’Œä¸€ä¸ªåç»§è¿æ¥ã€‚</li><li>å…·ä½“å¤„ç†è€…ï¼ˆConcrete Handlerï¼‰è§’è‰²ï¼šå®ç°æŠ½è±¡å¤„ç†è€…çš„å¤„ç†æ–¹æ³•ï¼Œåˆ¤æ–­èƒ½å¦å¤„ç†æœ¬æ¬¡è¯·æ±‚ï¼Œå¦‚æœå¯ä»¥å¤„ç†è¯·æ±‚åˆ™å¤„ç†ï¼Œå¦åˆ™å°†è¯¥è¯·æ±‚è½¬ç»™å®ƒçš„åç»§è€…ã€‚</li><li>å®¢æˆ·ç±»ï¼ˆClientï¼‰è§’è‰²ï¼šåˆ›å»ºå¤„ç†é“¾ï¼Œå¹¶å‘é“¾å¤´çš„å…·ä½“å¤„ç†è€…å¯¹è±¡æäº¤è¯·æ±‚ï¼Œå®ƒä¸å…³å¿ƒå¤„ç†ç»†èŠ‚å’Œè¯·æ±‚çš„ä¼ é€’è¿‡ç¨‹ã€‚</li></ol><p><img src="https://www.naste.top:9000/images/v2-323352bbdc7d89ec9835819fc63e779c_1440w.webp" alt="img"></p><p><img src="https://www.naste.top:9000/images/v2-56e0265703ecd889cb2f4b14a414d5c9_1440w.jpeg" alt="img"></p><h1 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h1><p>ç”¨è´£ä»»é“¾æ¨¡å¼è®¾è®¡ä¸€ä¸ªè¯·å‡æ¡å®¡æ‰¹æ¨¡å—,<strong>å°†æ‰€æœ‰å…·ä½“å¤„ç†è€…å…¨éƒ¨ç»„æˆä¸€ä¸ªé“¾è·¯ï¼Œè®©ç³»ç»Ÿä¸€è·¯å¾€ä¸‹æ‰¾èƒ½å¤„ç†çš„æ–¹æ³•è¿›è¡Œå¤„ç†</strong>ã€‚</p><p>åˆ†æï¼šå‡å¦‚è§„å®šå­¦ç”Ÿè¯·å‡å°äºæˆ–ç­‰äº 2 å¤©ï¼Œç­ä¸»ä»»å¯ä»¥æ‰¹å‡†ï¼›å°äºæˆ–ç­‰äº 7 å¤©ï¼Œç³»ä¸»ä»»å¯ä»¥æ‰¹å‡†ï¼›å°äºæˆ–ç­‰äº 10 å¤©ï¼Œé™¢é•¿å¯ä»¥æ‰¹å‡†ï¼›å…¶ä»–æƒ…å†µä¸äºˆæ‰¹å‡†ï¼›è¿™ä¸ªå®ä¾‹é€‚åˆä½¿ç”¨èŒè´£é“¾æ¨¡å¼å®ç°ã€‚</p><p>é¦–å…ˆï¼Œå®šä¹‰ä¸€ä¸ªé¢†å¯¼ç±»ï¼ˆLeaderï¼‰ï¼Œå®ƒæ˜¯æŠ½è±¡å¤„ç†è€…ï¼ŒåŒ…å«äº†ä¸€ä¸ªæŒ‡å‘ä¸‹ä¸€ä½é¢†å¯¼çš„æŒ‡é’ˆ next å’Œä¸€ä¸ªå¤„ç†å‡æ¡çš„æŠ½è±¡å¤„ç†æ–¹æ³• handleRequest(int LeaveDays)ï¼›ç„¶åï¼Œå®šä¹‰ç­ä¸»ä»»ç±»ï¼ˆClassAdviserï¼‰ã€ç³»ä¸»ä»»ç±»ï¼ˆDepartmentHeadï¼‰å’Œé™¢é•¿ç±»ï¼ˆDeanï¼‰ï¼Œå®ƒä»¬æ˜¯æŠ½è±¡å¤„ç†è€…çš„å­ç±»ï¼Œæ˜¯å…·ä½“å¤„ç†è€…ï¼Œå¿…é¡»æ ¹æ®è‡ªå·±çš„æƒåŠ›å»å®ç°çˆ¶ç±»çš„ handleRequest(int LeaveDays) æ–¹æ³•ï¼Œå¦‚æœæ— æƒå¤„ç†å°±å°†å‡æ¡äº¤ç»™ä¸‹ä¸€ä½å…·ä½“å¤„ç†è€…ï¼Œç›´åˆ°æœ€åï¼›å®¢æˆ·ç±»è´Ÿè´£åˆ›å»ºå¤„ç†é“¾ï¼Œå¹¶å°†å‡æ¡äº¤ç»™é“¾å¤´çš„å…·ä½“å¤„ç†è€…ï¼ˆç­ä¸»ä»»ï¼‰ã€‚</p><h2 id="ç±»å›¾"><a href="#ç±»å›¾" class="headerlink" title="ç±»å›¾"></a>ç±»å›¾</h2><p><img src="https://www.naste.top:9000/images/v2-21e07beda83e24d59c462b40c0abd15f_1440w.webp" alt="img"></p><p><img src="https://www.naste.top:9000/images/v2-21e07beda83e24d59c462b40c0abd15f_1440w-1687072779373-6.webp" alt="img"></p><h2 id="Leader"><a href="#Leader" class="headerlink" title="Leader"></a>Leader</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æŠ½è±¡å¤„ç†è€…ï¼šé¢†å¯¼ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Leader</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Leader next;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setNext</span><span class="params">(Leader next)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.next = next;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Leader <span class="title function_">getNext</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> next;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¤„ç†è¯·æ±‚çš„æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">handleRequest</span><span class="params">(<span class="type">int</span> LeaveDays)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ClassAdviser"><a href="#ClassAdviser" class="headerlink" title="ClassAdviser"></a>ClassAdviser</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å…·ä½“å¤„ç†è€…1ï¼šç­ä¸»ä»»ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClassAdviser</span> <span class="keyword">extends</span> <span class="title class_">Leader</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleRequest</span><span class="params">(<span class="type">int</span> LeaveDays)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (LeaveDays &lt;= <span class="number">2</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ç­ä¸»ä»»æ‰¹å‡†æ‚¨è¯·å‡&quot;</span> + LeaveDays + <span class="string">&quot;å¤©ã€‚&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (getNext() != <span class="literal">null</span>) &#123;</span><br><span class="line">                getNext().handleRequest(LeaveDays);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;è¯·å‡å¤©æ•°å¤ªå¤šï¼Œæ²¡æœ‰äººæ‰¹å‡†è¯¥å‡æ¡ï¼&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="DepartmentHead"><a href="#DepartmentHead" class="headerlink" title="DepartmentHead"></a>DepartmentHead</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å…·ä½“å¤„ç†è€…2ï¼šç³»ä¸»ä»»ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DepartmentHead</span> <span class="keyword">extends</span> <span class="title class_">Leader</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleRequest</span><span class="params">(<span class="type">int</span> LeaveDays)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (LeaveDays &lt;= <span class="number">7</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ç³»ä¸»ä»»æ‰¹å‡†æ‚¨è¯·å‡&quot;</span> + LeaveDays + <span class="string">&quot;å¤©ã€‚&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (getNext() != <span class="literal">null</span>) &#123;</span><br><span class="line">                getNext().handleRequest(LeaveDays);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;è¯·å‡å¤©æ•°å¤ªå¤šï¼Œæ²¡æœ‰äººæ‰¹å‡†è¯¥å‡æ¡ï¼&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="DeanOfStudies"><a href="#DeanOfStudies" class="headerlink" title="DeanOfStudies"></a>DeanOfStudies</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å…·ä½“å¤„ç†è€…3ï¼šé™¢é•¿ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DeanOfStudies</span> <span class="keyword">extends</span> <span class="title class_">Leader</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleRequest</span><span class="params">(<span class="type">int</span> LeaveDays)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (LeaveDays &lt;= <span class="number">20</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æ•™åŠ¡å¤„é•¿æ‰¹å‡†æ‚¨è¯·å‡&quot;</span> + LeaveDays + <span class="string">&quot;å¤©ã€‚&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (getNext() != <span class="literal">null</span>) &#123;</span><br><span class="line">                getNext().handleRequest(LeaveDays);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;è¯·å‡å¤©æ•°å¤ªå¤šï¼Œæ²¡æœ‰äººæ‰¹å‡†è¯¥å‡æ¡ï¼&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="DeanOfStudies-1"><a href="#DeanOfStudies-1" class="headerlink" title="DeanOfStudies"></a>DeanOfStudies</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å…·ä½“å¤„ç†è€…4ï¼šæ•™åŠ¡å¤„é•¿ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dean</span> <span class="keyword">extends</span> <span class="title class_">Leader</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleRequest</span><span class="params">(<span class="type">int</span> LeaveDays)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (LeaveDays &lt;= <span class="number">10</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;é™¢é•¿æ‰¹å‡†æ‚¨è¯·å‡&quot;</span> + LeaveDays + <span class="string">&quot;å¤©ã€‚&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (getNext() != <span class="literal">null</span>) &#123;</span><br><span class="line">                getNext().handleRequest(LeaveDays);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;è¯·å‡å¤©æ•°å¤ªå¤šï¼Œæ²¡æœ‰äººæ‰¹å‡†è¯¥å‡æ¡ï¼&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="LeaveApprovalTest"><a href="#LeaveApprovalTest" class="headerlink" title="LeaveApprovalTest"></a>LeaveApprovalTest</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å°†æ‰€æœ‰å…·ä½“å¤„ç†è€…å…¨éƒ¨ç»„æˆä¸€ä¸ªé“¾è·¯ï¼Œè®©ç³»ç»Ÿä¸€è·¯å¾€ä¸‹æ‰¾èƒ½å¤„ç†çš„æ–¹æ³•è¿›è¡Œå¤„ç†</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LeaveApprovalTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//ç»„è£…è´£ä»»é“¾</span></span><br><span class="line">        <span class="type">Leader</span> <span class="variable">teacher1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassAdviser</span>();</span><br><span class="line">        <span class="type">Leader</span> <span class="variable">teacher2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DepartmentHead</span>();</span><br><span class="line">        <span class="type">Leader</span> <span class="variable">teacher3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Dean</span>();</span><br><span class="line">        Leader teacher4=<span class="keyword">new</span> <span class="title class_">DeanOfStudies</span>();</span><br><span class="line">        teacher1.setNext(teacher2);</span><br><span class="line">        teacher2.setNext(teacher3);</span><br><span class="line">        teacher3.setNext(teacher4);</span><br><span class="line">        <span class="comment">//æäº¤è¯·æ±‚</span></span><br><span class="line">        teacher1.handleRequest(<span class="number">8</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://www.naste.top:9000/images/image-20230618152446117.png" alt="image-20230618152446117"></p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><ul><li>ä¼˜ç‚¹<ul><li>é™ä½äº†å¯¹è±¡ä¹‹é—´çš„è€¦åˆåº¦ã€‚è¯¥æ¨¡å¼ä½¿å¾—ä¸€ä¸ªå¯¹è±¡æ— é¡»çŸ¥é“åˆ°åº•æ˜¯å“ªä¸€ä¸ªå¯¹è±¡å¤„ç†å…¶è¯·æ±‚ä»¥åŠé“¾çš„ç»“æ„ï¼Œå‘é€è€…å’Œæ¥æ”¶è€…ä¹Ÿæ— é¡»æ‹¥æœ‰å¯¹æ–¹çš„æ˜ç¡®ä¿¡æ¯ã€‚</li><li>å¢å¼ºäº†ç³»ç»Ÿçš„å¯æ‰©å±•æ€§ã€‚å¯ä»¥æ ¹æ®éœ€è¦å¢åŠ æ–°çš„è¯·æ±‚å¤„ç†ç±»ï¼Œæ»¡è¶³å¼€é—­åŸåˆ™ã€‚</li><li>å¢å¼ºäº†ç»™å¯¹è±¡æŒ‡æ´¾èŒè´£çš„çµæ´»æ€§ã€‚å½“å·¥ä½œæµç¨‹å‘ç”Ÿå˜åŒ–ï¼Œå¯ä»¥åŠ¨æ€åœ°æ”¹å˜é“¾å†…çš„æˆå‘˜æˆ–è€…è°ƒåŠ¨å®ƒä»¬çš„æ¬¡åºï¼Œä¹Ÿå¯åŠ¨æ€åœ°æ–°å¢æˆ–è€…åˆ é™¤è´£ä»»ã€‚</li><li>è´£ä»»é“¾ç®€åŒ–äº†å¯¹è±¡ä¹‹é—´çš„è¿æ¥ã€‚æ¯ä¸ªå¯¹è±¡åªéœ€ä¿æŒä¸€ä¸ªæŒ‡å‘å…¶åç»§è€…çš„å¼•ç”¨ï¼Œä¸éœ€ä¿æŒå…¶ä»–æ‰€æœ‰å¤„ç†è€…çš„å¼•ç”¨ï¼Œè¿™é¿å…äº†ä½¿ç”¨ä¼—å¤šçš„ if æˆ–è€… ifÂ·Â·Â·else è¯­å¥ã€‚</li><li>è´£ä»»åˆ†æ‹…ã€‚æ¯ä¸ªç±»åªéœ€è¦å¤„ç†è‡ªå·±è¯¥å¤„ç†çš„å·¥ä½œï¼Œä¸è¯¥å¤„ç†çš„ä¼ é€’ç»™ä¸‹ä¸€ä¸ªå¯¹è±¡å®Œæˆï¼Œæ˜ç¡®å„ç±»çš„è´£ä»»èŒƒå›´ï¼Œç¬¦åˆç±»çš„å•ä¸€èŒè´£åŸåˆ™ã€‚</li></ul></li><li>ç¼ºç‚¹<ul><li>ä¸èƒ½ä¿è¯æ¯ä¸ªè¯·æ±‚ä¸€å®šè¢«å¤„ç†ã€‚ç”±äºä¸€ä¸ªè¯·æ±‚æ²¡æœ‰æ˜ç¡®çš„æ¥æ”¶è€…ï¼Œæ‰€ä»¥ä¸èƒ½ä¿è¯å®ƒä¸€å®šä¼šè¢«å¤„ç†ï¼Œè¯¥è¯·æ±‚å¯èƒ½ä¸€ç›´ä¼ åˆ°é“¾çš„æœ«ç«¯éƒ½å¾—ä¸åˆ°å¤„ç†ã€‚</li><li>å¯¹æ¯”è¾ƒé•¿çš„èŒè´£é“¾ï¼Œè¯·æ±‚çš„å¤„ç†å¯èƒ½æ¶‰åŠå¤šä¸ªå¤„ç†å¯¹è±¡ï¼Œç³»ç»Ÿæ€§èƒ½å°†å—åˆ°ä¸€å®šå½±å“ã€‚</li><li>èŒè´£é“¾å»ºç«‹çš„åˆç†æ€§è¦é å®¢æˆ·ç«¯æ¥ä¿è¯ï¼Œå¢åŠ äº†å®¢æˆ·ç«¯çš„å¤æ‚æ€§ï¼Œå¯èƒ½ä¼šç”±äºèŒè´£é“¾çš„é”™è¯¯è®¾ç½®è€Œå¯¼è‡´ç³»ç»Ÿå‡ºé”™ï¼Œå¦‚å¯èƒ½ä¼šé€ æˆå¾ªç¯è°ƒç”¨ã€‚</li></ul></li></ul>]]></content>
    
    
    <summary type="html">è®¾è®¡æ¨¡å¼-è´£ä»»é“¾æ¨¡å¼</summary>
    
    
    
    <category term="Java" scheme="https://www.naste.top:1024/categories/Java/"/>
    
    
    <category term="Java" scheme="https://www.naste.top:1024/tags/Java/"/>
    
    <category term="è®¾è®¡æ¨¡å¼" scheme="https://www.naste.top:1024/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    <category term="è´£ä»»é“¾æ¨¡å¼" scheme="https://www.naste.top:1024/tags/%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>è®¾è®¡æ¨¡å¼-æ¨¡æ¿æ–¹æ³•æ¨¡å¼</title>
    <link href="https://www.naste.top:1024/posts/759022725.html"/>
    <id>https://www.naste.top:1024/posts/759022725.html</id>
    <published>2023-06-17T09:45:43.000Z</published>
    <updated>2023-06-18T06:45:32.569Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h1><p>[TOC]</p><h1 id="ä»€ä¹ˆæ˜¯æ¨¡æ¿æ–¹æ³•æ¨¡å¼"><a href="#ä»€ä¹ˆæ˜¯æ¨¡æ¿æ–¹æ³•æ¨¡å¼" class="headerlink" title="ä»€ä¹ˆæ˜¯æ¨¡æ¿æ–¹æ³•æ¨¡å¼"></a>ä»€ä¹ˆæ˜¯æ¨¡æ¿æ–¹æ³•æ¨¡å¼</h1><p>æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼ˆTemplate Method Patternï¼‰ï¼Œåˆå«æ¨¡æ¿æ¨¡å¼(Template Pattern)ï¼Œåœ¨ä¸€ä¸ªæŠ½è±¡ç±»å…¬å¼€å®šä¹‰äº†æ‰§è¡Œå®ƒçš„æ–¹æ³•çš„æ¨¡æ¿ã€‚å®ƒçš„å­ç±»å¯ä»¥æŒ‰éœ€è¦é‡å†™æ–¹æ³•å®ç°ï¼Œä½†è°ƒç”¨å°†ä»¥æŠ½è±¡ç±»ä¸­å®šä¹‰çš„æ–¹å¼è¿›è¡Œã€‚</p><p>ç®€å•è¯´ï¼Œæ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼Œå®šä¹‰ä¸€ä¸ªæ“ä½œä¸­çš„ç®—æ³•çš„éª¨æ¶ï¼Œè€Œå°†ä¸€äº›æ­¥éª¤å»¶è¿Ÿåˆ°å­ç±»ä¸­ï¼Œä½¿å¾—å­ç±»å¯ä»¥ä¸æ”¹å˜ä¸€ä¸ªç®—æ³•çš„ç»“æ„ï¼Œå°±å¯ä»¥é‡å®šä¹‰è¯¥ç®—æ³•çš„æŸäº›ç‰¹å®šæ­¥éª¤ï¼Œè¿™ç§ç±»å‹çš„è®¾è®¡æ¨¡å¼å±äºè¡Œä¸ºå‹æ¨¡å¼ã€‚</p><p>åœ¨æ¨¡æ¿æ–¹æ³•æ¨¡å¼ä¸­ï¼Œæœ‰ä¸€ä¸ªæŠ½è±¡çˆ¶ç±»ï¼Œå®ƒå®šä¹‰äº†ä¸€ç»„æ“ä½œï¼Œè¿™äº›æ“ä½œæ˜¯åœ¨ç®—æ³•ä¸­çš„ä¸å˜éƒ¨åˆ†ã€‚ç„¶åï¼Œæ¯ä¸ªå­ç±»éƒ½å®ç°äº†è¿™äº›æ“ä½œä¸­çš„ä¸€äº›æˆ–å…¨éƒ¨ï¼Œä»¥ä¾¿æ ¹æ®éœ€è¦è¿›è¡Œå®šåˆ¶ã€‚åœ¨å­ç±»ä¸­ï¼Œå¯ä»¥ä½¿ç”¨çˆ¶ç±»ä¸­å®šä¹‰çš„æ“ä½œæ¥å®Œæˆç®—æ³•çš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿå¯ä»¥æ·»åŠ è‡ªå·±çš„å®ç°æ¥å®Œæˆå…¶ä»–éƒ¨åˆ†ã€‚</p><h1 id="ç±»å›¾"><a href="#ç±»å›¾" class="headerlink" title="ç±»å›¾"></a>ç±»å›¾</h1><p>å¯¹åŸç†ç±»å›¾çš„è¯´æ˜ï¼š</p><ul><li>AbstractClass æŠ½è±¡ç±»ï¼Œ ç±»ä¸­å®ç°äº†æ¨¡æ¿æ–¹æ³•(template)ï¼Œå®šä¹‰äº†ç®—æ³•çš„éª¨æ¶ï¼Œå…·ä½“å­ç±»éœ€è¦å»å®ç° å…¶å®ƒçš„æŠ½è±¡æ–¹æ³• operation2,3,4</li><li>ConcreteClass å®ç°æŠ½è±¡æ–¹æ³•ï¼Œå‡è®¾æ˜¯operation2,3,4, ä»¥å®Œæˆç®—æ³•ä¸­ç‰¹å®šå­ç±»çš„å…·ä½“ä¸šåŠ¡æ­¥éª¤</li></ul><p><img src="https://www.naste.top:9000/images/image-20230618142251707.png" alt="image-20230618142251707"></p><h1 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h1><h2 id="éœ€æ±‚"><a href="#éœ€æ±‚" class="headerlink" title="éœ€æ±‚"></a>éœ€æ±‚</h2><p>ç¼–å†™åˆ¶ä½œè±†æµ†çš„ç¨‹åºï¼Œè¯´æ˜å¦‚ä¸‹ï¼š</p><ul><li>åˆ¶ä½œè±†æµ†çš„æµç¨‹ï¼šé€‰æâ€”&gt;æ·»åŠ é…æ–™â€”&gt;æµ¸æ³¡â€”&gt;æ”¾åˆ°è±†æµ†æœºæ‰“ç¢</li><li>é€šè¿‡æ·»åŠ ä¸åŒçš„é…æ–™ï¼Œå¯ä»¥åˆ¶ä½œå‡ºä¸åŒå£å‘³çš„è±†æµ†</li><li>é€‰æã€æµ¸æ³¡å’Œæ”¾åˆ°è±†æµ†æœºæ‰“ç¢è¿™å‡ ä¸ªæ­¥éª¤å¯¹äºåˆ¶ä½œæ¯ç§å£å‘³çš„è±†æµ†éƒ½æ˜¯ä¸€æ ·çš„</li></ul><blockquote><p><strong>è¯´æ˜ï¼šå› ä¸ºæ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼Œæ¯”è¾ƒç®€å•ï¼Œå¾ˆå®¹æ˜“å°±æƒ³åˆ°è¿™ä¸ªæ–¹æ¡ˆï¼Œå› æ­¤å°±ç›´æ¥ä½¿ç”¨ï¼Œä¸å†ä½¿ç”¨ä¼ ç»Ÿçš„æ–¹æ¡ˆæ¥å¼•å‡ºæ¨¡æ¿æ–¹æ³•æ¨¡å¼</strong></p></blockquote><h2 id="ç±»å›¾-1"><a href="#ç±»å›¾-1" class="headerlink" title="ç±»å›¾"></a>ç±»å›¾</h2><p><img src="https://www.naste.top:9000/images/image-20230618143104197.png" alt="image-20230618143104197"></p><h2 id="æœªä½¿ç”¨æ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„é’©å­æ–¹æ³•"><a href="#æœªä½¿ç”¨æ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„é’©å­æ–¹æ³•" class="headerlink" title="æœªä½¿ç”¨æ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„é’©å­æ–¹æ³•"></a>æœªä½¿ç”¨æ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„é’©å­æ–¹æ³•</h2><h3 id="SoyaMilk"><a href="#SoyaMilk" class="headerlink" title="SoyaMilk"></a>SoyaMilk</h3><blockquote><p><strong>æŠ½è±¡ç±»ï¼Œæ¨¡æ¿æ–¹æ³•</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaofei.template;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æŠ½è±¡ç±»ï¼Œè¡¨ç¤ºè±†æµ†</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">SoyaMilk</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¨¡æ¿æ–¹æ³•ï¼šå¯ä»¥åšæˆfinalï¼Œä¸è®©å­ç±»å»è¦†ç›–</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">make</span><span class="params">()</span> &#123;</span><br><span class="line">        select();</span><br><span class="line">        addCondiment();</span><br><span class="line">        soak();</span><br><span class="line">        beat();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é€‰ææ–™</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">select</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ç¬¬ä¸€æ­¥ï¼šé€‰æ‹©æ–°é²œçš„è±†å­&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ·»åŠ ä¸åŒçš„é…æ–™ï¼šæŠ½è±¡æ–¹æ³•ï¼Œç”±å­ç±»å…·ä½“å®ç°</span></span><br><span class="line">    <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">addCondiment</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æµ¸æ³¡</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">soak</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ç¬¬ä¸‰æ­¥ï¼šè±†å­å’Œé…æ–™å¼€å§‹æµ¸æ³¡3H&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ¦¨æ±</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">beat</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ç¬¬å››æ­¥ï¼šè±†å­å’Œé…æ–™æ”¾å…¥è±†æµ†æœºæ¦¨æ±&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="PeanutSoyaMilk"><a href="#PeanutSoyaMilk" class="headerlink" title="PeanutSoyaMilk"></a>PeanutSoyaMilk</h3><blockquote><p><strong>ç»§æ‰¿æŠ½è±¡æ–¹æ³•å’Œé‡å†™æŠ½è±¡æ–¹æ³•ä¸­çš„æ–¹æ³•</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æŠ½è±¡æ¨¡æ¿æ–¹æ³•é›†æˆå’Œé‡å†™</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PeanutSoyaMilk</span> <span class="keyword">extends</span> <span class="title class_">SoyaMilk</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">addCondiment</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ç¬¬äºŒæ­¥ï¼šåŠ å…¥ä¸Šå¥½çš„èŠ±ç”Ÿ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ReadBeanSoyaMilk"><a href="#ReadBeanSoyaMilk" class="headerlink" title="ReadBeanSoyaMilk"></a>ReadBeanSoyaMilk</h3><blockquote><p><strong>ç»§æ‰¿æŠ½è±¡æ–¹æ³•å’Œé‡å†™æŠ½è±¡æ–¹æ³•ä¸­çš„æ–¹æ³•</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æŠ½è±¡æ¨¡æ¿æ–¹æ³•é›†æˆå’Œé‡å†™</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReadBeanSoyaMilk</span> <span class="keyword">extends</span> <span class="title class_">SoyaMilk</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">addCondiment</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ç¬¬äºŒæ­¥ï¼šåŠ å…¥ä¸Šå¥½çš„çº¢è±†&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Client"><a href="#Client" class="headerlink" title="Client"></a>Client</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;=======åˆ¶ä½œçº¢è±†è±†æµ†=======&quot;</span>);</span><br><span class="line">        <span class="type">SoyaMilk</span> <span class="variable">redBeanSoyaMilk</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReadBeanSoyaMilk</span>();</span><br><span class="line">        redBeanSoyaMilk.make();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;=======åˆ¶ä½œèŠ±ç”Ÿè±†æµ†=======&quot;</span>);</span><br><span class="line">        <span class="type">SoyaMilk</span> <span class="variable">peanutSoyaMilk</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PeanutSoyaMilk</span>();</span><br><span class="line">        peanutSoyaMilk.make();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://www.naste.top:9000/images/image-20230618143758209.png" alt="image-20230618143758209"></p><h2 id="ä½¿ç”¨æ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„é’©å­æ–¹æ³•"><a href="#ä½¿ç”¨æ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„é’©å­æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„é’©å­æ–¹æ³•"></a>ä½¿ç”¨æ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„é’©å­æ–¹æ³•</h2><p>åœ¨æ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„çˆ¶ç±»ä¸­ï¼Œå¯ä»¥å®šä¹‰ä¸€ä¸ªæ–¹æ³•ï¼Œå®ƒé»˜è®¤ä¸åšä»»ä½•äº‹ï¼Œå­ç±»å¯ä»¥è§†æƒ…å†µè¦ä¸è¦è¦†ç›–å®ƒï¼Œè¯¥æ–¹æ³•ç§°ä¸ºâ€œé’©å­â€ã€‚è¿˜æ˜¯ç”¨ä¸Šé¢åšè±†æµ†çš„ä¾‹å­æ¥è®²è§£ï¼Œæ¯”å¦‚ï¼Œæˆ‘ä»¬è¿˜å¸Œæœ›åˆ¶ä½œçº¯è±†æµ†ï¼Œä¸æ·»åŠ ä»»ä½•çš„é…æ–™ï¼Œè¯·ä½¿ç”¨é’©å­æ–¹æ³•å¯¹å‰é¢çš„æ¨¡æ¿æ–¹æ³•è¿›è¡Œæ”¹é€ ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// RedBeanSoyaMilk.java/PeanutSoyaMilk.javaåŒä¸Šï¼Œç•¥</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//æŠ½è±¡ç±»ï¼Œè¡¨ç¤ºè±†æµ†ï¼ŒSoyaMilk</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">SoyaMilk</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ¨¡æ¿æ–¹æ³•ï¼šå¯ä»¥åšæˆfinalï¼Œä¸è®©å­ç±»å»è¦†ç›–</span></span><br><span class="line"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">make</span><span class="params">()</span> &#123;</span><br><span class="line">select();</span><br><span class="line"><span class="keyword">if</span>(customerWantCondiment()) &#123;</span><br><span class="line">addCondiment();</span><br><span class="line">&#125;</span><br><span class="line">soak();</span><br><span class="line">beat();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//1.é€‰ææ–™</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">select</span><span class="params">()</span> &#123; System.out.println(<span class="string">&quot;ç¬¬ä¸€æ­¥ï¼šé€‰æ‹©æ–°é²œçš„è±†å­&quot;</span>); &#125;</span><br><span class="line"><span class="comment">//2.æ·»åŠ ä¸åŒçš„é…æ–™ï¼šæŠ½è±¡æ–¹æ³•ï¼Œç”±å­ç±»å…·ä½“å®ç°</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">addCondiment</span><span class="params">()</span>;</span><br><span class="line"><span class="comment">//3.æµ¸æ³¡</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">soak</span><span class="params">()</span> &#123; System.out.println(<span class="string">&quot;ç¬¬ä¸‰æ­¥ï¼šè±†å­å’Œé…æ–™å¼€å§‹æµ¸æ³¡3H&quot;</span>); &#125;</span><br><span class="line"><span class="comment">//4.æ¦¨æ±</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">beat</span><span class="params">()</span> &#123; System.out.println(<span class="string">&quot;ç¬¬å››æ­¥ï¼šè±†å­å’Œé…æ–™æ”¾å…¥è±†æµ†æœºæ¦¨æ±&quot;</span>); &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//é’©å­æ–¹æ³•ï¼šå†³å®šæ˜¯å¦éœ€è¦æ·»åŠ é…æ–™</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">customerWantCondiment</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;<span class="comment">//é»˜è®¤æƒ…å†µä¸‹æ˜¯è¦åŠ é…æ–™çš„</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PureSoyaMilk</span> <span class="keyword">extends</span> <span class="title class_">SoyaMilk</span> &#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">addCondiment</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="comment">// æ·»åŠ é…æ–™çš„æ–¹æ³• ç©ºå®ç° å³å¯</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">customerWantCondiment</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;=åˆ¶ä½œçº¯è±†æµ†=&quot;</span>);</span><br><span class="line"><span class="type">SoyaMilk</span> <span class="variable">pureSoyMilk</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PureSoyaMilk</span>();</span><br><span class="line">pureSoyMilk.make();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>å½“å¤šä¸ªç±»ä¸­ï¼Œæœ‰å¤šä¸ªæ–¹æ³•éƒ½æœ‰ç›¸åŒçš„æ–¹æ³•ï¼Œæ­¤æ—¶å¯ä»¥ä½¿ç”¨æ¨¡æ¿æ–¹æ³•æ¨¡å¼ã€‚ä¾‹å¦‚ä¸Šé¢åˆ¶ä½œè±†æµ†çš„è¿‡ç¨‹ï¼Œéƒ½éœ€è¦é€‰æ‹©ææ–™ã€åˆ¶ä½œå·¥å…·ï¼Œåˆ¶ä½œæ—¶é—´ï¼Œè¿™äº›æ­¥éª¤éƒ½æ˜¯ç›¸åŒçš„ï¼Œåªæ˜¯åŠ å…¥çš„å…¶ä»–ææ–™ä¸ä¸€è‡´ï¼Œæ­¤æ—¶åŠ å…¥ææ–™çš„æ–¹æ³•å°±éœ€è¦å…·ä½“çš„ç±»å»å®ç°äº†ï¼Œè€Œåˆ¶ä½œçš„æ­¥éª¤é¡ºåºéƒ½æ˜¯ä¸€æ ·çš„ï¼Œæ­¤æ—¶ï¼Œåˆ¶ä½œè±†æµ†çš„è¿™ä¸ªæ–¹æ³•å°±æ˜¯æ¨¡æ¿æ–¹æ³•ï¼Œä¸”æ˜¯finalä¸å¯ä»¥è¢«å­ç±»é‡å†™ä¿®æ”¹çš„ã€‚</p><p>æ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„ä¼˜ç‚¹æ˜¯å¯ä»¥æé«˜ä»£ç çš„å¯æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚ç¼ºç‚¹æ˜¯å¯èƒ½ä¼šå¯¼è‡´ä»£ç å˜å¾—å¤æ‚å’Œéš¾ä»¥ç†è§£</p><ul><li><p>åŸºæœ¬æ€æƒ³æ˜¯ï¼šç®—æ³•åªå­˜åœ¨äºä¸€ä¸ªåœ°æ–¹ï¼Œä¹Ÿå°±æ˜¯åœ¨çˆ¶ç±»ä¸­ï¼Œå®¹æ˜“ä¿®æ”¹ã€‚éœ€è¦ä¿®æ”¹ç®—æ³•æ—¶ï¼Œåªè¦ä¿®æ”¹çˆ¶ç±»çš„æ¨¡æ¿æ–¹æ³•æˆ–è€…å·²ç»å®ç°çš„æŸäº›æ­¥éª¤ï¼Œå­ç±»å°±ä¼šç»§æ‰¿è¿™äº›ä¿®æ”¹</p></li><li><p>å¥½å¤„ï¼š</p><ul><li><p>å®ç°äº†æœ€å¤§åŒ–ä»£ç å¤ç”¨ã€‚çˆ¶ç±»çš„æ¨¡æ¿æ–¹æ³•å’Œå·²å®ç°çš„æŸäº›æ­¥éª¤ä¼šè¢«å­ç±»ç»§æ‰¿è€Œç›´æ¥ä½¿ç”¨ï¼›</p></li><li><p>æ—¢ç»Ÿä¸€äº†ç®—æ³•ï¼Œä¹Ÿæä¾›äº†å¾ˆå¤§çš„çµæ´»æ€§ã€‚çˆ¶ç±»çš„æ¨¡æ¿æ–¹æ³•ç¡®ä¿äº†ç®—æ³•çš„ç»“æ„ä¿æŒä¸å˜ï¼ŒåŒæ—¶ç”±å­ç±»æä¾›éƒ¨åˆ†æ­¥éª¤çš„å®ç°</p></li></ul></li><li>è¯¥æ¨¡å¼çš„ä¸è¶³ä¹‹å¤„ï¼šæ¯ä¸€ä¸ªä¸åŒçš„å®ç°éƒ½éœ€è¦ä¸€ä¸ªå­ç±»å®ç°ï¼Œå¯¼è‡´ç±»çš„ä¸ªæ•°å¢åŠ ï¼Œä½¿å¾—ç³»ç»Ÿæ›´åŠ åºå¤§</li></ul><blockquote><p><strong>æ³¨æ„ï¼šä¸€èˆ¬æ¨¡æ¿æ–¹æ³•éƒ½åŠ ä¸Š final å…³é”®å­—ï¼Œ é˜²æ­¢å­ç±»é‡å†™æ¨¡æ¿æ–¹æ³•</strong></p></blockquote><ul><li><p>æ¨¡æ¿æ–¹æ³•æ¨¡å¼ä½¿ç”¨åœºæ™¯ï¼š</p><ul><li><p>å½“è¦å®Œæˆåœ¨æŸä¸ªè¿‡ç¨‹ï¼Œè¯¥è¿‡ç¨‹è¦æ‰§è¡Œä¸€ç³»åˆ—æ­¥éª¤ ï¼Œè¿™ä¸€ç³»åˆ—çš„æ­¥éª¤åŸºæœ¬ç›¸åŒï¼Œä½†å…¶ä¸ªåˆ«æ­¥éª¤åœ¨å®ç°æ—¶å¯èƒ½ä¸åŒï¼Œé€šå¸¸è€ƒè™‘ç”¨æ¨¡æ¿æ–¹æ³•æ¨¡å¼æ¥å¤„ç†</p></li><li><p>ç»Ÿè®¡æŸä¸€æ®µä»£ç çš„æ‰§è¡Œæ—¶é—´ä¹Ÿå¯ä»¥ç”¨æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼šåœ¨å‰é¢æ‰“å°å‡ºä»£ç æ‰§è¡Œå‰çš„æ—¶é—´ï¼Œåé¢å†æ‰“å°å‡ºä»£ç æ‰§è¡Œåçš„æ—¶é—´ï¼Œä¸­é—´éƒ¨åˆ†å°±æ˜¯ä¸åŒçš„æ‰§è¡Œä»£ç </p></li></ul></li></ul>]]></content>
    
    
    <summary type="html">è®¾è®¡æ¨¡å¼-æ¨¡æ¿æ–¹æ³•æ¨¡å¼</summary>
    
    
    
    <category term="Java" scheme="https://www.naste.top:1024/categories/Java/"/>
    
    
    <category term="Java" scheme="https://www.naste.top:1024/tags/Java/"/>
    
    <category term="è®¾è®¡æ¨¡å¼" scheme="https://www.naste.top:1024/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    <category term="æ¨¡æ¿æ–¹æ³•æ¨¡å¼" scheme="https://www.naste.top:1024/tags/%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>è®¾è®¡æ¨¡å¼-è¿­ä»£å™¨æ¨¡å¼</title>
    <link href="https://www.naste.top:1024/posts/1151138150.html"/>
    <id>https://www.naste.top:1024/posts/1151138150.html</id>
    <published>2023-06-17T02:05:59.000Z</published>
    <updated>2023-06-17T09:29:33.822Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h1><p>[TOC]</p><h1 id="ä»€ä¹ˆæ˜¯è¿­ä»£å™¨æ¨¡å¼"><a href="#ä»€ä¹ˆæ˜¯è¿­ä»£å™¨æ¨¡å¼" class="headerlink" title="ä»€ä¹ˆæ˜¯è¿­ä»£å™¨æ¨¡å¼"></a>ä»€ä¹ˆæ˜¯è¿­ä»£å™¨æ¨¡å¼</h1><p>è¿­ä»£å™¨æ¨¡å¼æ˜¯ä¸€ç§è¡Œä¸ºè®¾è®¡æ¨¡å¼ï¼Œèƒ½åœ¨ä¸æš´éœ²é›†åˆåº•å±‚è¡¨ç°å½¢å¼ï¼ˆåˆ—è¡¨ã€æ ˆå’Œæ ‘ç­‰ï¼‰çš„æƒ…å†µä¸‹ä¾¿åˆ©é›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ </p><h1 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h1><ul><li>å½“éœ€è¦ä¸ºèšåˆå¯¹è±¡æä¾›å¤šç§éå†æ–¹å¼æ—¶</li><li>å½“éœ€è¦ä¸ºéå†ä¸åŒçš„èšåˆç»“æ„æä¾›ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£æ—¶</li></ul><h1 id="è¿­ä»£å™¨è®¾è®¡æ¨¡å¼ç±»å›¾"><a href="#è¿­ä»£å™¨è®¾è®¡æ¨¡å¼ç±»å›¾" class="headerlink" title="è¿­ä»£å™¨è®¾è®¡æ¨¡å¼ç±»å›¾"></a>è¿­ä»£å™¨è®¾è®¡æ¨¡å¼ç±»å›¾</h1><p><img src="https://www.naste.top:9000/images/image-20230617171322142.png" alt="image-20230617171322142"></p><h1 id="è¿­ä»£å™¨ä¸­çš„è§’è‰²"><a href="#è¿­ä»£å™¨ä¸­çš„è§’è‰²" class="headerlink" title="è¿­ä»£å™¨ä¸­çš„è§’è‰²"></a>è¿­ä»£å™¨ä¸­çš„è§’è‰²</h1><ul><li>Iteratorï¼ˆè¿­ä»£å™¨ï¼‰ï¼šè¿™ä¸ªæ¥å£è´Ÿè´£å®šä¹‰æŒ‰é¡ºåºéå†å…ƒç´ çš„æ¥å£ã€‚å…¶ä¸­hasNextè´Ÿè´£åˆ¤æ–­æ˜¯å¦è¿˜å­˜åœ¨ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œnextæ–¹æ³•ç”¨äºè·å–è¯¥å…ƒç´ å¹¶å°†å…ƒç´ æŒ‡é’ˆåç§»ã€‚</li><li>ConcreteIteratorï¼ˆå…·ä½“çš„è¿­ä»£å™¨ï¼‰ï¼šè¯¥ç±»è´Ÿè´£å®ç°Iteratoræ‰€å®šä¹‰çš„æ¥å£ï¼ŒåŒæ—¶åŒ…å«éå†é›†åˆæ‰€å¿…è¦çš„ä¿¡æ¯ã€‚åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼ŒBookShelfç±»çš„å®ä¾‹ä¿å­˜è‡³bookShelfä¸­ï¼ŒæŒ‡å‘å½“å‰ä¹¦çš„ä¸‹æ ‡ä¿å­˜åœ¨indexä¸­ã€‚</li><li>Aggregateï¼ˆé›†åˆï¼‰ï¼šå®ç°è¯¥æ¥å£çš„ç±»éƒ½éœ€è¦å®ç°è·å–Iteratorçš„æ–¹æ³•</li><li>ConcreteAggregateï¼ˆå…·ä½“çš„é›†åˆï¼‰ï¼šè¯¥ç±»è´Ÿè´£å…·ä½“å®ç°Aggregateæ‰€å®šä¹‰çš„æ–¹æ³•ã€‚åœ¨è¯¥ç¤ºä¾‹ä¸­ç”±BookShelfè´Ÿè´£æ‰¿æ‹…æ­¤åŠŸèƒ½ã€‚</li><li></li></ul><h1 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h1><h2 id="æœªä½¿ç”¨è¿­ä»£å™¨"><a href="#æœªä½¿ç”¨è¿­ä»£å™¨" class="headerlink" title="æœªä½¿ç”¨è¿­ä»£å™¨"></a>æœªä½¿ç”¨è¿­ä»£å™¨</h2><p>åœ¨Javaä¸­æƒ³è¦éå†ä¸€ä¸ªarrä¸­çš„æ‰€æœ‰å…ƒç´ æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨forå¾ªç¯æ¥éå†æ•´ä¸ªåˆ—è¡¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; items = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; items.size(); i++) &#123;</span><br><span class="line">    System.out.println(items.get(i));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ˜¾ç„¶æ˜¯ä¸€ç§å¾ˆè‡ªç„¶çš„åšæ³•ï¼Œä½†æ˜¯è‹¥æ­¤æ—¶ç”¨äºå­˜å‚¨å…ƒç´ çš„åº•å±‚æ•°æ®ç»“æ„å‘ç”Ÿå˜åŒ–ï¼Œæˆ‘ä»¬å°±éœ€è¦æ ¹æ®ä¸åŒçš„æ•°æ®ç»“æ„å®ç°ä¸åŒçš„éå†æ–¹å¼ã€‚æ­¤æ—¶çš„æˆ‘ä»…ä»…ä½œä¸ºæœåŠ¡çš„è°ƒç”¨è€…ï¼Œè¿™æ˜¾ç„¶ç»™æˆ‘å¸¦æ¥çš„ä¸å¿…è¦çš„è´Ÿæ‹…ã€‚å› ä¸ºæˆ‘åªæ˜¯æƒ³è¦éå†ä¸€éæ‰€æœ‰å…ƒç´ ï¼Œä½†æ˜¯æˆ‘å´éœ€è¦æ·±å…¥äº†è§£æœåŠ¡å¼€å‘è€…æ‰€ä½¿ç”¨çš„æ•°æ®ç»“æ„ï¼Œå¹¶å®ç°ä¸åŒçš„éå†é€»è¾‘ã€‚</p><p>æœ‰æ²¡æœ‰ä¸€ç§æ–¹å¼å¯ä»¥è®©æœåŠ¡å¼€å‘è€…å®ç°ä¸€ä¸ªæ˜“è°ƒç”¨çš„æ¥å£ï¼Œæˆ‘åªéœ€è¦è°ƒç”¨ä¸€ä¸ªæ–¹æ³•å°±å¯ä»¥å®Œæˆå…ƒç´ çš„éå†ã€‚å°†è¿™ç§æ€æƒ³æŠ½è±¡èµ·æ¥ï¼Œä¾¿å¾—åˆ°äº†è¿­ä»£å™¨æ¨¡å¼ã€‚</p><h2 id="ä½¿ç”¨è¿­ä»£å™¨"><a href="#ä½¿ç”¨è¿­ä»£å™¨" class="headerlink" title="ä½¿ç”¨è¿­ä»£å™¨"></a>ä½¿ç”¨è¿­ä»£å™¨</h2><h3 id="Iteratoræ¥å£"><a href="#Iteratoræ¥å£" class="headerlink" title="Iteratoræ¥å£"></a>Iteratoræ¥å£</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¿­ä»£å™¨æ¥å£</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Iterator</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ˜¯å¦è¿˜æœ‰ä¸‹ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> boolean</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">hasNext</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿”å›å½“å‰å…ƒç´ å¹¶å°†å½“å‰ä½ç½®æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> element</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    T <span class="title function_">next</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="BookShelfIterator"><a href="#BookShelfIterator" class="headerlink" title="BookShelfIterator"></a>BookShelfIterator</h3><blockquote><p><strong>è¿­ä»£å™¨æ¥å£å®ç°</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaofei.iterator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookShelfIterator</span> <span class="keyword">implements</span> <span class="title class_">Iterator</span>&lt;Book&gt;&#123;</span><br><span class="line">    <span class="keyword">private</span> BookShelf bookShelf;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BookShelfIterator</span><span class="params">(BookShelf bookShelf)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.bookShelf = bookShelf;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasNext</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> bookShelf.getLength() &gt; index;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Book <span class="title function_">next</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Book</span> <span class="variable">book</span> <span class="operator">=</span> bookShelf.getBookAt(index);</span><br><span class="line">        index++;</span><br><span class="line">        <span class="keyword">return</span> book;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Aggrate"><a href="#Aggrate" class="headerlink" title="Aggrate"></a>Aggrate</h3><blockquote><p><strong>è·å–è¿­ä»£å™¨</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Aggregate</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–è¿­ä»£å™¨</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Iterator</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Iterator&lt;T&gt; <span class="title function_">getIterator</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="BookShelf"><a href="#BookShelf" class="headerlink" title="BookShelf"></a>BookShelf</h3><blockquote><p><strong>è·å–è¿­ä»£å™¨æ¥å£å®ç°å’Œæ·»åŠ é¢å¤–éœ€è¦ä½¿ç”¨çš„æ–¹æ³•</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaofei.iterator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookShelf</span> <span class="keyword">implements</span> <span class="title class_">Aggregate</span>&lt;Book&gt; &#123;</span><br><span class="line">    List&lt;Book&gt; bookList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Iterator&lt;Book&gt; <span class="title function_">getIterator</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BookShelfIterator</span>(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getLength</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.bookList.size();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">appendBook</span><span class="params">(Book book)</span> &#123;</span><br><span class="line">        bookList.add(book);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Book <span class="title function_">getBookAt</span><span class="params">(Integer position)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.bookList.get(position);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Bookç±»"><a href="#Bookç±»" class="headerlink" title="Bookç±»"></a>Bookç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¹¦ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Book</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String bookName;</span><br><span class="line">    <span class="keyword">private</span> Double price;</span><br><span class="line">    <span class="keyword">private</span> String author;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">BookShelf</span> <span class="variable">bookShelf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BookShelf</span>();</span><br><span class="line">    bookShelf.appendBook(<span class="keyword">new</span> <span class="title class_">Book</span>(<span class="string">&quot;æ–‡åŸ&quot;</span>, <span class="number">55.0</span>,<span class="string">&quot;ä½™å&quot;</span>));</span><br><span class="line">    bookShelf.appendBook(<span class="keyword">new</span> <span class="title class_">Book</span>(<span class="string">&quot;æœºå™¨å­¦ä¹ &quot;</span>, <span class="number">63.0</span>,<span class="string">&quot;å‘¨å¿—å&quot;</span>));</span><br><span class="line">    bookShelf.appendBook(<span class="keyword">new</span> <span class="title class_">Book</span>(<span class="string">&quot;ç»Ÿè®¡å­¦ä¹ æ–¹æ³•&quot;</span>, <span class="number">82.0</span>,<span class="string">&quot;æèˆª&quot;</span>));</span><br><span class="line"></span><br><span class="line">    Iterator&lt;Book&gt; iterator = bookShelf.getIterator();</span><br><span class="line">    <span class="keyword">while</span> (iterator.hasNext())&#123;</span><br><span class="line">        <span class="type">Book</span> <span class="variable">book</span> <span class="operator">=</span> iterator.next();</span><br><span class="line">        System.out.println(<span class="string">&quot;book = &quot;</span> + book);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://www.naste.top:9000/images/image-20230617171542664.png" alt="image-20230617171542664"></p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>è¿­ä»£å™¨æ¨¡å¼æ˜¯ä¸€ç§è¡Œä¸ºè®¾è®¡æ¨¡å¼ï¼Œå®ƒè®©ä½ èƒ½åœ¨ä¸æš´éœ²é›†åˆåº•å±‚è¡¨ç°å½¢å¼(åˆ—è¡¨ã€æ ˆå’Œæ ‘ç­‰)çš„æƒ…å†µä¸‹éå†é›†åˆä¸­æ‰€æœ‰çš„å…ƒç´ ã€‚è¿­ä»£å™¨æ¨¡å¼å°†é›†åˆå¯¹è±¡çš„éå†æ“ä½œä»é›†åˆç±»ä¸­æ‹†åˆ†å‡ºæ¥ï¼Œæ”¾åˆ°è¿­ä»£å™¨ç±»ä¸­ï¼Œè®©ä¸¤è€…çš„èŒè´£æ›´åŠ å•ä¸€ã€‚</p><p>è¿­ä»£å™¨æ¨¡å¼çš„ä¸»è¦æ€æƒ³æ˜¯å°†é›†åˆçš„éå†è¡Œä¸ºæŠ½å–ä¸ºå•ç‹¬çš„è¿­ä»£å™¨å¯¹è±¡ã€‚é™¤å®ç°è‡ªèº«ç®—æ³•å¤–ï¼Œè¿­ä»£å™¨è¿˜å°è£…äº†éå†æ“ä½œçš„æ‰€æœ‰ç»†èŠ‚ï¼Œæ¯”å¦‚å½“å‰ä½ç½®å’Œæœ«å°¾å‰©ä½™å…ƒç´ çš„æ•°é‡ã€åŒæ—¶è¿˜æœ‰æä¾›ä¸€ä¸ªè·å–é›†åˆå…ƒç´ çš„åŸºæœ¬æ–¹æ³•ã€‚å®¢æˆ·ç«¯å¯ä¸æ–­è°ƒç”¨è¯¥æ–¹æ³•ç›´åˆ°å®ƒä¸è¿”å›ä»»ä½•å†…å®¹ ( å·²éå†æ‰€æœ‰å…ƒç´  )ã€æ‰€æœ‰è¿­ä»£å™¨å¿…é¡»å®ç°ç›¸åŒçš„æ¥å£ (åªè¦æœ‰åˆé€‚çš„è¿­ä»£å™¨ï¼Œå®¢æˆ·ç«¯ä»£ç å°±èƒ½å…¼å®¹ä»»ä½•ç±»å‹çš„é›†åˆæˆ–éå†ç®—æ³•)ã€‚</p>]]></content>
    
    
    <summary type="html">è®¾è®¡æ¨¡å¼-è¿­ä»£å™¨æ¨¡å¼</summary>
    
    
    
    <category term="Java" scheme="https://www.naste.top:1024/categories/Java/"/>
    
    
    <category term="Java" scheme="https://www.naste.top:1024/tags/Java/"/>
    
    <category term="è®¾è®¡æ¨¡å¼" scheme="https://www.naste.top:1024/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    <category term="è¿­ä»£å™¨æ¨¡å¼" scheme="https://www.naste.top:1024/tags/%E8%BF%AD%E4%BB%A3%E5%99%A8%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>Navicaté‡ç½®è¯•ç”¨æ—¶é—´</title>
    <link href="https://www.naste.top:1024/posts/1384618004.html"/>
    <id>https://www.naste.top:1024/posts/1384618004.html</id>
    <published>2023-06-07T08:17:31.000Z</published>
    <updated>2023-10-12T01:38:53.698Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h1><p>[TOC]</p><h1 id="åˆ›å»ºæ¸…ç†è¯•ç”¨ä¿¡æ¯bat"><a href="#åˆ›å»ºæ¸…ç†è¯•ç”¨ä¿¡æ¯bat" class="headerlink" title="åˆ›å»ºæ¸…ç†è¯•ç”¨ä¿¡æ¯bat"></a>åˆ›å»ºæ¸…ç†è¯•ç”¨ä¿¡æ¯bat</h1><h2 id="navicat-16-2-5"><a href="#navicat-16-2-5" class="headerlink" title="navicat 16.2.5"></a>navicat 16.2.5</h2><blockquote><p><strong>åˆ›å»ºåç¼€ä¸º<code>.bat</code>æ ¼å¼æ–‡ä»¶</strong></p></blockquote><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> Delete HKEY_CURRENT_USER\Software\PremiumSoft\NavicatPremium\Registration[version and language]</span><br><span class="line"><span class="keyword">for</span> /f <span class="variable">%%i</span> <span class="keyword">in</span> (&#x27;&quot;REG QUERY &quot;HKEY_CURRENT_USER\Software\PremiumSoft\NavicatPremium&quot; /s | <span class="built_in">findstr</span> /L Registration&quot;&#x27;) <span class="keyword">do</span> (</span><br><span class="line">    reg delete <span class="variable">%%i</span> /va /f</span><br><span class="line">)</span><br><span class="line"><span class="built_in">echo</span>.</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> Delete Info folder under HKEY_CURRENT_USER\Software\Classes\CLSID</span><br><span class="line"><span class="keyword">for</span> /f <span class="variable">%%i</span> <span class="keyword">in</span> (&#x27;&quot;REG QUERY &quot;HKEY_CURRENT_USER\Software\Classes\CLSID&quot; /s | <span class="built_in">findstr</span> /E Info&quot;&#x27;) <span class="keyword">do</span> (</span><br><span class="line">    reg delete <span class="variable">%%i</span> /va /f</span><br><span class="line">)</span><br><span class="line"><span class="built_in">echo</span>.</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> Finish</span><br><span class="line"></span><br><span class="line"><span class="built_in">pause</span></span><br></pre></td></tr></table></figure><h2 id="navicat-16-2-7"><a href="#navicat-16-2-7" class="headerlink" title="navicat 16.2.7"></a>navicat 16.2.7</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">@echo off</span><br><span class="line">set dn=Info</span><br><span class="line">set dn2=ShellFolder</span><br><span class="line">set rp=HKEY_CURRENT_USER\Software\Classes\CLSID</span><br><span class="line">:: reg delete HKEY_CURRENT_USER\Software\PremiumSoft\NavicatPremium\Registration14XCS /f  %é’ˆå¯¹&lt;strong&gt;&lt;font color=&quot;#FF0000&quot;&gt;navicat&lt;/font&gt;&lt;/strong&gt;15%</span><br><span class="line">reg delete HKEY_CURRENT_USER\Software\PremiumSoft\NavicatPremium\Registration16XCS /f</span><br><span class="line">reg delete HKEY_CURRENT_USER\Software\PremiumSoft\NavicatPremium\Update /f</span><br><span class="line">echo finding.....</span><br><span class="line">for /f &quot;tokens=*&quot; %%a in (&#x27;reg query &quot;%rp%&quot;&#x27;) do (</span><br><span class="line"> echo %%a</span><br><span class="line">for /f &quot;tokens=*&quot; %%l in (&#x27;reg query &quot;%%a&quot; /f &quot;%dn%&quot; /s /e ^|findstr /i &quot;%dn%&quot;&#x27;) do (</span><br><span class="line">  echo deleteing: %%a</span><br><span class="line">  reg delete %%a /f</span><br><span class="line">)</span><br><span class="line">for /f &quot;tokens=*&quot; %%l in (&#x27;reg query &quot;%%a&quot; /f &quot;%dn2%&quot; /s /e ^|findstr /i &quot;%dn2%&quot;&#x27;) do (</span><br><span class="line">  echo deleteing: %%a</span><br><span class="line">  reg delete %%a /f</span><br><span class="line">)</span><br><span class="line">)</span><br><span class="line">echo re trial done!</span><br><span class="line">  </span><br><span class="line">pause</span><br><span class="line">exit</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Navicaté‡ç½®è¯•ç”¨æ—¶é—´</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>è®¾è®¡æ¨¡å¼-å»ºé€ è€…æ¨¡å¼</title>
    <link href="https://www.naste.top:1024/posts/709379917.html"/>
    <id>https://www.naste.top:1024/posts/709379917.html</id>
    <published>2023-06-07T07:55:57.000Z</published>
    <updated>2023-06-08T13:14:00.812Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h1><p>[TOC]</p><h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><ul><li><a href="https://zhuanlan.zhihu.com/p/143101326">https://zhuanlan.zhihu.com/p/143101326</a></li><li><a href="https://zhuanlan.zhihu.com/p/58093669">https://zhuanlan.zhihu.com/p/58093669</a></li></ul><h1 id="ä»€ä¹ˆæ˜¯å»ºé€ è€…æ¨¡å¼"><a href="#ä»€ä¹ˆæ˜¯å»ºé€ è€…æ¨¡å¼" class="headerlink" title="ä»€ä¹ˆæ˜¯å»ºé€ è€…æ¨¡å¼"></a>ä»€ä¹ˆæ˜¯å»ºé€ è€…æ¨¡å¼</h1><p>å»ºé€ è€…æ¨¡å¼æ˜¯ä¸€ç§åˆ›å»ºå‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒå¯ä»¥å°†å¯¹è±¡çš„æ„å»ºä¸è¡¨ç¤ºåˆ†ç¦»å¼€æ¥ï¼Œä»¥ä¾¿ç›¸åŒçš„æ„å»ºè¿‡ç¨‹å¯ä»¥åˆ›å»ºä¸åŒçš„è¡¨ç¤ºå½¢å¼ã€‚å®ƒå…è®¸æ‚¨åˆ›å»ºå¤æ‚çš„å¯¹è±¡ï¼ŒåŒæ—¶å¯¹å…¶æ„å»ºè¿‡ç¨‹è¿›è¡Œç»†ç²’åº¦çš„æ§åˆ¶ã€‚</p><p>åœ¨è¯¥æ¨¡å¼ä¸­ï¼Œä¸€ä¸ªDirectorå¯¹è±¡è´Ÿè´£æ ¹æ®ç”¨æˆ·è¾“å…¥æŒ‡ç¤ºç”Ÿæˆæ­£ç¡®çš„äº§å“ã€‚è¯¥æ¨¡å¼é€šå¸¸ç”¨äºå¤„ç†å¤æ‚çš„å¯¹è±¡ï¼Œä¾‹å¦‚åŒ…å«å¤šä¸ªå­ç»„ä»¶ä»¥åŠéœ€è¦æ‰§è¡Œè®¸å¤šæ­¥éª¤çš„å¯¹è±¡ã€‚å»ºé€ è€…æ¨¡å¼æ ¹æ®å»ºé€ è¿‡ç¨‹ä¸åŒåˆ†ä¸ºæ ‡å‡†å»ºé€ è€…æ¨¡å¼å’Œæµå¼å»ºé€ è€…æ¨¡å¼ã€‚åœ¨æ ‡å‡†å»ºé€ è€…æ¨¡å¼ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨å¤šä¸ªæ–¹æ³•æ¥è®¾ç½®å»ºé€ æ­¥éª¤ï¼Œåœ¨æµå¼å»ºé€ è€…æ¨¡å¼ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨å®ç°é“¾å¼è°ƒç”¨çš„å•ä¸ªæ–¹æ³•æ¥è®¾ç½®æ­¥éª¤ã€‚</p><h2 id="å››ä¸ªè§’è‰²"><a href="#å››ä¸ªè§’è‰²" class="headerlink" title="å››ä¸ªè§’è‰²"></a>å››ä¸ªè§’è‰²</h2><p><img src="https://www.naste.top:9000/images/image-20230608205738300.png" alt="image-20230608205738300"></p><p><strong>Productï¼ˆäº§å“è§’è‰²ï¼‰ï¼š</strong> ä¸€ä¸ªå…·ä½“çš„äº§å“å¯¹è±¡ã€‚</p><p><strong>Builderï¼ˆæŠ½è±¡å»ºé€ è€…ï¼‰ï¼š</strong> åˆ›å»ºä¸€ä¸ªProductå¯¹è±¡çš„å„ä¸ªéƒ¨ä»¶æŒ‡å®šçš„æŠ½è±¡æ¥å£ã€‚</p><p><strong>ConcreteBuilderï¼ˆå…·ä½“å»ºé€ è€…ï¼‰ï¼š</strong> å®ç°æŠ½è±¡æ¥å£ï¼Œæ„å»ºå’Œè£…é…å„ä¸ªéƒ¨ä»¶ã€‚</p><p><strong>Directorï¼ˆæŒ‡æŒ¥è€…ï¼‰ï¼š</strong> æ„å»ºä¸€ä¸ªä½¿ç”¨Builderæ¥å£çš„å¯¹è±¡ã€‚å®ƒä¸»è¦æ˜¯ç”¨äºåˆ›å»ºä¸€ä¸ªå¤æ‚çš„å¯¹è±¡ã€‚å®ƒä¸»è¦æœ‰ä¸¤ä¸ªä½œç”¨ï¼Œä¸€æ˜¯ï¼šéš”ç¦»äº†å®¢æˆ·ä¸å¯¹è±¡çš„ç”Ÿäº§è¿‡ç¨‹ï¼ŒäºŒæ˜¯ï¼šè´Ÿè´£æ§åˆ¶äº§å“å¯¹è±¡çš„ç”Ÿäº§è¿‡ç¨‹ã€‚</p><blockquote><p>æ‹¿å…¶ä¸­ä¸¤ä¸ªå¥—é¤ä¸¾ä¾‹</p><p>å¥—é¤A:æ±‰å ¡ï¼Œè–¯æ¡ï¼Œå¤§é¸¡è…¿<br>å¥—é¤B:æ±‰å ¡ï¼Œè–¯æ¡ï¼Œå°é¸¡è…¿ï¼Œå°å¯ä¹ï¼Œå°æŠ«è¨</p><p>å…¶ä¸­è–¯æ¡å’Œæ±‰å ¡å¯å¤§å¯å°ï¼Œå¹¶ä¸”å¿…é¡»æœ‰ï¼Œ<br>å…¶å®ƒçš„éƒ½ä¸ºå›ºå®šå¤§å°ï¼Œä½†æ˜¯ä½ å¯ä»¥é€‰æ‹©æœ‰æˆ–æ²¡æœ‰</p></blockquote><h1 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h1><blockquote><p><strong>å½“ä¸€ä¸ªç±»çš„æ„é€ å‡½æ•°å‚æ•°ä¸ªæ•°è¶…è¿‡4ä¸ªï¼Œè€Œä¸”è¿™äº›å‚æ•°æœ‰äº›æ˜¯å¯é€‰çš„å‚æ•°ï¼Œè€ƒè™‘ä½¿ç”¨æ„é€ è€…æ¨¡å¼</strong></p></blockquote><p>è¿™ä¸ªå°±éå¸¸é‡è¦äº†ï¼Œå› ä¸ºå¦‚æœä½ å­¦äº†ä¸ªä¸œè¥¿ï¼Œéƒ½ä¸çŸ¥é“ç”¨æ¥è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Œä½ è¯´æœ‰ä»€ä¹ˆç”¨ï¼Ÿç†è§£ä½¿ç”¨åœºæ™¯çš„çš„é‡è¦æ€§è¦è¿œé«˜äºä½ æ˜¯ä¸æ˜¯ä¼šå®ç°è¿™ä¸ªæ¨¡å¼ï¼Œå› ä¸ºåªè¦ä½ çŸ¥é“ä»€ä¹ˆé—®é¢˜å¯ä»¥ä½¿ç”¨builderæ¨¡å¼æ¥è§£å†³ï¼Œé‚£ä½ å³ä½¿ä¸ä¼šå†™ï¼Œä¹Ÿå¯ä»¥åœ¨è°ƒæŸ¥ç›¸å…³èµ„æ–™åå®Œæˆã€‚<br>æˆ‘ä¸æƒ³è¯´ä¸€äº›å¤§è€Œæ­£ç¡®çš„æœ¯è¯­æ¥æŠŠä½ æè’™ï¼Œæˆ‘ä»¬åªé’ˆå¯¹å…·ä½“çš„é—®é¢˜ï¼Œè‡³äºå»¶å±•æ€§çš„æ€è€ƒï¼Œéšç€ä½ çŸ¥è¯†çš„å¢é•¿ï¼Œé€æ¸ä¼šæ˜ç™½çš„ã€‚</p><h1 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h1><p>KFCå¥—é¤æ¡ˆä¾‹ï¼šå‡å¦‚ç›®å‰KFCé‡Œé¢æœ‰å¾ˆå¤šä¸ªå¥—é¤</p><ul><li>åœ¨å¥—é¤é‡Œé¢æœ‰å¿…ç‚¹ï¼Œä¹Ÿæœ‰é€‰ç‚¹ï¼Œç„¶åæ¯ä¸ªå•å“åˆæœ‰å¤§å°ä¹‹åˆ†</li><li>å¿…ç‚¹ï¼šæ±‰å ¡ï¼ˆhamburgerï¼‰ï¼Œè–¯æ¡ï¼ˆchipsï¼‰</li><li>é€‰ç‚¹ï¼šé¸¡è…¿ï¼ˆchickenï¼‰ï¼Œå¯ä¹ï¼ˆcolaï¼‰ï¼ŒæŠ«è¨ï¼ˆpizzaï¼‰</li></ul><p>æˆ‘ä»¬å¦‚ä½•æ„æˆè¿™ä¹ˆå¤šå¥—é¤å®ä¾‹å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬ä¸ä½¿ç”¨å»ºé€ è€…æ¨¡å¼ä¹Ÿèƒ½æ„å»ºä»£ç ï¼Œä½†æ˜¯å»ºé€ è€…æ¨¡å¼ä¼šè®©ä»£ç çœ‹ä¸Šå»æ›´è£…é€¼ï¼Œä»£ç åˆ°åæœŸæ›´ç»“æ„åŒ–æ›´å®¹æ˜“ç»´æŠ¤å’Œæ‹“å±•</p><p>é¦–å…ˆæ„å»ºè¿™ä¸ªå®ä½“ç±»`KFC</p><h2 id="å®ä½“ç±»KFC"><a href="#å®ä½“ç±»KFC" class="headerlink" title="å®ä½“ç±»KFC"></a>å®ä½“ç±»KFC</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å®ä½“ç±»`KFC</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">KFC</span> &#123;</span><br><span class="line">    <span class="comment">//å¥—é¤å¿…ç‚¹</span></span><br><span class="line">    <span class="keyword">private</span> String hamburger;</span><br><span class="line">    <span class="keyword">private</span> String chips;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¥—é¤é€‰ç‚¹</span></span><br><span class="line">    <span class="keyword">private</span> String chicken;</span><br><span class="line">    <span class="keyword">private</span> String cola;</span><br><span class="line">    <span class="keyword">private</span> String pizza;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="éå»ºé€ è€…æ¨¡å¼ä»£ç "><a href="#éå»ºé€ è€…æ¨¡å¼ä»£ç " class="headerlink" title="éå»ºé€ è€…æ¨¡å¼ä»£ç "></a>éå»ºé€ è€…æ¨¡å¼ä»£ç </h2><p>æˆ‘ä»¬çš„æƒ³æ³•æ˜¯ä¸æ˜¯æŠ˜å æ„é€ å‡½æ•°æ¥åˆ›å»ºå®ä¾‹ï¼Œä¸‹é¢æ¥å°è¯•ä¸€ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å®ä½“ç±»`KFC</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">KFC</span> &#123;</span><br><span class="line">    <span class="comment">//å¥—é¤å¿…ç‚¹</span></span><br><span class="line">    <span class="keyword">private</span> String hamburger;</span><br><span class="line">    <span class="keyword">private</span> String chips;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¥—é¤é€‰ç‚¹</span></span><br><span class="line">    <span class="keyword">private</span> String chicken;</span><br><span class="line">    <span class="keyword">private</span> String cola;</span><br><span class="line">    <span class="keyword">private</span> String pizza;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¿…ç‚¹å¥—é¤A</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">KFC</span><span class="params">(String hamburger, String chips)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>(hamburger, chips, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¥—é¤B</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">KFC</span><span class="params">(String hamburger, String chips, String chicken)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>(hamburger, chips, chicken, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¥—é¤C</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">KFC</span><span class="params">(String hamburger, String chips, String chicken, String cola)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>(hamburger, chips, chicken, cola, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//......è¿˜æœ‰å¥½å¤šç§ç»„åˆæ–¹å¼ï¼Œä½ ä¼šå‘ç°ä½¿ç”¨æŠ˜å æ„é€ å‡½æ•°çš„æ–¹æ³•ååˆ†å¤æ‚</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//å…¨é€‰</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">KFC</span><span class="params">(String hamburger, String chips, String chicken, String cola, String pizza)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.hamburger = hamburger;</span><br><span class="line">        <span class="built_in">this</span>.chips = chips;</span><br><span class="line">        <span class="built_in">this</span>.chicken = chicken;</span><br><span class="line">        <span class="built_in">this</span>.cola = cola;</span><br><span class="line">        <span class="built_in">this</span>.pizza = pizza;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¼šå‘ç°ä½¿ç”¨æŠ˜å æ„é€ å‡½æ•°çš„æ–¹å¼å¾ˆå¤æ‚ï¼Œå¾ˆæ¶å¿ƒï¼Œä»£ç çœ‹éƒ½ä¸æƒ³çœ‹</p><p>é‚£ä¹ˆæœ‰äººä¼šæƒ³ï¼Œæˆ‘å¯ä»¥ä½¿ç”¨<code>set</code>æ–¹æ³•æ¥åˆ›å»ºï¼Œæˆ‘åªè¦ä¸€ä¸ªå¿…ç‚¹æ„é€ å°±å¥½äº†ï¼Œé‚£ç»§ç»­æ¨¡æ‹Ÿå’¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å®ä½“ç±»`KFC</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">KFC</span> &#123;</span><br><span class="line">    <span class="comment">//å¥—é¤å¿…ç‚¹</span></span><br><span class="line">    <span class="keyword">private</span> String hamburger;</span><br><span class="line">    <span class="keyword">private</span> String chips;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¥—é¤é€‰ç‚¹</span></span><br><span class="line">    <span class="keyword">private</span> String chicken;</span><br><span class="line">    <span class="keyword">private</span> String cola;</span><br><span class="line">    <span class="keyword">private</span> String pizza;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¿…ç‚¹</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">KFC</span><span class="params">(String hamburger, String chips)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.hamburger = hamburger;</span><br><span class="line">        <span class="built_in">this</span>.chips = chips;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//setæ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setChicken</span><span class="params">(String chicken)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.chicken = chicken;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCola</span><span class="params">(String cola)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.cola = cola;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPizza</span><span class="params">(String pizza)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.pizza = pizza;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å®ä¾‹åŒ–å¯¹è±¡ï¼Œä½ ä¼šå‘ç°è¿™ç§æ–¹å¼å°±å‹å¥½å¾ˆå¤š</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">KFC</span> <span class="variable">kfc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">KFC</span>(<span class="string">&quot;å¤§æ±‰å ¡&quot;</span>, <span class="string">&quot;å¤§è–¯æ¡&quot;</span>);</span><br><span class="line">        <span class="comment">//åŠ å°ä»½å¯ä¹</span></span><br><span class="line">        kfc.setCola(<span class="string">&quot;å°å¯ä¹&quot;</span>);</span><br><span class="line">        <span class="comment">//åŠ ä¸ªé¸¡è…¿</span></span><br><span class="line">        kfc.setChicken(<span class="string">&quot;å¤§é¸¡è…¿&quot;</span>);</span><br><span class="line">        System.out.println(kfc);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½ ä¼šå‘ç°ä½¿ç”¨<code>set</code>æ–¹å¼å°±å‹å¥½äº†å¾ˆå¤š</p><p>è¿™ä¸ªè™½ç„¶å‹å¥½äº†å¾ˆå¤šï¼Œä½†æ˜¯ä¹Ÿæœ‰ç‚¹å°æ¯›ç—…ï¼Œå°±æ˜¯ä½ <strong>setå¤ªéšæ„äº†ï¼Œæˆ‘å¯èƒ½è¿™ä¸ªå¥—é¤é‡Œé¢æ²¡æœ‰è¿™ä¸ªå•å“ï¼Œè€Œä½¿ç”¨setçš„äººå´ä¸çŸ¥é“</strong>ï¼Œé€ æˆé”™è¯¯çš„å¥—é¤å‡ºç°ï¼ã€‚</p><p>ä¸ºäº†è§£å†³ä¸Šé¢çš„ä¸¤ç§é—®é¢˜ï¼šä¸€ç§è®¾è®¡æ¨¡å¼è§£å†³ä¸€ç±»é—®é¢˜ï¼Œæ‰€ä»¥<strong>å»ºé€ è€…æ¨¡å¼</strong>å°±å‡ºç°äº†</p><h2 id="å»ºé€ è€…æ¨¡å¼ä»£ç "><a href="#å»ºé€ è€…æ¨¡å¼ä»£ç " class="headerlink" title="å»ºé€ è€…æ¨¡å¼ä»£ç "></a>å»ºé€ è€…æ¨¡å¼ä»£ç </h2><h3 id="äº§å“"><a href="#äº§å“" class="headerlink" title="äº§å“"></a>äº§å“</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * KFCäº§å“</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">KFC</span> &#123;</span><br><span class="line">    <span class="comment">//å¥—é¤å¿…ç‚¹</span></span><br><span class="line">    <span class="keyword">private</span> String hamburger;</span><br><span class="line">    <span class="keyword">private</span> String chips;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¥—é¤é€‰ç‚¹</span></span><br><span class="line">    <span class="keyword">private</span> String chicken;</span><br><span class="line">    <span class="keyword">private</span> String cola;</span><br><span class="line">    <span class="keyword">private</span> String pizza;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¿…ç‚¹</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">KFC</span><span class="params">(String hamburger, String chips)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.hamburger = hamburger;</span><br><span class="line">        <span class="built_in">this</span>.chips = chips;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//setæ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setChicken</span><span class="params">(String chicken)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.chicken = chicken;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCola</span><span class="params">(String cola)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.cola = cola;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPizza</span><span class="params">(String pizza)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.pizza = pizza;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;KFC&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;hamburger=&#x27;&quot;</span> + hamburger + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, chips=&#x27;&quot;</span> + chips + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, chicken=&#x27;&quot;</span> + chicken + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, cola=&#x27;&quot;</span> + cola + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, pizza=&#x27;&quot;</span> + pizza + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Builder"><a href="#Builder" class="headerlink" title="Builder"></a>Builder</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œè¡¨æ˜éœ€è¦å»ºé€ ä»€ä¹ˆï¼Œå¾—åˆ°ä»€ä¹ˆ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Builder</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setChicken</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setCola</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setPizza</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    KFC <span class="title function_">getKFC</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¥—é¤A"><a href="#å¥—é¤A" class="headerlink" title="å¥—é¤A"></a>å¥—é¤A</h3><p>æ­¤æ—¶åº”è¯¥æ³¨æ„ï¼Œè¿™ä¸ªæ—¶å€™è¿˜æ²¡æœ‰ç”Ÿäº§å¥—é¤ï¼Œåªæ˜¯å®šä¹‰å¥—é¤</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¥—é¤A</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConcreteBuilder1</span> <span class="keyword">implements</span> <span class="title class_">Builder</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> KFC kfc;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è¿™ä¸€æ­¥éå¸¸é‡è¦</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ConcreteBuilder1</span><span class="params">(String hamburger, String chips)</span> &#123;</span><br><span class="line">        kfc = <span class="keyword">new</span> <span class="title class_">KFC</span>(hamburger, chips);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setChicken</span><span class="params">()</span> &#123;</span><br><span class="line">        kfc.setChicken(<span class="string">&quot;å¤§é¸¡è…¿&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCola</span><span class="params">()</span> &#123;</span><br><span class="line">        kfc.setCola(<span class="literal">null</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;å¥—é¤Aé‡Œé¢æ²¡æœ‰å¯ä¹&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPizza</span><span class="params">()</span> &#123;</span><br><span class="line">        kfc.setPizza(<span class="literal">null</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;å¥—é¤Aé‡Œé¢æ²¡æœ‰æŠ«è¨&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> KFC <span class="title function_">getKFC</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> kfc;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¥—é¤B"><a href="#å¥—é¤B" class="headerlink" title="å¥—é¤B"></a>å¥—é¤B</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¥—é¤B</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConcreteBuilder2</span> <span class="keyword">implements</span> <span class="title class_">Builder</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> KFC kfc;</span><br><span class="line">    <span class="comment">//è¿™ä¸€æ­¥éå¸¸é‡è¦</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ConcreteBuilder2</span><span class="params">(String hamburger,String chips)</span>&#123;</span><br><span class="line">        kfc = <span class="keyword">new</span> <span class="title class_">KFC</span>(hamburger,chips);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setChicken</span><span class="params">()</span> &#123;</span><br><span class="line">        kfc.setChicken(<span class="string">&quot;å°é¸¡è…¿&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCola</span><span class="params">()</span> &#123;</span><br><span class="line">        kfc.setCola(<span class="string">&quot;å°å¯ä¹&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPizza</span><span class="params">()</span> &#123;</span><br><span class="line">        kfc.setPizza(<span class="string">&quot;å°æŠ«è¨&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> KFC <span class="title function_">getKFC</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> kfc;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Director"><a href="#Director" class="headerlink" title="Director"></a>Director</h3><blockquote><p><strong>çœŸæ­£çš„æ‰§è¡Œè€…ï¼Œè¿™é‡ŒæŠŠä»–å½“ä½œæœåŠ¡å‘˜ï¼Œæ­¤æ—¶ä½ åƒæœåŠ¡å‘˜ç‚¹é¤</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œè¡¨æ˜éœ€è¦å»ºé€ ä»€ä¹ˆï¼Œå¾—åˆ°ä»€ä¹ˆ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Builder</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setChicken</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setCola</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setPizza</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    KFC <span class="title function_">getKFC</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BuilderTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//å¥—é¤A</span></span><br><span class="line">        System.out.println(<span class="string">&quot;======å¥—é¤A======&quot;</span>);</span><br><span class="line">        <span class="type">Builder</span> <span class="variable">concreteBuilder1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConcreteBuilder1</span>(<span class="string">&quot;å¤§æ±‰å ¡&quot;</span>, <span class="string">&quot;å°è–¯æ¡&quot;</span>);</span><br><span class="line">        <span class="type">KFC</span> <span class="variable">kfc1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Director</span>().build(concreteBuilder1);</span><br><span class="line">        System.out.println(kfc1);</span><br><span class="line">        <span class="comment">//å¥—é¤B</span></span><br><span class="line">        System.out.println(<span class="string">&quot;======å¥—é¤B======&quot;</span>);</span><br><span class="line">        <span class="type">Builder</span> <span class="variable">concreteBuilder2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConcreteBuilder2</span>(<span class="string">&quot;å°æ±‰å ¡&quot;</span>, <span class="string">&quot;å°è–¯æ¡&quot;</span>);</span><br><span class="line">        <span class="type">KFC</span> <span class="variable">kfc2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Director</span>().build(concreteBuilder2);</span><br><span class="line">        System.out.println(kfc2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://www.naste.top:9000/images/image-20230608210618559.png" alt="image-20230608210618559"></p><p>åˆ°äº†è¿™é‡Œä½ è¿˜æ˜¯ä¼šè§‰å¾—æœ‰ç‚¹éº»çƒ¦ï¼Œä½ ä¼šå‘ç°ï¼Œå•å“å¯æœ‰å¯æ— çš„é€‰æ‹©ä¸Šé¢ä½ ååˆ†çš„è¢«åŠ¨ï¼Œä»£ç çœ‹ä¸Šå»ä¹Ÿå¾ˆæ€ªï¼Œå¦‚æœä½ ä¸‹æ¬¡æƒ³å…¨éƒ¨å•å“å…ˆé€‰ä¸Šï¼Œå†å»é€‰å¥—é¤çš„æ—¶å€™ï¼Œä½ åˆè¦æ–°å»ºä¸€ä¸ªæ–°çš„æŒ‡å¯¼è€…ã€‚</p><p>æˆ‘è§‰å¾—æ™®é€šçš„å»ºé€ è€…æ¨¡å¼ä¸é€‚åˆå‚æ•°çš„å¯æœ‰å¯æ— çš„é€‰æ‹©ï¼Œ<strong>æ™®é€šçš„å»ºé€ è€…æ¨¡å¼æ›´ä¾§é‡è°ƒæ§æ¬¡åº</strong>ï¼Œåœ¨æœ‰äº›æƒ…å†µä¸‹éœ€è¦ç®€åŒ–ç³»ç»Ÿç»“æ„</p><h2 id="ç®€åŒ–ç‰ˆçš„å»ºé€ è€…æ¨¡å¼"><a href="#ç®€åŒ–ç‰ˆçš„å»ºé€ è€…æ¨¡å¼" class="headerlink" title="ç®€åŒ–ç‰ˆçš„å»ºé€ è€…æ¨¡å¼"></a>ç®€åŒ–ç‰ˆçš„å»ºé€ è€…æ¨¡å¼</h2><h3 id="é‡‡ç”¨é“¾å¼ç¼–ç¨‹çš„æ–¹å¼"><a href="#é‡‡ç”¨é“¾å¼ç¼–ç¨‹çš„æ–¹å¼" class="headerlink" title="é‡‡ç”¨é“¾å¼ç¼–ç¨‹çš„æ–¹å¼"></a>é‡‡ç”¨é“¾å¼ç¼–ç¨‹çš„æ–¹å¼</h3><p>è¿™ç§æ¨¡å¼æ›´åŠ çµæ´»ï¼Œæ›´åŠ ç¬¦åˆå®šä¹‰</p><p>æ—¢ç„¶Directoræ˜¯å˜åŒ–çš„ï¼Œå¹¶ä¸”å…¶å®åœ¨ç”Ÿæ´»ä¸­æˆ‘ä»¬è‡ªå·±æœ¬èº«å°±æ˜¯Director,æ‰€ä»¥è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥<strong>æŠŠDirectorè¿™ä¸ªè§’è‰²å»æ‰</strong>ï¼Œå› ä¸ºæˆ‘ä»¬è‡ªèº«å°±æ˜¯æŒ‡å¯¼è€…</p><h3 id="äº§å“-1"><a href="#äº§å“-1" class="headerlink" title="äº§å“"></a>äº§å“</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å®ä½“ç±»`KFC</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">KFC</span> &#123;</span><br><span class="line">    <span class="comment">//å¥—é¤å¿…ç‚¹</span></span><br><span class="line">    <span class="keyword">private</span> String hamburger;</span><br><span class="line">    <span class="keyword">private</span> String chips;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¥—é¤é€‰ç‚¹</span></span><br><span class="line">    <span class="keyword">private</span> String chicken;</span><br><span class="line">    <span class="keyword">private</span> String cola;</span><br><span class="line">    <span class="keyword">private</span> String pizza;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">KFC</span><span class="params">(String hamburger,String chips)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.hamburger = hamburger;</span><br><span class="line">        <span class="built_in">this</span>.hamburger = chips;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setChicken</span><span class="params">(String chicken)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.chicken = chicken;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCola</span><span class="params">(String cola)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.cola = cola;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPizza</span><span class="params">(String pizza)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.pizza = pizza;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;KFC&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;hamburger=&#x27;&quot;</span> + hamburger + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, chips=&#x27;&quot;</span> + chips + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, chicken=&#x27;&quot;</span> + chicken + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, cola=&#x27;&quot;</span> + cola + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, pizza=&#x27;&quot;</span> + pizza + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æŠ½è±¡å»ºé€ è€…ï¼ˆBuilderï¼‰"><a href="#æŠ½è±¡å»ºé€ è€…ï¼ˆBuilderï¼‰" class="headerlink" title="æŠ½è±¡å»ºé€ è€…ï¼ˆBuilderï¼‰"></a>æŠ½è±¡å»ºé€ è€…ï¼ˆBuilderï¼‰</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œè¡¨æ˜éœ€è¦å»ºé€ ä»€ä¹ˆï¼Œå¾—åˆ°ä»€ä¹ˆ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Builder</span> &#123;</span><br><span class="line">    <span class="keyword">abstract</span> Builder <span class="title function_">setChicken</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">abstract</span> Builder <span class="title function_">setCola</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">abstract</span> Builder <span class="title function_">setPizza</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">abstract</span> KFC <span class="title function_">getKFC</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å…·ä½“å»ºé€ è€…-ConcreteBuilder"><a href="#å…·ä½“å»ºé€ è€…-ConcreteBuilder" class="headerlink" title="å…·ä½“å»ºé€ è€…(ConcreteBuilder)"></a>å…·ä½“å»ºé€ è€…(ConcreteBuilder)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConcreteBuilder</span> <span class="keyword">extends</span> <span class="title class_">Builder</span> &#123;</span><br><span class="line">    KFC kfc;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ConcreteBuilder</span><span class="params">(String hamburger,String chips)</span>&#123;</span><br><span class="line">        kfc = <span class="keyword">new</span> <span class="title class_">KFC</span>(hamburger,chips);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    Builder <span class="title function_">setChicken</span><span class="params">()</span> &#123;</span><br><span class="line">        kfc.setChicken(<span class="string">&quot;é¸¡è…¿&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    Builder <span class="title function_">setCola</span><span class="params">()</span> &#123;</span><br><span class="line">        kfc.setCola(<span class="string">&quot;å¯ä¹&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    Builder <span class="title function_">setPizza</span><span class="params">()</span> &#123;</span><br><span class="line">        kfc.setPizza(<span class="string">&quot;æŠ«è¨&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    KFC <span class="title function_">getKFC</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> kfc;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æµ‹è¯•-1"><a href="#æµ‹è¯•-1" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BuilderTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">KFC</span> <span class="variable">kfc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConcreteBuilder</span>(<span class="string">&quot;æ±‰å ¡&quot;</span>, <span class="string">&quot;è–¯æ¡&quot;</span>).setChicken().setCola().getKFC();</span><br><span class="line">        System.out.println(kfc);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://www.naste.top:9000/images/image-20230608211039517.png" alt="image-20230608211039517"></p><p>å¦‚æœä¸éœ€è¦æŠ½è±¡å»ºé€ è€…çš„è§’è‰²æ¥è§„å®šç”Ÿäº§å†…å®¹ï¼Œé‚£ä¹ˆä»£ç åˆ°è¿™é‡Œå…¶å®è¿˜æœ‰è¿›ä¸€æ­¥çš„ç®€åŒ–ç©ºé—´ã€‚</p><h2 id="ä½¿ç”¨é™æ€å†…éƒ¨ç±»çš„æ–¹å¼"><a href="#ä½¿ç”¨é™æ€å†…éƒ¨ç±»çš„æ–¹å¼" class="headerlink" title="ä½¿ç”¨é™æ€å†…éƒ¨ç±»çš„æ–¹å¼"></a>ä½¿ç”¨é™æ€å†…éƒ¨ç±»çš„æ–¹å¼</h2><blockquote><p><strong>è¿›ä¸€æ­¥ç®€åŒ–</strong></p></blockquote><h3 id="äº§å“-2"><a href="#äº§å“-2" class="headerlink" title="äº§å“"></a>äº§å“</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaofei.builder;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å®ä½“ç±»`KFC</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">KFC</span> &#123;</span><br><span class="line">    <span class="comment">//å¥—é¤å¿…ç‚¹</span></span><br><span class="line">    <span class="keyword">private</span> String hamburger;</span><br><span class="line">    <span class="keyword">private</span> String chips;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¥—é¤é€‰ç‚¹</span></span><br><span class="line">    <span class="keyword">private</span> String chicken;</span><br><span class="line">    <span class="keyword">private</span> String cola;</span><br><span class="line">    <span class="keyword">private</span> String pizza;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä¸€å®šè¦æœ‰ä¸€ä¸ªå¸¦æœ‰Builderå‚æ•°çš„å»ºé€ è€…</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">KFC</span><span class="params">(Builder builder)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.hamburger = builder.hamburger;</span><br><span class="line">        <span class="built_in">this</span>.chips = builder.chips;</span><br><span class="line">        <span class="built_in">this</span>.chicken = builder.chicken;</span><br><span class="line">        <span class="built_in">this</span>.cola = builder.cola;</span><br><span class="line">        <span class="built_in">this</span>.pizza = builder.pizza;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ³¨æ„å¿…é¡»ä¸ºé™æ€å†…éƒ¨ç±»</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Builder</span> &#123;</span><br><span class="line">        <span class="comment">//å¥—é¤å¿…ç‚¹</span></span><br><span class="line">        <span class="keyword">private</span> String hamburger;</span><br><span class="line">        <span class="keyword">private</span> String chips;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¥—é¤é€‰ç‚¹</span></span><br><span class="line">        <span class="keyword">private</span> String chicken;</span><br><span class="line">        <span class="keyword">private</span> String cola;</span><br><span class="line">        <span class="keyword">private</span> String pizza;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Builder</span><span class="params">(String hamburger, String chips)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.hamburger = hamburger;</span><br><span class="line">            <span class="built_in">this</span>.chips = chips;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Builder <span class="title function_">setChicken</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.chicken = <span class="string">&quot;å°é¸¡è…¿&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Builder <span class="title function_">setCola</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.cola = <span class="string">&quot;å°å¯ä¹&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Builder <span class="title function_">setPizza</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.pizza = <span class="string">&quot;å°æŠ«è¨&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç”Ÿæˆä¸€ä¸ªäº§å“</span></span><br><span class="line">        <span class="keyword">public</span> KFC <span class="title function_">getKFC</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">KFC</span>(<span class="built_in">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;KFC&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;hamburger=&#x27;&quot;</span> + hamburger + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, chips=&#x27;&quot;</span> + chips + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, chicken=&#x27;&quot;</span> + chicken + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, cola=&#x27;&quot;</span> + cola + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, pizza=&#x27;&quot;</span> + pizza + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æµ‹è¯•-2"><a href="#æµ‹è¯•-2" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BuilderTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">KFC</span> <span class="variable">kfc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">KFC</span>.Builder(<span class="string">&quot;å¤§æ±‰å ¡&quot;</span>, <span class="string">&quot;å°è–¯æ¡&quot;</span>).setChicken().setCola().getKFC();</span><br><span class="line">        System.out.println(kfc);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://www.naste.top:9000/images/image-20230608211250487.png" alt="image-20230608211250487"></p><h1 id="å»ºé€ è€…æ¨¡å¼å’ŒæŠ½è±¡å·¥å‚æ¨¡å¼çš„åŒºåˆ«"><a href="#å»ºé€ è€…æ¨¡å¼å’ŒæŠ½è±¡å·¥å‚æ¨¡å¼çš„åŒºåˆ«" class="headerlink" title="å»ºé€ è€…æ¨¡å¼å’ŒæŠ½è±¡å·¥å‚æ¨¡å¼çš„åŒºåˆ«"></a>å»ºé€ è€…æ¨¡å¼å’ŒæŠ½è±¡å·¥å‚æ¨¡å¼çš„åŒºåˆ«</h1><p>é€šè¿‡ä¸Šé¢çš„ä»£ç ï¼Œä½ å‘ç°æ™®é€šçš„å»ºé€ è€…æ¨¡å¼å’ŒæŠ½è±¡å·¥å‚æ¨¡å¼çœŸçš„å¾ˆåƒï¼Œåœ¨å»ºé€ è€…æ¨¡å¼ä¸­çš„builderè§’è‰²å¾ˆåƒè¶…çº§å·¥å‚ï¼Œç„¶åcontracterBuilderå¾ˆåƒå…·ä½“çš„å·¥å‚ï¼Œéƒ½æ˜¯è§„å®šäº†å»ºé€ çš„å†…å®¹</p><p>é‚£ä¹ˆå®ƒä»¬ä¹‹é—´ æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢</p><ul><li>å»ºé€ è€…æ¨¡å¼æœ‰æŒ‡å¯¼è€…è¿™ä¸ªè§’è‰²ï¼Œç›´æ¥è¿”å›ä¸€ä¸ªç»„è£…å¥½çš„äº§å“ï¼Œè€ŒæŠ½è±¡å·¥å‚æ¨¡å¼è¿”å›ä¸€ç³»åˆ—ç›¸å…³çš„äº§å“ï¼Œè¿™äº›äº§å“ä½äºä¸åŒçš„äº§å“ç­‰çº§ç»“æ„ï¼Œæ„æˆäº†ä¸€ä¸ªäº§å“æ—</li><li>å»ºé€ è€…æ¨¡å¼æ›´é€‚åˆå¤æ‚çš„äº§å“æ„å»º</li><li>å¯ä»¥å°†æŠ½è±¡å·¥å‚æ¨¡å¼ç†è§£æˆæ±½è½¦é›¶ä»¶ç”Ÿäº§å·¥å‚ï¼Œè€Œå»ºé€ è€…æ¨¡å¼çœ‹å‡ºç»„è£…å·¥å‚</li></ul><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>å­¦ä¹ ä¸€ç±»æŠ€å·§æ˜¯ä¸ºäº†è§£å†³ä¸€ç±»é—®é¢˜ï¼Œå­¦ä¹ è®¾è®¡æ¨¡å¼ä¸»è¦æ˜¯ä¸ºäº†ç†è§£å®ƒçš„æ€æƒ³ï¼Œå°†æ¥é‡åˆ°ä»£ç çš„ç¼–å†™ï¼Œä½¿ç”¨è¿™ç§æ¨¡å¼ä¼šæ›´åŠ çš„æ–¹å¼ï¼Œè€Œæ²¡æœ‰å¿…è¦åˆ»æ„çš„å»ä½¿ç”¨ï¼Œä½†æ˜¯éœ€è¦åˆ»æ„çš„å»ç»ƒä¹ ï¼Œå½¢æˆè¿™ç§æ€æƒ³</p><p>ä¼˜ç‚¹ï¼š</p><ul><li>å¤æ‚äº§å“çš„åˆ›å»ºæ­¥éª¤åˆ†è§£åœ¨ä¸åŒçš„æ–¹æ³•ä¸­ï¼Œè¿™äº›æ–¹æ³•å¯ä»¥è°ƒç”¨é¡ºåºä¸åŒï¼Œç»“æœä¸åŒï¼Œåˆ›å»ºç»“æœå¾ˆæ¸…æ™°</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>å¦‚æœäº§å“çš„å†…éƒ¨å˜åŒ–å¤æ‚ï¼Œå¯èƒ½ä¼šå¯¼è‡´éœ€è¦å®šä¹‰å¾ˆå¤šå…·ä½“å»ºé€ è€…æ¥å®ç°è¿™ç§å˜åŒ–ã€‚</li></ul>]]></content>
    
    
    <summary type="html">è®¾è®¡æ¨¡å¼-å»ºé€ è€…æ¨¡å¼</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>è®¾è®¡æ¨¡å¼-å•ä¾‹æ¨¡å¼</title>
    <link href="https://www.naste.top:1024/posts/1776793711.html"/>
    <id>https://www.naste.top:1024/posts/1776793711.html</id>
    <published>2023-06-07T06:24:15.000Z</published>
    <updated>2023-06-07T07:15:00.427Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h1><p>[TOC]</p><h1 id="ä»€ä¹ˆæ˜¯å•ä¾‹æ¨¡å¼"><a href="#ä»€ä¹ˆæ˜¯å•ä¾‹æ¨¡å¼" class="headerlink" title="ä»€ä¹ˆæ˜¯å•ä¾‹æ¨¡å¼"></a>ä»€ä¹ˆæ˜¯å•ä¾‹æ¨¡å¼</h1><p>å•ä¾‹è®¾è®¡æ¨¡å¼(Singleton Pattern)æ˜¯ä¸€ç§å¸¸ç”¨çš„è½¯ä»¶è®¾è®¡æ¨¡å¼ï¼Œå®ƒä¿è¯ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›ä¸€ä¸ªå…¨å±€è®¿é—®ç‚¹ã€‚è¿™ç§æ¨¡å¼åœ¨éœ€è¦ç¡®ä¿æŸä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹çš„æƒ…å†µä¸‹éå¸¸æœ‰ç”¨ï¼Œå¸¸ç”¨äºç®¡ç†å…±äº«èµ„æºæˆ–é™åˆ¶å¯¹è±¡çš„åˆ›å»ºã€‚</p><h1 id="å•ä¾‹æ¨¡å¼åº”ç”¨åœºæ™¯"><a href="#å•ä¾‹æ¨¡å¼åº”ç”¨åœºæ™¯" class="headerlink" title="å•ä¾‹æ¨¡å¼åº”ç”¨åœºæ™¯"></a>å•ä¾‹æ¨¡å¼åº”ç”¨åœºæ™¯</h1><ol><li>é…ç½®ç®¡ç†ï¼šåœ¨åº”ç”¨ç¨‹åºä¸­ï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨ä¸€äº›å…¨å±€çš„é…ç½®ä¿¡æ¯ï¼Œä¾‹å¦‚æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²ã€æ—¥å¿—çº§åˆ«ç­‰ã€‚è¿™äº›é…ç½®ä¿¡æ¯é€šå¸¸åªéœ€è¦ä¸€ä»½ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨å•ä¾‹æ¨¡å¼æ¥å®ç°ã€‚é€šè¿‡å•ä¾‹æ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶åˆ›å»ºä¸€ä¸ªå”¯ä¸€çš„å®ä¾‹ï¼Œå¹¶åœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­å…±äº«è¿™ä¸ªå®ä¾‹ã€‚è¿™æ ·å¯ä»¥é¿å…å¤šä¸ªçº¿ç¨‹æˆ–è¿›ç¨‹åŒæ—¶è®¿é—®å’Œä¿®æ”¹é…ç½®ä¿¡æ¯ï¼Œä»è€Œä¿è¯äº†é…ç½®ä¿¡æ¯çš„ä¸€è‡´æ€§å’Œå¯é æ€§ã€‚</li><li>æ—¥å¿—è®°å½•ï¼šåœ¨åº”ç”¨ç¨‹åºä¸­ï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨ä¸€ä¸ªå…¨å±€çš„æ—¥å¿—è®°å½•å™¨ï¼Œç”¨äºè®°å½•åº”ç”¨ç¨‹åºçš„è¿è¡Œæƒ…å†µå’Œé”™è¯¯ä¿¡æ¯ã€‚åŒæ ·åœ°ï¼Œåªéœ€è¦ä¸€ä»½æ—¥å¿—è®°å½•å™¨å³å¯ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨å•ä¾‹æ¨¡å¼æ¥å®ç°ã€‚é€šè¿‡å•ä¾‹æ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶åˆ›å»ºä¸€ä¸ªå”¯ä¸€çš„å®ä¾‹ï¼Œå¹¶åœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­å…±äº«è¿™ä¸ªå®ä¾‹ã€‚è¿™æ ·å¯ä»¥é¿å…å¤šä¸ªçº¿ç¨‹æˆ–è¿›ç¨‹åŒæ—¶è®¿é—®å’Œä¿®æ”¹æ—¥å¿—è®°å½•å™¨ï¼Œä»è€Œä¿è¯äº†æ—¥å¿—è®°å½•çš„ä¸€è‡´æ€§å’Œå¯é æ€§ã€‚</li><li>ç¼“å­˜ç®¡ç†ï¼šåœ¨åº”ç”¨ç¨‹åºä¸­ï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨ä¸€ä¸ªå…¨å±€çš„ç¼“å­˜ç³»ç»Ÿï¼Œç”¨äºç¼“å­˜ä¸€äº›æ•°æ®ä»¥æé«˜åº”ç”¨ç¨‹åºçš„æ€§èƒ½ã€‚åŒæ ·åœ°ï¼Œåªéœ€è¦ä¸€ä»½ç¼“å­˜ç³»ç»Ÿå³å¯ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨å•ä¾‹æ¨¡å¼æ¥å®ç°ã€‚é€šè¿‡å•ä¾‹æ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶åˆ›å»ºä¸€ä¸ªå”¯ä¸€çš„å®ä¾‹ï¼Œå¹¶åœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­å…±äº«è¿™ä¸ªå®ä¾‹ã€‚è¿™æ ·å¯ä»¥é¿å…å¤šä¸ªçº¿ç¨‹æˆ–è¿›ç¨‹åŒæ—¶è®¿é—®å’Œä¿®æ”¹ç¼“å­˜ç³»ç»Ÿï¼Œä»è€Œä¿è¯äº†ç¼“å­˜ç³»ç»Ÿçš„ä¸€è‡´æ€§å’Œå¯é æ€§ã€‚</li><li>èµ„æºç®¡ç†ï¼šåœ¨åº”ç”¨ç¨‹åºä¸­ï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨ä¸€äº›å…¨å±€çš„èµ„æºï¼Œä¾‹å¦‚æ–‡ä»¶å¥æŸ„ã€ç½‘ç»œè¿æ¥ç­‰ã€‚è¿™äº›èµ„æºé€šå¸¸åªéœ€è¦ä¸€ä»½ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨å•ä¾‹æ¨¡å¼æ¥å®ç°ã€‚é€šè¿‡å•ä¾‹æ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶åˆ›å»ºä¸€ä¸ªå”¯ä¸€çš„å®ä¾‹ï¼Œå¹¶åœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­å…±äº«è¿™ä¸ªå®ä¾‹ã€‚è¿™æ ·å¯ä»¥é¿å…å¤šä¸ªçº¿ç¨‹æˆ–è¿›ç¨‹åŒæ—¶è®¿é—®å’Œä¿®æ”¹èµ„æºï¼Œä»è€Œä¿è¯äº†èµ„æºçš„ä¸€è‡´æ€§å’Œå¯é æ€§ã€‚</li></ol><h1 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h1><h2 id="æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼ï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼‰"><a href="#æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼ï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼‰" class="headerlink" title="æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼ï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼‰"></a>æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼ï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼‰</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼ï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼‰</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LazySingleton</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ›å»ºä¸€ä¸ªç§æœ‰é™æ€å˜é‡instance,ç”¨äºå­˜å‚¨å•ä¾‹å¯¹è±¡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> LazySingleton instance;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†æ„é€ æ–¹æ³•è®¾ä¸ºç§æœ‰ï¼Œé˜²æ­¢å¤–éƒ¨åˆ›å»ºæ–°çš„å®ä¾‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">LazySingleton</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–å•ä¾‹å®ä¾‹çš„æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> LazySingleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœå®ä¾‹è¿˜æœªåˆ›å»ºï¼Œåˆ›å»ºä¸€ä¸ªæ–°å®ä¾‹è¿”å›</span></span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">            instance = <span class="keyword">new</span> <span class="title class_">LazySingleton</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰"><a href="#æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰" class="headerlink" title="æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰"></a>æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SafeLazySingleton</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ›å»ºä¸€ä¸ªç§æœ‰é™æ€å˜é‡instance,ç”¨äºå­˜å‚¨å•ä¾‹å¯¹è±¡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SafeLazySingleton instance;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†æ„é€ æ–¹æ³•è®¾ä¸ºç§æœ‰ï¼Œé˜²æ­¢å¤–éƒ¨åˆ›å»ºæ–°çš„å®ä¾‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">SafeLazySingleton</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–å•ä¾‹å®ä¾‹çš„æ–¹æ³•ï¼Œä½¿ç”¨ synchronized ä¿®é¥°ä»¥ä¿è¯çº¿ç¨‹å®‰å…¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> SafeLazySingleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœå®ä¾‹è¿˜æœªåˆ›å»ºï¼Œåˆ›å»ºä¸€ä¸ªæ–°å®ä¾‹è¿”å›</span></span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">            instance = <span class="keyword">new</span> <span class="title class_">SafeLazySingleton</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é¥¿æ±‰å¼å•ä¾‹æ¨¡å¼"><a href="#é¥¿æ±‰å¼å•ä¾‹æ¨¡å¼" class="headerlink" title="é¥¿æ±‰å¼å•ä¾‹æ¨¡å¼"></a>é¥¿æ±‰å¼å•ä¾‹æ¨¡å¼</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é¥¿æ±‰å¼å•ä¾‹æ¨¡å¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HungrySingleton</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç±»åŠ è½½æ—¶å°±åˆ›å»ºå•ä¾‹å®ä¾‹ï¼Œä½¿ç”¨ final ä¿®é¥°ä»¥ä¿è¯å®ä¾‹å”¯ä¸€æ€§</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">HungrySingleton</span> <span class="variable">instance</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HungrySingleton</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†æ„é€ æ–¹æ³•è®¾ä¸ºç§æœ‰ï¼Œé˜²æ­¢å¤–éƒ¨åˆ›å»ºæ–°çš„å®ä¾‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">HungrySingleton</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–å•ä¾‹å®ä¾‹çš„æ–¹æ³•ï¼Œç›´æ¥è¿”å›é¢„å…ˆåˆ›å»ºçš„å®ä¾‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> HungrySingleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åŒé‡æ£€æŸ¥é”å•ä¾‹æ¨¡å¼"><a href="#åŒé‡æ£€æŸ¥é”å•ä¾‹æ¨¡å¼" class="headerlink" title="åŒé‡æ£€æŸ¥é”å•ä¾‹æ¨¡å¼"></a>åŒé‡æ£€æŸ¥é”å•ä¾‹æ¨¡å¼</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åŒé‡æ£€æŸ¥é”å•ä¾‹æ¨¡å¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DoubleCheckSingleton</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ£€æŸ¥å®ä¾‹æ˜¯å¦å·²åˆ›å»ºçš„ volatile å˜é‡ï¼Œå¯è§æ€§ä¿è¯çº¿ç¨‹å®‰å…¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> DoubleCheckSingleton instance;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†æ„é€ æ–¹æ³•è®¾ä¸ºç§æœ‰ï¼Œé˜²æ­¢å¤–éƒ¨åˆ›å»ºæ–°çš„å®ä¾‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">DoubleCheckSingleton</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–å•ä¾‹å®ä¾‹çš„æ–¹æ³•ï¼Œä½¿ç”¨åŒé‡æ£€æŸ¥é”ä¿è¯çº¿ç¨‹å®‰å…¨å’Œæ€§èƒ½</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> DoubleCheckSingleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (DoubleCheckSingleton.class) &#123;</span><br><span class="line">                <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="comment">// å¦‚æœå®ä¾‹è¿˜æœªåˆ›å»ºï¼Œåˆ›å»ºä¸€ä¸ªæ–°å®ä¾‹è¿”å›</span></span><br><span class="line">                    instance = <span class="keyword">new</span> <span class="title class_">DoubleCheckSingleton</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é™æ€å†…éƒ¨ç±»å•ä¾‹æ¨¡å¼"><a href="#é™æ€å†…éƒ¨ç±»å•ä¾‹æ¨¡å¼" class="headerlink" title="é™æ€å†…éƒ¨ç±»å•ä¾‹æ¨¡å¼"></a>é™æ€å†…éƒ¨ç±»å•ä¾‹æ¨¡å¼</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é™æ€å†…éƒ¨ç±»å•ä¾‹æ¨¡å¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StaticInnerClassSingleton</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç§æœ‰æ„é€ å‡½æ•°ï¼Œé¿å…ç±»åœ¨å¤–éƒ¨è¢«å®ä¾‹åŒ–</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">StaticInnerClassSingleton</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é™æ€å†…éƒ¨ç±»æŒæœ‰å•ä¾‹å®ä¾‹ï¼Œç±»åŠ è½½æ—¶ä¸ä¼šè¿›è¡Œåˆå§‹åŒ–ã€‚</span></span><br><span class="line"><span class="comment">     * ç›´åˆ°ç¬¬ä¸€æ¬¡è·å–å®ä¾‹æ—¶æ‰åˆ›å»ºï¼Œå¹¶ç¡®ä¿å®ä¾‹åªè¢«åˆå§‹åŒ–ä¸€æ¬¡ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">StaticInnerClassSingleton</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StaticInnerClassSingleton</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿”å›å”¯ä¸€å®ä¾‹çš„æ–¹æ³•ï¼Œä½¿ç”¨é™æ€å†…éƒ¨ç±»ä¸­çš„INSTANCEè¿›è¡Œå®ä¾‹çš„è·å–ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> StaticInnerClassSingleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Singleton.INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æšä¸¾å•ä¾‹æ¨¡å¼"><a href="#æšä¸¾å•ä¾‹æ¨¡å¼" class="headerlink" title="æšä¸¾å•ä¾‹æ¨¡å¼"></a>æšä¸¾å•ä¾‹æ¨¡å¼</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æšä¸¾å•ä¾‹æ¨¡å¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">EnumSingleton</span> &#123;</span><br><span class="line">    INSTANCE;</span><br><span class="line">    <span class="type">int</span> value;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è‡ªå®šä¹‰æ„é€ å‡½æ•°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">EnumSingleton</span><span class="params">()</span> &#123;</span><br><span class="line">        value = <span class="number">1</span>;</span><br><span class="line">        System.out.println(<span class="string">&quot;INSTANCE now created!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getValue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setValue</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaofei.singleton;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å•ä¾‹æ¨¡å¼æµ‹è¯•</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SingletonTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">lazySingletonTest</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼ï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼‰&quot;</span>);</span><br><span class="line">        <span class="type">LazySingleton</span> <span class="variable">instance</span> <span class="operator">=</span> LazySingleton.getInstance();</span><br><span class="line">        System.out.println(instance);</span><br><span class="line">        System.out.println(<span class="string">&quot;æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼ï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼‰\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">safeLazySingleton</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰&quot;</span>);</span><br><span class="line">        <span class="type">SafeLazySingleton</span> <span class="variable">instance</span> <span class="operator">=</span> SafeLazySingleton.getInstance();</span><br><span class="line">        System.out.println(instance);</span><br><span class="line">        System.out.println(<span class="string">&quot;æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">hungrySingleton</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;é¥¿æ±‰å¼å•ä¾‹æ¨¡å¼&quot;</span>);</span><br><span class="line">        <span class="type">HungrySingleton</span> <span class="variable">instance</span> <span class="operator">=</span> HungrySingleton.getInstance();</span><br><span class="line">        System.out.println(instance);</span><br><span class="line">        System.out.println(<span class="string">&quot;é¥¿æ±‰å¼å•ä¾‹æ¨¡å¼\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doubleCheckSingleton</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;åŒé‡æ£€æŸ¥é”å•ä¾‹æ¨¡å¼&quot;</span>);</span><br><span class="line">        <span class="type">DoubleCheckSingleton</span> <span class="variable">instance</span> <span class="operator">=</span> DoubleCheckSingleton.getInstance();</span><br><span class="line">        System.out.println(instance);</span><br><span class="line">        System.out.println(<span class="string">&quot;åŒé‡æ£€æŸ¥é”å•ä¾‹æ¨¡å¼\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">staticInnerClassSingleton</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;é™æ€å†…éƒ¨ç±»å•ä¾‹æ¨¡å¼&quot;</span>);</span><br><span class="line">        <span class="type">StaticInnerClassSingleton</span> <span class="variable">instance</span> <span class="operator">=</span> StaticInnerClassSingleton.getInstance();</span><br><span class="line">        System.out.println(instance);</span><br><span class="line">        System.out.println(<span class="string">&quot;é™æ€å†…éƒ¨ç±»å•ä¾‹æ¨¡å¼\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">enumSingleton</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æšä¸¾å•ä¾‹æ¨¡å¼&quot;</span>);</span><br><span class="line">        <span class="type">EnumSingleton</span> <span class="variable">singleton</span> <span class="operator">=</span> EnumSingleton.INSTANCE;</span><br><span class="line">        System.out.println(singleton.getValue());</span><br><span class="line">        singleton.setValue(<span class="number">2</span>);</span><br><span class="line">        System.out.println(singleton.getValue());</span><br><span class="line">        System.out.println(<span class="string">&quot;æšä¸¾å•ä¾‹æ¨¡å¼\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://www.naste.top:9000/images/image-20230607151223998.png" alt="image-20230607151223998"></p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><ul><li>æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼(çº¿ç¨‹ä¸å®‰å…¨): <ul><li>ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œæ€§èƒ½å¥½ã€‚ </li><li>ç¼ºç‚¹ï¼šçº¿ç¨‹ä¸å®‰å…¨ï¼Œéœ€è¦åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹è¿›è¡ŒåŒæ­¥å¤„ç†ã€‚</li></ul></li><li>æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼(çº¿ç¨‹å®‰å…¨): <ul><li>ä¼˜ç‚¹ï¼šçº¿ç¨‹å®‰å…¨ï¼Œä¸éœ€è¦é¢å¤–çš„åŒæ­¥å¤„ç†ã€‚</li><li>ç¼ºç‚¹ï¼šå®ç°ç›¸å¯¹å¤æ‚ï¼Œæ€§èƒ½ç•¥å·®äºé¥¿æ±‰å¼å•ä¾‹æ¨¡å¼ã€‚</li></ul></li><li>é¥¿æ±‰å¼å•ä¾‹æ¨¡å¼ï¼š <ul><li>ä¼˜ç‚¹ï¼šçº¿ç¨‹å®‰å…¨ï¼Œæ€§èƒ½å¥½ã€‚ </li><li>ç¼ºç‚¹ï¼šåˆ›å»ºå®ä¾‹æ—¶ä¼šè€—è´¹ä¸€å®šçš„æ—¶é—´å’Œèµ„æºã€‚</li></ul></li><li>åŒé‡æ£€æŸ¥é”å•ä¾‹æ¨¡ï¼š <ul><li>ä¼˜ç‚¹ï¼šçº¿ç¨‹å®‰å…¨ï¼Œæ€§èƒ½å¥½ã€‚ </li><li>ç¼ºç‚¹ï¼šå®ç°ç›¸å¯¹å¤æ‚ã€‚</li></ul></li><li>é™æ€å†…éƒ¨ç±»å•ä¾‹æ¨¡å¼ï¼š <ul><li>ä¼˜ç‚¹ï¼šçº¿ç¨‹å®‰å…¨ï¼Œæ€§èƒ½å¥½ã€‚ </li><li>ç¼ºç‚¹ï¼šå®ç°ç›¸å¯¹å¤æ‚ã€‚</li></ul></li><li>æšä¸¾å•ä¾‹æ¨¡å¼ï¼š <ul><li>ä¼˜ç‚¹ï¼šçº¿ç¨‹å®‰å…¨ï¼Œæ€§èƒ½å¥½ã€‚ </li><li>ç¼ºç‚¹ï¼šæšä¸¾ç±»å‹æœ¬èº«ä¸èƒ½è¢«ä¿®æ”¹ï¼Œå› æ­¤å¦‚æœéœ€è¦æ‰©å±•åŠŸèƒ½åˆ™éœ€è¦ä¿®æ”¹æšä¸¾ç±»å‹ã€‚</li></ul></li></ul><p>ç»¼ä¸Šæ‰€è¿°ï¼Œä¸åŒçš„å•ä¾‹æ¨¡å¼é€‚ç”¨äºä¸åŒçš„åœºæ™¯ã€‚æ ¹æ®å®é™…çš„éœ€æ±‚é€‰æ‹©åˆé€‚çš„å•ä¾‹æ¨¡å¼å¯ä»¥æé«˜ç¨‹åºçš„æ•ˆç‡ï¼Œå¹¶ä¿è¯å•ä¾‹å®ä¾‹çš„å”¯ä¸€æ€§ã€‚</p>]]></content>
    
    
    <summary type="html">è®¾è®¡æ¨¡å¼-å•ä¾‹æ¨¡å¼</summary>
    
    
    
    
  </entry>
  
</feed>
